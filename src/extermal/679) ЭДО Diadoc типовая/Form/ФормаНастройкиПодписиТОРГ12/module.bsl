
Процедура ПриОткрытии()
	
	КартинкаЗаголовка= ЭДО_БиблиотекаКартинок().КартинкаЗаголовка;
	
	ЗаполнитьПодписи();
	УправлениеФормой();
	
КонецПроцедуры

Процедура УправлениеФормой()
	
	Если (НЕ ЗначениеЗаполнено(ФункцияУПД) ИЛИ НЕ ЗначениеЗаполнено(ПолучитьМодульПрог("Модуль_РаботаССерверомДиадок").СтрокаКонтекста(Организация).ОтпечатокСертификата))
		И ЭлементыФормы.ОсновныеДействияФормы.Кнопки.Найти("КнопкаНастроитьПараметрыПодписанияУПД") <> Неопределено Тогда
		ЭлементыФормы.ОсновныеДействияФормы.Кнопки.Удалить(ЭлементыФормы.ОсновныеДействияФормы.Кнопки.КнопкаНастроитьПараметрыПодписанияУПД);
		ЭлементыФормы.ОсновныеДействияФормы.Кнопки.Удалить(ЭлементыФормы.ОсновныеДействияФормы.Кнопки.Разделитель1);
	КонецЕсли;
	
	ЭлементыФормы.ТипПодписи.Доступность  = не ЗаполнятьВсеТриПодписи;
	ЭлементыФормы.ТипПодписи2.Доступность = не ЗаполнятьВсеТриПодписи;
	ЭлементыФормы.ТипПодписи3.Доступность = не ЗаполнятьВсеТриПодписи;
	
	Если ЗаполнятьВсеТриПодписи Тогда 
		
		ЭлементыФормы.Должность1.Доступность = Ложь;
		ЭлементыФормы.ФИО1.Доступность 		 = Ложь;
		Должность1 = ДолжностьПодписанта;
		ФИО1 = ФИОПодписанта;
		
		ЭлементыФормы.ФИО2.Доступность = Ложь;
		ФИО2 = ФИОПодписанта;
		
		ЭлементыФормы.ФИО3.Доступность 		 = Ложь;
		ЭлементыФормы.Должность3.Доступность = Ложь;
		ФИО3 = ФИОПодписанта;
		Должность3 = ДолжностьПодписанта;
		
	Иначе 	
		
		ВидимостьСтроки1 = (ТипПодписи=1);
		ВидимостьСтроки2 = (ТипПодписи=2);
		ВидимостьСтроки3 = (ТипПодписи=3);
	
		Элементыформы.Должность1.Доступность = Ложь;
		ЭлементыФормы.ФИО1.Доступность 		 = Ложь;
		Должность1 = ?(ВидимостьСтроки1, ДолжностьПодписанта, "");
		ФИО1 	   = ?(ВидимостьСтроки1, ФИОПодписанта,       "");
	
		ЭлементыФормы.ФИО2.Доступность 		 = Ложь;
		ФИО2 	   = ?(ВидимостьСтроки2, ФИОПодписанта,       "");
	
		Элементыформы.Должность3.Доступность = Ложь;
		ЭлементыФормы.ФИО3.Доступность 		 = Ложь;
		Должность3 = ?(ВидимостьСтроки3, ДолжностьПодписанта, "");
		ФИО3 	   = ?(ВидимостьСтроки3, ФИОПодписанта,       "");
		
	КонецЕсли;	
	
КонецПроцедуры	


Процедура ЗаполнитьПодписи()
	
	ПараметрыПодписания = ПолучитьМодульПрог("Модуль_Данные1С_СвязиОбъектов").ПолучитьПараметрыПодписанияТ12вДиадок(Организация);
	
	Если ПараметрыПодписания.СпособПодписания = "4" Тогда 
		Элементыформы.ТипПодписи.Значение = 1 ;
		ЗаполнятьВсеТриПодписи = Истина;
	ИначеЕсли ПараметрыПодписания.СпособПодписания = "2" Тогда 
		Элементыформы.ТипПодписи.Значение = 2 ;
	ИначеЕсли	ПараметрыПодписания.СпособПодписания = "3" Тогда 
		Элементыформы.ТипПодписи.Значение = 3;
		Должность3 = ПараметрыПодписания.ДолжностьПодписанта;
	Иначе 
		Элементыформы.ТипПодписи.Значение = 1;
		Должность1 = ПараметрыПодписания.ДолжностьПодписанта;
	КонецЕсли;	
	
	ФИОПодписанта =  ПараметрыПодписания.ФИОПодписанта;
    ДолжностьПодписанта =  ПараметрыПодписания.ДолжностьПодписанта;
	
	ДолжностьПодписантаСвойство = ПолучитьМодульПрог("Модуль_Данные1С_СвязиОбъектов").ПолучитьСвойствоДолжностьПодписанта();
	Если ЗначениеЗаполнено(ДолжностьПодписантаСвойство) 
		И (СокрЛП(ДолжностьПодписантаСвойство) <> СокрЛП(ДолжностьПодписанта)) Тогда
		Предупреждение("Должность пользователя больше не настраивается в 1С, теперь должность задается в свойствах пользователя в Диадоке", 120, "Диадок");
		ПолучитьМодульПрог("Модуль_Данные1С_СвязиОбъектов").СброситьСвойствоДолжностьПодписанта();
	КонецЕсли;

КонецПроцедуры	


Процедура ТипПодписиПриИзменении(Элемент)
	
	УправлениеФормой()
	
КонецПроцедуры

Процедура Должность1ПриИзменении(Элемент)
	
	ДолжностьПодписанта = Должность1;
	
	УправлениеФормой();
	
КонецПроцедуры

Процедура Должность3ПриИзменении(Элемент)
	
	ДолжностьПодписанта = Должность3;
	
КонецПроцедуры


Процедура КнопкаВыполнитьНажатие(Кнопка)
	
	Если (типПодписи<>2) и (ЗначениеЗаполнено(ДолжностьПодписанта)=Ложь)  Тогда 
		предупреждение("Не указана должность лица, подписывающего ТОРГ-12",, НаименованиеСистемы);
		Возврат;
	КонецЕсли;	
	
	параметрыПодписания = Новый Структура;
	параметрыПодписания.Вставить("ДолжностьПодписанта", ДолжностьПодписанта);
	параметрыПодписания.Вставить("СпособПодписания", формат(?(ЗаполнятьВсеТриПодписи, 4, ТипПодписи), "ЧЦ=1"));
	ПолучитьМодульПрог("Модуль_Данные1С_СвязиОбъектов").УстановитьПараметрыПодписанияТ12вДиадок(Организация,  параметрыПодписания);
	успех = Истина;
	Закрыть();
	
КонецПроцедуры

Процедура КнопкаНастроитьПараметрыПодписанияУПДНажатие(Кнопка)
	
	НоваяФорма = ПолучитьФорму("ФормаНастройкиПодписиУПД");
	НоваяФорма.Организация = Организация;
	НоваяФорма.Исходящие   = Истина;
	НоваяФорма.Открыть();
	
КонецПроцедуры


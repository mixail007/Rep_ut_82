
Процедура ПриОткрытии()
	
	КартинкаЗаголовка= ЭДО_БиблиотекаКартинок().КартинкаЗаголовка;
	
	ЗаполнитьПодписи();
	УправлениеФормой();
	
КонецПроцедуры

Процедура УправлениеФормой()
	
	Если (НЕ ЗначениеЗаполнено(ФункцияУПД) ИЛИ НЕ ЗначениеЗаполнено(ПолучитьМодульПрог("Модуль_РаботаССерверомДиадок").СтрокаКонтекста(Организация).ОтпечатокСертификата)) 
		И ЭлементыФормы.ОсновныеДействияФормы.Кнопки.Найти("КнопкаНастроитьПараметрыПодписанияУПД") <> Неопределено Тогда
		ЭлементыФормы.ОсновныеДействияФормы.Кнопки.Удалить(ЭлементыФормы.ОсновныеДействияФормы.Кнопки.КнопкаНастроитьПараметрыПодписанияУПД);
	КонецЕсли;
	
КонецПроцедуры


Процедура ЗаполнитьПодписи() 
	
	ПараметрыПодписания = ПолучитьМодульПрог("Модуль_Данные1С_СвязиОбъектов").ПолучитьПараметрыПодписанияТ12вДиадок(Организация);
	
	ФИО 	  =  ПараметрыПодписания.ФИОПодписанта;
	Должность =  ПараметрыПодписания.ДолжностьПодписанта;
	
	ДолжностьПодписантаСвойство = ПолучитьМодульПрог("Модуль_Данные1С_СвязиОбъектов").ПолучитьСвойствоДолжностьПодписанта();
	Если ЗначениеЗаполнено(ДолжностьПодписантаСвойство) 
		И (СокрЛП(ДолжностьПодписантаСвойство) <> СокрЛП(Должность)) Тогда
		Предупреждение("Должность пользователя больше не настраивается в 1С, теперь должность задается в свойствах пользователя в Диадоке", 120, "Диадок");
		ПолучитьМодульПрог("Модуль_Данные1С_СвязиОбъектов").СброситьСвойствоДолжностьПодписанта();
	КонецЕсли;
	
КонецПроцедуры	


Процедура КнопкаВыполнитьНажатие(Кнопка)
	Если (ЗначениеЗаполнено(Должность)=Ложь)  Тогда 
		предупреждение("Не указана должность лица, подписывающего Акт выполненных работ.",, НаименованиеСистемы);
		Возврат;
	КонецЕсли;	
	// Вставить содержимое обработчика.
	параметрыПодписания = Новый Структура;
	параметрыПодписания.Вставить("ДолжностьПодписанта", Должность);
	ПолучитьМодульПрог("Модуль_Данные1С_СвязиОбъектов").УстановитьПараметрыПодписанияТ12вДиадок(Организация,  параметрыПодписания);
	Успех = Истина;
	Закрыть();
КонецПроцедуры

Процедура КнопкаНастроитьПараметрыПодписанияУПДНажатие(Кнопка)
	
	НоваяФорма = ПолучитьФорму("ФормаНастройкиПодписиУПД");
	НоваяФорма.Организация = Организация;
	НоваяФорма.Исходящие   = Истина;
	НоваяФорма.Открыть();
	
КонецПроцедуры

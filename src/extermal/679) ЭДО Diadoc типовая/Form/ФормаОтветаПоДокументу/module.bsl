// Режим формы задает контекст использования:
//1 - Отказ в подписи
//2 - Согласовани
//3 - Отказ в согласовании
//4 - Отказ в аннулировании
//5 - Запрос аннулирования
//6 - Аннулирование документа

Процедура ПриОткрытии()
	
	КартинкаЗаголовка= ЭДО_БиблиотекаКартинок().КартинкаЗаголовка;
	
	УправлениеФормой();
	
КонецПроцедуры

Процедура КнопкаВыполнитьНажатие(Кнопка)
	
	Если ПустаяСтрока(Комментарий) И РежимФормы = 1 Тогда
		Предупреждение("Укажите причину отказа.",, НаименованиеСистемы);
	Иначе 
		Результат = Истина;
		Закрыть();
	КонецЕсли;	
	
КонецПроцедуры

Процедура УправлениеФормой()
	
	НастроитьФормуПоРежиму();
	СвернутьРазвернутьПанели();
	ЗаполнитьЗаголовокНадписиДополнительныеДокументыНаПодпись();
	
КонецПроцедуры

Процедура НастроитьФормуПоРежиму()
	
	Если РежимФормы = 1 Тогда
		
		Заголовок = "Отказ в подписи";
		Элементыформы.НадписьКомментарий.Заголовок = "Комментарий по отказу";
		
		Если КоличествоДокументовНаОбработку > 1 Тогда
			ЭлементыФормы.ОсновныеДействияФормы.Кнопки.КнопкаВыполнить.Текст= "Отказать по " + КоличествоДокументовНаОбработку + " " + РезультатСклоненияСловаДокументВариант2(КоличествоДокументовНаОбработку);
		Иначе
			Элементыформы.НадписьЗаголовок.Заголовок= "Отказ в подписи";
		КонецЕсли;
		
	ИначеЕсли РежимФормы = 2 Тогда
		
		Заголовок = "Согласование";
		Элементыформы.НадписьЗаголовок.Заголовок = "Согласование";
		Элементыформы.НадписьКомментарий.Заголовок = "Комментарий к согласованию";
		
		Если КоличествоДокументовНаОбработку > 1 Тогда
			ЭлементыФормы.ОсновныеДействияФормы.Кнопки.КнопкаВыполнить.Текст= "Согласовать " + КоличествоДокументовНаОбработку + " " + РезультатСклоненияСловаДокументВариант1(КоличествоДокументовНаОбработку);
		Иначе
			Элементыформы.ОсновныеДействияФормы.Кнопки.КнопкаВыполнить.Текст = "Согласовать";
		КонецЕсли;
		
		УстановитьРежимСверткиЭлементаУправления(ЭлементыФормы.ПанельПодписи, РежимСверткиЭлементаУправления.Низ);
		
	ИначеЕсли РежимФормы = 3 Тогда
		Заголовок = "Отказ в согласовании";
		Элементыформы.НадписьЗаголовок.Заголовок = "Отказ в согласовании";
		Элементыформы.НадписьКомментарий.Заголовок = "Комментарий по отказу";
		Элементыформы.ОсновныеДействияФормы.Кнопки.КнопкаВыполнить.Текст = "Отказать в согласовании";
		УстановитьРежимСверткиЭлементаУправления(ЭлементыФормы.ПанельПодписи, РежимСверткиЭлементаУправления.Низ);
	ИначеЕсли РежимФормы = 4 Тогда
		Заголовок = "Отказ в аннулировании";
		Элементыформы.НадписьЗаголовок.Заголовок = "Отказать в аннулировании?";
		Элементыформы.НадписьКомментарий.Заголовок = "Комментарий по отказу";
		Элементыформы.ОсновныеДействияФормы.Кнопки.КнопкаВыполнить.Текст = "Отказать в аннулировании";
		Элементыформы.ОсновныеДействияФормы.Кнопки.КнопкаВыполнить.Картинка=		ЭДО_БиблиотекаКартинок().КартинкаОтказатьВПодписи;
		Элементыформы.ОсновныеДействияФормы.Кнопки.КнопкаВыполнить.Отображение=	ОтображениеКнопкиКоманднойПанели.НадписьКартинка;
		ЭлементыФормы.ОтказБудетподписан.Заголовок=	"Отказ в аннулировании будет подписан:";
	ИначеЕсли РежимФормы = 5 Тогда
		Заголовок = "Запрос аннулирования";
		Элементыформы.НадписьЗаголовок.Заголовок = "Запросить аннулирование?";
		Элементыформы.НадписьКомментарий.Заголовок = "Комментарий по запросу";
		Элементыформы.ОсновныеДействияФормы.Кнопки.КнопкаВыполнить.Текст = "Запросить аннулирование";
		Элементыформы.ОсновныеДействияФормы.Кнопки.КнопкаВыполнить.Картинка=		ЭДО_БиблиотекаКартинок().КартинкаОтказатьВПодписи;
		Элементыформы.ОсновныеДействияФормы.Кнопки.КнопкаВыполнить.Отображение=	ОтображениеКнопкиКоманднойПанели.НадписьКартинка;
		ЭлементыФормы.ОтказБудетподписан.Заголовок=	"Соглашение об аннулировании будет подписано:";
	ИначеЕсли РежимФормы = 6 Тогда
		Заголовок = "Аннулирование документа";
		Элементыформы.НадписьЗаголовок.Заголовок = "Аннулировать документ?";
		Элементыформы.НадписьКомментарий.Заголовок = "Комментарий к аннулированию";
		Элементыформы.ОсновныеДействияФормы.Кнопки.КнопкаВыполнить.Текст = "Аннулировать";
		Элементыформы.ОсновныеДействияФормы.Кнопки.КнопкаВыполнить.Картинка=		ЭДО_БиблиотекаКартинок().КартинкаОтказатьВПодписи;
		Элементыформы.ОсновныеДействияФормы.Кнопки.КнопкаВыполнить.Отображение=	ОтображениеКнопкиКоманднойПанели.НадписьКартинка;
		ЭлементыФормы.ОтказБудетподписан.Заголовок=	"Соглашение об аннулировании будет подписано:";
	КонецЕсли;
	
КонецПроцедуры

Процедура СвернутьРазвернутьПанели()
	
	Если КоличествоДокументовНаОбработку = 1 ИЛИ РежимФормы > 2 Тогда
		УстановитьРежимСверткиЭлементаУправления(ЭлементыФормы.ПанельДополнительныеДокументыНаПодпись, РежимСверткиЭлементаУправления.Верх);
	ИначеЕсли КоличествоДокументовНаОбработку > 1 Тогда
		Если ЭлементыФормы.НадписьДополнительныеДокументыНаПодпись.Высота <> 28 Тогда
			ЭлементыФормы.НадписьДополнительныеДокументыНаПодпись.Высота= 28;
		КонецЕсли;
		Если ЭлементыФормы.ПанельДополнительныеДокументыНаПодпись.Высота <> 33 Тогда
			ЭлементыФормы.ПанельДополнительныеДокументыНаПодпись.Высота= 33;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

Процедура ЗаполнитьЗаголовокНадписиДополнительныеДокументыНаПодпись()
	
	Если РежимФормы = 1 Тогда
		
		Если КоличествоДокументовНаОбработку = 0 Тогда
			ЭлементыФормы.НадписьДополнительныеДокументыНаПодпись.Заголовок= 
			"Среди выбранных могут быть документы из пакетов, по которым отправитель запретил обработку по отдельности. Такие пакеты будут отказаны в подписи целиком.";
		ИначеЕсли КоличествоДокументовНаОбработку > 1 Тогда
			ЭлементыФормы.НадписьДополнительныеДокументыНаПодпись.Заголовок= 
			"Вместе с выбранным документом будет отказано в подписи еще по " + (КоличествоДокументовНаОбработку-1) + " " + РезультатСклоненияСловаДокументВариант2(КоличествоДокументовНаОбработку-1) + " из пакета, по которому отправитель запретил обработку по отдельности.";
		КонецЕсли;
		
	ИначеЕсли РежимФормы = 2 Тогда
		
		Если КоличествоДокументовНаОбработку = 0 Тогда
			ЭлементыФормы.НадписьДополнительныеДокументыНаПодпись.Заголовок= 
			"Среди выбранных могут быть документы из пакетов, по которым отправитель запретил обработку по отдельности. Такие пакеты будут согласованы целиком.";
		ИначеЕсли КоличествоДокументовНаОбработку > 1 Тогда
			ЭлементыФормы.НадписьДополнительныеДокументыНаПодпись.Заголовок= 
			"Вместе с выбранным будут согласованы еще " + (КоличествоДокументовНаОбработку-1) + " " + РезультатСклоненияСловаДокументВариант1(КоличествоДокументовНаОбработку-1) + " из пакета, по которому отправитель запретил обработку по отдельности.";
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

Функция РезультатСклоненияСловаДокументВариант1(Знач Числительное)
	
	Числительное= Число(Прав(Формат(Числительное, "ЧГ="), 2));
	
	Если Числительное > 19 Тогда
		Числительное= Число(Прав(Формат(Числительное, "ЧГ="), 1));
	КонецЕсли;
	
	Если Числительное = 1 Тогда
		Возврат "документ";
	ИначеЕсли Числительное >= 2 И Числительное <= 4 Тогда
		Возврат "документа";
	ИначеЕсли Числительное = 0 ИЛИ Числительное >= 5 И Числительное <= 19 Тогда
		Возврат "документов";
	КонецЕсли;	
	
КонецФункции

Функция РезультатСклоненияСловаДокументВариант2(Числительное)
	
	Если Числительное = 1 Тогда
		Возврат "документу";
	Иначе
		Возврат "документам";
	КонецЕсли;
			
КонецФункции

Процедура КомментарийОткрытие(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка= Ложь;
КонецПроцедуры

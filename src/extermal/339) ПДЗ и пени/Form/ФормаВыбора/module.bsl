
Процедура Надпись1Нажатие(Элемент)
	Клиент.ПолучитьФорму().Открыть();
	ЭтаФорма.Закрыть();
КонецПроцедуры

Процедура Надпись2Нажатие(Элемент)
	ТД = ПолучитьТаблицуЗвонковЛ(3, Клиент, ДатаНачТ, ДатаКонТ);
	ТД.Открыть();
	ЭтаФорма.Закрыть();

КонецПроцедуры

Процедура Надпись3Нажатие(Элемент)
	
   // Если Дебеторская <> 1 тогда
   //	Предупреждение("Графики строятся ТОЛЬКО по Дебиторской задолженности!", 10);
   //	возврат;
   //КонецЕсли;	   
	
   формаГрафик = ПолучитьФорму("ОтчетГрафик");
   формаГрафик.ФлМен = Ложь;
   формаГрафик.ответственноеЛицо = справочники.Пользователи.ПустаяСсылка();
   
   формаГрафик.Контрагент1 = Клиент;
   формаГрафик.ФлКонтр = Истина;
   // НачДата1 = ?(ДеньНедели(ЭтаФорма.ДатаНач)=1, ЭтаФорма.ДатаНач, ЭтаФорма.ДатаНач - (ДеньНедели(ЭтаФорма.ДатаНач) - 1)*86400 );
   формаГрафик.НачДата = ЭтаФорма.ДатаНач;
   формаГрафик.КонДата = КонецДня(ЭтаФорма.ДатаКон)+1;
   формаГрафик.Открыть();
   формаГрафик.отчетВывести();

   	ЭтаФорма.Закрыть();

КонецПроцедуры



Функция ПолучитьТаблицуЗвонковЛ (ТипЗвонка = 3,Клиент,ДатаНачала,ДатаОкончания) Экспорт
	
	   
   ///+++НОВАЯ ВЕРСИЯ ПО 281 ОТЧЕТУ 31.05.2018 
   Исходящие = ложь;
   Входящие = ложь;
   НачПериода  = ДатаНачала;
   КонПериода  = ДатаОкончания;
   ТолькоВнешние = ложь;
   ТолькоКлиенты = истина;
   НеЗаполнен = ложь;
   глТекущийПользователь = ПараметрыСеанса.ТекущийПользователь;
   
   	Начало=ТекущаяДата();
	
	ТЗИтог = Новый ТаблицаЗначений;
	
	ТЗИтог.Колонки.Добавить("Дата");
	ТЗИтог.Колонки.Добавить("Абонент");
	ТЗИтог.Колонки.Добавить("Продолжительность");
	ТЗИтог.Колонки.Добавить("Тип");
	ТЗИтог.Колонки.Добавить("Телефон");
	
	#Если Клиент тогда
	Состояние("Идёт поиск всех телефонов сотрудников и клиентов...");	
	#КонецЕсли
	Запрос = Новый запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ВЫБОР
	               |		КОГДА ТИПЗНАЧЕНИЯ(КонтактнаяИнформация.Объект) = ТИП(Справочник.КонтактныеЛица)
	               |				И ТИПЗНАЧЕНИЯ(КонтактнаяИнформация.Объект.ОбъектВладелец) = ТИП(Справочник.Контрагенты)
	               |			ТОГДА КонтактнаяИнформация.Объект.ОбъектВладелец
	               |		ИНАЧЕ КонтактнаяИнформация.Объект
	               |	КОНЕЦ КАК Объект,
	               |	ЕстьNull(КонтактнаяИнформация.Представление,"""") как Представление
	               |ИЗ
	               |	РегистрСведений.КонтактнаяИнформация КАК КонтактнаяИнформация
	               |ГДЕ
	               |	КонтактнаяИнформация.Тип = Значение(Перечисление.ТипыКонтактнойИнформации.Телефон)
				   |	И ЕстьNull(КонтактнаяИнформация.Представление,"""") ПОДОБНО (""%___"") ";
	Обработать = Запрос.Выполнить().Выгрузить();
	
	Телефоны = новый ТаблицаЗначений;
	для каждого кол1 из Обработать.Колонки цикл
		Телефоны.Колонки.Добавить( кол1.Имя, кол1.ТипЗначения, кол1.Заголовок, кол1.Ширина);
	КонецЦикла;
	
	КС = Новый КвалификаторыСтроки(6);
	Массив = Новый Массив;
	Массив.Добавить(Тип("Строка"));
	ОписаниеТиповС = Новый ОписаниеТипов(Массив, , КС);
	Телефоны.Колонки.Добавить("Поиск",ОписаниеТиповС);
	
	//Телефоны.Очистить();
	#Если Клиент тогда
	Состояние("Идёт обработка "+строка(Обработать.Количество())+" телефонов сотрудников и клиентов...");	
	#КонецЕсли
	Для каждого стр из Обработать Цикл
		//ОбработкаПрерыванияПользователя();
		Строка = Стр.Представление;
		Строка = СтрЗаменить(Строка,"(","");
		Строка = СтрЗаменить(Строка,")","");
		Строка = СтрЗаменить(Строка,"-","");
		Строка = СтрЗаменить(Строка," ","");
		Строка = СтрЗаменить(Строка,":","");
		
		Строка = СтрЗаменить(Строка,"+7","8"); //27.04.2017
		Строка = СтрЗаменить(Строка,"доб.",",#");     //+7 (495) 775-91-75 доб. 1-16-24, +7 (985) 234-20-52
		Строка = СтрЗаменить(Строка,"вн.",",#");     // 8 (727) 311-12-24 (вн.7103)
		
		Строка = СтрЗаменить(Строка,"и",",");
		Строка = СтрЗаменить(Строка,".",",");
		Строка = СтрЗаменить(Строка,";",",");
		
		ТекущаяСтрока = СтрЗаменить(Строка, ",", Символы.ПС);
		Для Счетчик = 1 По СтрЧислоСтрок(ТекущаяСтрока) Цикл
			стр1 = СокрЛП(СтрПолучитьСтроку(ТекущаяСтрока, Счетчик));
			Если СтрДлина(стр1)> 2 и найти(стр1,"#")=0 Тогда //от 3х символов и без внутренних!
				
				Если типЗнч(стр.Объект)=тип("СправочникСсылка.Контрагенты") и СтрДлина(стр1)<5 тогда
					продолжить; // вн.номера сотрудников контрагентов 
				КонецЕсли;
				
				Нов = Телефоны.Добавить();
				Нов.Объект = стр.Объект;
				Нов.Поиск = Прав(стр1,6);
			КонецЕсли;
		КонецЦикла;
		//стр.Поиск = Строка;
	КонецЦикла;
	
	
	Тип = 0;
	
	Если Исходящие Тогда
		Тип = 1;
	ИначеЕсли Входящие тогда
		тип = 2;
	КонецЕсли;
	
	
	ЗапросМобильные = Новый Запрос;
	//ЗапросМобильные.УстановитьПараметр("Клиент",Клиент);
	ЗапросМобильные.УстановитьПараметр("Телефоны",Телефоны);
	ЗапросМобильные.УстановитьПараметр("ДатаН",НачалоДня(НачПериода));
	ЗапросМобильные.УстановитьПараметр("ДатаК",КонецДня(КонПериода));
	ЗапросМобильные.УстановитьПараметр("Тип",Тип);
	ЗапросМобильные.УстановитьПараметр("ТолькоВнешние",ТолькоВнешние);
	ЗапросМобильные.УстановитьПараметр("ТолькоКлиенты",ТолькоКлиенты);
	ЗапросМобильные.УстановитьПараметр("ФактАдрес",Справочники.ВидыКонтактнойИнформации.ФактАдресКонтрагента);
	
	ЗапросМобильные.Текст = "
	|ВЫБРАТЬ
	|КонтактнаяИнформация.Объект,
	|КонтактнаяИнформация.Поле2
	|ПОМЕСТИТЬ Регионы
	|ИЗ
	|РегистрСведений.КонтактнаяИнформация КАК КонтактнаяИнформация
	|ГДЕ
	|ТИПЗНАЧЕНИЯ(КонтактнаяИнформация.Объект) = ТИП(Справочник.Контрагенты)
	|И КонтактнаяИнформация.Вид = &ФактАдрес
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	НАЧАЛОПЕРИОДА(Журнал.Дата, ДЕНЬ) КАК День,
	|	Журнал.ПоискСотрудник КАК НомерСотрудника,
	|	Журнал.ПоискАбонент КАК НомерАбонента,
	|	Журнал.ДлительностьЗвонка,
	|	Журнал.Исход_Вход,
	|	Журнал.НомерАбонента КАК НомерАбонента1,
	|	Журнал.Дата КАК ДеньВремя,
	|	Журнал.НомерСотрудника КАК НомерСотр,
	|	Журнал.Ссылка
	|ПОМЕСТИТЬ Журнал
	|ИЗ
	|	РегистрСведений.ЖурналЗвонков КАК Журнал
	|ГДЕ
	|	Журнал.Дата МЕЖДУ &ДатаН И &ДатаК
	
	//20.04.2017	
	|//ТолькоСвой   И ( Журнал.ПоискСотрудник В (&СвоиТелефоны)  )
	//ИЛИ Журнал.НомерАбонента В (&СвоиТелефоны) 
	|				  
	|	и Журнал.НомерСотрудника <> ""117""
	|   И Журнал.НомерАбонента <> ""117""
	
	|	и Журнал.НомерСотрудника <> ""220""
	|   И Журнал.НомерАбонента <> ""220""
	
	|   И Журнал.ПоискСотрудник <> ""009797""
	|   И Журнал.ПоискАбонент <> ""009797""
	
	|   И ВЫБОР
	|       КОГДА &толькоВнешние = ИСТИНА или &ТолькоКлиенты
	|	    ТОГДА Журнал.НомерАбонента ПОДОБНО ""%_____""
	|       ИНАЧЕ ИСТИНА
	|   КОНЕЦ
	
	//26.04.2017 - для ускорения вывода только по себе... эти условия НЕ нужны!	
	|//НеТолькоСвой
	|
	//+++ 26.04.2017
	|ИНДЕКСИРОВАТЬ ПО 
	|	НомерСотрудника, НомерАбонента
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Телефоны.Объект,
	|	Телефоны.Поиск КАК Представление
	|ПОМЕСТИТЬ Телефоны
	|ИЗ
	|	&Телефоны КАК Телефоны
	|ГДЕ 
	|   Телефоны.Поиск<>""""
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Представление
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Журнал.НомерСотрудника КАК Абонент,
	|	МАКСИМУМ(Журнал.НомерАбонента1) КАК Номер,
	|	Журнал.ДлительностьЗвонка КАК BillSec,
	|	ВЫБОР
	|		КОГДА Журнал.Исход_Вход = ""Исходящий""
	|			ТОГДА ""Исходящий >>""
	|		ИНАЧЕ ""<< Входящий""
	|	КОНЕЦ КАК Входящий,
	|	МАКСИМУМ(Телефоны.Объект) КАК АбонентФизЛицо,
	|	ВЫБОР
	|		КОГДА Журнал.ДлительностьЗвонка < 1
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК Пропущен,
	|	Журнал.День,
	|	Журнал.ДеньВремя,
	|	Журнал.НомерСотр,
	|	//РР Журнал.Ссылка,
	//21.03.2017
	|	Пользователи.НаправлениеПродаж,
	|	МАКСИМУМ(Телефоны1.Объект) КАК Объект
	|ПОМЕСТИТЬ БезГрупп
	|ИЗ
	|	Журнал КАК Журнал
	
	|		ЛЕВОЕ СОЕДИНЕНИЕ (выбрать * из Телефоны как ТелФизЛиц
	|							ГДЕ ТелФизЛиц.Объект ссылка справочник.ФизическиеЛица ) КАК Телефоны 
	|		ПО Журнал.НомерСотрудника = Телефоны.Представление
	
	|		ЛЕВОЕ СОЕДИНЕНИЕ Телефоны КАК Телефоны1
	|		ПО Журнал.НомерАбонента = Телефоны1.Представление
	
	|		ЛЕВОЕ СОЕДИНЕНИЕ (выбрать различные п.ФизЛицо, п.НаправлениеПродаж
	|		из справочник.Пользователи как п) как Пользователи
	|		ПО (Телефоны.Объект = Пользователи.ФизЛицо )
	
	|ГДЕ
	|       ВЫБОР
	|		     КОГДА Журнал.НомерСотрудника ПОДОБНО ""______""
	|			     ТОГДА НЕ Телефоны.Объект ЕСТЬ NULL 
	|		     ИНАЧЕ ИСТИНА
	|	    КОНЕЦ
	|     и ВЫБОР
	|            КОГДА &Тип = 1
	|	            ТОГДА Журнал.Исход_Вход = ""Исходящий""
	|            КОГДА &Тип = 2
	|	            ТОГДА Журнал.Исход_Вход = ""Входящий""
	|            ИНАЧЕ ИСТИНА
	|        КОНЕЦ
	|     и  ВЫБОР
	//+++  &НеЗаполнен 
	|			КОГДА &НеЗаполнен 	   
	|	           ТОГДА ( Телефоны1.Объект есть Null ) 
	|					или (&ТолькоКлиенты и выразить(Телефоны1.Объект как Справочник.Контрагенты) = Значение(Справочник.Контрагенты.ПустаяСсылка))
	|					или (&ТолькоКлиенты=ЛОЖЬ И выразить(Телефоны1.Объект как Справочник.Контрагенты) = Значение(Справочник.ФизическиеЛица.ПустаяСсылка))
	
	//+++  Заполнен и Только Клиенты 
	|            КОГДА &ТолькоКлиенты = ИСТИНА и &НеЗаполнен = ЛОЖЬ
	|	           ТОГДА ТИПЗНАЧЕНИЯ(Телефоны1.Объект) = ТИП(Справочник.Контрагенты)
	
	|            ИНАЧЕ ИСТИНА
	|        КОНЕЦ
	|
	|СГРУППИРОВАТЬ ПО
	//21.03.2017
	|	Пользователи.НаправлениеПродаж,
	|	Журнал.НомерСотрудника,
	|	Журнал.ДлительностьЗвонка,
	|	Журнал.День,
	|	Журнал.ДеньВремя,
	|	Журнал.НомерСотр,
	|	ВЫБОР
	|		КОГДА Журнал.Исход_Вход = ""Исходящий""
	|			ТОГДА ""Исходящий >>""
	|		ИНАЧЕ ""<< Входящий""
	|	КОНЕЦ
	|   //AA, Журнал.Ссылка
	|;
	|////////////////////////////////////////////////////////////////////////////////
	|
	|ВЫБРАТЬ
	|	БезГрупп.АбонентФизЛицо как Абонент,
	|	СУММА(БезГрупп.BillSec) КАК BillSec
	|ПОМЕСТИТЬ Групп
	|ИЗ
	|	БезГрупп КАК БезГрупп
	|
	|СГРУППИРОВАТЬ ПО
	|	БезГрупп.АбонентФизЛицо
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Телефоны.Объект,
	|	МАКСИМУМ(Телефоны.Представление) КАК Представление
	|ПОМЕСТИТЬ ТолькоВнутренние
	|ИЗ
	|	Телефоны КАК Телефоны
	|ГДЕ
	|	Телефоны.Представление ПОДОБНО ""___""
	|
	|СГРУППИРОВАТЬ ПО
	|	Телефоны.Объект
	|;
	|
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВЫБОР
	|		КОГДА БезГрупп.Абонент ПОДОБНО ""%_____""
	|			ТОГДА ЕСТЬNULL(ТолькоВнутренние.Представление, БезГрупп.Абонент)
	|       КОГДА БезГрупп.Абонент = ""999""
	|			ТОГДА ""Яршинторг""
	|		ИНАЧЕ БезГрупп.Абонент
	|	КОНЕЦ КАК Абонент,
	|	БезГрупп.Номер,
	|	БезГрупп.BillSec,
	|	БезГрупп.Входящий,
	|	БезГрупп.АбонентФизЛицо,
	|	БезГрупп.Пропущен,
	|	БезГрупп.День,
	|	БезГрупп.ДеньВремя,
	|	БезГрупп.НомерСотр,
	|	ВЫБОР
	|       КОГДА БезГрупп.Абонент = ""999""
	|			ТОГДА ""Пропущенные""
	|		ИНАЧЕ БезГрупп.НаправлениеПродаж
	|	КОНЕЦ КАК НаправлениеПродаж,
	//|	БезГрупп.НаправлениеПродаж,
	|	БезГрупп.Объект,
	|   БезГрупп.Ссылка,
	|	Групп.BillSec КАК ОбщТрафик,
	|    ВЫБОР
	|		КОГДА БезГрупп.Абонент ПОДОБНО ""%_____""
	|			ТОГДА ""Сот.*""+БезГрупп.Абонент
	|		ИНАЧЕ     ""Вн.""+БезГрупп.Абонент
	|	КОНЕЦ КАК ТипТелефона,
	|Регионы.Поле2 КАК Регион
	|ИЗ
	|	БезГрупп КАК БезГрупп
	|		ЛЕВОЕ СОЕДИНЕНИЕ Групп КАК Групп
	|		ПО БезГрупп.АбонентФизЛицо = Групп.Абонент
	
	|        ЛЕВОЕ СОЕДИНЕНИЕ ТолькоВнутренние КАК ТолькоВнутренние
	|		ПО БезГрупп.АбонентФизЛицо = ТолькоВнутренние.Объект
	|ЛЕВОЕ СОЕДИНЕНИЕ Регионы КАК Регионы
	|		ПО БезГрупп.Объект = Регионы.Объект
	|   ГДЕ БезГрупп.Объект = &Клиент";  

	//+++ 20.04.2017 Только свой телефон
	ЗапросМобильные.УстановитьПараметр("Клиент",Клиент);
	ЗапросМобильные.УстановитьПараметр("НеЗаполнен",НеЗаполнен);
	
услИсключенение = ( СокрЛП(глТекущийПользователь.Код) = "Лапенков" 
				или СокрЛП(глТекущийПользователь.Код) = "Малышев"
				или СокрЛП(глТекущийПользователь.Код) = "Серков" 
				или СокрЛП(глТекущийПользователь.Код) = "Аверкина" 
				или СокрЛП(глТекущийПользователь.Код) = "Голубева В.С."
				или СокрЛП(глТекущийПользователь.Код) = "Филатова С.В."
				
				или СокрЛП(глТекущийПользователь.Код) = "Бондаренко Е.Д. (снабжение)" 
				
				или СокрЛП(глТекущийПользователь.ФизЛицо.Код) =  "С2305" // Марешева  - несколько пользователей на 1 физ.лице	
				или СокрЛП(глТекущийПользователь.Код) = "Лигута А.С."                    // есть ограничение в доп. отборе
				или СокрЛП(глТекущийПользователь.Код) = "Лигута А.С.(руководитель)"      // есть ограничение в доп. отборе
				или СокрЛП(глТекущийПользователь.Код) = "Красюк Н.В."                    // есть ограничение в доп. отборе
				или СокрЛП(глТекущийПользователь.Код) = "Красюк Н.В.(руководитель)"      // есть ограничение в доп. отборе
			
				или РольДоступна("ПравоЗавершенияРаботыПользователей") // IT-отдел !  с 26.04.2017
				  );
				  
	Если ЗначениеЗаполнено(глТекущийПользователь.направлениеПродаж) 
		И НЕ ( услИсключенение ) тогда
		СвойТелефон = "";
		СвоиТелефоны = новый СписокЗначений;
		
		Если ЗначениеЗаполнено(глТекущийПользователь.ФизЛицо) тогда
			СвойТелефон = получитьВнутреннийТелефон(глТекущийПользователь.ФизЛицо);
			СвойТелефон = сокрЛП(СвойТелефон);
			СвойТелефон = стрЗаменить(СвойТелефон,"-","");  //10-08
			Если СвойТелефон<>"" тогда
				СвоиТелефоны.Добавить(СвойТелефон);
			КонецЕсли;
			
			СвойТелефон2 = получитьВнутреннийТелефон(глТекущийПользователь.ФизЛицо,"00022"); //Сотовый
			Если СвойТелефон2<>"" тогда
				ОбработкаОбъект.ОбрезатьНомер(СвойТелефон2);
				СвоиТелефоны.Добавить(СвойТелефон2);
			КонецЕсли;
			
			СвойТелефон2 = получитьВнутреннийТелефон(глТекущийПользователь.ФизЛицо,"00024"); //Сотовый 2
			Если СвойТелефон2<>"" тогда
				ОбработкаОбъект.ОбрезатьНомер(СвойТелефон2);
				СвоиТелефоны.Добавить(СвойТелефон2);
			КонецЕсли;
		Иначе
			СвойТелефон2 = получитьВнутреннийТелефон(глТекущийПользователь, "38841"); // телефон сотрудника!
			Если СвойТелефон2<>"" тогда
				ОбработкаОбъект.ОбрезатьНомер(СвойТелефон2);
				СвоиТелефоны.Добавить(СвойТелефон2);
			КонецЕсли;
		КонецЕсли;
		
		Если СвоиТелефоны.Количество()=0 тогда
			Если ЗначениеЗаполнено(глТекущийПользователь.ФизЛицо) тогда 
			#Если Клиент тогда	
			Предупреждение("У Вас - Не задан ""Внутренний телефон"" в настройках Физ.лица!
		   |Формирование отчета - не возможно!", 60);
		   #КОНЕЦЕсли
		   
	   Иначе   
		   #Если Клиент тогда	
			Предупреждение("У Вас - Не задан ""Телефон сотрудника"" в настройках Пользователя
						   |       И нет привязки пользователя к физ.лицу!
						   |        Формирование отчета - не возможно!", 60);
			#КОНЕЦЕсли
			КонецЕсли;
			Возврат Неопределено;
		КонецЕсли;			   
			
		ЗапросМобильные.УстановитьПараметр("СвоиТелефоны",СвоиТелефоны);
		ЗапросМобильные.Текст = стрЗаменить(ЗапросМобильные.Текст ,"//ТолькоСвой","");
		
//------------------------прослушка---------------------------------
		ЗапросМобильные.Текст = СтрЗаменить(ЗапросМобильные.Текст,"//РР","");
		ЗапросМобильные.Текст = СтрЗаменить(ЗапросМобильные.Текст,"//AA","");
	ИНАЧЕ
		
	
	КонецЕсли;//Только свой телефон

//------------------------прослушка всех---------------------------------
	если услИсключенение тогда
		ЗапросМобильные.Текст = СтрЗаменить(ЗапросМобильные.Текст,"//РР","");
		ЗапросМобильные.Текст = СтрЗаменить(ЗапросМобильные.Текст,"//AA","");
	Иначе
		ЗапросМобильные.Текст = СтрЗаменить(ЗапросМобильные.Текст,"//РР Журнал.Ссылка","""1"" КАК Ссылка");
		ЗапросМобильные.Текст = СтрЗаменить(ЗапросМобильные.Текст,"//AA","");
	КонецЕсли;
	
	
	#Если Клиент тогда
	Состояние("Идёт обработка звонков по условиям. Пожалуйста подождите...");	
	#КонецЕсли
	Рез1 = ЗапросМобильные.Выполнить();
	#Если Клиент тогда
	Состояние("Идёт вывод звонков по условиям...");	
	#КонецЕсли
	Рез = Рез1.Выгрузить();
	
	//ВыполнитьДополнительныйОтборПоМенеджерам(Рез);
	
	//Связь между таблицей значений и именами в СКД ВнешниеНаборыДанных = Новый Структура;
	#Если Клиент тогда
	Состояние("Идёт обработка условий отбора по "+строка(Рез.Количество())+" звонкам...");	
	#КонецЕсли
   
   ///---НОВАЯ ВЕРСИЯ ПО 281 ОТЧЕТУ 31.05.2018
   
   Рез.Сортировать("ДеньВремя Возр");

   
		ТабДокумент = Новый ТабличныйДокумент;
		ТабДокумент.ОтображатьСетку = Ложь;
		макет = ОбработкаОбъект.ПолучитьМакет( "Звонки");
		Область = Макет.ПолучитьОбласть("Шапка");
        ТабДокумент.Вывести(Область);
		
		Для каждого стр из Рез Цикл
			Если стр.BillSec>=90 тогда      //если продолжительность > 90 сек
				Строка = Макет.ПолучитьОбласть("Строка");
				Строка.Параметры.Дата = стр.ДеньВремя;
				Строка.Параметры.Абонент = ?( ЗначениеЗаполнено(стр.АбонентФизЛицо),Строка(стр.АбонентФизЛицо),Строка(стр.Номер)) +"("+стр.НомерСотр+")" ;
				Строка.Параметры.Продолжительность = стр.BillSec;
				Строка.Параметры.Тип = стр.Входящий;
				Строка.Параметры.Телефон =  стр.ТипТелефона;
				Строка.Параметры.ПрослушатьРасш = стр.ссылка;
				Строка.Параметры.ссылка = стр.ссылка;
				ТабДокумент.Вывести(Строка);
			КонецЕсли;
		КонецЦикла;
		
		Форма = ПолучитьОбщуюФорму("Звонки");
		Форма.ЭлементыФормы.ПолеТабличногоДокумента.Очистить();
		Форма.ЭлементыФормы.ПолеТабличногоДокумента.Вывести(ТабДокумент);
		
		Возврат Форма;
		
	КонецФункции   //ПолучитьТаблицуЗвонков()

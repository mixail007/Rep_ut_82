<?xml version="1.0" encoding="UTF-8"?>
<SchemaFile xmlns="" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema">
		<dataSource>
			<name>ИсточникДанных1</name>
			<dataSourceType>Local</dataSourceType>
		</dataSource>
		<dataSet xsi:type="DataSetQuery">
			<name>НаборДанных1</name>
			<field xsi:type="DataSetFieldField">
				<dataPath>ЗаказПокупателя</dataPath>
				<field>ЗаказПокупателя</field>
				<role>
					<dimension xmlns="http://v8.1c.ru/8.1/data-composition-system/common">true</dimension>
				</role>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>ЗаказПокупателяТип</dataPath>
				<field>ЗаказПокупателяТип</field>
				<appearance>
					<item xmlns="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xsi:type="dcsset:SettingsParameterValue">
						<parameter>Формат</parameter>
						<value xsi:type="xs:string">ЧН=0</value>
					</item>
				</appearance>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>ДисконтнаяКарта</dataPath>
				<field>ДисконтнаяКарта</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>ДоговорКонтрагента</dataPath>
				<field>ДоговорКонтрагента</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>ДокументПродажи</dataPath>
				<field>ДокументПродажи</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Номенклатура</dataPath>
				<field>Номенклатура</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Подразделение</dataPath>
				<field>Подразделение</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Проект</dataPath>
				<field>Проект</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>ХарактеристикаНоменклатуры</dataPath>
				<field>ХарактеристикаНоменклатуры</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>ОтветственноеЛицо</dataPath>
				<field>ОтветственноеЛицо</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Контрагент</dataPath>
				<field>Контрагент</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>НаправлениеПродаж</dataPath>
				<field>НаправлениеПродаж</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Регион</dataPath>
				<field>Регион</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>КоличествоИнтернет</dataPath>
				<field>КоличествоИнтернет</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>КоличествоМенеджеры</dataPath>
				<field>КоличествоМенеджеры</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>СумИнтернет</dataPath>
				<field>СумИнтернет</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>СумМенеджеры</dataPath>
				<field>СумМенеджеры</field>
			</field>
			<dataSource>ИсточникДанных1</dataSource>
			<query>ВЫБРАТЬ
	ПродажиОбороты.ДокументПродажи КАК Реализация,
	ПродажиОбороты.ЗаказПокупателя КАК Заказ,
	ПродажиОбороты.СтоимостьОборот,
	ПродажиОбороты.ДоговорКонтрагента,
	ПродажиОбороты.ДоговорКонтрагента.Владелец КАК Контрагент
ПОМЕСТИТЬ втРеализации
ИЗ
	РегистрНакопления.Продажи.Обороты(, , , ) КАК ПродажиОбороты

ИНДЕКСИРОВАТЬ ПО
	Заказ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	втРеализации.Реализация,
	втРеализации.Заказ КАК ОбъединяющийЗаказ,
	зтНачальныеЗаказы.НачальныйЗаказ
ПОМЕСТИТЬ втОбъединенияЗаказов
ИЗ
	втРеализации КАК втРеализации
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			НачальныеЗаказы.ЗаказПокупателя КАК НачальныйЗаказ,
			НачальныеЗаказы.Ссылка КАК ОбъединяющийЗаказ
		ИЗ
			Документ.ЗаказПокупателя.Заказы КАК НачальныеЗаказы
		ГДЕ
			НачальныеЗаказы.Ссылка В
					(ВЫБРАТЬ
						втРеализации.Заказ КАК ОбъединяющийЗаказ
					ИЗ
						втРеализации КАК втРеализации
					ГДЕ
						(НЕ втРеализации.Заказ ЕСТЬ NULL 
								И НЕ втРеализации.Заказ = НЕОПРЕДЕЛЕНО
								И втРеализации.Заказ.ТипЗаказа = 6
							ИЛИ втРеализации.Заказ.ТипЗаказа = 7))) КАК зтНачальныеЗаказы
		ПО втРеализации.Заказ = зтНачальныеЗаказы.ОбъединяющийЗаказ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втОбъединенияЗаказов.Реализация,
	СУММА(втОбъединенияЗаказов.НачальныйЗаказ.СуммаДокумента) КАК СуммаНачЗаказов
ПОМЕСТИТЬ втСуммыНачЗаказов
ИЗ
	втОбъединенияЗаказов КАК втОбъединенияЗаказов

СГРУППИРОВАТЬ ПО
	втОбъединенияЗаказов.Реализация
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втРеализации.Реализация КАК Реализация,
	втРеализации.Заказ КАК Заказ,
	втОбъединенияЗаказов.НачальныйЗаказ КАК НачальныйЗаказ,
	ЕСТЬNULL(втОбъединенияЗаказов.НачальныйЗаказ, втРеализации.Заказ) КАК ЗаказПокупателя,
	втРеализации.СтоимостьОборот КАК СтоимостьПродажа,
	втРеализации.ДоговорКонтрагента.ОтветственноеЛицо КАК ОтветственноеЛицо,
	втРеализации.Контрагент
ПОМЕСТИТЬ втДанные
ИЗ
	втРеализации КАК втРеализации
		ЛЕВОЕ СОЕДИНЕНИЕ втОбъединенияЗаказов КАК втОбъединенияЗаказов
		ПО втРеализации.Заказ = втОбъединенияЗаказов.ОбъединяющийЗаказ
			И втРеализации.Реализация = втОбъединенияЗаказов.Реализация
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	КонтактнаяИнформация.Объект,
	МАКСИМУМ(КонтактнаяИнформация.Поле2) КАК Поле2
ПОМЕСТИТЬ регионы
ИЗ
	РегистрСведений.КонтактнаяИнформация КАК КонтактнаяИнформация
ГДЕ
	КонтактнаяИнформация.Вид = &amp;Факт

СГРУППИРОВАТЬ ПО
	КонтактнаяИнформация.Объект
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	втДанные.ЗаказПокупателя КАК ЗаказПокупателя,
	втДанные.ЗаказПокупателя.ТипЗаказа КАК ЗаказПокупателяТип,
	ВЫБОР
		КОГДА втДанные.ЗаказПокупателя.ТипЗаказа = 8
				ИЛИ втДанные.ЗаказПокупателя.ТипЗаказа = 2
				ИЛИ втДанные.ЗаказПокупателя.ТипЗаказа = 3
				ИЛИ втДанные.ЗаказПокупателя.ТипЗаказа = 4
				ИЛИ втДанные.ЗаказПокупателя.ТипЗаказа = 9
				ИЛИ втДанные.ЗаказПокупателя.ТипЗаказа = 10
			ТОГДА ВЫБОР
					КОГДА НЕ ЕСТЬNULL(втСуммыНачЗаказов.СуммаНачЗаказов, ЕСТЬNULL(втДанные.ЗаказПокупателя.СуммаДокумента, 0)) = 0
						ТОГДА втДанные.ЗаказПокупателя.СуммаДокумента * втДанные.СтоимостьПродажа / ЕСТЬNULL(втСуммыНачЗаказов.СуммаНачЗаказов, втДанные.ЗаказПокупателя.СуммаДокумента)
					ИНАЧЕ втДанные.СтоимостьПродажа
				КОНЕЦ
		ИНАЧЕ 0
	КОНЕЦ КАК СумИнтернет,
	втДанные.ОтветственноеЛицо,
	втДанные.Контрагент,
	втДанные.ОтветственноеЛицо.НаправлениеПродаж КАК НаправлениеПродаж,
	регионы.Поле2 КАК Регион,
	ВЫБОР
		КОГДА втДанные.ЗаказПокупателя.ТипЗаказа = 8
				ИЛИ втДанные.ЗаказПокупателя.ТипЗаказа = 2
				ИЛИ втДанные.ЗаказПокупателя.ТипЗаказа = 3
				ИЛИ втДанные.ЗаказПокупателя.ТипЗаказа = 4
				ИЛИ втДанные.ЗаказПокупателя.ТипЗаказа = 9
				ИЛИ втДанные.ЗаказПокупателя.ТипЗаказа = 10
			ТОГДА 1
		ИНАЧЕ 0
	КОНЕЦ КАК КоличествоИнтернет,
	ВЫБОР
		КОГДА втДанные.ЗаказПокупателя.ТипЗаказа = 0
				ИЛИ втДанные.ЗаказПокупателя.ТипЗаказа = 1
			ТОГДА ВЫБОР
					КОГДА НЕ ЕСТЬNULL(втСуммыНачЗаказов.СуммаНачЗаказов, ЕСТЬNULL(втДанные.ЗаказПокупателя.СуммаДокумента, 0)) = 0
						ТОГДА втДанные.ЗаказПокупателя.СуммаДокумента * втДанные.СтоимостьПродажа / ЕСТЬNULL(втСуммыНачЗаказов.СуммаНачЗаказов, втДанные.ЗаказПокупателя.СуммаДокумента)
					ИНАЧЕ втДанные.СтоимостьПродажа
				КОНЕЦ
		ИНАЧЕ 0
	КОНЕЦ КАК СумМенеджеры,
	ВЫБОР
		КОГДА втДанные.ЗаказПокупателя.ТипЗаказа = 0
				ИЛИ втДанные.ЗаказПокупателя.ТипЗаказа = 1
			ТОГДА 1
		ИНАЧЕ 0
	КОНЕЦ КАК КоличествоМенеджеры
ПОМЕСТИТЬ Итог
ИЗ
	втДанные КАК втДанные
		ЛЕВОЕ СОЕДИНЕНИЕ втСуммыНачЗаказов КАК втСуммыНачЗаказов
		ПО втДанные.Реализация = втСуммыНачЗаказов.Реализация
		ЛЕВОЕ СОЕДИНЕНИЕ регионы КАК регионы
		ПО втДанные.Контрагент = регионы.Объект
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Итог.ЗаказПокупателя,
	Итог.ЗаказПокупателяТип,
	Итог.СумИнтернет,
	Итог.ОтветственноеЛицо,
	Итог.Контрагент,
	Итог.НаправлениеПродаж,
	Итог.Регион,
	Итог.КоличествоИнтернет,
	Итог.СумМенеджеры,
	Итог.КоличествоМенеджеры
ИЗ
	Итог КАК Итог
ГДЕ
	(Итог.КоличествоИнтернет = 1
			ИЛИ Итог.КоличествоМенеджеры = 1)</query>
		</dataSet>
		<totalField>
			<dataPath>КоличествоИнтернет</dataPath>
			<expression>Сумма(КоличествоИнтернет)</expression>
		</totalField>
		<totalField>
			<dataPath>КоличествоМенеджеры</dataPath>
			<expression>Сумма(КоличествоМенеджеры)</expression>
		</totalField>
		<totalField>
			<dataPath>СумИнтернет</dataPath>
			<expression>Сумма(СумИнтернет)</expression>
		</totalField>
		<totalField>
			<dataPath>СумМенеджеры</dataPath>
			<expression>Сумма(СумМенеджеры)</expression>
		</totalField>
		<parameter>
			<name>НачалоПериода</name>
			<title xmlns:d4p1="http://v8.1c.ru/8.1/data/core" xsi:type="d4p1:LocalStringType">
				<d4p1:item>
					<d4p1:lang>ru</d4p1:lang>
					<d4p1:content>Начало периода</d4p1:content>
				</d4p1:item>
			</title>
			<valueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:dateTime</Type>
				<DateQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<DateFractions>DateTime</DateFractions>
				</DateQualifiers>
			</valueType>
			<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
			<useRestriction>false</useRestriction>
		</parameter>
		<parameter>
			<name>КонецПериода</name>
			<title xmlns:d4p1="http://v8.1c.ru/8.1/data/core" xsi:type="d4p1:LocalStringType">
				<d4p1:item>
					<d4p1:lang>ru</d4p1:lang>
					<d4p1:content>Конец периода</d4p1:content>
				</d4p1:item>
			</title>
			<valueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:dateTime</Type>
				<DateQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<DateFractions>DateTime</DateFractions>
				</DateQualifiers>
			</valueType>
			<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
			<useRestriction>false</useRestriction>
		</parameter>
		<parameter>
			<name>Факт</name>
			<title xmlns:d4p1="http://v8.1c.ru/8.1/data/core" xsi:type="d4p1:LocalStringType">
				<d4p1:item>
					<d4p1:lang>ru</d4p1:lang>
					<d4p1:content>Факт</d4p1:content>
				</d4p1:item>
			</title>
			<valueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core" xmlns:d5p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d5p1:CatalogRef.ВидыКонтактнойИнформации</Type>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:string</Type>
				<StringQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<Length>50</Length>
					<AllowedLength>Variable</AllowedLength>
				</StringQualifiers>
			</valueType>
			<value xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xsi:type="dcscor:DesignTimeValue"/>
			<useRestriction>true</useRestriction>
		</parameter>
		<settingsVariant>
			<name xmlns="http://v8.1c.ru/8.1/data-composition-system/settings">Основной</name>
			<presentation xmlns="http://v8.1c.ru/8.1/data-composition-system/settings" xsi:type="xs:string">Основной</presentation>
		</settingsVariant>
	</dataCompositionSchema>
</SchemaFile>﻿<?xml version="1.0" encoding="UTF-8"?>
<Settings xmlns="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<selection>
		<item xsi:type="SelectedItemField">
			<field>КоличествоИнтернет</field>
		</item>
		<item xsi:type="SelectedItemField">
			<field>СумИнтернет</field>
		</item>
		<item xsi:type="SelectedItemField">
			<field>КоличествоМенеджеры</field>
		</item>
		<item xsi:type="SelectedItemField">
			<field>СумМенеджеры</field>
		</item>
	</selection>
	<dataParameters>
		<dcscor:item xsi:type="SettingsParameterValue">
			<dcscor:use>false</dcscor:use>
			<dcscor:parameter>Факт</dcscor:parameter>
			<dcscor:value xsi:nil="true"/>
		</dcscor:item>
	</dataParameters>
	<order>
		<item xsi:type="OrderItemField">
			<field>ЗаказПокупателяТип</field>
			<orderType>Asc</orderType>
		</item>
		<item xsi:type="OrderItemField">
			<field>ЗаказПокупателя</field>
			<orderType>Asc</orderType>
		</item>
	</order>
	<conditionalAppearance>
		<item>
			<selection>
				<item>
					<field>СумИнтернет</field>
				</item>
				<item>
					<field>СумМенеджеры</field>
				</item>
			</selection>
			<filter/>
			<appearance>
				<dcscor:item xsi:type="SettingsParameterValue">
					<dcscor:parameter>Формат</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ЧДЦ=0</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</appearance>
		</item>
	</conditionalAppearance>
	<item xsi:type="StructureItemGroup">
		<groupItems>
			<item xsi:type="GroupItemField">
				<field>НаправлениеПродаж</field>
				<groupType>Items</groupType>
				<periodAdditionType>None</periodAdditionType>
				<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
				<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
			</item>
		</groupItems>
		<order>
			<item xsi:type="OrderItemAuto"/>
		</order>
		<selection>
			<item xsi:type="SelectedItemAuto"/>
		</selection>
		<item xsi:type="StructureItemGroup">
			<groupItems>
				<item xsi:type="GroupItemField">
					<field>ОтветственноеЛицо</field>
					<groupType>Items</groupType>
					<periodAdditionType>None</periodAdditionType>
					<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
					<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
				</item>
			</groupItems>
			<order>
				<item xsi:type="OrderItemAuto"/>
			</order>
			<selection>
				<item xsi:type="SelectedItemAuto"/>
			</selection>
			<item xsi:type="StructureItemGroup">
				<groupItems>
					<item xsi:type="GroupItemField">
						<field>Регион</field>
						<groupType>Items</groupType>
						<periodAdditionType>None</periodAdditionType>
						<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
						<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
					</item>
				</groupItems>
				<order>
					<item xsi:type="OrderItemAuto"/>
				</order>
				<selection>
					<item xsi:type="SelectedItemAuto"/>
				</selection>
				<item xsi:type="StructureItemGroup">
					<groupItems>
						<item xsi:type="GroupItemField">
							<field>Контрагент</field>
							<groupType>Items</groupType>
							<periodAdditionType>None</periodAdditionType>
							<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
							<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
						</item>
					</groupItems>
					<order>
						<item xsi:type="OrderItemAuto"/>
					</order>
					<selection>
						<item xsi:type="SelectedItemAuto"/>
					</selection>
				</item>
			</item>
		</item>
	</item>
</Settings>﻿<?xml version="1.0" encoding="UTF-8"?>
<SchemaFile xmlns="" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema"/>
</SchemaFile>
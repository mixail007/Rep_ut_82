
Процедура КнопкаВыполнитьНажатие(Кнопка)
	
	Если ВыбранныеДоки.Количество()>0 тогда
		//тзДанныеПоДопРасходам=ПолучитьДанныеПоДопРасходам();
		Эксель = Новый COMОбъект("Excel.Application");
		//ПутьКФайлу="\\Novikova\Таблица11\таблица 11.xls";
		ПутьКФайлу="c:\Таблица11\таблица 11.xls";
		//ПутьКФайлу="c:\obm\ТАБЛИЦА 11.xls";
		Файл = Новый Файл(ПутьКФайлу);
		Если Не Файл.Существует() Тогда
			Сообщить("Файл не существует!");
			Возврат;
		КонецЕсли; 
		Книга   = Эксель.Workbooks.Open(ПутьКФайлу);
		КоличествоЛистов = Книга.Sheets.Count;
		НомерЛиста=1;
		СписокЛистов=новый СписокЗначений;
		Пока НомерЛиста <= КоличествоЛистов Цикл
			СписокЛистов.Добавить(Книга.Sheets(НомерЛиста).Name);
			НомерЛиста=НомерЛиста+1;
		КонецЦикла;
		ЛистСезон=СписокЛистов.ВыбратьЭлемент("Укажите сезон");
		Лист                = Книга.Worksheets(ЛистСезон.Значение);
		
		КолонкаКонтейнер="I";
		КолонкаДатаОтправкиETD ="L";
		КолонкаДатаВыпускаДТ="DM";
		КолонкаДатаПодачиДТ="DL";
		КолонкаДатаЗаявкиНаБукинг="DK";
		КолонкаДатаПриходаВПортИлиНаТаможню="Q";
		КолонкаПланДатаПриходаНаСклад="V";
			
		Для каждого стрДоки из ВыбранныеДоки Цикл
			Если стрДоки.флажок тогда
				КонтейнерИзДока=СокрЛП(стрДоки.НомерКонтейнера);
				НСтр = Лист.Columns(КолонкаКонтейнер).Find(КонтейнерИзДока);
				Если НСтр<>Неопределено тогда
					СтрокаExcel=НСтр.Row;
					//Сообщить(""+СтрокаExcel);
					Попытка
						Сообщить(КонтейнерИзДока+" "+СокрЛП(Лист.Cells(СтрокаExcel,  КолонкаДатаОтправкиETD).Value));
						ДатаОтправкиETD				 = (СокрЛП(Лист.Cells(СтрокаExcel,  КолонкаДатаОтправкиETD).Value));
						ДатаВыпускаДТ				 = (СокрЛП(Лист.Cells(СтрокаExcel,  КолонкаДатаВыпускаДТ).Value));
						ДатаПодачиДТ			 	 = (СокрЛП(Лист.Cells(СтрокаExcel,  КолонкаДатаПодачиДТ).Value));
						ДатаЗаявкиНаБукинг			 = (СокрЛП(Лист.Cells(СтрокаExcel,  КолонкаДатаЗаявкиНаБукинг).Value));
						ДатаПриходаВПортИлиНаТаможню = (СокрЛП(Лист.Cells(СтрокаExcel,  КолонкаДатаПриходаВПортИлиНаТаможню).Value));
						ПланДатаПриходаНаСклад		 = (СокрЛП(Лист.Cells(СтрокаExcel,  КолонкаПланДатаПриходаНаСклад).Value));
						
						ЗаказОб = стрДоки.ЗаказПоставщику.ПолучитьОбъект();
						Если ПланДатаПриходаНаСклад<>"" Тогда
							ЗаказОб.ДатаОтправкиETD 				= Дата(ДатаОтправкиETD);
							ЗаказОб.ДатаОриентировочнойДоставкиНаСклад = ПланДатаПриходаНаСклад;
	                        ЗаказОб.ДатаПоступления = ЗаказОб.ДатаОриентировочнойДоставкиНаСклад;
						ИначеЕсли ДатаОтправкиETD<>"" тогда
							ЗаказОб.ДатаОтправкиETD 				= Дата(ДатаОтправкиETD);
							//ЗаказОб.ДатаОриентировочнойДоставкиНаСклад = ЗаказОб.ДатаОтправкиETD + 60*24*60*60;
	                        //ЗаказОб.ДатаПоступления = ЗаказОб.ДатаОриентировочнойДоставкиНаСклад;
						КонецЕсли;
						
						Если ДатаВыпускаДТ<>"" тогда
							ЗаказОб.ДатаВыпускаДТ 					= Дата(ДатаВыпускаДТ);
						КонецЕсли;
						Если ДатаПодачиДТ<>"" тогда
							ЗаказОб.ДатаПодачиДТ 					= Дата(ДатаПодачиДТ);
						КонецЕсли;
						Если ДатаЗаявкиНаБукинг<>"" тогда
							ЗаказОб.ДатаЗаявкиНаБукингОтОтправителя = Дата(ДатаЗаявкиНаБукинг);
						КонецЕсли;
						Если ДатаПриходаВПортИлиНаТаможню<>"" тогда
							ЗаказОб.ДатаПриходаВПортИлиНаТаможнюETA = Дата(ДатаПриходаВПортИлиНаТаможню);
							Если не ЗначениеЗаполнено(ПланДатаПриходаНаСклад) тогда
								ЗаказОб.ДатаОриентировочнойДоставкиНаСклад = ЗаказОб.ДатаПриходаВПортИлиНаТаможнюETA + 14*24*60*60;
								ЗаказОб.ДатаПоступления = ЗаказОб.ДатаОриентировочнойДоставкиНаСклад;
							КонецЕсли;
						КонецЕсли;
						
						//Сообщить(""+ЗаказОб+": ДатаОтправкиETD: " + ЗаказОб.ДатаОтправкиETD+ 
						//					", ДатаВыпускаДТ: " + ЗаказОб.ДатаВыпускаДТ+
						//					", ДатаПодачиДТ: "   +ЗаказОб.ДатаПодачиДТ+
						//					", ДатаЗаявкиНаБукингОтОтправителя: "   +ЗаказОб.ДатаЗаявкиНаБукингОтОтправителя+
						//					", ДатаПриходаВПортИлиНаТаможнюETA: "   +ЗаказОб.ДатаПриходаВПортИлиНаТаможнюETA);
						ЗаказОб.ОбменДанными.Загрузка = истина;
						ЗаказОб.Записать(РежимЗаписиДокумента.Запись);
					Исключение
						Сообщить("Контейнер: "+КонтейнерИзДока+", строка эксель:"+СтрокаExcel);
						Сообщить(ОписаниеОшибки());
					КонецПопытки;
				Иначе
					Сообщить("Контейнер: "+КонтейнерИзДока+" в таблице не найден.");
				КонецЕсли;
			КонецЕсли;
		КонецЦикла;
		
		Эксель.DisplayAlerts = 0; 
		Эксель.Quit();
	КонецЕсли;
КонецПроцедуры

Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	Если НастройкаПериода.Редактировать() Тогда
		НачПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры

Процедура ОсновныеДействияФормыДействие(Кнопка)
	СписокКонтрагентов=Новый СписокЗначений;
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("91735")); //FREEMAN RACING WHEELS INC
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("93695")); //NINGBO PARTNER INTERNATIONAL TRADE CO., LTD
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("91535")); //JIANGSU SAINTY MACHINERY I&E CORP. LTD
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("П000715")); //Zhejiang Jingu Company Ltd
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("93777")); //Steel Strips Wheels Limited
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("93694")); //Zhangzhou Shuangsheng WHeels Co., ltd
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("91834")); //NINGBO LONGTIME MACHINE CO.,LTD
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("П001626")); //XIAMEN YONGXINGXUN INDUSTRY AND TRADE CO., LTD	
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("92540")); //FUJIAN SHUANGSHENG IM &EX CO., LTD	
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("94302")); //ZHANGZHOU LIYANG MACHINE CO., LTD	
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("94447")); //XIAMEN FUYISHENG MACHINE CO., LTD,
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("94442")); //JIANGSU SIBORUI IMPORT AND EXPORT CO., LTD
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("П001797")); //Tyre Technology
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("93512")); //Nexen Tire Corporation
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("П005407")); //Sailun JinyuGroup Co.,Ltd.
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("94075")); //Inci Aku Sanayi ve Ticaret A.S.
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("94632")); //Xiamen Jiashunlai Trading Co..Ltd
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("П012694")); //SHANDONG ZHONGYI RUBBER CO. LTD

	//отбираем документы без сформированных доп.расходов
	Запрос=Новый Запрос;
	Запрос.Текст="ВЫБРАТЬ
	             |	ЗаказПоставщику.Ссылка КАК ЗаказПоставщику,
	             |	ЗаказПоставщику.Дата,
	             |	ЗаказПоставщику.Номер,
	             |	ЗаказПоставщику.Контрагент,
	             |	ЗаказПоставщику.НомерКонтейнера КАК НомерКонтейнера,
	             |	ЗаказПоставщику.НомерВходящегоДокумента,
	             |	ЗаказПоставщику.СуммаДокумента,
	             |	ИСТИНА КАК флажок
	             |ИЗ
	             |	Документ.ЗаказПоставщику КАК ЗаказПоставщику
	             |ГДЕ
	             |	ЗаказПоставщику.Дата МЕЖДУ &ДатаН И &ДатаК
	             |	И ЗаказПоставщику.Проведен = ИСТИНА
	             |	И НЕ ЗаказПоставщику.НомерКонтейнера ЕСТЬ NULL 
	             |	И НЕ ЗаказПоставщику.НомерКонтейнера = """"
	             |	И ЗаказПоставщику.Контрагент В(&СписокКонтрагентов)";
	Запрос.УстановитьПараметр("ДатаН",НачПериода);
	Запрос.УстановитьПараметр("ДатаК",КонецДня(КонПериода));
	Запрос.УстановитьПараметр("СписокКонтрагентов",СписокКонтрагентов);
	Рез=Запрос.Выполнить().Выгрузить();
	ВыбранныеДоки=рез;
	
	ЭлементыФормы.ВыбранныеДоки.СоздатьКолонки();
	ЭлементыФормы.ВыбранныеДоки.Колонки.Добавить("фл","фл");
	Колонки = ЭлементыФормы.ВыбранныеДоки.Колонки;
	Индекс=Колонки.Индекс(Колонки["фл"]);
	//ЭлементыФормы.ВыбранныеДоки.Колонки.ЗаказПоставщику.КнопкаВыбора = истина;
	ЭлементыФормы.ВыбранныеДоки.Колонки.Сдвинуть(Колонки["фл"],-Индекс);
	ЭлементыФормы.ВыбранныеДоки.Колонки.фл.РежимРедактирования=РежимРедактированияКолонки.Непосредственно;
	ЭлементыФормы.ВыбранныеДоки.Колонки.фл.ДанныеФлажка="флажок";
	ЭлементыФормы.ВыбранныеДоки.Колонки.флажок.видимость=ложь;
	
КонецПроцедуры
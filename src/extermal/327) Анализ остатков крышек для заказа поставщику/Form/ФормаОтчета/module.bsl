
Процедура КнопкаСформироватьНажатие(Кнопка)
	
	Таб = ЭлементыФормы.ПолеТабличногоДокумента1;
	Таб.Очистить();
	СформироватьОтчет(Таб,Поставщик);
	Таб.ТолькоПросмотр = Истина;
	
КонецПроцедуры

Процедура ПолеТабличногоДокумента1ОбработкаРасшифровки(Элемент, Расшифровка, СтандартнаяОбработка)
	
	//ТабДок=Новый ТабличныйДокумент;
		
	Если ТипЗнч(Расшифровка)=Тип("Структура") Тогда
		Если Расшифровка.Свойство("НеобходимоеКоличество") и Расшифровка.Свойство("Комплектующая") Тогда
			СтандартнаяОбработка = Ложь;
			
			ФормаРасшифровки = ЭтотОбъект.ПолучитьФорму("ФормаРасшифровки",,Новый УникальныйИдентификатор());
			ТабДок = ФормаРасшифровки.ЭлементыФормы["ПолеТабличногоДокумента1"];
			ТабДок.Очистить();
			ФормаРасшифровки.Заголовок = "Расшифровка по "+СокрЛП(Расшифровка.Комплектующая);
			ФормаРасшифровки.Открыть();
			
			НайденныеСтроки=ТаблицаСводная.НайтиСтроки(Новый Структура("Комплектующая", Расшифровка.Комплектующая));
			
			Если НайденныеСтроки.Количество()>0 Тогда
				МакетРасш = ПолучитьМакет("МакетРасшифровка");
				ОбластьШапкаРасш = МакетРасш.ПолучитьОбласть("Шапка");
				ОбластьСтрокаРасш = МакетРасш.ПолучитьОбласть("Строка");
				ОбластьИтогРасш = МакетРасш.ПолучитьОбласть("Итог");
				ОбластьШапкаРасш.Параметры.Комплектующая = Расшифровка.Комплектующая;
				ТабДок.Вывести(ОбластьШапкаРасш);
				ТабДок.ФиксацияСверху = ТабДок.ВысотаТаблицы;
				
				ТЗит = ТаблицаСводная.Скопировать(НайденныеСтроки);
				ТЗит.Свернуть("","КоличествоНаСкладе, КоличествоЗаказПоставщикам, КоличествоСезонныйЗаказ, НеобходимоеКоличество");
				Для каждого СтрТЗ ИЗ НайденныеСтроки Цикл
					ОбластьСтрокаРасш.Параметры.Заполнить(СтрТЗ);
					
					РасшифровкаЗаказПоставщикам = Новый Структура;
					РасшифровкаЗаказПоставщикам.Вставить("ИмяРегистра","ЗаказыПоставщикам");
					РасшифровкаЗаказПоставщикам.Вставить("Номенклатура", СтрТЗ.Номенклатура);
					ОбластьСтрокаРасш.Параметры.РасшифровкаЗаказПоставщикам = РасшифровкаЗаказПоставщикам;
					РасшифровкаСезонныйЗаказ = Новый Структура;
					РасшифровкаСезонныйЗаказ.Вставить("ИмяРегистра","ЗаказыПоставщикамСезонные");
					РасшифровкаСезонныйЗаказ.Вставить("Номенклатура", СтрТЗ.Номенклатура);
					ОбластьСтрокаРасш.Параметры.РасшифровкаСезонныйЗаказ = РасшифровкаСезонныйЗаказ;
					РасшифровкаОстатки = Новый Структура;
					РасшифровкаОстатки.Вставить("ИмяРегистра","ТоварыНаСкладах");
					РасшифровкаОстатки.Вставить("Номенклатура", СтрТЗ.Номенклатура);
					ОбластьСтрокаРасш.Параметры.РасшифровкаОстатки = РасшифровкаОстатки;
					
					ТабДок.Вывести(ОбластьСтрокаРасш);
				КонецЦикла;
				Если ТЗит.Количество() > 0 Тогда
					ОбластьИтогРасш.Параметры.Заполнить(ТЗит[0]);
					ТабДок.Вывести(ОбластьИтогРасш);
				КонецЕсли;
			КонецЕсли;
			ТабДок.ТолькоПросмотр = Истина;
			ТабДок.Показать();
		ИначеЕсли Расшифровка.Свойство("УжеЗаказано") и Расшифровка.Свойство("Комплектующая") Тогда
			СтандартнаяОбработка = Ложь;
			ТекНом = Расшифровка.Комплектующая;
			ТекОтчет = Отчеты.ОтчетОстаткиИОбороты.Создать();
			ТекОтчет.ИмяРегистра = "ЗаказыПоставщикамКрышки";
			ТекОтчет.ЗаполнитьНачальныеНастройки();
			ТекОтчет.РаскрашиватьИзмерения = Истина;
			ТекОтчет.ВыводитьИтогиПоВсемУровням = Истина;
			ТекОтчет.ВыводитьПоказателиВСтроку = Истина;
			ТекОтчет.ПостроительОтчета.Отбор.Номенклатура.ВидСравнения = ВидСравнения.Равно;
			ТекОтчет.ПостроительОтчета.Отбор.Номенклатура.Значение = ТекНом;
			ТекОтчет.ПостроительОтчета.Отбор.Номенклатура.Использование = Истина;
			ТекОтчетФормаОтчета = ТекОтчет.ПолучитьОсновнуюФорму();
			ТекОтчетФормаОтчета.ТолькоПросмотр = Истина;
			//ТекОтчетФормаОтчета.ЭлементыФормы.КоманднаяПанельФормы.Доступность = Ложь;
			ТекОтчетФормаОтчета.Открыть();
			//ТекОтчетФормаОтчета.ЭлементыФормы.ДатаНач.Значение = ТекущаяДата();
			//ТекОтчетФормаОтчета.ЭлементыФормы.ДатаКон.Значение = ТекущаяДата();		
			ТекОтчетФормаОтчета.ОбновитьОтчет();
			
		КонецЕсли;	
	КонецЕсли;
	
	
КонецПроцедуры

Процедура СоздатьЗаказПоставщику(НаВсеКрышки = Истина)
	
	Если НаВсеКрышки Тогда
		НаимКолонки = "НеобходимоЗаказать";
	Иначе
		НаимКолонки = "НеобходимоЗаказатьПоЗаказам";
	КонецЕсли;	
	
	 НовДок = Документы.ЗаказПоставщикуКрышки.ПолучитьФормуНовогоДокумента();
	// НовДок = Документы.ЗаказПоставщику.СоздатьДокумент();
	 Для Каждого Стр Из ТЗдляЗаказа Цикл
		 Если Стр[НаимКолонки] > 0 Тогда
			 НовСтр = НовДок.Товары.Добавить();
			 НовСтр.Номенклатура = Стр.Комплектующая;
			 НовСтр.Количество = Стр[НаимКолонки];
		 КонецЕсли;	 
	 КонецЦикла;	 
	 НовДок.Открыть();
	 
КонецПроцедуры

Процедура ДействияФормыДействиеСоздатьЗаказНаВсеКрышки(Кнопка)
	СоздатьЗаказПоставщику(Истина);
КонецПроцедуры

Процедура ДействияФормыДействиеСоздатьЗаказНаНеобходимыеКрышки(Кнопка)
	СоздатьЗаказПоставщику(Ложь);
КонецПроцедуры

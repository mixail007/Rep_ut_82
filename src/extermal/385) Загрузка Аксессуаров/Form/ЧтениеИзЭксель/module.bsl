
Функция КнопкаВыполнитьНажатие(Кнопка)
	// Вставить содержимое обработчика.
	
	ТаблицаЗаказа = Новый ТаблицаЗначений;
	Таблицазаказа.Колонки.Добавить("Номенклатура");
	Таблицазаказа.Колонки.Добавить("Количество");
	Таблицазаказа.Колонки.Добавить("МинОстаток");
	
	ВыбФайл = Новый Файл(ИмяФайла);
	Если НЕ ВыбФайл.Существует() Тогда
		Сообщить("Файл не существует!");
		Возврат Неопределено;
	КонецЕсли;
	
	Попытка
		Excel = Новый COMОбъект("Excel.Application");
		Excel.WorkBooks.Open(ИмяФайла);
		Состояние("Обработка файла Microsoft Excel...");
		ExcelЛист 	= Excel.Sheets(1);
	Исключение
		Сообщить("Ошибка. Возможно неверно указан номер листа книги Excel.");
		Возврат Неопределено;
	КонецПопытки;
	                    
	Для сч=ПерваяСтрока по Excel.ActiveSheet.UsedRange.Rows.Count Цикл //65535 Цикл
		ОбработкаПрерыванияПользователя();
		
		Код 			= СтрЗаменить(СокрЛП(ExcelЛист.Cells(сч,КолонкаКода).Value)," ","");
		//Артикул			= СтрЗаменить(СокрЛП(ExcelЛист.Cells(сч,КолонкаКода).Value)," ","");
		
		//Если (Артикул="") Тогда 
		//	Прервать;
		//КонецЕсли;
		
		Количество 		= СокрЛП(ExcelЛист.Cells(сч,КолонкаКоличества).Value);
		МинОст 			= СокрЛП(ExcelЛист.Cells(сч,КолонкаМинимальныхОстатков).Value);
		
		Номенклатура = Справочники.Номенклатура.НайтиПоКоду(Код);
		
		Если не ЗначениеЗаполнено(Номенклатура) Тогда 
			Номенклатура = НайтиПоРегистру(Код);
		КонецЕсли;
		
		Если не ЗначениеЗаполнено(Номенклатура) Тогда 
			Сообщить("Не найдена номенклатура с кодом: " + Код + "   в строке" + сч);
			Продолжить;
		КонецЕсли;
		
		Если не ЗначениеЗаполнено(Количество) Тогда 
			Сообщить("Неверное количество в строке:" + сч);
			Продолжить;
		КонецЕсли;
		
		Если не ЗначениеЗаполнено(МинОст) Тогда 
			Сообщить("Неверное минимальное количество в строке:" + сч);
			Продолжить;
		КонецЕсли;
		
		СтрУ 				= ТаблицаЗаказа.Добавить();
		СтрУ.Номенклатура 	= Номенклатура;
		СтрУ.Количество 	= Количество;
		СтрУ.МинОстаток 	= МинОст;
		
	КонецЦикла;
	
	Excel.WorkBooks.Close();
	Закрыть(ТаблицаЗаказа);
	//////////////////////////////////////////////////////////////////////////////////////////////////	
	
КонецФункции

Процедура ИмяФайлаПриИзменении(Элемент)
	// Вставить содержимое обработчика.
КонецПроцедуры

Процедура ИмяФайлаНачалоВыбора(Элемент, СтандартнаяОбработка)
	// Вставить содержимое обработчика.
	
	Режим = РежимДиалогаВыбораФайла.Открытие; 
	Диалог = новый ДиалогВыбораФайла(Режим);

	Выбран = Диалог.Выбрать();
	
	Если (Выбран) Тогда 
		ИмяФайла = Диалог.ПолноеИмяФайла;
	КонецЕсли;
КонецПроцедуры

Функция НайтиПоРегистру(Код)
	
	Запрос = Новый Запрос("Выбрать Номенклатура из регистрсведений.номенклатураконтрагентов где контрагент=&контрагент и кодноменклатурыконтрагента=&код");
	
	ЗАпрос.УстановитьПараметр("контрагент",Справочники.Контрагенты.НайтиПоКоду("00568  "));
	ЗАпрос.УстановитьПараметр("код",код);
	
	Выб = Запрос.Выполнить().Выбрать();
	
	Если выб.Следующий() Тогда
		Возврат выб.номенклатура;
	КонецЕсли;
	
	Возврат неопределено;
КонецФункции
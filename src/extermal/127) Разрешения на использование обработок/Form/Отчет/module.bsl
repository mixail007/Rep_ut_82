
Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
КонецПроцедуры

Процедура ПриЗакрытии()
КонецПроцедуры

Процедура ДействияФормыОтчетСформировать(Кнопка)
	//{{КОНСТРУКТОР_ВЫХОДНЫХ_ФОРМ_ПРОЦЕДУРА_ВЫЗОВА(Отчет)
	// Данный фрагмент построен конструктором.
	// При повторном использовании конструктора, внесенные вручную изменения будут утеряны!!!

	ТабДок = ЭлементыФормы.ПолеТабличногоДокумента;
	Отчет(ТабДок);

	//}}КОНСТРУКТОР_ВЫХОДНЫХ_ФОРМ_ПРОЦЕДУРА_ВЫЗОВА
КонецПроцедуры

Процедура Отчет(ТабДок) Экспорт
	//{{КОНСТРУКТОР_ВЫХОДНЫХ_ФОРМ(Отчет)
	// Данный фрагмент построен конструктором.
	// При повторном использовании конструктора, внесенные вручную изменения будут утеряны!!!

	Макет = ВнешняяОбработкаОбъект.ПолучитьМакет(?(ПоПользователям = 0, "Макет", "Отчет"));
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ВнешниеОбработки.Ссылка КАК Ссылка,
	|	ВЫБОР
	|		КОГДА ЕСТЬNULL(ВнешниеОбработки.Родитель.Родитель.Родитель.Родитель.Наименование, """") <> """"
	|			ТОГДА ЕСТЬNULL(ВнешниеОбработки.Родитель.Родитель.Родитель.Родитель.Наименование, """") + ""/""
	|		ИНАЧЕ """"
	|	КОНЕЦ + ВЫБОР
	|		КОГДА ЕСТЬNULL(ВнешниеОбработки.Родитель.Родитель.Родитель.Наименование, """") <> """"
	|			ТОГДА ЕСТЬNULL(ВнешниеОбработки.Родитель.Родитель.Родитель.Наименование, """") + ""/""
	|		ИНАЧЕ """"
	|	КОНЕЦ + ВЫБОР
	|		КОГДА ЕСТЬNULL(ВнешниеОбработки.Родитель.Родитель.Наименование, """") <> """"
	|			ТОГДА ЕСТЬNULL(ВнешниеОбработки.Родитель.Родитель.Наименование, """") + ""/""
	|		ИНАЧЕ """"
	|	КОНЕЦ + ВЫБОР
	|		КОГДА ЕСТЬNULL(ВнешниеОбработки.Родитель.Наименование, """") <> """"
	|			ТОГДА ЕСТЬNULL(ВнешниеОбработки.Родитель.Наименование, """")
	|		ИНАЧЕ """"
	|	КОНЕЦ КАК Путь,
	|	ЕСТЬNULL(ВнешниеОбработкиРазрешения.Пользователь, ""Для всех"") КАК Пользователь
	|ИЗ
	|	Справочник.ВнешниеОбработки КАК ВнешниеОбработки
	|		ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ВнешниеОбработки.Разрешения КАК ВнешниеОбработкиРазрешения
	|		ПО ВнешниеОбработкиРазрешения.Ссылка = ВнешниеОбработки.Ссылка
	|ГДЕ
	|	ВнешниеОбработки.ЭтоГруппа = ЛОЖЬ
	|ИТОГИ ПО
	| " + ?(ПоПользователям = 0, "Пользователь КАК Итог", "Ссылка КАК Итог");

	Результат = Запрос.Выполнить();

	ОбластьЗаголовок = Макет.ПолучитьОбласть("Заголовок");
	ОбластьПодвал = Макет.ПолучитьОбласть("Подвал");
	ОбластьШапкаТаблицы = Макет.ПолучитьОбласть("ШапкаТаблицы");
	ОбластьПодвалТаблицы = Макет.ПолучитьОбласть("ПодвалТаблицы");
	ОбластьИтог = Макет.ПолучитьОбласть("Итог");
	ОбластьДетальныхЗаписей = Макет.ПолучитьОбласть("Детали");

	ТабДок.Очистить();
	ТабДок.Вывести(ОбластьЗаголовок);
	ТабДок.Вывести(ОбластьШапкаТаблицы);
	ТабДок.НачатьАвтогруппировкуСтрок();

	ВыборкаИтог = Результат.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);

	Пока ВыборкаИтог.Следующий() Цикл
		ОбластьИтог.Параметры.Заполнить(ВыборкаИтог);
		ТабДок.Вывести(ОбластьИтог, ВыборкаИтог.Уровень());

		ВыборкаДетали = ВыборкаИтог.Выбрать();

		Пока ВыборкаДетали.Следующий() Цикл
			ОбластьДетальныхЗаписей.Параметры.Заполнить(ВыборкаДетали);
			ТабДок.Вывести(ОбластьДетальныхЗаписей, ВыборкаДетали.Уровень());
		КонецЦикла;
	КонецЦикла;

	ТабДок.ЗакончитьАвтогруппировкуСтрок();
	ТабДок.Вывести(ОбластьПодвалТаблицы);
	ТабДок.Вывести(ОбластьПодвал);

	//}}КОНСТРУКТОР_ВЫХОДНЫХ_ФОРМ
КонецПроцедуры

ПоПользователям = 0;



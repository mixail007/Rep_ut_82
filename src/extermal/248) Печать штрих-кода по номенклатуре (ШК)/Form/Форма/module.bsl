
Процедура КнопкаВыполнитьНажатие(Кнопка)
	ТабДок =  Новый ТабличныйДокумент;
	
	ТабДок.ПолеСлева=0;
	ТабДок.ПолеСправа=0;
	ТабДок.ПолеСверху=0;
	ТабДок.ПолеСнизу=0;
	
	Макет = ПолучитьМакет("Макет");
	
	ОбластьСтрока=Макет.ПолучитьОбласть("Строка|Столбец");
	Если Флажок1 тогда
    ОбластьСтрока=Макет.ПолучитьОбласть("Строка1|Столбец");
	КонецЕсли;

	Если ЗначениеЗаполнено(Номенклатура) Тогда
		Для сч=1 по КоличествоШтрихКодов Цикл
			Наименование = Номенклатура.Наименование;
			
		Если НЕ Флажок1 тогда//30.06.2017
			ШтрихКод=ПолучитьКодШтрихКода(Номенклатура.Код); //+++ 13.05.2015 - "настоящий" штрихКод
			Если ШтрихКод="0" тогда
				ШтрихКод=ПолучитьНовыйКодДляШтрихКодаЯШТ(Номенклатура.Код);
			КонецЕсли;
		КонецЕсли;
		
			Наименование = СтрЗаменить(Наименование,"LegeArtis","TopDriver");
			Если ЗначениеЗаполнено(Номенклатура.ВидДефектаДляУценки) Тогда
				//ОбластьСтрока.Параметры.Наименование = ОбластьСтрока.Параметры.Наименование + "("+Номенклатура.ВидДефектаДляУценки+")";
				Наименование = Наименование + "("+Номенклатура.ВидДефектаДляУценки+")";
			конецЕсли;
			
		Если Флажок1 тогда//30.06.2017
			ОбластьСтрока.Параметры.Наименование = Наименование;
			ОбластьСтрока.Параметры.Артикул = "Артикул: "+Номенклатура.Артикул;
			ОбластьСтрока.Параметры.Код = "Код: "+Номенклатура.Код;
		Иначе
			ДобавитьАртикулКНаименованию(Наименование, Номенклатура);
			ОбластьСтрока.Параметры.Наименование = Наименование;
			ОбШтрихКод=ОбластьСтрока.Рисунки.ШК.Объект;
			ОбШтрихКод.ТипКода = 1; 
			ОбШтрихКод.Сообщение = ШтрихКод; 
			ОбШтрихКод.ОтображатьТекст = Истина;
			ОбШтрихКод.ТекстКода = ШтрихКод; 
		КонецЕсли;
		
			Если сч%2=1 Тогда
				Если Не ТабДок.ПроверитьВывод(ОбластьСтрока) Тогда
					ТабДок.ВывестиГоризонтальныйРазделительСтраниц();			
				КонецЕсли;
				ТабДок.Вывести(ОбластьСтрока);
			Иначе
				ТабДок.Присоединить(ОбластьСтрока);
			КонецЕсли;
			
		КонецЦикла;
	ТабДок.ТолькоПросмотр = Истина;	
	ТабДок.Показать(); 
	
	КонецЕсли;	
	
	
КонецПроцедуры

функция ПолучитьКодШтрихКода( КодТов ) 
	
 запрос = новый Запрос;
 запрос.Текст = "ВЫБРАТЬ
                |	ШК.Код,
                |	ШК.ТипШтрихкода,
                |	ШК.Штрихкод,
                |	ШК.Владелец,
                |	ШК.ЕдиницаИзмерения,
                |	ШК.ХарактеристикаНоменклатуры,
                |	ШК.СерияНоменклатуры,
                |	ШК.Качество
                |ИЗ
                |	РегистрСведений.Штрихкоды КАК ШК
                |ГДЕ
                |	ШК.Владелец.Код = &Код";
 запрос.Параметры.Вставить("Код", КодТов);
 рез = запрос.Выполнить().Выбрать();
 
 если рез.Следующий() тогда
	 ШК = строка(рез.Штрихкод);
 иначе 
	 ШК = "0"; //ПолучитьНовыйКодДляШтрихКодаЯШТ(КодТов);
 КонецЕсли;
 
 возврат ШК;
	 
конецФункции


функция ПолучитьНовыйКодДляШтрихКодаЯШТ(Код)

Если стрДлина(Код)<7 тогда
	код1 = Формат(число(Код), "ЧЦ=7; ЧВН=");
иначе 
	код1 = код;
КонецЕсли;	
	
ШтрихКод = "05000"+ Код;
ШтрихКод = ШтрихКод + КонтрольныйСимволEAN(ШтрихКод, 13);

возврат ШтрихКод;

КонецФункции

Процедура ДобавитьАртикулКНаименованию(Наименование, Номенклатура)
	
	Если НЕ Номенклатура.ВидТовара = Перечисления.ВидыТоваров.Диски Тогда
		Наименование = Наименование
		+ Символы.ПС
		+ "Арт.: " + Номенклатура.Артикул;
	КонецЕсли;
	
КонецПроцедуры // ДобавитьАртикулКНаименованию()


перем СписокРуководителей;

Процедура КнопкаВыполнитьНажатие(Кнопка)
	Для  каждого стр из список цикл
		Если стр.пометка и списокРуководителей.НайтиПоЗначению(глТекущийПользователь) = неопределено тогда
			//Отбор = Новый структура;
			//отбор.Вставить("Контрагент",стр.Контрагент);
			//Отбор.Вставить("Ответственный",стр.ОтветственноеЛицо);
			//Отбор.Вставить("ТоварнаяГруппа",стр.ТоварнаяГруппа);
			//
			//ДанныеСтатуса = РЕгистрыСведений.СтатусыКонтрагентовПоТоварнымГруппам.Получить(Отбор);	
			НаборЗаписей = РегистрыСведений.СтатусыКонтрагентовПоТоварнымГруппам.СоздатьНаборЗаписей();
			НаборЗаписей.Отбор.Контрагент.ВидСравнения  = ВидСравнения.Равно;
			НаборЗаписей.Отбор.Контрагент.Использование = истина;
			НаборЗаписей.Отбор.Контрагент.Значение = стр.Контрагент;
			НаборЗаписей.Отбор.ТоварнаяГруппа.ВидСравнения  = ВидСравнения.Равно;
			НаборЗаписей.Отбор.ТоварнаяГруппа.Использование = истина;
			НаборЗаписей.Отбор.ТоварнаяГруппа.Значение = стр.ТоварнаяГруппа;
			НаборЗаписей.Прочитать();
			Если НаборЗаписей.Количество()>0 Тогда
				НаборЗаписей[0].Ответственный = глТекущийПользователь;
			иначе
			Запись = НаборЗаписей.Добавить();
			Запись.Контрагент = стр.Контрагент;
			Запись.Ответственный = глТекущийПользователь;
			Запись.ТоварнаяГруппа = стр.ТоварнаяГруппа;
			конецЕсли;
			НаборЗаписей.Записать();
			стр.ОтветственноеЛицо = глТекущийПользователь;

		    иначеЕсли стр.пометка и списокРуководителей.НайтиПоЗначению(глТекущийПользователь) <> неопределено тогда
			НаборЗаписей = РегистрыСведений.СтатусыКонтрагентовПоТоварнымГруппам.СоздатьНаборЗаписей();
			НаборЗаписей.Отбор.Контрагент.ВидСравнения  = ВидСравнения.Равно;
			НаборЗаписей.Отбор.Контрагент.Использование = истина;
			НаборЗаписей.Отбор.Контрагент.Значение = стр.Контрагент;
			НаборЗаписей.Отбор.ТоварнаяГруппа.ВидСравнения  = ВидСравнения.Равно;
			НаборЗаписей.Отбор.ТоварнаяГруппа.Использование = истина;
			НаборЗаписей.Отбор.ТоварнаяГруппа.Значение = стр.ТоварнаяГруппа;
			НаборЗаписей.Прочитать();
			Если НаборЗаписей.Количество()>0 Тогда
				НаборЗаписей[0].Ответственный = Ответственный;
			иначе
			Запись = НаборЗаписей.Добавить();
			Запись.Контрагент = стр.Контрагент;
			Запись.Ответственный = Ответственный;
			Запись.ТоварнаяГруппа = стр.ТоварнаяГруппа;
			конецЕсли;
			НаборЗаписей.Записать();
			стр.ОтветственноеЛицо = Ответственный;

		КонецЕсли;
	конецЦикла;	
КонецПроцедуры

Процедура ОсновныеДействияФормыЗаполнить(Кнопка)

	
	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	КонтактнаяИнформация.Объект КАК РегионКонтрагент,
		|	КонтактнаяИнформация.Поле2 КАК Поле2
		|ПОМЕСТИТЬ Регион
		|ИЗ
		|	РегистрСведений.КонтактнаяИнформация КАК КонтактнаяИнформация
		|ГДЕ
		|	КонтактнаяИнформация.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Адрес)
		|	И КонтактнаяИнформация.Вид = ЗНАЧЕНИЕ(Справочник.ВидыКонтактнойИнформации.ФактАдресКонтрагента)
		|
		|СГРУППИРОВАТЬ ПО
		|	КонтактнаяИнформация.Объект,
		|	КонтактнаяИнформация.Поле2
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПродажиОбороты.ДоговорКонтрагента.Владелец КАК ДоговорКонтрагентаВладелец,
		|	ПродажиОбороты.Номенклатура.ВидТовара КАК НоменклатураВидТовара,
		|	СУММА(ПродажиОбороты.СтоимостьОборот) КАК СтоимостьОборот
		|ПОМЕСТИТЬ СуммаПродажЗаПериод
		|ИЗ
		|	РегистрНакопления.Продажи.Обороты(&Дата1, &Дата2, , ) КАК ПродажиОбороты
		|
		|СГРУППИРОВАТЬ ПО
		|	ПродажиОбороты.ДоговорКонтрагента.Владелец,
		|	ПродажиОбороты.Номенклатура.ВидТовара
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ЗначенияСвойствОбъектов.Объект КАК ВажностьКонтрагент,
		|	ЗначенияСвойствОбъектов.Значение КАК Значение
		|ПОМЕСТИТЬ Важность
		|ИЗ
		|	РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияСвойствОбъектов
		|ГДЕ
		|	ЗначенияСвойствОбъектов.Свойство.Код = ""90184""
		|
		|СГРУППИРОВАТЬ ПО
		|	ЗначенияСвойствОбъектов.Объект,
		|	ЗначенияСвойствОбъектов.Значение
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ЗначенияСвойствОбъектов.Объект КАК Объект,
		|	ЗначенияСвойствОбъектов.Значение
		|ПОМЕСТИТЬ статусыКонтрагентов
		|ИЗ
		|	РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияСвойствОбъектов
		|ГДЕ
		|	ЗначенияСвойствОбъектов.Свойство = &Свойство
		|
		|СГРУППИРОВАТЬ ПО
		|	ЗначенияСвойствОбъектов.Объект,
		|	ЗначенияСвойствОбъектов.Значение
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СтатусыКонтрагентовПоТоварнымГруппам.Контрагент КАК Контрагент,
		|	СтатусыКонтрагентовПоТоварнымГруппам.Ответственный КАК ОтветственноеЛицо,
		|	СтатусыКонтрагентовПоТоварнымГруппам.ТоварнаяГруппа КАК ТоварнаяГруппа,
		|	СтатусыКонтрагентовПоТоварнымГруппам.Контрагент.ОсновнойМенеджерКонтрагента КАК ОсновнойМенеджер,
		|	СтатусыКонтрагентовПоТоварнымГруппам.Контрагент.ОсновнойМенеджерКонтрагента.НаправлениеПродаж КАК НаправлениеПродаж,
		|	ЛОЖЬ КАК пометка,
		|	СУММА(СуммаПродажЗаПериод.СтоимостьОборот) КАК СуммаПродаж,
		|	Важность.Значение КАК Важность,
		|	статусыКонтрагентов.Значение КАК Статус,
		|	Регион.Поле2 КАК Регион,
		|	СтатусыКонтрагентовПоТоварнымГруппам.Контрагент.Код КАК КодКонтрагента,
		|	СтатусыКонтрагентовПоТоварнымГруппам.Контрагент.ДопустимаяСуммаЗадолженности КАК ЛимитДебиторскойЗадолженности
		|ИЗ
		|	РегистрСведений.СтатусыКонтрагентовПоТоварнымГруппам КАК СтатусыКонтрагентовПоТоварнымГруппам
		|		ЛЕВОЕ СОЕДИНЕНИЕ СуммаПродажЗаПериод КАК СуммаПродажЗаПериод
		|		ПО СтатусыКонтрагентовПоТоварнымГруппам.Контрагент = СуммаПродажЗаПериод.ДоговорКонтрагентаВладелец
		|			И СтатусыКонтрагентовПоТоварнымГруппам.ТоварнаяГруппа = СуммаПродажЗаПериод.НоменклатураВидТовара
		|		ЛЕВОЕ СОЕДИНЕНИЕ Важность КАК Важность
		|		ПО СтатусыКонтрагентовПоТоварнымГруппам.Контрагент = Важность.ВажностьКонтрагент
		|		ЛЕВОЕ СОЕДИНЕНИЕ статусыКонтрагентов КАК статусыКонтрагентов
		|		ПО СтатусыКонтрагентовПоТоварнымГруппам.Контрагент = статусыКонтрагентов.Объект
		|		ЛЕВОЕ СОЕДИНЕНИЕ Регион КАК Регион
		|		ПО СтатусыКонтрагентовПоТоварнымГруппам.Контрагент = Регион.РегионКонтрагент
		|ГДЕ
		|	99 = 99
		|	И 98 = 98
		|
		|СГРУППИРОВАТЬ ПО
		|	СтатусыКонтрагентовПоТоварнымГруппам.Контрагент,
		|	СтатусыКонтрагентовПоТоварнымГруппам.Ответственный,
		|	СтатусыКонтрагентовПоТоварнымГруппам.ТоварнаяГруппа,
		|	Важность.Значение,
		|	статусыКонтрагентов.Значение,
		|	Регион.Поле2,
		|	СтатусыКонтрагентовПоТоварнымГруппам.Контрагент.ОсновнойМенеджерКонтрагента.НаправлениеПродаж,
		|	СтатусыКонтрагентовПоТоварнымГруппам.Контрагент.ОсновнойМенеджерКонтрагента,
		|	СтатусыКонтрагентовПоТоварнымГруппам.Контрагент.Код
		|
		|УПОРЯДОЧИТЬ ПО
		|	СтатусыКонтрагентовПоТоварнымГруппам.Контрагент.Наименование,
		|	СтатусыКонтрагентовПоТоварнымГруппам.Контрагент.Код,
		|	ТоварнаяГруппа";
		
		
		Запрос.УстановитьПараметр("Свойство",ПланыВидовХарактеристик.СвойстваОбъектов.НайтиПоКоду("90218"));
		Запрос.УстановитьПараметр("Дата1",НачПериода);
		Запрос.УстановитьПараметр("Дата2",КонПериода);

				
    Если списокРуководителей.НайтиПоЗначению(глТекущийПользователь) = неопределено тогда
		//Запрос.Текст = СтрЗаменить(Запрос.Текст,"99 = 99","СтатусыКонтрагентовПоТоварнымГруппам.Контрагент.ОсновнойМенеджерКонтрагента = &Ответственный");
		//Запрос.УстановитьПараметр("Ответственный", глТекущийПользователь);
	КонецЕсли;
	если ВсеГруппы = 1 тогда
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"98 = 98","СтатусыКонтрагентовПоТоварнымГруппам.ТоварнаяГруппа = Значение(перечисление.ВидыТоваров.Диски)");
		Запрос.УстановитьПараметр("Ответственный", глТекущийПользователь);
	конецЕсли;
	если ВсеГруппы = 2 тогда
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"98 = 98","СтатусыКонтрагентовПоТоварнымГруппам.ТоварнаяГруппа = Значение(перечисление.ВидыТоваров.Шины)");
		Запрос.УстановитьПараметр("Ответственный", глТекущийПользователь);
	конецЕсли;
	если ВсеГруппы = 3 тогда
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"98 = 98","СтатусыКонтрагентовПоТоварнымГруппам.ТоварнаяГруппа = Значение(перечисление.ВидыТоваров.Аксессуары)");
		Запрос.УстановитьПараметр("Ответственный", глТекущийПользователь);
	конецЕсли;
	если ВсеГруппы = 4 тогда
		Запрос.Текст = СтрЗаменить(Запрос.Текст,"98 = 98","СтатусыКонтрагентовПоТоварнымГруппам.ТоварнаяГруппа = Значение(перечисление.ВидыТоваров.АКБ)");
		Запрос.УстановитьПараметр("Ответственный", глТекущийПользователь);
	конецЕсли;

	
	Список.Загрузить(Запрос.Выполнить().Выгрузить());
	
КонецПроцедуры

Процедура ПриОткрытии()
	Если списокРуководителей.НайтиПоЗначению(глТекущийПользователь) = неопределено тогда
		ЭлементыФормы.НадписьОтветственный.Видимость = Ложь;
		ЭлементыФормы.Ответственный.Видимость = Ложь;
	конецЕсли;
	
	Если ЗначениеЗаполнено(НачПериода) Тогда
	Иначе
		НачПериода = НачалоГода(ТекущаяДата());
		КонПериода = ТекущаяДата();
	КонецЕсли;		
КонецПроцедуры

Процедура УстановитьНажатие(Элемент)
	Для каждого стр из Список цикл
		Если ЭлементыФормы.Список.ПроверитьСтроку(стр) Тогда
			стр.Пометка = Истина;	
		конецЕсли;
	конецЦикла;	
КонецПроцедуры

Процедура СнятьНажатие(Элемент)
	Для каждого стр из Список цикл
		Если ЭлементыФормы.Список.ПроверитьСтроку(стр) Тогда
		//Если Список.ПроверитьСтроку(стр) Тогда
			стр.Пометка = Ложь;	
		конецЕсли;
	конецЦикла;	
КонецПроцедуры

Процедура ОчиститьНажатие(Элемент)
	Для  каждого стр из список цикл
		    Если стр.пометка Тогда
			НаборЗаписей = РегистрыСведений.СтатусыКонтрагентовПоТоварнымГруппам.СоздатьНаборЗаписей();
			НаборЗаписей.Отбор.Контрагент.ВидСравнения  = ВидСравнения.Равно;
			НаборЗаписей.Отбор.Контрагент.Использование = истина;
			НаборЗаписей.Отбор.Контрагент.Значение = стр.Контрагент;
			НаборЗаписей.Отбор.ТоварнаяГруппа.ВидСравнения  = ВидСравнения.Равно;
			НаборЗаписей.Отбор.ТоварнаяГруппа.Использование = истина;
			НаборЗаписей.Отбор.ТоварнаяГруппа.Значение = стр.ТоварнаяГруппа;
			НаборЗаписей.Прочитать();
			Если НаборЗаписей.Количество()>0 Тогда
				НаборЗаписей[0].Ответственный = Справочники.Пользователи.ПустаяСсылка();
			иначе
			Запись = НаборЗаписей.Добавить();
			Запись.Контрагент = стр.Контрагент;
			Запись.Ответственный = Справочники.Пользователи.ПустаяСсылка();
			Запись.ТоварнаяГруппа = стр.ТоварнаяГруппа;
			конецЕсли;
			НаборЗаписей.Записать();
			стр.ОтветственноеЛицо = Справочники.Пользователи.ПустаяСсылка();
			конецЕсли;
	конецЦикла;	

КонецПроцедуры

Процедура КнопкаВыбораПериодаНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	Если НастройкаПериода.Редактировать() Тогда
		НачПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры

Процедура ПоказатьЛимитПриИзменении(Элемент)
	ЭлементыФормы.Список.Колонки.ЛимитДебиторскойЗадолженности.Видимость = ПоказатьЛимит;
КонецПроцедуры
	
    СписокРуководителей = Новый   СписокЗначений;

	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	НаправленияПродаж.Руководитель
		|ИЗ
		|	Справочник.НаправленияПродаж КАК НаправленияПродаж";

	Результат = Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("Руководитель");

	СписокРуководителей.ЗагрузитьЗначения(Результат);
	СписокРуководителей.Добавить(Справочники.Пользователи.НайтиПоКоду("Серков"));
    СписокРуководителей.Добавить(Справочники.Пользователи.НайтиПоКоду("Марешева И.Г."));
	СписокРуководителей.Добавить(Справочники.Пользователи.НайтиПоКоду("Голубева В.С."));
	СписокРуководителей.Добавить(Справочники.Пользователи.НайтиПоКоду("Сухачева А.В."));
	СписокРуководителей.Добавить(Справочники.Пользователи.НайтиПоКоду("Плотников"));
	СписокРуководителей.Добавить(Справочники.Пользователи.НайтиПоКоду("Алексеева А.Е."));
	СписокРуководителей.Добавить(Справочники.Пользователи.НайтиПоКоду("Красюк Н.В.(руководитель)"));
	СписокРуководителей.Добавить(Справочники.Пользователи.НайтиПоКоду("Лигута А.С.(руководитель)"));

Функция Печать() Экспорт
	СразуНаПринтер = Ложь;
	колЭкзТОРГ12 = 0;
    колЭкзТТН = 0;
    колЭкзРН = 0;
	КолЭкзСпец = 0;
	
	Список = Новый СписокЗначений;
	Список.Добавить("Самовывоз");
	Список.Добавить("Доставка сторонними перевозчиками");
	Список.Добавить("Доставка до ТК");
	Список.Добавить("Автоэксперт");
	СпособОтгрузки = Список.ВыбратьЭлемент("Способ отгрузки").Значение;
	Подразделение = ССылкаНаОбъект.Подразделение;
	Если не Найти(СсылкаНаОбъект.ДоговорКонтрагента.Наименование,"*") Тогда
		// безнал	
		Если СпособОтгрузки = "Самовывоз" Тогда  //Самовывоз
			Заказ = СсылкаНаОбъект.Сделка.ПолучитьОбъект();
			Заказ.самовывоз = истина;
			Заказ.Записать(РежимЗаписиДокумента.Запись);
			Если Подразделение = Справочники.Подразделения.НайтиПоКоду("00106") Тогда  //Ростов	
				колЭкзТТН = 0;
				колЭкзТОРГ12 = 2;
				колЭкзРН = 0;
				КолЭкзСпец = 2;
			ИначеЕсли Подразделение = Справочники.Подразделения.НайтиПоКоду("00112") Тогда  //Питер	
				колЭкзТТН = 0;
				колЭкзТОРГ12 = 2;
				колЭкзРН = 0;
				КолЭкзСпец = 2;
			ИначеЕсли Подразделение = Справочники.Подразделения.НайтиПоКоду("00122") или Подразделение = Справочники.Подразделения.НайтиПоКоду("00138") Тогда  //Екатеринбург	
				колЭкзТТН = 0;
				колЭкзТОРГ12 = 2;
				колЭкзРН = 0;
				КолЭкзСпец = 2;
			ИначеЕсли Подразделение = Справочники.Подразделения.НайтиПоКоду("00133") Тогда  //Москва
				колЭкзТТН = 0;
				колЭкзТОРГ12 = 2;
				колЭкзРН = 0;
				КолЭкзСпец = 2;
			конецЕсли;
			
		ИначеЕсли СпособОтгрузки = "Доставка сторонними перевозчиками" Тогда  //Доставка сторонними перевозчиками
			Если Подразделение = Справочники.Подразделения.НайтиПоКоду("00106") Тогда  //Ростов	
				колЭкзТТН = 4;
				колЭкзТОРГ12 = 3;
				колЭкзРН = 0;
				КолЭкзСпец = 2;
			ИначеЕсли Подразделение = Справочники.Подразделения.НайтиПоКоду("00112") Тогда  //Питер	
				колЭкзТТН = 3;
				колЭкзТОРГ12 = 3;
				колЭкзРН = 0;
				КолЭкзСпец = 2;
			ИначеЕсли Подразделение = Справочники.Подразделения.НайтиПоКоду("00122") или Подразделение = Справочники.Подразделения.НайтиПоКоду("00138") Тогда  //Екатеринбург	
				колЭкзТТН =1;
				колЭкзТОРГ12 = 2;
				колЭкзРН = 0;
				КолЭкзСпец = 2;
			конецЕсли;
		ИначеЕсли СпособОтгрузки = "Доставка до ТК" Тогда  //ТК
			Если Подразделение = Справочники.Подразделения.НайтиПоКоду("00122") или Подразделение = Справочники.Подразделения.НайтиПоКоду("00138") Тогда  //Екатеринбург	
				колЭкзТТН = 2;
				колЭкзТОРГ12 = 3;
				колЭкзРН = 0;
				КолЭкзСпец = 2;
			конецЕсли;
		ИначеЕсли  СпособОтгрузки = "Автоэксперт" Тогда  //Доставка сторонними перевозчиками
			Если Подразделение = Справочники.Подразделения.НайтиПоКоду("00106") Тогда  //Ростов	
				колЭкзТТН = 3;
				колЭкзТОРГ12 = 2;
				колЭкзРН = 0;
				КолЭкзСпец = 0;
			ИначеЕсли Подразделение = Справочники.Подразделения.НайтиПоКоду("00112") Тогда  //Питер	
				колЭкзТТН = 1;
				колЭкзТОРГ12 = 2;
				колЭкзРН = 0;
				КолЭкзСпец = 0;
			ИначеЕсли Подразделение = Справочники.Подразделения.НайтиПоКоду("00122") или Подразделение = Справочники.Подразделения.НайтиПоКоду("00138") Тогда  //Екатеринбург	
				колЭкзТТН = 0;
				колЭкзТОРГ12 = 3;
				колЭкзРН = 0;
				КолЭкзСпец = 0;
			КонецЕсли;	
			
		КонецЕсли;
	иначеЕсли СсылкаНаОбъект.Договорконтрагента.типДоговора = Справочники.ТипыДоговоров.НайтиПоКоду("00004") Тогда //нал с отсрочкой
		Если СпособОтгрузки = "Самовывоз" Тогда  //Самовывоз
			Заказ = СсылкаНаОбъект.Сделка.ПолучитьОбъект();
			Заказ.самовывоз = истина;
			Заказ.Записать(РежимЗаписиДокумента.Запись);

			Если Подразделение = Справочники.Подразделения.НайтиПоКоду("00106") Тогда  //Ростов	
				колЭкзТТН = 0;
				колЭкзТОРГ12 = 1;
				колЭкзРН = 3;
				КолЭкзСпец = 0;
			ИначеЕсли Подразделение = Справочники.Подразделения.НайтиПоКоду("00112") Тогда  //Питер	
				колЭкзТТН = 0;
				колЭкзТОРГ12 = 1;
				колЭкзРН = 1;
				КолЭкзСпец = 0;
			ИначеЕсли Подразделение = Справочники.Подразделения.НайтиПоКоду("00122") или Подразделение = Справочники.Подразделения.НайтиПоКоду("00138") Тогда  //Екатеринбург	
				колЭкзТТН = 0;
				колЭкзТОРГ12 = 1;
				колЭкзРН = 1;
				КолЭкзСпец = 0;
				
			конецЕсли;
		ИначеЕсли  СпособОтгрузки = "Доставка сторонними перевозчиками" Тогда  //Доставка сторонними перевозчиками
			Если Подразделение = Справочники.Подразделения.НайтиПоКоду("00106") Тогда  //Ростов	
				колЭкзТТН = 2;
				колЭкзТОРГ12 = 2;
				колЭкзРН = 2;
				КолЭкзСпец = 0;
			ИначеЕсли Подразделение = Справочники.Подразделения.НайтиПоКоду("00112") Тогда  //Питер	
				колЭкзТТН = 2;
				колЭкзТОРГ12 = 2;
				колЭкзРН = 1;
				КолЭкзСпец = 0;
			ИначеЕсли Подразделение = Справочники.Подразделения.НайтиПоКоду("00122") или Подразделение = Справочники.ПодразделенияОрганизаций.НайтиПоКоду("00138") Тогда  //Екатеринбург	
				колЭкзТТН = 0;
				колЭкзТОРГ12 = 1;
				колЭкзРН = 1;
				КолЭкзСпец = 0;
			конецЕсли;
			
		ИначеЕсли  СпособОтгрузки = "Автоэксперт" Тогда  //Доставка сторонними перевозчиками
			Если Подразделение = Справочники.Подразделения.НайтиПоКоду("00106") Тогда  //Ростов	
				колЭкзТТН = 3;
				колЭкзТОРГ12 = 2;
				колЭкзРН = 0;
				КолЭкзСпец = 0;
			ИначеЕсли Подразделение = Справочники.Подразделения.НайтиПоКоду("00112") Тогда  //Питер	
				колЭкзТТН = 1;
				колЭкзТОРГ12 = 2;
				колЭкзРН = 0;
				КолЭкзСпец = 0;
			ИначеЕсли Подразделение = Справочники.Подразделения.НайтиПоКоду("00122") или Подразделение = Справочники.ПодразделенияОрганизаций.НайтиПоКоду("00138") Тогда  //Екатеринбург	
				колЭкзТТН = 0;
				колЭкзТОРГ12 = 3;
				колЭкзРН = 0;
				КолЭкзСпец = 0;
			КонецЕсли;	
		конецЕсли;
	КонецЕсли;	
	
	
	
	Если ссылкаНаОбъект.Проведен Тогда
	РеализацияОбъект = ССылкаНаОбъект.ПолучитьОбъект();	
	ОбработкаПрерыванияПользователя();
	
	Режим = РежимДиалогаВопрос.ДаНет;
	Ответ = Вопрос("Распечатать все документы сразу на принтер?", Режим, 30, КодВозвратаДиалога.Нет);
	Если Ответ = КодВозвратаДиалога.Да Тогда
		сразуНаПринтер = Истина;
	КонецЕсли;
	
	//Торг-12
	 			
	Если ССылкаНаОбъект.Сделка.ДоговорКонтрагента.ТипДоговора=Справочники.ТипыДоговоров.Факторинг Тогда
		имя = "ТОРГ-12 Факторинг ПромсвязьБанк.";
		имяМакета = Справочники.ДополнительныеПечатныеФормы.НайтиПоНаименованию(имя); 
	Иначе	
		имя = "ТОРГ-12 (Яршинторг)";
		имяМакета = Справочники.ДополнительныеПечатныеФормы.НайтиПоНаименованию(имя); 
	КонецЕсли;
	
	РеализацияОбъект.Печать(имяМакета, колЭкзТОРГ12, сразуНаПринтер);
	
	
	Если колЭкзТТН <> 0 Тогда
	
	//ТТН
	имя1 = "ТТН-2012 (ТН прил.№4, СВ прил.№8)";
	имяМакета1 = Справочники.ДополнительныеПечатныеФормы.НайтиПоНаименованию(имя1); 
	ИмяФайла1 = КаталогВременныхФайлов()+"PrnFormTTN.tmp";
	ОбъектВнешнейФормы1 = ИмяМакета1.ПолучитьОбъект();
	Если ОбъектВнешнейФормы1 = Неопределено Тогда
		Сообщить("Ошибка получения внешней печ.формы '"+имя1+"'. Возможно форма была удалена или переименована.", СтатусСообщения.Важное);
		Возврат "";
	КонецЕсли;
	
	ДвоичныеДанные1 = ОбъектВнешнейФормы1.ХранилищеВнешнейОбработки.Получить();
	ДвоичныеДанные1.Записать(ИмяФайла1);
	Обработка1 = ВнешниеОбработки.Создать(ИмяФайла1);
	формаОбработки = Обработка1.получитьФорму();
	Обработка1.СсылкаНаОбъект  = документы.РеализацияТоваровУслуг.ПустаяСсылка();
	Обработка1.СсылкаНаОбъект = СсылкаНаОбъект;
	формаОбработки.ЗаполнитьДанныеПоДокументу();
	
	ТабДокумент = Обработка1.Печать(ложь,"");
	ТабДокумент.РазборПокопиям = Истина;
	НапечататьДокумент(ТабДокумент, колЭкзТТН, сразуНаПринтер,  " ТТН(прил.№4) по накладной № "+строка(СсылкаНаОбъект.Номер) );
	
	КонецЕсли;
	
	Если КолЭкзСпец <> 0 Тогда
	//Спецификация
	имя2 = "Спецификация - новая форма";
	имяМакета2 = Справочники.ДополнительныеПечатныеФормы.НайтиПоНаименованию(имя2); 
	ИмяФайла2 = КаталогВременныхФайлов()+"PrnFormSpec.tmp";
	ОбъектВнешнейФормы2 = ИмяМакета2.ПолучитьОбъект();
	Если ОбъектВнешнейФормы2 = Неопределено Тогда
		Сообщить("Ошибка получения внешней печ.формы '"+имя2+"'. Возможно форма была удалена или переименована.", СтатусСообщения.Важное);
		Возврат "";
	КонецЕсли;
	
	ДвоичныеДанные2 = ОбъектВнешнейФормы2.ХранилищеВнешнейОбработки.Получить();
	ДвоичныеДанные2.Записать(ИмяФайла2);
	Обработка2 = ВнешниеОбработки.Создать(ИмяФайла2);
	Обработка2.СсылкаНаОбъект = документы.Спецификация.ПустаяСсылка();
	Если ССылкаНаОбъект.Сделка.ВыписатьСпецификацию Тогда // Если в Заказе Покупателя указана необходимость...
		Спецификация = НайтиПодчиненныйДокумент(ССылкаНаОбъект, "Спецификация");
		Если Спецификация = Неопределено Тогда
			ОбъектСпецификации = Документы.Спецификация.СоздатьДокумент();
			
			ЗаполнитьЗначенияСвойств(ОбъектСпецификации, ССылкаНаОбъект); // Контрагент, Договор, Организация, Подразделение
			
			ОбъектСпецификации.Дата = ТекущаяДата();
			УстановитьНомерДокумента(ОбъектСпецификации);
			ОбъектСпецификации.ДокументОснование = ССылкаНаОбъект;
			
			ОбъектСпецификации.СпособОтгрузки = ССылкаНаОбъект.Сделка.СпособОтгрузки;
			
			ОбъектСпецификации.СпособОплаты   = Перечисления.ВидыДенежныхСредств.Безналичные;
			
			//--------------установить номер Для печати-------------------
			Запрос = Новый Запрос;
			Запрос.УстановитьПараметр("Контрагент", ССылкаНаОбъект.Контрагент);
			Запрос.Текст =
			"ВЫБРАТЬ РАЗЛИЧНЫЕ
			|	Спецификация.Ссылка КАК Ссылка
			|ИЗ
			|	Документ.Спецификация КАК Спецификация
			|ГДЕ
			|	Спецификация.Контрагент = &Контрагент";
			
			СледНомер = Строка(Запрос.Выполнить().Выбрать().Количество() + 1);
			
			//ОбъектСпецификации.НомерДляПечати = Номер + "/" + СледНомер;
			ЕстьИзменения = Истина;
		Иначе
			ОбъектСпецификации = Спецификация.ПолучитьОбъект();
			ЕстьИзменения = ложь;	//ПереЗапись
			Если НЕ (ОбъектСпецификации.Контрагент = ССылкаНаОбъект.Контрагент
				и ОбъектСпецификации.ДоговорКонтрагента =  ССылкаНаОбъект.ДоговорКонтрагента
				и ОбъектСпецификации.Организация 	 =  ССылкаНаОбъект.Организация
				и ОбъектСпецификации.Подразделение 	 =  ССылкаНаОбъект.Подразделение) Тогда
				ЕстьИзменения = Истина;
				ОбъектСпецификации.Контрагент = ССылкаНаОбъект.Контрагент;
				ОбъектСпецификации.ДоговорКонтрагента =  ССылкаНаОбъект.ДоговорКонтрагента;
				ОбъектСпецификации.Организация 	 =  ССылкаНаОбъект.Организация;
				ОбъектСпецификации.Подразделение =  ССылкаНаОбъект.Подразделение;
			КонецЕсли;
		КонецЕсли;
		
		Если ЕстьИзменения Тогда 
			попытка   // запись или перезапись спецификации
				ОбъектСпецификации.Записать(РежимЗаписиДокумента.Проведение);
			исключение
				Сообщить("Не удалось создать документ Спецификации Для "+строка(ССылкаНаОбъект), СтатусСообщения.Внимание);
			КонецПопытки;
		КонецЕсли;
		
		Обработка2.СсылкаНаОбъект = ОбъектСпецификации.Ссылка;
		ТабДокумент2 = Обработка2.Печать();
		ТабДокумент2.РазборПокопиям = Истина;
		НапечататьДокумент(ТабДокумент2, КолЭкзСпец, сразуНаПринтер, " Спецификация по накладной № "+строка(СсылкаНаОбъект.Номер) ); 
	КонецЕсли;
    конецЕсли;	
	
	Если колЭкзРН <>0 Тогда
	//Расходнаянакладная
	РеализацияОбъект.Печать("Накладная", колЭкзРН, сразуНаПринтер);
    КонецЕсли;
конецЕсли;
//Возврат;
КонецФункции
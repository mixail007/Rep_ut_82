Перем НомерНаПечать Экспорт;

Функция Печать(НомерДока = "") Экспорт
	
	НомерНаПечать = НомерДока;
	Если Не Метаданные.Имя = "УправлениеТорговлей" Тогда
		Сообщить("Печатная форма предназначена для использования в конфигурации ""Управление торговлей""", СтатусСообщения.Внимание);
	КонецЕсли;
	
	Если ТипЗнч(СсылкаНаОбъект) = Тип("ДокументСсылка.РеализацияТоваровУслуг") Тогда
		Возврат ПечатьДокумента(СсылкаНаОбъект);
	КонецЕсли;
	
КонецФункции // Печать

Функция ПечатьДокумента(СсылкаНаОбъект)
			
	ТабДокумент = Новый ТабличныйДокумент;
	ТабДокумент.ИмяПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_ЗаявкаНаПроведениеЭкспертизы";
	
	ИмяМакета = "ЗаявкаНаЭкспертизу";
		
	Макет = ПолучитьМакет(ИмяМакета);
	ОбластьШапка        = Макет.ПолучитьОбласть("Шапка");
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ТекущийДокумент", СсылкаНаОбъект);
	Запрос.Текст = "ВЫБРАТЬ
	               |	Документ.Номенклатура.Код КАК Код,
	               |	Документ.Номенклатура КАК Номенклатура,
	               |	Документ.ЕдиницаИзмерения КАК ЕдиницаИзмерения,
	               |	СУММА(Документ.Количество) КАК Количество,
				   |	СУММА(ВЫБОР КОГДА Документ.КоличествоМест > 0 Тогда Документ.КоличествоМест ИНАЧЕ Документ.Количество КОНЕЦ) КАК КоличествоМест
	               |ИЗ
	               |	Документ.РеализацияТоваровУслуг.Товары КАК Документ
	               |ГДЕ
	               |	Документ.Ссылка = &ТекущийДокумент
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	Документ.Номенклатура,
	               |	Документ.ЕдиницаИзмерения,
	               |	Документ.Номенклатура.Код,
				   |	Документ.Номенклатура.Производитель
	               |УПОРЯДОЧИТЬ ПО
	               |	ПОДСТРОКА(Документ.Номенклатура.НаименованиеПолное, 1, 50)
				   |";
	

	ТЗТоваров = Запрос.Выполнить().Выгрузить();
	
	//вывод шапки
		
	ОбластьШапка.Параметры.ПечНаименованиеТовара = СформироватьНаименованиеТовара(ТЗтоваров, Ложь);
	
	//ФактАдресПродавца = "г. Ярославль, 150049, Россия, ул. Лисицына, дом 7";
	//со 2 апреля 2015 изменился адрес
	ФактАдресПродавца = "Ярославль, 150014, Россия, ул. Салтыкова-Щедрина, дом 21, офис 507";
	
	ОбластьШапка.Параметры.ПродавецНаименование = "Общество с ограниченной ответственностью «ШинТрейд Ярославль»";
	ОбластьШапка.Параметры.ФактАдресПродавца = ФактАдресПродавца;
	ОбластьШапка.Параметры.ПечНомерКонтракта = "№ "+СсылкаНаОбъект.ДоговорКонтрагента.Номер+" от "+формат(СсылкаНаОбъект.ДоговорКонтрагента.Дата,"ДЛФ=D");
	
	Если НомерНаПечать = "" Тогда
		НомерДокумента = ЭтотОбъект.ПолучитьФорму("ВводНомераШинтрейдЯрославль").ОткрытьМодально();
	Иначе
		НомерДокумента = НомерНаПечать;
	КонецЕсли;
	Если СокрЛП(НомерДокумента)="" Тогда
		ОбластьШапка.Параметры.ПечНомерСФ = "";
	Иначе
		ОбластьШапка.Параметры.ПечНомерСФ = "№ "+СокрЛП(НомерДокумента)+" от "+формат(СсылкаНаОбъект.Дата,"ДЛФ=D");;
	КонецЕсли;	
	ОбластьШапка.Параметры.ПечДата  = Формат(СсылкаНаОбъект.Дата, "ДФ='dd MMMM yyyy'")+" г.";
	
	ОбластьШапка.Параметры.КолШтук = ТЗТоваров.Итог("Количество");
	ОбластьШапка.Параметры.КолМест = ТЗТоваров.Итог("КоличествоМест");
	
	ТабДокумент.Вывести(ОбластьШапка);
	ТабДокумент.АвтоМасштаб = Истина;
	ТабДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Портрет;
	
	Возврат ТабДокумент;
				   
КонецФункции

Функция СформироватьНаименованиеТовара(ТЗтоваров, ДваЯзыка)
	
	ГруппаЛитые = Справочники.Номенклатура.НайтиПоКоду("0001753"); //это из алюминия легковые
	ГруппаГрузовые = Справочники.Номенклатура.НайтиПоКоду("9004163");  //это грузовые
	ГруппаШтампованные = Справочники.Номенклатура.НайтиПоКоду("0001755"); //это стальные легковые
	
	ЕстьАлюминиевые = Ложь;
	ЕстьСтальные = Ложь;
	ЕстьГрузовые = Ложь;
	ЕстьАксессуары = Ложь;
	ЕстьШины = Ложь;
	Для Каждого Стр из ТЗТоваров Цикл
		ЭтоЛитойДиск = Стр.Номенклатура.ПринадлежитЭлементу(ГруппаЛитые);
		ЭтоШтампованныйДиск = Стр.Номенклатура.ПринадлежитЭлементу(ГруппаШтампованные);
		ЭтоГрузовойДиск = Стр.Номенклатура.ПринадлежитЭлементу(ГруппаГрузовые);
		Если ЭтоЛитойДиск Тогда
			ЕстьАлюминиевые = Истина;
		ИначеЕсли ЭтоШтампованныйДиск Тогда
			ЕстьСтальные = Истина;
		ИначеЕсли ЭтоГрузовойДиск Тогда 
			ЕстьГрузовые = Истина;
		ИначеЕсли Стр.Номенклатура.ВидТовара = Перечисления.ВидыТоваров.Аксессуары Тогда
			ЕстьАксессуары = Истина;
		ИначеЕсли Стр.Номенклатура.ВидТовара = Перечисления.ВидыТоваров.Шины Тогда
			ЕстьШины = Истина;
		КонецЕсли;	
	КонецЦикла;	
	ПечНаименованиеТовара = "";
	ПечНаименованиеТовараАнгл = "";
	Если ЕстьАлюминиевые Тогда
		ПечНаименованиеТовара = ПечНаименованиеТовара+"Новые алюминиевые";
		ПечНаименованиеТовараАнгл = ПечНаименованиеТовараАнгл+"New aluminum";
	КонецЕсли;
	Если ЕстьСтальные Тогда
		ПечНаименованиеТовара = ?(ПечНаименованиеТовара = "","Новые стальные", ПечНаименованиеТовара+", стальные");
		ПечНаименованиеТовараАнгл = ?(ПечНаименованиеТовараАнгл = "","New steel", ПечНаименованиеТовараАнгл+", steel");
	КонецЕсли;
	Если ПечНаименованиеТовара <> "" Тогда
		ПечНаименованиеТовара = ПечНаименованиеТовара+" колеса для легковых автомобилей, ";
		ПечНаименованиеТовараАнгл = ПечНаименованиеТовараАнгл+" wheels for passenger cars, ";
	КонецЕсли;
	Если ЕстьГрузовые Тогда
		ПечНаименованиеТовара = ПечНаименованиеТовара+"Новые колеса для грузовых автомобилей, ";
		ПечНаименованиеТовараАнгл = ПечНаименованиеТовараАнгл+"New wheels for trucks, ";
	КонецЕсли;
	Если ЕстьШины Тогда
		ПечНаименованиеТовара = ПечНаименованиеТовара+"Шины, ";
		ПечНаименованиеТовараАнгл = ПечНаименованиеТовараАнгл+"Tires, ";
	КонецЕсли;	
	Если ЕстьАксессуары Тогда
		ПечНаименованиеТовара = ПечНаименованиеТовара+"Аксессуары, ";
		ПечНаименованиеТовараАнгл = ПечНаименованиеТовараАнгл+"Accessories, ";
	КонецЕсли;	
	
	ПечНаименованиеТовара = Лев(ПечНаименованиеТовара, СтрДлина(ПечНаименованиеТовара)-2);
	ПечНаименованиеТовараАнгл = Лев(ПечНаименованиеТовараАнгл, СтрДлина(ПечНаименованиеТовараАнгл)-2);
	
	Если ДваЯзыка Тогда
		возврат ПечНаименованиеТовараАнгл+" / "+ПечНаименованиеТовара;
	Иначе	
		возврат ПечНаименованиеТовара;
	КонецЕсли;
	
КонецФункции
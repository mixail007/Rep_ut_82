
Перем КоличествоСтрокНаЛисте;
Перем КоличествоСтрокШапки;
Перем КоличествоСтрокПодвала;	
Перем КоличествоСтрокШапкиВторойСтраницы;
Перем Контрагент;	

Функция ПолучитьСуммуПрописью(ВсегоКоличество,ВсегоСумма, ВалютаДокумента)
	СтрокаВозврата = "Всего получено: " + Лев(ЧислоПрописью(ВсегоКоличество,"НД=ложь"),Найти(ЧислоПрописью(ВсегоКоличество,"НД=ложь"),"00") - 1) + "единиц(ы) товара. На сумму: " + ЧислоПрописью(ВсегоСумма, ,ВалютаДокумента.ПараметрыПрописиНаРусском);	
	Возврат СтрокаВозврата;
КонецФункции

Процедура УстановитьЗначенияКоличестваСтрокНаЛисте()
	КоличествоСтрокНаЛисте	= 57;
	КоличествоСтрокШапки 	= 28;
	КоличествоСтрокПодвала	= 15;	
	КоличествоСтрокШапкиВторойСтраницы = 6;
КонецПроцедуры

// Функция берет реквизиты шапки документа и возвращает структуру.
Функция ЗаполнитьРеквизитыШапки(ДокументСсылка)
	СтруктураШапки = Новый Структура;
	ЗапросПоРеквизитам = Новый Запрос;
	ЗапросПоРеквизитам.УстановитьПараметр("Ссылка",ДокументСсылка);
	ЗапросПоРеквизитам.Текст = "ВЫБРАТЬ
	                           |	РеализацияТоваровУслуг.Организация,
	                           |	РеализацияТоваровУслуг.Контрагент,
	                           |	РеализацияТоваровУслуг.Номер,
	                           |	РеализацияТоваровУслуг.Дата
	                           |ИЗ
	                           |	Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
	                           |ГДЕ
	                           |	РеализацияТоваровУслуг.Ссылка = &Ссылка";
	
	Шапка = ЗапросПоРеквизитам.Выполнить().Выбрать();
	Если Шапка.Следующий() Тогда
		СведенияОбОрганизации 				= СведенияОЮрФизЛице(Шапка.Организация, Шапка.Дата);
		//СведенияОПоклажедателе 				= СведенияОЮрФизЛице(Шапка.Контрагент, Шапка.Дата);
		СведенияОПоклажедателе 				= "";
		Если не ЗначениеНеЗаполнено(Шапка.Контрагент) Тогда
		СведенияОПоклажедателе 				= СведенияОЮрФизЛице(Шапка.Контрагент, Шапка.Дата);
		КонецЕсли;
	    ПредставлениеОрганизации 			= ОписаниеОрганизации(СведенияОПоклажедателе);
		ПредставлениеПоклажедателя     		= ОписаниеОрганизации(СведенияОбОрганизации,"ПолноеНаименование,ИНН,ЮридическийАдрес,Телефоны,НомерСчета,Банк,БИК,КоррСчет");
		Валюта								= Шапка.Организация.ОсновнойБанковскийСчет.ВалютаДенежныхСредств;
		СтруктураШапки.Вставить("Организация",ПредставлениеОрганизации);
		СтруктураШапки.Вставить("Поклажедатель",ПредставлениеПоклажедателя);
		СтруктураШапки.Вставить("Номер",Шапка.Номер);
		СтруктураШапки.Вставить("Дата",Шапка.Дата);
		СтруктураШапки.Вставить("Валюта",Валюта);
		Возврат СтруктураШапки;
	КонецЕсли; 
	Возврат Неопределено;
КонецФункции

Процедура ПечатьДокумента(СтруктураШапки,ДокументОприходования,КоличествоКопий=1,НаПринтер=Истина);
	
	//ЗапросПоТоварам = Новый Запрос;
	//ЗапросПоТоварам.УстановитьПараметр("Ссылка",ДокументОприходования);
	ТабДок = новый ТабличныйДокумент;
	//
			//Макет = ПолучитьМакет("Штрих");
			//ОбластьШтриха = Макет.ПолучитьОбласть("Штрих");
			//ТабДок.Вывести(ОбластьШтриха);
	
	
	ТабТовары = СсылкаНаОбъект.Товары.Выгрузить();
	ТабТовары.свернуть("Номенклатура,ЕдиницаИзмерения,Цена","Количество,Сумма");
	
	//Если (Выборка.Количество()>0) Тогда 
	//	Если (ТабТовары.Количество() + КоличествоСтрокШапки + КоличествоСтрокПодвала)> КоличествоСтрокНаЛисте Тогда	 		
			// Многостраничный вывод
			// Первая страница
        	МакетОсновной 							= ПолучитьМакет("МакетПервойСтраницы");
			МакетОстальные 							= ПолучитьМакет("МакетВторойСтраницы");
			ШапкаОсновная							= МакетОсновной.ПолучитьОбласть("Шапка");
			
			ОбШтрихКод=ШапкаОсновная.Рисунки.Штрихкод.Объект ;
			ОбШтрихКод.ТипКода = 4; 
			ОбШтрихКод.Сообщение = СформироватьШКРеализации(СсылкаНаОбъект,"M");//XMLСтрока(ЭтотОбъект.Ссылка.УникальныйИдентификатор()); 
			ОбШтрихКод.ОтображатьТекст = Ложь;


			ШапкаОсновная.Параметры.Организация 	= СтруктураШапки.Организация;
			ШапкаОсновная.Параметры.Поклажедатель 	= СтруктураШапки.Поклажедатель;
			ШапкаОсновная.Параметры.Номер 			= СтруктураШапки.Номер;				
			ШапкаОсновная.Параметры.Дата 			= СтруктураШапки.Дата;	
			ШапкаОсновная.Параметры.Страница		= "Страница 1";
			ТабДок.Вывести(ШапкаОсновная);
			СтрокаОсновная							= МакетОсновной.ПолучитьОбласть("Строка");
			Номер 									= 1;
			ИтогоКоличество 						= 0;
			ИтогоСумма 								= 0;
			НомерПозиции							= КоличествоСтрокШапки + 1;
			вывели = 0;
			всегоКоличество =0 ;
			всегоСумма = 0;
			Страница 								= 1;
			Для каждого стр из табТовары цикл
				Если (НомерПозиции<=(КоличествоСтрокНаЛисте)) тогда
					СтрокаОсновная.Параметры.Номер 			= 	Вывели+1;
					СтрокаОсновная.Параметры.Наименование 	= 	стр.номенклатура.Наименование;
					СтрокаОсновная.Параметры.Код			=	стр.номенклатура.Код;
					СтрокаОсновная.Параметры.ЕдНаим			=   стр.ЕдиницаИзмерения;
					СтрокаОсновная.Параметры.ЕдКод			= 	стр.ЕдиницаИзмерения.ЕдиницаПоКлассификатору.код;
					СтрокаОсновная.Параметры.Количество		= 	стр.Количество;
					СтрокаОсновная.Параметры.Цена			= 	стр.Цена;
					СтрокаОсновная.Параметры.Стоимость		= 	стр.Сумма;
					ИтогоКоличество 						= 	ИтогоКоличество 	+ стр.Количество;
					ИтогоСумма 								= 	ИтогоСумма		+ стр.Сумма;
					ТабДок.Вывести(СтрокаОсновная);
					НомерПозиции							= 	НомерПозиции + 1;
					Вывели						            = 	Вывели + 1;
				конецЕсли;	
				Если (НомерПозиции =(КоличествоСтрокНаЛисте)) тогда
					СтрокаИтого 							= МакетОсновной.ПолучитьОбласть("СтрокаИтого"); 
					СтрокаИтого.Параметры.ИтогоКоличество 	= ИтогоКоличество;
					СтрокаИтого.Параметры.ИтогоСтоимость 	= ИтогоСумма;
					ТабДок.Вывести(СтрокаИтого);
					// Остальные страницы
					ВсегоКоличество 						=ВсегоКоличество+ИтогоКоличество;
					ВсегоСумма								=ВсегоСумма+ ИтогоСумма;
					ИтогоКоличество							= 0;
					ИтогоСумма								= 0;
					Страница 								= Страница + 1;
				
				
				Если вывели < ТабТовары.Количество() Тогда
					ТабДок.ВывестиГоризонтальныйРазделительСтраниц();
					Страница 								= Страница 								+ 1;
					НомерПозиции = КоличествоСтрокШапкиВторойСтраницы;
					ШапкаВторая								= МакетОстальные.ПолучитьОбласть("Шапка");
					ШапкаВторая.Параметры.Страница			= "Страница " + Строка(Страница);
					ТабДок.Вывести(ШапкаВторая);			
					Условие 								= Истина;				
					НачалоСтраницы = Ложь;
				конецЕсли;	
				
				конецесли;
				//Пока Условие Цикл								
				//	СтрокаОстальные.Параметры.Номер 			= 	Номер;
				//	СтрокаОстальные.Параметры.Наименование 		= 	Выборка.Наименование;
				//	СтрокаОстальные.Параметры.Код				=	Выборка.Код;
				//	СтрокаОстальные.Параметры.ЕдНаим			=   Выборка.ЕдиницаИзмерения;
				//	СтрокаОстальные.Параметры.ЕдКод				= 	Выборка.КодЕдиницы;
				//	СтрокаОстальные.Параметры.Количество		= 	Выборка.Количество;
				//	СтрокаОстальные.Параметры.Цена				= 	Выборка.Цена;
				//	СтрокаОстальные.Параметры.Стоимость			= 	Выборка.Сумма;
				//	Номер 										= 	Номер 	+ 1;
				//	ИтогоКоличество 							= 	ИтогоКоличество 	+ Выборка.Количество;
				//	ИтогоСумма 									= 	ИтогоСумма			+ Выборка.Сумма;
				//	ТабДок.Вывести(СтрокаОстальные);
				//	НомерПозиции								= НомерПозиции + 1;
				//	Если ((НомерПозиции>=(КоличествоСтрокНаЛисте))) Тогда
				//// Выведем итого
				//		НомерПозиции 							= КоличествоСтрокШапкиВторойСтраницы;
				//		СтрокаИтого 							= МакетОсновной.ПолучитьОбласть("СтрокаИтого"); 
				//		СтрокаИтого.Параметры.ИтогоКоличество 	= ИтогоКоличество;
				//		СтрокаИтого.Параметры.ИтогоСтоимость 	= ИтогоСумма;
				//		ВсегоСумма 								= ВсегоСумма + ИтогоСумма;
				//		ВсегоКоличество 						= ВсегоКоличество + ИтогоКоличество;
				//		ТабДок.Вывести(СтрокаИтого);
				//		ИтогоКоличество 						= 0;
				//		ИтогоСумма 								= 0;					
				//		НачалоСтраницы = Истина;
				//	КонецЕсли;
				//	Условие 									= Выборка.Следующий(); 
				//	КоличествоВВыборке						= 	КоличествоВВыборке - 1;
				//	Если (Условие и НачалоСтраницы) Тогда
				//		ТабДок.ВывестиГоризонтальныйРазделительСтраниц();	
				//		Страница								= Страница + 1;
				//		ШапкаВторая.Параметры.Страница			= "Страница " + Строка(Страница);
				//		ТабДок.Вывести(ШапкаВторая);			
				//		НачалоСтраницы 							= Ложь;
				//	ИначеЕсли((Не(Условие))) Тогда 
				//		СтрокаИтого 							= МакетОсновной.ПолучитьОбласть("СтрокаИтого"); 
				//		СтрокаИтого.Параметры.ИтогоКоличество 	= ИтогоКоличество;
				//		СтрокаИтого.Параметры.ИтогоСтоимость 	= ИтогоСумма;
				//		ВсегоСумма 								= ВсегоСумма + ИтогоСумма;
				//		ВсегоКоличество 						= ВсегоКоличество + ИтогоКоличество;
				//		ТабДок.Вывести(СтрокаИтого);						
				//	КонецЕсли;	
				//КонецЦикла;
				//КонецЕсли; 				
				// Выводим последний подвал
				//ВсегоКоличество = ВсегоКоличество + ИтогоКоличество;
				//ВсегоСумма = ВсегоСумма + ИтогоСумма;
				//СтрокаИтого									= МакетОстальные.ПолучитьОбласть("СтрокаИтого");  
				//СтрокаИтого.Параметры.АктКоличество	 		= ВсегоКоличество;
				//СтрокаИтого.Параметры.АктСтоимость 			= ВсегоСумма;			
				//ТабДок.Вывести(СтрокаИтого);
			конецЦикла;			
			       если номерПозиции<>КоличествоСтрокНаЛисте тогда
			       СтрокаИтого 							= Макетосновной.ПолучитьОбласть("СтрокаИтого"); 
			       СтрокаИтого.Параметры.ИтогоКоличество 	= ИтогоКоличество;
			       СтрокаИтого.Параметры.ИтогоСтоимость 	= ИтогоСумма;
			       ТабДок.Вывести(СтрокаИтого);
					ВсегоКоличество 						=ВсегоКоличество+ИтогоКоличество;
					ВсегоСумма								=ВсегоСумма+ ИтогоСумма;

                   конецЕсли;
			
					
					Подвал										= МакетОстальные.ПолучитьОбласть("Подвал");
					Если ((НомерПозиции + КоличествоСтрокПодвала)>КоличествоСтрокНаЛисте) Тогда
						ТабДок.ВывестиГоризонтальныйРазделительСтраниц();
						Подвал.Параметры.Страница				= "Страница " + Строка(Страница + 1);
					КонецЕсли;
					СуммаПрописью = ПолучитьСуммуПрописью(ВсегоКоличество,ВсегоСумма, СтруктураШапки.Валюта);
					Подвал.Параметры.Принято					= СуммаПрописью; 
					ТабДок.Вывести(Подвал);
		//Иначе
		//	// Одностраничный вывод 
		//	Макет 		= ПолучитьМакет("МакетПервойСтраницы");
		//	МакетВторой = ПолучитьМакет("МакетВторойСтраницы");
		//	Шапка = Макет.ПолучитьОбласть("Шапка");
		//	Шапка.Параметры.Организация = СтруктураШапки.Организация;
		//	Шапка.Параметры.Поклажедатель = СтруктураШапки.Поклажедатель;
		//	Шапка.Параметры.Номер = СтруктураШапки.Номер;				
		//	Шапка.Параметры.Дата = СтруктураШапки.Дата;	
		//	ТабДок.Вывести(Шапка);
		//	Строка = Макет.ПолучитьОбласть("Строка");
		//	Номер 			= 1;
		//	ИтогоКоличество = 0;
		//	ИтогоСумма 		= 0;
		//	Пока Выборка.Следующий() Цикл
		//		Строка.Параметры.Номер 			= 	Номер;
		//		Строка.Параметры.Наименование 	= 	Выборка.Наименование;
		//		Строка.Параметры.Код			=	Выборка.Код;
		//		Строка.Параметры.ЕдНаим			=   Выборка.ЕдиницаИзмерения;
		//		Строка.Параметры.ЕдКод			= 	Выборка.КодЕдиницы;
		//		Строка.Параметры.Количество		= 	Выборка.Количество;
		//		Строка.Параметры.Цена			= 	Выборка.Цена;
		//		Строка.Параметры.Стоимость		= 	Выборка.Сумма;
		//		Номер 					= 	Номер 	+ 1;
		//		ИтогоКоличество = ИтогоКоличество 	+ Выборка.Количество;
		//		ИтогоСумма 		= ИтогоСумма		+ Выборка.Сумма;
		//		ТабДок.Вывести(Строка);
		//	КонецЦикла;
			//СтрокаИтого 							= Макет.ПолучитьОбласть("СтрокаИтого"); 
			//СтрокаИтого.Параметры.ИтогоКоличество 	= ИтогоКоличество;
			//СтрокаИтого.Параметры.ИтогоСтоимость 	= ИтогоСумма;
			//ТабДок.Вывести(СтрокаИтого);
		//	СтрокаИтого 							= МакетВторой.ПолучитьОбласть("СтрокаИтого"); 
		//	СтрокаИтого.Параметры.АктКоличество		= ИтогоКоличество;
		//	СтрокаИтого.Параметры.АктСтоимость		= ИтогоСумма;
		//	ТабДок.Вывести(СтрокаИтого);
		//	СуммаПрописью = ПолучитьСуммуПрописью(ИтогоКоличество,ИтогоСумма, СтруктураШапки.Валюта);
		//	Подвал 									= Макет.ПолучитьОбласть("Подвал");  
		//	Подвал.Параметры.Принято				= СуммаПрописью; 
		//	ТабДок.Вывести(Подвал);
	//	КонецЕсли;		
		ТабДок.АвтоМасштаб	=	Истина;
		ТабДок.Показать();
	//КонецЕсли;
	
КонецПроцедуры

Функция Печать() Экспорт
	//Если  СсылкаНаОбъект.ВидОперации = Перечисления.ВидыОперацийПоОтветственномуХранению.Поступление Тогда
		УстановитьЗначенияКоличестваСтрокНаЛисте();
		СтруктураШапки = ЗаполнитьРеквизитыШапки(СсылкаНаОбъект);
		Если СтруктураШапки<>Неопределено Тогда
			ПечатьДокумента(СтруктураШапки,СсылкаНаОбъект,1,Ложь);
		КонецЕсли;
	//КОнецЕсли;	
КонецФункции

функция Печать() Экспорт
	
Если НЕ ЗначениеЗаполнено(СсылкаНаОбъект) тогда
Предупреждение("Не выбран документ!", 30);		
КонецЕсли;
	
	Если ТипЗнч(СсылкаНаОбъект) = Тип("ДокументСсылка.ПоступлениеТоваровУслуг")	тогда
		  ТабДокумент = ПечатьПоступления();
	КонецЕсли;
	
 Возврат ТабДокумент;
 
КонецФункции

Функция  ПечатьПоступления()
	
	ТабДок = Новый ТабличныйДокумент;
	Макет = ПолучитьМакет("Отчет");
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЕСТЬNULL(ТоварыАдресноеХранение.Номенклатура, Товары.Номенклатура) КАК Номенклатура,
	|	ЕСТЬNULL(ТоварыАдресноеХранение.Склад, Товары.Склад) КАК Склад,
	|	ЕСТЬNULL(ТоварыАдресноеХранение.Количество, 0) КАК КоличествоПоАдресам,
	|	ЕСТЬNULL(Товары.Количество, 0) КАК Количество
	|ИЗ
	|	(ВЫБРАТЬ
	|		ПоступлениеТоваровУслугТоварыАдресноеХранение.Номенклатура КАК Номенклатура,
	|		ПоступлениеТоваровУслугТоварыАдресноеХранение.Склад КАК Склад,
	|		СУММА(ПоступлениеТоваровУслугТоварыАдресноеХранение.Количество) КАК Количество
	|	ИЗ
	|		Документ.ПоступлениеТоваровУслуг.ТоварыАдресноеХранение КАК ПоступлениеТоваровУслугТоварыАдресноеХранение
	|	ГДЕ
	|		ПоступлениеТоваровУслугТоварыАдресноеХранение.Ссылка = &Ссылка
	|	
	|	СГРУППИРОВАТЬ ПО
	|		ПоступлениеТоваровУслугТоварыАдресноеХранение.Номенклатура,
	|		ПоступлениеТоваровУслугТоварыАдресноеХранение.Склад) КАК ТоварыАдресноеХранение
	|		ПОЛНОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	|			ПоступлениеТоваровУслугТовары.Номенклатура КАК Номенклатура,
	|			ПоступлениеТоваровУслугТовары.Склад КАК Склад,
	|			СУММА(ПоступлениеТоваровУслугТовары.Количество) КАК Количество
	|		ИЗ
	|			Документ.ПоступлениеТоваровУслуг.Товары КАК ПоступлениеТоваровУслугТовары
	|		ГДЕ
	|			ПоступлениеТоваровУслугТовары.Ссылка = &Ссылка
	|		
	|		СГРУППИРОВАТЬ ПО
	|			ПоступлениеТоваровУслугТовары.Номенклатура,
	|			ПоступлениеТоваровУслугТовары.Склад) КАК Товары
	|		ПО ТоварыАдресноеХранение.Номенклатура = Товары.Номенклатура
	|			И (ВЫБОР
	|				КОГДА Товары.Склад = &ПустойСклад
	|					ТОГДА ИСТИНА
	|				ИНАЧЕ ТоварыАдресноеХранение.Склад = Товары.Склад
	|			КОНЕЦ)
	|ГДЕ
	|	ТоварыАдресноеХранение.Номенклатура = Товары.Номенклатура
	|	И ЕСТЬNULL(Товары.Количество, 0) <> ЕСТЬNULL(ТоварыАдресноеХранение.Количество, 0)";

	Запрос.УстановитьПараметр("Ссылка", СсылкаНаОбъект);
    Запрос.УстановитьПараметр("ПустойСклад", справочники.Склады.ПустаяСсылка() );
	Результат = Запрос.Выполнить();

	ОбластьЗаголовок = Макет.ПолучитьОбласть("Заголовок");
	
	ОбластьШапкаТаблицы = Макет.ПолучитьОбласть("ШапкаТаблицы");
	
	ОбластьДетальныхЗаписей = Макет.ПолучитьОбласть("Детали");

	ТабДок.Очистить();
	
	Если не Результат.Пустой() Тогда
		ОбластьЗаголовок.Параметры.ЗаголовокДокумента= "Расхождения по " + СформироватьЗаголовокДокумента(СсылкаНаОбъект);
		ТабДок.Вывести(ОбластьЗаголовок);
		ТабДок.Вывести(ОбластьШапкаТаблицы);
	Иначе
		
		ОбластьЗаголовок.Параметры.ЗаголовокДокумента= "Расхождения отсутствуют";
		ТабДок.Вывести(ОбластьЗаголовок);
		
	КонецЕсли;
	
	

	ВыборкаДетали = Результат.Выбрать();

	Пока ВыборкаДетали.Следующий() Цикл
		ОбластьДетальныхЗаписей.Параметры.Заполнить(ВыборкаДетали);
		ОбластьДетальныхЗаписей.Параметры.Код=ВыборкаДетали.Номенклатура.Код;
		ТабДок.Вывести(ОбластьДетальныхЗаписей, ВыборкаДетали.Уровень());
	КонецЦикла;
Возврат ТабДок;
КонецФункции	

Процедура СформироватьОтчет(ДокументРезультат) Экспорт

//	ДокументРезультат = новый ТабличныйДокумент;
    Запрос= новый Запрос;
    // Проверка на пустые значения
		//Предупреждение("Не выбран заказ!");
		//Возврат;
		Текст="ВЫБРАТЬ
		      |	ЗаказПокупателяТовары.Номенклатура
		      |ПОМЕСТИТЬ втНоменклатура
		      |ИЗ
		      |	Документ.ЗаказПокупателя.Товары КАК ЗаказПокупателяТовары
		      |ГДЕ
		      |	ЗаказПокупателяТовары.Ссылка.Ссылка = &Заказ
		      |;
		      |
		      |////////////////////////////////////////////////////////////////////////////////
		      |ВЫБРАТЬ //ПЕРВЫЕСколькото
		      |	ТоварыНаСкладахОбороты.Регистратор.Дата КАК ДатаПоступления,
		      |	ТоварыНаСкладахОбороты.Регистратор.Ссылка КАК Поступление,
		      |	ТоварыНаСкладахОбороты.Номенклатура КАК Номенклатура,
		      |	СУММА(ТоварыНаСкладахОбороты.КоличествоПриход) КАК КоличествоПриход
		      |ИЗ
		      |	РегистрНакопления.ТоварыНаСкладах.Обороты(
		      |			//НачПериода
		      |			,//КонПериода
		      |			,Регистратор,
		      |			Склад.Транзитный = ЛОЖЬ
		      |				И Склад.ЗапретитьИспользование = ЛОЖЬ
		      |				И Номенклатура В
		      |					(ВЫБРАТЬ
		      |						втНоменклатура.Номенклатура
		      |					ИЗ
		      |						втНоменклатура КАК втНоменклатура)) КАК ТоварыНаСкладахОбороты
		      |ГДЕ
		      |	ТоварыНаСкладахОбороты.Регистратор ССЫЛКА Документ.ПоступлениеТоваровУслуг
		      |
		      |СГРУППИРОВАТЬ ПО
		      |	ТоварыНаСкладахОбороты.Регистратор.Ссылка,
		      |	ТоварыНаСкладахОбороты.Номенклатура,
		      |	ТоварыНаСкладахОбороты.Регистратор.Дата
		      |
		      |УПОРЯДОЧИТЬ ПО
		      |	ДатаПоступления УБЫВ
		      |ИТОГИ
		      |	СУММА(КоличествоПриход)
		      |ПО
		      |	Номенклатура,
		      |	Поступление
		      |АВТОУПОРЯДОЧИВАНИЕ";
			 
	Запрос.УстановитьПараметр("НачПериода", НачПериода);
	Запрос.УстановитьПараметр("КонПериода", КонецДня(КонПериода));
	Запрос.УстановитьПараметр("Заказ",        СсылкаНаОбъект);

	Если НачПериода<>Дата(1,1,1) тогда
		Текст=СтрЗаменить(Текст,"//НачПериода","&НачПериода");
	КонецЕсли;
	Если КонПериода<>Дата(1,1,1) тогда
		Текст=СтрЗаменить(Текст,"//КонПериода","&КонПериода");
	КонецЕсли;
	Если НачПериода=Дата(1,1,1) и КонПериода=Дата(1,1,1) тогда
		Текст=СтрЗаменить(Текст,"//ПЕРВЫЕСколькото","ПЕРВЫЕ 100");
	КонецЕсли;
    Запрос.Текст=Текст;
	Макет = ПолучитьМакет("Макет");
	ДокументРезультат.Очистить();

	ОбластьШапка=Макет.ПолучитьОбласть("Шапка");
    ОбластьНоменклатура=Макет.ПолучитьОбласть("СтрНоменклатура");
	ОбластьПоступление=Макет.ПолучитьОбласть("СтрПоступление");
	
	ДокументРезультат.Вывести(ОбластьШапка);
	Рез=Запрос.Выполнить();	
	//Рез.Выгрузить().ВыбратьСтроку();
    // Выполнение сформированного запроса
	ДокументРезультат.НачатьАвтогруппировкуСтрок();
	ВыборкаНоменклатура = Рез.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	Пока ВыборкаНоменклатура.Следующий() Цикл
		ОбластьНоменклатура.Параметры.Заполнить(ВыборкаНоменклатура);
		ДокументРезультат.Вывести(ОбластьНоменклатура,1);
		ВыборкаПоступления=ВыборкаНоменклатура.Выбрать();
		Пока ВыборкаПоступления.Следующий() Цикл
			ОбластьПоступление.Параметры.Заполнить(ВыборкаПоступления);
			ДокументРезультат.Вывести(ОбластьПоступление,2);
		КонецЦикла;	
	КонецЦикла;	
    ДокументРезультат.ЗакончитьАвтогруппировкуСтрок();
КонецПроцедуры // СформироватьОтчет()

Функция Печать() Экспорт
	Форма=ПолучитьФорму("ФормаГлавная");
	Форма.Открыть();
	//СформироватьОтчет(ДокументРезультат);		
	//Возврат ДокументРезультат;
	
КонецФункции
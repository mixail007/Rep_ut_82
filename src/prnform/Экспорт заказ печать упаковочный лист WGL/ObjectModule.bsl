Перем НомерНаПечать Экспорт;

Функция Печать(НомерДока = "") Экспорт
	
	НомерНаПечать = НомерДока;
	
	Если ТипЗнч(СсылкаНаОбъект) = Тип("ДокументСсылка.РеализацияТоваровУслуг") Тогда
		Возврат ПечатьДокумента(СсылкаНаОбъект.Сделка,СсылкаНаОбъект);
	иначе
		Возврат ПечатьДокумента(СсылкаНаОбъект);
	КонецЕсли;
	
КонецФункции // Печать

Функция ПечатьДокумента(СсылкаНаОбъект,Ссылка2 = Неопределено)
			
	ТабДокумент = Новый ТабличныйДокумент;
	ТабДокумент.ИмяПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_УпаковочныйЛист_Экспорт";
	
	ОрганизацияТТ=?(СсылкаНаОбъект.Организация=Справочники.Организации.НайтиПоКоду("00004"),истина,ложь);
	
	//Если СсылкаНаОбъект.Контрагент.ДвуязычныйЭкспорт Тогда
		ДваЯзыка = Истина;
		ИмяМакета = "УпаковочныйЛистДваЯзыка";
	//Иначе
	//	ДваЯзыка = Ложь;
	//	
	//	ДваЯзыка = Ложь;
	//	Если ОрганизацияТТ тогда
	//		ИмяМакета = "PACKING";
	//	иначе
	//		ИмяМакета = "УпаковочныйЛистРус";
	//	КонецЕсли;
	//	
	//	ИмяМакета = "УпаковочныйЛистРус";
	//КонецЕсли;
	
	//Если ОрганизацияТТ тогда
			//ИмяМакета = "PACKING";
	//КонецЕсли;
	
	Макет = ПолучитьМакет(ИмяМакета);
	ОбластьШапка        = Макет.ПолучитьОбласть("Шапка");
	ОбластьШапкаТаблицы = Макет.ПолучитьОбласть("ШапкаТаблицы");
	ОбластьСтрока       = Макет.ПолучитьОбласть("Строка");
	ОбластьИтог         = Макет.ПолучитьОбласть("Итого");
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ТекущийДокумент", ?(Ссылка2 <> Неопределено,Ссылка2,СсылкаНаОбъект));
	Запрос.Текст = "ВЫБРАТЬ
	               |	Документ.Номенклатура.Код КАК Код,
	               |	Документ.Номенклатура КАК Номенклатура,
				   |	Документ.Номенклатура.Производитель КАК Производитель,
	               |	Документ.ЕдиницаИзмерения КАК ЕдиницаИзмерения,
	               |	СУММА(Документ.Количество) КАК Количество,
				   |	СУММА(ВЫБОР КОГДА Документ.КоличествоМест > 0 Тогда Документ.КоличествоМест ИНАЧЕ Документ.Количество КОНЕЦ) КАК КоличествоМест,
	               |	СУММА(Документ.Сумма) КАК Сумма,
				   |	СУММА(Выразить(Документ.Вес КАК Число(15,2))) КАК ВесБрутто,
	               |	Документ.Цена КАК Цена
	               |ИЗ
	               |	Документ.ЗаказПокупателяСезонный.Товары КАК Документ
	               |ГДЕ
	               |	Документ.Ссылка = &ТекущийДокумент
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	Документ.Номенклатура,
	               |	Документ.ЕдиницаИзмерения,
	               |	Документ.Цена,
	               |	Документ.Номенклатура.Код,
				   |	Документ.Номенклатура.Производитель
	               |УПОРЯДОЧИТЬ ПО
	               |	ПОДСТРОКА(Документ.Номенклатура.НаименованиеПолное, 1, 50)
				   |";
				   
				   Если ТипЗнч(СсылкаНаОбъект) = Тип("ДокументСсылка.ЗаказПоставщику") Тогда
					   запрос.Текст = СтрЗаменить(Запрос.Текст,"ЗаказПокупателяСезонный","ЗаказПоставщику");
				   КонецЕсли;
				   
				    Если Ссылка2 <> Неопределено Тогда
					   запрос.Текст = СтрЗаменить(Запрос.Текст,"ЗаказПокупателяСезонный","РеализацияТоваровУслуг");
	               КонецЕсли;
	

	ТЗТоваров = Запрос.Выполнить().Выгрузить();
	
	//вывод шапки
	ВидАдресаЮрАнгл = Справочники.ВидыКонтактнойИнформации.НайтиПоКоду("38846");
	ВидАдресаФактАнгл = Справочники.ВидыКонтактнойИнформации.НайтиПоКоду("38847");
	АдресДоставки = Справочники.ВидыКонтактнойИнформации.НайтиПоКоду("00021");
		
	ОбластьШапка.Параметры.ПечНаименованиеТовара = СформироватьНаименованиеТовара(ТЗтоваров, ДваЯзыка,ОрганизацияТТ);
	
	Грузоотправитель = СсылкаНаОбъект.Организация;
	ФактАдресГО = "Office 7D, Cheuk Nang Plaza, Hennessy Road 250, Wan Chai, Hong Kong";
	//ФактАдресПродавца = "Ярославль, 150049, Россия, ул. Лисицына, дом 7";
	//со 2 апреля 2015 изменился адрес
	ФактАдресПродавца = "Office 7D, Cheuk Nang Plaza, Hennessy Road 250, Wan Chai, Hong Kong";
	
	//Если ОрганизацияТТ тогда
		ФактАдресГО = "Office 7D, Cheuk Nang Plaza, Hennessy Road 250, Wan Chai, Hong Kong";
	    ФактАдресПродавца = "Office 7D, Cheuk Nang Plaza, Hennessy Road 250, Wan Chai, Hong Kong";
	//КонецЕсли;
	
	//***2018.06.19 Задача № 49314 адреса WG из карточки
	ЮрАдресОрганизации = "";
	ФактАдресОрганизации = "";
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Объект", СсылкаНаОбъект.Организация);
	Запрос.Текст = "ВЫБРАТЬ
	               |	КонтактнаяИнформация.Представление,
	               |	КонтактнаяИнформация.Вид
	               |ИЗ
	               |	РегистрСведений.КонтактнаяИнформация КАК КонтактнаяИнформация
	               |ГДЕ
	               |	КонтактнаяИнформация.Объект = &Объект
	               |	И КонтактнаяИнформация.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.Адрес)";
	Результат = Запрос.Выполнить().Выбрать();
	Пока Результат.Следующий() Цикл
		Если Результат.Вид = Справочники.ВидыКонтактнойИнформации.ЮрАдресОрганизации Тогда
			ЮрАдресОрганизации = СокрЛП(Результат.Представление);
		ИначеЕсли Результат.Вид = Справочники.ВидыКонтактнойИнформации.ФактАдресОрганизации Тогда
			ФактАдресОрганизации = СокрЛП(Результат.Представление);
		КонецЕсли;
	КонецЦикла;
	
	ФактАдресГО = ФактАдресОрганизации;
	ФактАдресПродавца = ФактАдресОрганизации;
	
	
	//Покупатель  = СсылкаНаОбъект.Контрагент;
	//СведенияОПокупателе     = СведенияОЮрФизЛице(Покупатель,  СсылкаНаОбъект.Дата);
	
	//Грузополучатель  = ?(ЗначениеЗаполнено(СсылкаНаОбъект.Грузополучатель), СсылкаНаОбъект.Грузополучатель,   СсылкаНаОбъект.Контрагент);
	//СведенияОГрузополучателе     = СведенияОЮрФизЛице(Грузополучатель,       СсылкаНаОбъект.Дата);
	//Если СокрЛП(СсылкаНаОбъект.АдресДоставки)= "" Тогда
	//	ФактАдресГП = ОписаниеОрганизации(СведенияОГрузополучателе, "ФактическийАдрес,");
	//	ФактАдресГП = ?(СокрЛП(ФактАдресГП)="", ОписаниеОрганизации(СведенияОГрузополучателе, "ЮридическийАдрес,"), СокрЛП(ФактАдресГП));
	//Иначе
	//	ФактАдресГП = СокрЛП(СсылкаНаОбъект.АдресДоставки);
	//КонецЕсли;
	
	
	ЗаказПоставщику = ?(ТипЗнч(СсылкаНаОбъект) = Тип("ДокументСсылка.ЗаказПоставщику"),Истина,ложь);
	
	Грузополучатель  = ?(ЗаказПоставщику,?(СсылкаНаОбъект.Основание.документоснование.договорКонтрагента.ТипДоговора = Справочники.ТипыДоговоров.TyreTechnology,Справочники.Контрагенты.НайтиПоКоду("94655"),?(ЗначениеЗаполнено(СсылкаНаОбъект.Основание.документоснование.Грузополучатель), СсылкаНаОбъект.Основание.документоснование.Грузополучатель,   СсылкаНаОбъект.Основание.документоснование.Контрагент)),?(ЗначениеЗаполнено(СсылкаНаОбъект.Грузополучатель), СсылкаНаОбъект.Грузополучатель,   СсылкаНаОбъект.Контрагент));
	
	Покупатель  = Грузополучатель;
	СведенияОПокупателе     = СведенияОЮрФизЛице(Покупатель,  СсылкаНаОбъект.Дата);
	
	СведенияОГрузополучателе     = СведенияОЮрФизЛице(Грузополучатель,       СсылкаНаОбъект.Дата);
	Если ТипЗнч(СсылкаНаОбъект) <> Тип("ДокументСсылка.ЗаказПоставщику") и СокрЛП(СсылкаНаОбъект.АдресДоставки)= "" Тогда
		ФактАдресГП = ОписаниеОрганизации(СведенияОГрузополучателе, "ФактическийАдрес,");
		ФактАдресГП = ?(СокрЛП(ФактАдресГП)="", ОписаниеОрганизации(СведенияОГрузополучателе, "ЮридическийАдрес,"), СокрЛП(ФактАдресГП));
	ИначеЕсли ТипЗнч(СсылкаНаОбъект) = Тип("ДокументСсылка.ЗаказПоставщику") Тогда
		ФактАдресГП = ОписаниеОрганизации(СведенияОГрузополучателе, "ФактическийАдрес,");
		ФактАдресГП = ?(СокрЛП(ФактАдресГП)="", ОписаниеОрганизации(СведенияОГрузополучателе, "ЮридическийАдрес,"), СокрЛП(ФактАдресГП));
	Иначе
		ФактАдресГП = СокрЛП(СсылкаНаОбъект.АдресДоставки);
	КонецЕсли;


	
	Если ДваЯзыка Тогда
		//Если ОрганизацияТТ тогда
			//ОбластьШапка.Параметры.ГрузоотправительНаименование = "Tire Technology Co LTD, Китай/TYRE TECHNOLOGY CO.,LIMITED";
			//ОбластьШапка.Параметры.ФактАдресГрузоотправителя = "NO.20,HONGKONG MIDDLE ROAD,QINGDAO,CHINA";
			ОбластьШапка.Параметры.ПродавецНаименование = "WHEELS GROUP LIMITED";
			ОбластьШапка.Параметры.ФактАдресПродавца = ФактАдресОрганизации;//"Office 7D, Cheuk Nang Plaza, Hennessy Road 250, Wan Chai, Hong Kong";
			//ОбластьШапка.Параметры.ФактАдресГрузоотправителя = "NO.20,HONGKONG MIDDLE ROAD,QINGDAO,CHINA";
			РегАдреса = РегистрыСведений.КонтактнаяИнформация.Получить(Новый Структура("Объект,Тип,Вид",Покупатель,Перечисления.ТипыКонтактнойИнформации.Адрес,ВидАдресаЮрАнгл));
			
			ОбластьШапка.Параметры.АдресПокупателяАнгл = РегАдреса.Представление;
			РегАдреса = РегистрыСведений.КонтактнаяИнформация.Получить(Новый Структура("Объект,Тип,Вид",Грузополучатель,Перечисления.ТипыКонтактнойИнформации.Адрес,АдресДоставки));
			//ОбластьШапка.Параметры.АдресГрузополучателяАнгл = РегАдреса.Представление;
			ОбластьШапка.Параметры.Договор    = СсылкаНаОбъект.ДоговорКонтрагента.Номер+" dtd "+формат(СсылкаНаОбъект.ДоговорКонтрагента.Дата,"ДЛФ=D");
            ОбластьШапка.Параметры.ПокупательНаименование = СведенияОПокупателе.ПолноеНаименование;
		//Иначе
		//	//грузоотправитель и продавец
		//	ОбластьШапка.Параметры.ГрузоотправительНаименование = "JSC TRADING COMPANY “YARSHINTORG” / "+строка(Грузоотправитель.НаименованиеПолное);
		//	ОбластьШапка.Параметры.ФактАдресГрузоотправителя = "150044, RUSSIA, YAROSLAVL, BAZOVAYA STR., 3,BUILDING.2 / "+ФактАдресГО;
		//	ОбластьШапка.Параметры.ПродавецНаименование = "ShinTrade Yaroslavl Ltd / Общество с ограниченной ответственностью «ШинТрейд Ярославль»";
		//	//ОбластьШапка.Параметры.ФактАдресПродавца = "YAROSLAVL 150049,RUSSIA, LISITSINA STR., 7 / "+ФактАдресПродавца;
		//	ОбластьШапка.Параметры.ФактАдресПродавца = "150014, RUSSIA, YAROSLAVL, SALTYKOVA-SHCHEDRINA STR., 21, OFFICE 507 / "+ФактАдресПродавца;
		//	//грузополучатель и покупатель
		//	ОбластьШапка.Параметры.ПокупательНаименование = СведенияОПокупателе.ПолноеНаименование;
		//	ОбластьШапка.Параметры.АдресПокупателя = СведенияОПокупателе.ЮридическийАдрес;
		//	ОбластьШапка.Параметры.ГрузополучательНаименование = СведенияОГрузополучателе.ПолноеНаименование;
		//	ОбластьШапка.Параметры.АдресГрузополучателя = ФактАдресГП;
		//	//получаем юр.адрес на английском языке
		//	РегАдреса = РегистрыСведений.КонтактнаяИнформация.Получить(Новый Структура("Объект,Тип,Вид",Покупатель,Перечисления.ТипыКонтактнойИнформации.Адрес, ВидАдресаЮрАнгл));
		//	ОбластьШапка.Параметры.АдресПокупателяАнгл = РегАдреса.Представление;
		//	РегАдреса = РегистрыСведений.КонтактнаяИнформация.Получить(Новый Структура("Объект,Тип,Вид",Грузополучатель,Перечисления.ТипыКонтактнойИнформации.Адрес, АдресДоставки));
		//	ОбластьШапка.Параметры.АдресГрузополучателяАнгл = РегАдреса.Представление;
		//	ОбластьШапка.Параметры.Договор    = СсылкаНаОбъект.ДоговорКонтрагента.Номер+" dtd/от "+формат(СсылкаНаОбъект.ДоговорКонтрагента.Дата,"ДЛФ=D");
		//	
		//КонецЕсли;
		
	Иначе
		//Если ОрганизацияТТ тогда
			//ОбластьШапка.Параметры.ГрузоотправительНаименование = "Tire Technology Co LTD, Китай/TYRE TECHNOLOGY CO.,LIMITED";
			ОбластьШапка.Параметры.ПродавецНаименование = "WHEELS GROUP LIMITED";
			ОбластьШапка.Параметры.ФактАдресПродавца = ФактАдресОрганизации;//"Office 7D, Cheuk Nang Plaza, Hennessy Road 250, Wan Chai, Hong Kong";
			ОбластьШапка.Параметры.ФактАдресГрузоотправителя = ФактАдресОрганизации;//"Office 7D, Cheuk Nang Plaza, Hennessy Road 250, Wan Chai, Hong Kong";
			РегАдреса = РегистрыСведений.КонтактнаяИнформация.Получить(Новый Структура("Объект,Тип,Вид",Покупатель,Перечисления.ТипыКонтактнойИнформации.Адрес, ВидАдресаЮрАнгл));
			ОбластьШапка.Параметры.АдресПокупателяАнгл = РегАдреса.Представление;
			РегАдреса = РегистрыСведений.КонтактнаяИнформация.Получить(Новый Структура("Объект,Тип,Вид",Грузополучатель,Перечисления.ТипыКонтактнойИнформации.Адрес, ВидАдресаФактАнгл));
			//ОбластьШапка.Параметры.АдресГрузополучателяАнгл = РегАдреса.Представление;
			ОбластьШапка.Параметры.Договор    = СсылкаНаОбъект.ДоговорКонтрагента.Номер+" dtd "+формат(СсылкаНаОбъект.ДоговорКонтрагента.Дата,"ДЛФ=D");
            ОбластьШапка.Параметры.ПокупательНаименование = СведенияОПокупателе.ПолноеНаименование;
		//Иначе
		//	//грузоотправитель и продавец
		//	ОбластьШапка.Параметры.ГрузоотправительНаименование = строка(Грузоотправитель.НаименованиеПолное);
		//	ОбластьШапка.Параметры.ФактАдресГрузоотправителя = ФактАдресГО;
		//	ОбластьШапка.Параметры.ПродавецНаименование = "Общество с ограниченной ответственностью «ШинТрейд Ярославль»";
		//	ОбластьШапка.Параметры.ФактАдресПродавца = ФактАдресПродавца;
		//	//грузополучатель и покупатель
		//	ОбластьШапка.Параметры.ПокупательНаименование = СведенияОПокупателе.ПолноеНаименование;
		//	ОбластьШапка.Параметры.АдресПокупателя = СведенияОПокупателе.ЮридическийАдрес;
		//	ОбластьШапка.Параметры.ГрузополучательНаименование = СведенияОГрузополучателе.ПолноеНаименование;
		//	ОбластьШапка.Параметры.АдресГрузополучателя = ФактАдресГП;
		//	ОбластьШапка.Параметры.Договор    = СсылкаНаОбъект.ДоговорКонтрагента.Номер+" от "+формат(СсылкаНаОбъект.ДоговорКонтрагента.Дата,"ДЛФ=D");
		//КонецЕсли;
		
		
	КонецЕсли;
	
	//Если НомерНаПечать = "" Тогда
	//	Если СсылкаНаОбъект.НомерФормулаАвто = 0 Тогда
	//		НомерДокумента = ЭтотОбъект.ПолучитьФорму("ВводНомераШинтрейдЯрославль").ОткрытьМодально();
	//	Иначе
	//		НомерДокумента = СтрЗаменить(Строка(СсылкаНаОбъект.НомерФормулаАвто),Символы.НПП,"");
	//	КонецЕсли;
	//Иначе
		НомерДокумента = НомерНаПечать;
	//КонецЕсли;
	
	ОбластьШапка.Параметры.Номер = СокрЛП(?(Ссылка2= Неопределено,НомерДокумента,ссылка2.номер));
	ОбластьШапка.Параметры.Дата  = Формат(?(Ссылка2= Неопределено,СсылкаНаОбъект.Дата,ссылка2.Дата), "ДФ=dd.MM.yyyy");
	РегАдреса = РегистрыСведений.КонтактнаяИнформация.Получить(Новый Структура("Объект,Тип,Вид",Покупатель,Перечисления.ТипыКонтактнойИнформации.Адрес, ВидАдресаЮрАнгл));
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("заказ",СсылкаНаОбъект);
	Запрос.Текст = "ВЫБРАТЬ ПЕРВЫЕ 1
	               |	ЗаданиеОтделуВЭД.Ссылка,
	               |	ЗаданиеОтделуВЭД.Дата КАК Дата,
	               |	ЗаданиеОтделуВЭД.УсловияПоставки,
	               |	ЗаданиеОтделуВЭД.ПортНазначения
	               |ИЗ
	               |	Документ.ЗаданиеОтделуВЭД КАК ЗаданиеОтделуВЭД
	               |ГДЕ
	               |	ЗаданиеОтделуВЭД.Заказ = &заказ
	               |	И ЗаданиеОтделуВЭД.ПометкаУдаления = ЛОЖЬ
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Дата УБЫВ";
	Рез = Запрос.Выполнить().Выгрузить();
	
	Если Рез.Количество()>0 Тогда
		УсловиеПоставки = СокрЛП(рез[0].УсловияПоставки) + " " + СокрЛП(рез[0].ПортНазначения);
	иначе
		УсловиеПоставки = "";
	КонецЕсли;

	ОбластьШапка.Параметры.УсловиеПоставки =УсловиеПоставки;
	
	ТабДокумент.Вывести(ОбластьШапка);
	ТабДокумент.Вывести(ОбластьШапкаТаблицы);
	//конец вывод шапки
	
	ИтВесНетто = 0;
	ИтКоличествоМест = 0;
	ИтКомплКоличество = 0;
	НомСтр = 0;
	Для Каждого Строка Из ТЗТоваров Цикл
		
		НомСтр = НомСтр+1;
		ОбластьСтрока.Параметры.НомерСтроки = НомСтр;
		ОбластьСтрока.Параметры.Код = Строка.Номенклатура.Код;
		ОбластьСтрока.Параметры.Номенклатура = СтрЗаменить(Строка.Номенклатура.НаименованиеПолное,"Диск","Wheel");
		ОбластьСтрока.Параметры.Количество = Строка.Количество;
		Если Строка.КоличествоМест = 0 Тогда
			ОбластьСтрока.Параметры.КоличествоМест = Строка.Количество;
			ИтКоличествоМест = ИтКоличествоМест+Строка.Количество;
		Иначе
			ОбластьСтрока.Параметры.КоличествоМест = Строка.КоличествоМест;
			ИтКоличествоМест = ИтКоличествоМест+Строка.КоличествоМест;
		КонецЕсли;	
		ОбластьСтрока.Параметры.ВесБрутто  = Строка.ВесБрутто;
		
		Если Строка.Номенклатура.ВидТовара = Перечисления.ВидыТоваров.Диски Тогда
			парам1   = Строка.Номенклатура.Типоразмер;
			ЭтоЛитойДиск = Строка.Номенклатура.ПринадлежитЭлементу(Справочники.Номенклатура.НайтиПоКоду("0001753"));
			ДваВОдном = Строка.КоличествоМест/Строка.Количество;
			//ВесНетто = Строка.ВесБрутто - ВесУпаковки(парам1, ЭтоЛитойДиск) * Строка.Количество * ?(ДваВОдном=0,1,ДваВОдном);
			ВесНетто = Строка.ВесБрутто - ВесУпаковки(парам1, ЭтоЛитойДиск) * Строка.Количество;
		Иначе
			ВесНетто = Строка.ВесБрутто;
		КонецЕсли;
		ОбластьСтрока.Параметры.ВесНетто = ВесНетто;
		ИтВесНетто = ИтВесНетто+ВесНетто;
		
		//ОбластьСтрока.Параметры.ШтрихКод   =  ПолучитьШтрихКодЯШТ(Строка.Номенклатура.Код);
		//болты и гайки только для Replica
		//КомплКоличество = ?(Найти(врег(Строка.Номенклатура.Производитель.Наименование),"REPLICA")=0, 0,
		// 							число(Строка.Номенклатура.Типоразмер.КоличествоОтверстий));
		//должно быть как в спецификации
		ТекПроизводитель = Строка.Номенклатура.Производитель.Наименование;
		Если Найти(врег(ТекПроизводитель),"REPLICA")>0
			или врег(ТекПроизводитель)="TOP DRIVER"
			или врег(ТекПроизводитель)="CATWILD"
			или врег(ТекПроизводитель)="YST"
			Тогда
			КомплКоличество = число(Строка.Номенклатура.Типоразмер.КоличествоОтверстий);
		Иначе // название производителя = Брэнд
			КомплКоличество = 0;
		КонецЕсли;	
		
		Если Ссылка2 <> Неопределено Тогда
			
			Запрос = Новый Запрос;
			Запрос.УстановитьПараметр("ссылка",Ссылка2);
			Запрос.УстановитьПараметр("Количество",ссылка2.Товары.Итог("Количество"));
			Запрос.Текст = "ВЫБРАТЬ
			               |	ЗаказПоставщикуТовары.Ссылка.НомерКонтейнера,
			               |	ЗаказПоставщикуТовары.Ссылка.Дата КАК Дата,
			               |	СУММА(ЗаказПоставщикуТовары.Количество) КАК Количество
			               |ПОМЕСТИТЬ ВРем
			               |ИЗ
			               |	Документ.РеализацияТоваровУслуг.Товары КАК РеализацияТоваровУслугТовары
			               |		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЗаказПоставщику.Товары КАК ЗаказПоставщикуТовары
			               |		ПО РеализацияТоваровУслугТовары.Ссылка.Сделка = ЗаказПоставщикуТовары.Ссылка.Основание.ДокументОснование
			               |			И РеализацияТоваровУслугТовары.Номенклатура = ЗаказПоставщикуТовары.Номенклатура
			               |ГДЕ
			               |	РеализацияТоваровУслугТовары.Ссылка = &Ссылка
			               |	И НЕ ЗаказПоставщикуТовары.Ссылка ЕСТЬ NULL 
			               |
			               |СГРУППИРОВАТЬ ПО
			               |	ЗаказПоставщикуТовары.Ссылка.НомерКонтейнера,
			               |	ЗаказПоставщикуТовары.Ссылка.Дата
			               |;
			               |
			               |////////////////////////////////////////////////////////////////////////////////
			               |ВЫБРАТЬ
			               |	ВРем.НомерКонтейнера
			               |ИЗ
			               |	ВРем КАК ВРем
			               |ГДЕ
			               |	ВРем.Количество = &Количество";
			Рез = Запрос.Выполнить().Выгрузить();
			
			Если Рез.Количество()>0 Тогда
				НомерКонтейнера = рез[0].НомерКонтейнера;
			иначе
				НомерКонтейнера = "";
			КонецЕсли;
			
			ОбластьСтрока.Параметры.Контейнер = НомерКонтейнера;
			
		КонецЕсли;
		
		ИтКомплКоличество = ИтКомплКоличество+КомплКоличество;
		
		ТабДокумент.Вывести(ОбластьСтрока);
		
	КонецЦикла;
	
	//Итог
	ОбластьИтог.Параметры.ИтогКоличество = ТЗТоваров.Итог("Количество");
	ОбластьИтог.Параметры.ИтогКоличествоМест = ИтКоличествоМест;
	ОбластьИтог.Параметры.ИтогВесБрутто = ТЗТоваров.Итог("ВесБрутто");
	ОбластьИтог.Параметры.ИтогВесНетто = ИтВесНетто;
	//ОбластьИтог.Параметры.ИтогКомплКоличество = ИтКомплКоличество;


	ТабДокумент.Вывести(ОбластьИтог);
		
//-------------------печати и подписи---------------------------------------
	ОбластьСтрока1 = Макет.ПолучитьОбласть("ПодвалШапка");
	ОбластьСтрока1.Параметры.ПечПоставщик = "WHEELS GROUP LIMITED";
	ОбластьСтрока1.Параметры.ПечРуководитель="Svilen Spasov";
	ТабДокумент.Вывести(ОбластьСтрока1);
		
	ТабДокумент.АвтоМасштаб = Истина;
	ТабДокумент.ОтображатьСетку = Ложь;
	
	Возврат ТабДокумент;
				   
КонецФункции

Функция СформироватьНаименованиеТовара(ТЗтоваров, ДваЯзыка,ОрганизацияТТ=ложь)
	
	ГруппаЛитые = Справочники.Номенклатура.НайтиПоКоду("0001753"); //это из алюминия легковые
	ГруппаГрузовые = Справочники.Номенклатура.НайтиПоКоду("9004163");  //это грузовые
	ГруппаШтампованные = Справочники.Номенклатура.НайтиПоКоду("0001755"); //это стальные легковые
	
	ЕстьАлюминиевые = Ложь;
	ЕстьСтальные = Ложь;
	ЕстьГрузовые = Ложь;
	ЕстьАксессуары = Ложь;
	ЕстьШины = Ложь;
	Для Каждого Стр из ТЗТоваров Цикл
		ЭтоЛитойДиск = Стр.Номенклатура.ПринадлежитЭлементу(ГруппаЛитые);
		ЭтоШтампованныйДиск = Стр.Номенклатура.ПринадлежитЭлементу(ГруппаШтампованные);
		ЭтоГрузовойДиск = Стр.Номенклатура.ПринадлежитЭлементу(ГруппаГрузовые);
		Если ЭтоЛитойДиск Тогда
			ЕстьАлюминиевые = Истина;
		ИначеЕсли ЭтоШтампованныйДиск Тогда
			ЕстьСтальные = Истина;
		ИначеЕсли ЭтоГрузовойДиск Тогда 
			ЕстьГрузовые = Истина;
		ИначеЕсли Стр.Номенклатура.ВидТовара = Перечисления.ВидыТоваров.Аксессуары Тогда
			ЕстьАксессуары = Истина;
		ИначеЕсли Стр.Номенклатура.ВидТовара = Перечисления.ВидыТоваров.Шины Тогда
			ЕстьШины = Истина;
		КонецЕсли;	
	КонецЦикла;	
	ПечНаименованиеТовара = "";
	ПечНаименованиеТовараАнгл = "";
	Если ЕстьАлюминиевые Тогда
		ПечНаименованиеТовара = ПечНаименованиеТовара+"Новые алюминиевые";
		ПечНаименованиеТовараАнгл = ПечНаименованиеТовараАнгл+"New aluminum";
	КонецЕсли;
	Если ЕстьСтальные Тогда
		ПечНаименованиеТовара = ?(ПечНаименованиеТовара = "","Новые стальные", ПечНаименованиеТовара+", стальные");
		ПечНаименованиеТовараАнгл = ?(ПечНаименованиеТовараАнгл = "","New steel", ПечНаименованиеТовараАнгл+", steel");
	КонецЕсли;
	Если ПечНаименованиеТовара <> "" Тогда
		ПечНаименованиеТовара = ПечНаименованиеТовара+" колеса для легковых автомобилей, ";
		ПечНаименованиеТовараАнгл = ПечНаименованиеТовараАнгл+" wheels for passenger cars, ";
	КонецЕсли;
	Если ЕстьГрузовые Тогда
		ПечНаименованиеТовара = ПечНаименованиеТовара+"Новые колеса для грузовых автомобилей, ";
		ПечНаименованиеТовараАнгл = ПечНаименованиеТовараАнгл+"New wheels for trucks, ";
	КонецЕсли;
	Если ЕстьШины Тогда
		ПечНаименованиеТовара = ПечНаименованиеТовара+"Шины, ";
		ПечНаименованиеТовараАнгл = ПечНаименованиеТовараАнгл+"Tires, ";
	КонецЕсли;	
	Если ЕстьАксессуары Тогда
		ПечНаименованиеТовара = ПечНаименованиеТовара+"Аксессуары, ";
		ПечНаименованиеТовараАнгл = ПечНаименованиеТовараАнгл+"Accessories, ";
	КонецЕсли;	
	
	ПечНаименованиеТовара = Лев(ПечНаименованиеТовара, СтрДлина(ПечНаименованиеТовара)-2);
	ПечНаименованиеТовараАнгл = Лев(ПечНаименованиеТовараАнгл, СтрДлина(ПечНаименованиеТовараАнгл)-2);
	
	//Если ДваЯзыка и не организацияТТ Тогда
	//	возврат ПечНаименованиеТовараАнгл+" / "+ПечНаименованиеТовара;
	//ИначеЕсли организацияТТ	тогда
		возврат ПечНаименованиеТовараАнгл;
	//Иначе	
	//	возврат ПечНаименованиеТовара;
	//КонецЕсли;
	
КонецФункции	


Функция ВесУпаковки(типоразмер, ЭтоЛитойДиск = Ложь)
	
	индексД = ?(типоразмер.Диаметр="",0, число(типоразмер.Диаметр)-13);  
	
	Если индексД>=0 тогда
		Если ЭтоЛитойДиск Тогда
			масса = новый Массив;
			масса.Добавить(0.430); //13
			масса.Добавить(0.650); //14
			масса.Добавить(0.700); //15
			масса.Добавить(0.870); //16
			масса.Добавить(0.950); //17
			масса.Добавить(1.100);  //18
			масса.Добавить(1.200);  //19
			масса.Добавить(1.400);  //20
			масса.Добавить(1.550);  //21
			масса.Добавить(1.700); //22 
			m = масса[индексД];
		Иначе
			масса = новый Массив;
			масса.Добавить(0.300); //13
			масса.Добавить(0.400); //14
			масса.Добавить(0.500); //15
			масса.Добавить(0.600); //16
			масса.Добавить(0.700); //17
			//+++  Шарафутдинов 28.03.2018 не печаталась спецификация
			масса.Добавить(0.800);  //18
			масса.Добавить(0.900);  //19
			масса.Добавить(1.000);  //20
			масса.Добавить(1.100);  //21
			масса.Добавить(1.200); //22 
			//+++  Шарафутдинов 28.03.2018
			m = масса[индексД];
		КонецЕсли;
	Иначе // это болты или гайки
		m = 0;
	КонецЕсли;
	возврат Окр(m,3);
КонецФункции	

функция ПолучитьШтрихКодЯШТ(Код)

Если стрДлина(Код)<7 тогда
	код1 = Формат(число(Код), "ЧЦ=7; ЧВН=");
иначе 
	код1 = код;
КонецЕсли;	
	
ШтрихКод = "05000"+ Код;
ШтрихКод = ШтрихКод + КонтрольныйСимволEAN(ШтрихКод, 13);

возврат ШтрихКод;

КонецФункции



 Функция Печать() Экспорт
	 
Запрос = Новый Запрос;
Запрос.Текст = "ВЫБРАТЬ
               |	А.Номенклатура КАК Номенклатура,
               |	ВЫБОР
               |		КОГДА А.Комплектующая = NULL
               |			ТОГДА ""нет""
               |		ИНАЧЕ А.Комплектующая.Код
               |	КОНЕЦ КАК Код,
               |	ВЫБОР
               |		КОГДА А.Комплектующая = NULL
               |			ТОГДА ""нет""
               |		ИНАЧЕ А.Комплектующая.КодСБИС
               |	КОНЕЦ КАК КодСБИС,
               |	СУММА(А.Количество) КАК Количество,
               |	А.Комплектующая
               |ИЗ
               |	(ВЫБРАТЬ
               |		РеализацияТоваровУслугТовары.Номенклатура КАК Номенклатура,
               |		КомплектующиеНоменклатуры.Комплектующая КАК Комплектующая,
               |		РеализацияТоваровУслугТовары.Количество КАК Количество
               |	ИЗ
               |		(ВЫБРАТЬ
               |			РеализацияТоваровУслугТовары.Номенклатура КАК Номенклатура,
               |			СУММА(РеализацияТоваровУслугТовары.Количество) КАК Количество
               |		ИЗ
               |			Документ.РеализацияТоваровУслуг.Товары КАК РеализацияТоваровУслугТовары
               |		ГДЕ
               |			РеализацияТоваровУслугТовары.Ссылка = &Ссылка
               |			И РеализацияТоваровУслугТовары.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)
               |		
               |		СГРУППИРОВАТЬ ПО
               |			РеализацияТоваровУслугТовары.Номенклатура) КАК РеализацияТоваровУслугТовары
               |			ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
               |				КомплектующиеНоменклатуры.Номенклатура КАК Номенклатура,
               |				КомплектующиеНоменклатуры.Комплектующая КАК Комплектующая,
               |				КомплектующиеНоменклатуры.Количество КАК Количество
               |			ИЗ
               |				РегистрСведений.КомплектующиеНоменклатуры КАК КомплектующиеНоменклатуры
               |			ГДЕ
               |				КомплектующиеНоменклатуры.Номенклатура В
               |						(ВЫБРАТЬ РАЗЛИЧНЫЕ
               |							Документ.РеализацияТоваровУслуг.Товары.Номенклатура
               |						ИЗ
               |							Документ.РеализацияТоваровУслуг.Товары
               |						ГДЕ
               |							Документ.РеализацияТоваровУслуг.Товары.Ссылка = &Ссылка)
               |				И КомплектующиеНоменклатуры.Комплектующая В ИЕРАРХИИ(&Крышки)) КАК КомплектующиеНоменклатуры
               |			ПО РеализацияТоваровУслугТовары.Номенклатура = КомплектующиеНоменклатуры.Номенклатура) КАК А
               |
               |СГРУППИРОВАТЬ ПО
               |	А.Номенклатура,
               |	ВЫБОР
               |		КОГДА А.Комплектующая = NULL
               |			ТОГДА ""нет""
               |		ИНАЧЕ А.Комплектующая.Код
               |	КОНЕЦ,
               |	ВЫБОР
               |		КОГДА А.Комплектующая = NULL
               |			ТОГДА ""нет""
               |		ИНАЧЕ А.Комплектующая.КодСБИС
               |	КОНЕЦ,
               |	А.Комплектующая
               |
               |УПОРЯДОЧИТЬ ПО
               |	КодСБИС
               |ИТОГИ
               |	СУММА(Количество)
               |ПО
               |	Номенклатура";

Запрос.УстановитьПараметр("Ссылка", СсылкаНаОбъект );
Запрос.УстановитьПараметр("Крышки", Справочники.Номенклатура.НайтиПоКоду("0080004") );

Результат = Запрос.Выполнить();
Выборка = Результат.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);

	ТабДокумент = Новый ТабличныйДокумент;
	ТабДокумент.ИмяПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_РеализацияТоваровУслуг_ВнешняяПечФорма_КодКодСбисКолво";

	Макет = ПолучитьМакет("Макет");

	// Выводим шапку накладной

	ОбластьМакета = Макет.ПолучитьОбласть("Заголовок");
	ОбластьМакета.Параметры.ТекстЗаголовка = Строка(СсылкаНаОбъект);
	ТабДокумент.Вывести(ОбластьМакета);

	ОбластьМакета = Макет.ПолучитьОбласть("Поставщик");
	ПредставлениеПоставщика = ОписаниеОрганизации(СведенияОЮрФизЛице(СсылкаНаОбъект.Организация, СсылкаНаОбъект.Дата), "ПолноеНаименование,");
	ОбластьМакета.Параметры.ПредставлениеПоставщика = ПредставлениеПоставщика;
	ОбластьМакета.Параметры.Поставщик = СсылкаНаОбъект.Организация;
	ТабДокумент.Вывести(ОбластьМакета);

	ОбластьМакета = Макет.ПолучитьОбласть("Покупатель");
	ПредставлениеПолучателя = ОписаниеОрганизации(СведенияОЮрФизЛице(СсылкаНаОбъект.Контрагент, СсылкаНаОбъект.Дата), "ПолноеНаименование,");
	ОбластьМакета.Параметры.ПредставлениеПолучателя = ПредставлениеПолучателя;
	ОбластьМакета.Параметры.Получатель = СсылкаНаОбъект.Контрагент;
	ТабДокумент.Вывести(ОбластьМакета);

    ОбластьМакета = Макет.ПолучитьОбласть("ШапкаТаблицы");
	ТабДокумент.Вывести(ОбластьМакета);

 ОбластьМакетаГруппа = Макет.ПолучитьОбласть("Группа");
 ОбластьМакета = Макет.ПолучитьОбласть("Строка");
 
 номНом=0; пп=0;
 Пока Выборка.Следующий() Цикл
	 номНом = номНом+1;
	//ОбластьМакетаГруппа.Параметры.НомерСтроки = номНом; 
	//ОбластьМакетаГруппа.Параметры.Код  = ""; //Выборка.Номенклатура.Код;
	//ОбластьМакетаГруппа.Параметры.КодСБИС  = ""; //Выборка.Номенклатура.КодСБИС;
	//ОбластьМакетаГруппа.Параметры.Номенклатура = Строка(Выборка.Номенклатура);
	//ОбластьМакетаГруппа.Параметры.Количество = ""; //Выборка.Количество;
	//ТабДокумент.Вывести(ОбластьМакетаГруппа);

    ВыборкаСтр = Выборка.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
 номСтр = 0;	 
 Пока ВыборкаСтр.Следующий() Цикл
 номСтр = номСтр + 1; пп = пп + 1;
 ОбластьМакета.Параметры.Заполнить(ВыборкаСтр);
 ОбластьМакета.Параметры.НомерСтроки = строка(пп); //строка(номНом)+"."+строка(номСтр);
 Если ВыборкаСтр.Код = Null тогда
	  //ОбластьМакета.Параметры.Код = "нет";
	  //ОбластьМакета.Параметры.КодСБИС = "нет";
	  сообщить("Для номенклатуры: "+Выборка.Номенклатура.Код+") "+строка(Выборка.Номенклатура)+" - НЕТ крышек");
	  пп = пп - 1;
 иначе
 	ТабДокумент.Вывести(ОбластьМакета);
 КонецЕсли;	  
КонецЦикла;
КонецЦикла;

ТабДокумент.ТолькоПросмотр = истина;
ТабДокумент.Показать();
возврат Неопределено;

КонецФункции
	
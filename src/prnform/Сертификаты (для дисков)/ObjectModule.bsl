ФУНКЦИЯ Печать() ЭКСПОРТ
	//ОчиститьСообщения();
	
	Если СсылкаНаОбъект.Товары.Количество()=0 Тогда
		Сообщить(нстр("ru=""Нет товаров для печати!"";
					  |en=""No goods for printing!""") );
		Возврат неопределено;
	КонецЕсли;	
	
	Если СсылкаНаОбъект.Ссылка.Пустая() Тогда
		Сообщить(нстр("ru=""Для печати необходимо предварительно записать Документ!"";
					  |en=""For the printing it is necessary to write down the Document previously!""") );
		Возврат неопределено;
	КонецЕсли;		
	
	ТабДок = ПечатьСертификатов();
	
	возврат ТабДок;
   
КонецФункции



Функция ПечатьСертификатов()
	
путь = "\\terminal\ОТДЕЛ ДИСКОВ\СЕРТИФИКАТЫ\ВЕСНА 2015\";
Поставщик = "Freeman";
	
	ТабДокумент = Новый ТабличныйДокумент;
	ТабДокумент.ИмяПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_Заказ_Сертификаты";
	
	Макет = ПолучитьМакет("Сертификат");
	
	ОбластьКартинки    = Макет.ПолучитьОбласть("Картинка");
	
Запрос = Новый Запрос;
Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ
               |	Номенклатура.Производитель.Представление КАК Брэнд,
               |	Номенклатура.НоменклатурнаяГруппа как Тип
			   |
			   |ИЗ
               |	Справочник.Номенклатура КАК Номенклатура
               |ГДЕ
               |	Номенклатура.Ссылка В(&Спис)
               |	И Номенклатура.ВидТовара = &ВидТовара";

 спис = СсылкаНаОбъект.Товары.ВыгрузитьКолонку("Номенклатура");
 Запрос.УстановитьПараметр("Спис", спис);
 Запрос.УстановитьПараметр("ВидТовара",Перечисления.ВидыТоваров.Диски);
 
Результат = Запрос.Выполнить();
Выборка = Результат.Выбрать();

//======================================================	
ЭтоПервый = истина;
пока выборка.Следующий() цикл
	АдресСертификата = путь+выборка.тип+"\"+Поставщик+"\"+выборка.Брэнд+".jpg";
	
попытка
		ФайлКартинки = Новый Файл(АдресСертификата); //для каждой номенклатуры адрес свой
	
	Если НЕ ФайлКартинки.Существует() тогда
		#Если Клиент тогда
		сообщить("Нет файла cертификата для '"+ выборка.Брэнд+"':
		          |   "+АдресСертификата, СтатусСообщения.Внимание);
		#КонецЕсли				
		Продолжить;
	КонецЕсли;
	
	Изображение = Новый Картинка(ФайлКартинки.ПолноеИмя, ложь);
	Рисунок = ОбластьКартинки.Рисунки.Получить(0);
	Рисунок.Картинка = Изображение;
	
	Если выборка.Брэнд="REPLICA TD" тогда
		выборкаБрэнд = "TOP DRIVER";
	ИначеЕсли Найти(врег(выборка.Брэнд),"REPLICA")>0 тогда // это всё LegeArtis
		выборкаБрэнд = "LEGEARTIS";
	Иначе 
		выборкаБрэнд =выборка.Брэнд;
	КонецЕсли;	
	ОбластьКартинки.Параметры.Брэнд	= "КОПИЯ сертификата на "+выборка.тип+" диски """+выборкаБрэнд+"""";
	
	если ЭтоПервый тогда
		ЭтоПервый=ложь;
	иначе	
    	ТабДокумент.ВывестиГоризонтальныйРазделительСтраниц();
	КонецЕсли;
	
	ТабДокумент.Вывести(ОбластьКартинки);
исключение
		#Если Клиент тогда
		сообщить("Не удаётся получить файл cертификата для '"+ выборка.Брэнд+"':
		          |   "+АдресСертификата, СтатусСообщения.Внимание);
		#КонецЕсли				
		Продолжить;
КонецПопытки;
	
КонецЦикла;
//=========================================================	
	//ТабДокумент.АвтоМасштаб = Истина;
	ТабДокумент.ОтображатьСетку = Ложь;
	ТабДокумент.Защита = истина;

	Если выборка.Количество()=0 тогда // нет ничего - ничего и не выводим!
		ТабДокумент = неопределено;
		#Если Клиент тогда
		Предупреждение("         Нет дисков в документе. 
		                |Печать Сертификатов - только для дисков.", 30);
		#КонецЕсли				
	КонецЕсли;

	Возврат ТабДокумент;
	
КонецФункции // ПечатьСпецификации()


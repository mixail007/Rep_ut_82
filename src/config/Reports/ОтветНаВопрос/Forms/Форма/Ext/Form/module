Перем ВысотаЗаголовка;
Перем НеЗаполнятьНастройкиПриОткрытии;
Перем СтруктураСвязиЭлементовСДанными;
Перем ОтборРазвернут;

// Управляет пометками кнопок ком. панели
//
// Параметры:
//	Нет.
//
Процедура УправлениеПараметрамиОтображенияЭлементовФормы()
	
	Если ПоказыватьЗаголовок Тогда
		ЭлементыФормы.КоманднаяПанельФормы.Кнопки.Заголовок.Пометка = Истина;
		ЭлементыФормы.КоманднаяПанельФормы.Кнопки.Подменю.Кнопки.Заголовок.Пометка = Истина;

	Иначе
		ЭлементыФормы.КоманднаяПанельФормы.Кнопки.Заголовок.Пометка = Ложь;
		ЭлементыФормы.КоманднаяПанельФормы.Кнопки.Подменю.Кнопки.Заголовок.Пометка = Ложь;

	КонецЕсли;

	// Отображение заголовка отчета
	Если НЕ ЗначениеНеЗаполнено(ВысотаЗаголовка) Тогда
		ЭлементыФормы.ДокументРезультат.Область(1,,ВысотаЗаголовка).Видимость = ПоказыватьЗаголовок;
	КонецЕсли;

	Если ОтборРазвернут Тогда
		ЭлементыФормы.КоманднаяПанельФормы.Кнопки.Отбор.Пометка = Истина;
		ЭлементыФормы.КоманднаяПанельФормы.Кнопки.Подменю.Кнопки.Отбор.Пометка = Истина;
		ЭлементыФормы.ПанельОтбор.Свертка = РежимСверткиЭлементаУправления.Нет;
	Иначе
		ЭлементыФормы.ПанельОтбор.Свертка = РежимСверткиЭлементаУправления.Верх;
		ЭлементыФормы.КоманднаяПанельФормы.Кнопки.Отбор.Пометка = Ложь;
		ЭлементыФормы.КоманднаяПанельФормы.Кнопки.Подменю.Кнопки.Отбор.Пометка = Ложь;
	КонецЕсли;
	
КонецПроцедуры // УправлениеПараметрамиОтображенияЭлементовФормы()

//  Управляет выводом заголовка
//
// Параметры:
//	Нет.
//
Процедура ВыводЗаголовка()

	// Перезаполнять заголовок можно только у "чистого" отчета
	Если ЭлементыФормы.ДокументРезультат.ВысотаТаблицы = 0 Тогда

		ЭтотОтчет.СформироватьОтчет(ЭлементыФормы.ДокументРезультат, ПоказыватьЗаголовок, ВысотаЗаголовка, Истина);
		
	КонецЕсли;

	УправлениеПараметрамиОтображенияЭлементовФормы();
	
КонецПроцедуры // ВыводЗаголовка()

// Формирует текст заголовка
//
// Параметры:
//	Нет.
//
Процедура СформироватьЗаголовокФормы()

	Заголовок = СформироватьЗаголовокОсновнойФормы(, , мНазваниеОтчета, -1);

КонецПроцедуры // СформироватьЗаголовокФормы()

// Обновляет таблицу отчета
//
// Параметры:
//	Нет.
//
Процедура ОбновитьТаблицуОтчета() Экспорт

	ЭтотОтчет.СформироватьОтчет(ЭлементыФормы.ДокументРезультат, ПоказыватьЗаголовок, ВысотаЗаголовка);

	Если НЕ ЗначениеНеЗаполнено(ВысотаЗаголовка) Тогда
		ЭлементыФормы.ДокументРезультат.Область(1,,ВысотаЗаголовка).Видимость = ПоказыватьЗаголовок;
	КонецЕсли;

	ЭтаФорма.ТекущийЭлемент = ЭлементыФормы.ДокументРезультат;

	УправлениеПараметрамиОтображенияЭлементовФормы();
	
КонецПроцедуры // ОбновитьТаблицуОтчета()

Процедура ОбновитьДиаграмму(ОбновлятьПостроитель = Истина) Экспорт

	Если ОбновлятьПостроитель Тогда
		ЭтотОтчет.ОтчетДиаграмма.ПостроительОтчета.УстановитьНастройки(ПостроительОтчета.ПолучитьНастройки());
	КонецЕсли;
	
	ЭтотОтчет.СформироватьДиаграмму(ЭлементыФормы.Диаграмма);
	ОбщийОтчетДиаграмма = ЭтотОтчет.ОтчетДиаграмма;
	
	Если ОбщийОтчетДиаграмма.НомерПоказателя = 2 тогда // это показатель Развернутый ответ
		ЭлементыФормы.Диаграмма.Очистить();
		РезультатРазвернутыйОтвет = ЭтотОтчет.ОтчетДиаграмма.ПостроительОтчета.Результат;
		ТаблицаРазвернутыйОтвет = РезультатРазвернутыйОтвет.Выгрузить(ОбходРезультатаЗапроса.Прямой);
		ТаблицаРазвернутыйОтвет.Колонки.Добавить("Ответ");
		СписокСтрокКУдалению = Новый СписокЗначений;
		Для Каждого СтрокаТаблицаРазвернутыйОтвет из ТаблицаРазвернутыйОтвет Цикл
			Попытка
				СтрокаТаблицаРазвернутыйОтвет.Ответ = Число(СтрокаТаблицаРазвернутыйОтвет.РазвернутыйОтвет);
			Исключение
			КонецПопытки;
		КонецЦикла;
		ТаблицаРазвернутыйОтвет.Свернуть("ТиповойОтвет", "Ответ");
		ВсегоСтрок = ТаблицаРазвернутыйОтвет.Количество() - 1;
		Для индСтроки = 0 по ВсегоСтрок Цикл
			СтрокаТаблицаРазвернутыйОтвет = ТаблицаРазвернутыйОтвет[ВсегоСтрок - индСтроки];
			Если ЗначениеНеЗаполнено(СтрокаТаблицаРазвернутыйОтвет.ТиповойОтвет) тогда
				ТаблицаРазвернутыйОтвет.Удалить(СтрокаТаблицаРазвернутыйОтвет);
			КонецЕсли;
		КонецЦикла;
		ЭлементыФормы.Диаграмма.ИсточникДанных = ТаблицаРазвернутыйОтвет;
	КонецЕсли;
	ТипДиаграммыОтчета = ОбщийОтчетДиаграмма.ТипДиаграммыОтчета;
	Если ТипДиаграммыОтчета <> Неопределено Тогда
		ЭлементыФормы.Диаграмма.ТипДиаграммы = ТипДиаграммыОтчета;
	КонецЕсли;
	
	ЭлементыФормы.КоманднаяПанельДиаграммы.Кнопки.Транспонировать.Доступность =  
			(ТипДиаграммыОтчета <> ТипДиаграммы.Круговая И ТипДиаграммыОтчета <> ТипДиаграммы.КруговаяОбъемная);
			
	Если ОбщийОтчетДиаграмма.ВидПодписейККруговойДиаграмме<>Неопределено Тогда
		ЭлементыФормы.Диаграмма.ВидПодписей = ОбщийОтчетДиаграмма.ВидПодписейККруговойДиаграмме;
	КонецЕсли;
	
	Если ОбщийОтчетДиаграмма.РаздвижениеСерийКруговойДиаграммы<>Неопределено Тогда
		ЭлементыФормы.Диаграмма.АвтоРаздвижениеСерий = ОбщийОтчетДиаграмма.РаздвижениеСерийКруговойДиаграммы;
	КонецЕсли; 
	
	ЭлементыФормы.Диаграмма.Свет = ОбщийОтчетДиаграмма.Свет;
	ЭлементыФормы.Диаграмма.Окантовка = ОбщийОтчетДиаграмма.Окантовка;
	ЭлементыФормы.Диаграмма.Градиент = ОбщийОтчетДиаграмма.Градиент;
	
	Если ОбщийОтчетДиаграмма.ОриентацияИзометрическойДиаграммы <> Неопределено Тогда
		ЭлементыФормы.Диаграмма.Ориентация = ОбщийОтчетДиаграмма.ОриентацияИзометрическойДиаграммы;
	КонецЕсли;
	
	Если ОбщийОтчетДиаграмма.РежимПробеловДиаграммыСОбластями <> Неопределено Тогда
		ЭлементыФормы.Диаграмма.РежимПробелов = ОбщийОтчетДиаграмма.РежимПробеловДиаграммыСОбластями;
	КонецЕсли;
	
	Если ОбщийОтчетДиаграмма.ОграничениеСерий<>Неопределено Тогда
		ЭлементыФормы.Диаграмма.МаксимумСерий = ОбщийОтчетДиаграмма.ОграничениеСерий;
	КонецЕсли;
	
	ЭлементыФормы.Диаграмма.МаксимумСерийКоличество = ОбщийОтчетДиаграмма.МаксимумСерийКоличество;
	ЭлементыФормы.Диаграмма.МаксимумСерийПроцент = ОбщийОтчетДиаграмма.МаксимумСерийПроцент;

	ВыводимыйПоказатель = "";
	Если ОбщийОтчетДиаграмма.НомерПоказателя < ОбщийОтчетДиаграмма.мТаблицаПоказатели.Количество() Тогда
		ВыводимыйПоказатель = ОбщийОтчетДиаграмма.мТаблицаПоказатели[ОбщийОтчетДиаграмма.НомерПоказателя].ПредставлениеПоля;
	КонецЕсли;
	
	ЭлементыФормы.Диаграмма.ОбластьПостроения.ВертикальныеМетки = ОбщийОтчетДиаграмма.ВертикальныеМетки;

	ЭлементыФормы.Диаграмма.ОбластьЗаголовка.Текст = ОбщийОтчетДиаграмма.мНазваниеОтчета + ": " + ВыводимыйПоказатель;
	
	ЭлементыФормы.Диаграмма.БазовоеЗначение = ОбщийОтчетДиаграмма.БазовоеЗначение;
	
	ЭлементыФормы.Диаграмма.ОтображатьЗаголовок = ОбщийОтчетДиаграмма.ОтображатьЗаголовок;
	
	ЭлементыФормы.Диаграмма.ОтображатьЛегенду   = ОбщийОтчетДиаграмма.ОтображатьЛегенду;
	
	ТекущийЭлемент = ЭлементыФормы.Диаграмма;

КонецПроцедуры

Процедура ОбновитьСводнуюТаблицу() Экспорт

	ЭтотОтчет.СформироватьСводнуюТаблицу(ЭлементыФормы.СводнаяТаблица.ВстроенныеТаблицы.СводнаяТаблица);
	
	ТекущийЭлемент = ЭлементыФормы.СводнаяТаблица;

КонецПроцедуры

// Обновляет таблицу отчета
//
// Параметры:
//	Нет.
//
Процедура ОбновитьОтчет() Экспорт
	
	//ЭтотОтчет.ПостроительОтчета.Параметры.Установить("Анкета", );
	//ЭтотОтчет.ПостроительОтчета.Параметры.Установить("Вопрос", );
	
	СписокПустыхЗначений = Новый СписокЗначений;
	ТипыПВХ = Метаданные.ПланыВидовХарактеристик.ВопросыДляАнкетирования.Тип.Типы();
	ЭтотОтчет.ОтчетДиаграмма.мНазваниеОтчета = Строка(ЭтотОтчет.ОбщийОтчет.ПостроительОтчета.Отбор.Вопрос.Значение);

	
	Для каждого ТипИзХарактеристики из ТипыПВХ Цикл
		СписокПустыхЗначений.Добавить(ПустоеЗначениеТипа(ТипИзХарактеристики));
	КонецЦикла;
	СписокПустыхЗначений.Добавить(Неопределено);
	
	ЭтотОтчет.ОбщийОтчет.ПостроительОтчета.Параметры.Вставить("СписокПустыхЗначений", СписокПустыхЗначений);
	ЭтотОтчет.ОбщийОтчет.ПостроительОтчета.Параметры.Вставить("Анкета", 			  ЭлементыФормы.ПолеНастройкиАнкета.Значение);
	ЭтотОтчет.ОбщийОтчет.ПостроительОтчета.Параметры.Вставить("Раздел",	  	  	  	  ЭлементыФормы.ПолеНастройкиРаздел.Значение);
	ЭтотОтчет.ОбщийОтчет.ПостроительОтчета.Параметры.Вставить("Опрос",	  	  	  	  ЭлементыФормы.ПолеНастройкиОпрос.Значение);
	ЭтотОтчет.ОтчетДиаграмма.ПостроительОтчета.Параметры.Вставить("СписокПустыхЗначений", СписокПустыхЗначений);
	ЭтотОтчет.ОтчетДиаграмма.ПостроительОтчета.Параметры.Вставить("Анкета", 			  ЭлементыФормы.ПолеНастройкиАнкета.Значение);
	ЭтотОтчет.ОтчетДиаграмма.ПостроительОтчета.Параметры.Вставить("Раздел",	  	  	  	  ЭлементыФормы.ПолеНастройкиРаздел.Значение);
	ЭтотОтчет.ОтчетДиаграмма.ПостроительОтчета.Параметры.Вставить("Опрос",	  	  	  	  ЭлементыФормы.ПолеНастройкиОпрос.Значение);
	

	Если ЭтотОтчет.ВариантОтображения = "Таблица" Тогда
		
		ОбновитьТаблицуОтчета();
		
	ИначеЕсли ЭтотОтчет.ВариантОтображения = "Диаграмма" Тогда
		
		ЭтотОтчет.ОтчетДиаграмма.Показатели.Загрузить(ОбщийОтчет.Показатели.Выгрузить());
		
		ОбновитьДиаграмму();
		
	ИначеЕсли ЭтотОтчет.ВариантОтображения = "СводнаяТаблица" Тогда
		
		ОбновитьСводнуюТаблицу();
		
	КонецЕсли;
	
КонецПроцедуры // ОбновитьОтчет()

// Заполняет параметры диаграммы по умолчанию
//
// Параметры:
//	Нет.
//
Процедура ЗаполнитьНачальныеНастройкиДиаграммы()
	
	Если ЭтотОтчет.ОтчетДиаграмма.ТипДиаграммыОтчета<>Неопределено Тогда
		ЭлементыФормы.Диаграмма.ТипДиаграммы = ЭтотОтчет.ОтчетДиаграмма.ТипДиаграммыОтчета;
	Иначе
		ЭтотОтчет.ОтчетДиаграмма.ТипДиаграммыОтчета = ЭлементыФормы.Диаграмма.ТипДиаграммы;
	КонецЕсли;
	
	Если ЭтотОтчет.ОтчетДиаграмма.ВидПодписейККруговойДиаграмме<>Неопределено Тогда
		ЭлементыФормы.Диаграмма.ВидПодписей = ЭтотОтчет.ОтчетДиаграмма.ВидПодписейККруговойДиаграмме;
	Иначе
		ЭтотОтчет.ОтчетДиаграмма.ВидПодписейККруговойДиаграмме = ЭлементыФормы.Диаграмма.ВидПодписей;
	КонецЕсли;
	
	Если ЭтотОтчет.ОтчетДиаграмма.РаздвижениеСерийКруговойДиаграммы<>Неопределено Тогда
		ЭлементыФормы.Диаграмма.АвтоРаздвижениеСерий = ЭтотОтчет.ОтчетДиаграмма.РаздвижениеСерийКруговойДиаграммы;
	Иначе
		ЭтотОтчет.ОтчетДиаграмма.РаздвижениеСерийКруговойДиаграммы = ЭлементыФормы.Диаграмма.АвтоРаздвижениеСерий;
	КонецЕсли;
	
	Если ЭтотОтчет.ОтчетДиаграмма.ОриентацияИзометрическойДиаграммы<>Неопределено Тогда
		ЭлементыФормы.Диаграмма.Ориентация = ЭтотОтчет.ОтчетДиаграмма.ОриентацияИзометрическойДиаграммы;
	Иначе
		ЭтотОтчет.ОтчетДиаграмма.ОриентацияИзометрическойДиаграммы = ЭлементыФормы.Диаграмма.Ориентация;
	КонецЕсли;
	
	Если ЭтотОтчет.ОтчетДиаграмма.РежимПробеловДиаграммыСОбластями<>Неопределено Тогда
		ЭлементыФормы.Диаграмма.РежимПробелов = ЭтотОтчет.ОтчетДиаграмма.РежимПробеловДиаграммыСОбластями;
	Иначе
		ЭтотОтчет.ОтчетДиаграмма.РежимПробеловДиаграммыСОбластями = ЭлементыФормы.Диаграмма.РежимПробелов;
	КонецЕсли;
	
	Если ЭтотОтчет.ОтчетДиаграмма.ОграничениеСерий<>Неопределено Тогда
		ЭлементыФормы.Диаграмма.МаксимумСерий = ЭтотОтчет.ОтчетДиаграмма.ОграничениеСерий;
	Иначе
		ЭтотОтчет.ОтчетДиаграмма.ОграничениеСерий = ЭлементыФормы.Диаграмма.МаксимумСерий;
	КонецЕсли;
	
	ЭтотОтчет.ОтчетДиаграмма.ОтображатьЗаголовок = ЭлементыФормы.Диаграмма.ОтображатьЗаголовок;
	ЭтотОтчет.ОтчетДиаграмма.ОтображатьЛегенду   = ЭлементыФормы.Диаграмма.ОтображатьЛегенду;
	
	ЭтотОтчет.ОтчетДиаграмма.Окантовка = Истина;
	ЭтотОтчет.ОтчетДиаграмма.Свет = Истина;
	
КонецПроцедуры // ЗаполнитьПараметрыДиаграммы()

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ НАЖАТИЯ КНОПОК КОМАНДНОЙ ПАНЕЛИ

// Процедура - обработчик нажатия кнопки "Настройка".
//
Процедура КоманднаяПанельФормыНастройка(Кнопка)
	
	ФормаНастройка = ЭтотОтчет.ПолучитьФормуНастройки();
	ФормаНастройка.ВладелецФормы = ЭтаФорма;

	СтруктураСНастройками = ЭтотОтчет.СформироватьСтруктуруДляСохраненияНастроек(ПоказыватьЗаголовок);

	СтараяДатаКон = ДатаКон;
	СтараяДатаНач = ДатаНач;
	
	РезультатОткрытия = ФормаНастройка.ОткрытьМодально();

	Если РезультатОткрытия = Истина Тогда

		ОбновитьОтчет();

	Иначе
		
		// Форму закрыли эскейпом или по "Закрыть" - восстановим настройки, отчет формировать не будем!
		// Восстанавливаем сохраненные значения
		
		ЭтотОтчет.ВосстановитьНастройкиИзСтруктуры(СтруктураСНастройками, ПоказыватьЗаголовок);
		
		ДатаКон = СтараяДатаКон;
		ДатаНач = СтараяДатаНач;
		
	КонецЕсли;

КонецПроцедуры

// Процедура - обработчик нажатия кнопки "Отбор".
//
Процедура КоманднаяПанельФормыОтбор(Кнопка)

	ОтборРазвернут = НЕ ОтборРазвернут;

	УправлениеПараметрамиОтображенияЭлементовФормы();
	
КонецПроцедуры

// Процедура - обработчик нажатия кнопки "Обновить".
//
Процедура КоманднаяПанельФормыОбновить(Кнопка)

	ОбновитьОтчет();

КонецПроцедуры // ВыполнитьНажатие()

// Процедура - обработчик нажатия кнопки "Заголовок".
//
Процедура КоманднаяПанельФормыЗаголовок(Кнопка)
	
	ПоказыватьЗаголовок = Не ПоказыватьЗаголовок;
	
	ВыводЗаголовка();
	
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)

	Если Лев(ЭтотОтчет.ТекстЗапросаОтчета, 7) <> "ВЫБРАТЬ" тогда
		Отказ = Истина;
		Возврат;
	КонецЕсли;
	Если НЕ (НеЗаполнятьНастройкиПриОткрытии = Истина) Тогда

		ЭтотОтчет.ОбщийОтчет = ЭтотОбъект;

		ЭтотОтчет.ЗаполнитьНачальныеНастройки();
		
		ЗаполнитьНачальныеНастройкиДиаграммы();

		ВысотаЗаголовка = 0;

		СформироватьЗаголовокФормы();
		
		// Вспомним параметры для данной формы
		ИмяОтчета=ЭтотОтчет.Метаданные().Имя;
		ОтборРазвернут=?(ВосстановитьЗначение(ИмяОтчета + "_ОтборПомечен") = Истина, Истина, Ложь); // отбор в первый раз не показывать
		ПоказыватьЗаголовок = ?(ВосстановитьЗначение(ИмяОтчета + "_ЗаголовокПомечен") = Ложь, Ложь, Истина); // заголовок в первый раз наоборот, показывать
		
		ВыводЗаголовка();
		
	КонецЕсли;
	
	УстановитьСвязьПолейБыстрогоОтбораНаФорме(ЭлементыФормы, ПостроительОтчета.Отбор, СтруктураСвязиЭлементовСДанными, "ОбщийОтчет.ПостроительОтчета.Отбор");
	
КонецПроцедуры // ПередОткрытием()

// Процедура - обработчик события при открытии формы
//
Процедура ПриОткрытии(Отказ)
	Если ЗначениеНеЗаполнено(ЭтотОтчет.ВариантОтображения) Тогда
		ЭтотОтчет.ВариантОтображения = "Таблица";
	КонецЕсли;
	ЗаполнитьМенюОтчетаОтображение(ЭтотОтчет,ЭтаФорма);		
	УстановитьВидимостьПанелиОтчета(ЭлементыФормы, ЭтотОтчет.ВариантОтображения);
	
	НеЗаполнятьНастройкиПриОткрытии = Ложь;

	УправлениеПараметрамиОтображенияЭлементовФормы();
	
КонецПроцедуры

// Процедура - обработчик события перед сохранением значений формы
//
Процедура ПередСохранениемЗначений(Отказ)

	СохраненныеНастройки = ЭтотОтчет.СформироватьСтруктуруДляСохраненияНастроек(ПоказыватьЗаголовок);

КонецПроцедуры // ПередСохранениемЗначений()

// Процедура - обработчик события после восстановления значений формы
//
Процедура ПослеВосстановленияЗначений()

	// Если настройка восстанавливается, когда открывается форма сформровенного отчета, игнорируем
	Если НеЗаполнятьНастройкиПриОткрытии Тогда
		Возврат;
	КонецЕсли;
	
	Если ТипЗнч(СохраненныеНастройки) = Тип("Структура") Тогда
		
		ЭтотОтчет.ВосстановитьНастройкиИзСтруктуры(СохраненныеНастройки, ПоказыватьЗаголовок);
		
		// Очистим результат - он более не соответствует настройке
		ЭлементыФормы.ДокументРезультат.Очистить();
		ВысотаЗаголовка=0;
		
		ВыводЗаголовка();
		
		СформироватьЗаголовокФормы();
		
	КонецЕсли;

КонецПроцедуры // ПослеВосстановленияЗначений()

// Процедура - обработчик нажатия кнопки "Сформировать"
Процедура КоманднаяПанельФормыОтображение(Кнопка)

	ДействияПриИзмененииОтображения(ЭтотОтчет, ЭтаФорма, Кнопка)

КонецПроцедуры

// Процедура - обработчик нажатия кнопки "Транспонировать"
//
Процедура КоманднаяПанельФормыТранспонировать(Кнопка)
	
	ЭтотОтчет.ОтчетДиаграмма.Транспонировать();
	
	ОбновитьДиаграмму(Ложь);
	
КонецПроцедуры

// Процедура - обработчик нажатия кнопки "Настройка" диаграммы.
//
Процедура КоманднаяПанельФормыНастройкаДиаграммы(Кнопка)
	
	ФормаНастройка = ЭтотОтчет.ОтчетДиаграмма.ПолучитьФорму("ФормаНастройка", ЭтаФорма);
	
	//ФормаНастройка.НеНастраиватьПостроитель = Истина;
	
	РезультатОткрытия = ФормаНастройка.ОткрытьМодально();

	Если РезультатОткрытия = Истина Тогда
		ПостроительОтчета.УстановитьНастройки(ЭтотОтчет.ОтчетДиаграмма.ПостроительОтчета.ПолучитьНастройки());
		ОбновитьДиаграмму(Ложь);
	КонецЕсли;
КонецПроцедуры

// Процедура - обработчик нажатия кнопки "Печать" диаграммы.
//
Процедура КоманднаяПанельДиаграммыПечать(Кнопка)
	
	ДокументРезультат = Новый ТабличныйДокумент;
	ЭтотОтчет.ОтчетДиаграмма.ПолучитьДиаграммуНаПечать(ДокументРезультат);
	ДокументРезультат.Показать();
	
КонецПроцедуры

// При инициализации формы необходимо заполнить реквизиты и поля основного реквизита формы 
ЗаполнитьПоляОсновногоРеквизита(ЭтотОтчет.ОбщийОтчет);

НеЗаполнятьНастройкиПриОткрытии = Ложь;
ОтборРазвернут = Ложь;

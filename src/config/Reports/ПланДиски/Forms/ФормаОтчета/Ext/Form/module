
Процедура ПриОткрытии()
	компоновщикнастроек.ЗагрузитьФиксированныеНастройки(компоновщикнастроек.ФиксированныеНастройки);
	ПриОжидании();
	Если ГлТекущийПользователь.НаправлениеПродаж=Справочники.НаправленияПродаж.Диски 
		или ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "АвтооткрытиеПланаПродажДисков") тогда
		подключитьОбработчикОжидания("ПриОжидании",1800);
	конецЕсли;
	
	Датаотчета = текущаядата();
	ПараметрСКД = КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("ДатаОтчета");
	ПараметрСКД.Использование = Истина;
	ПараметрСКД.Значение  =НачалоМесяца(ДатаОтчета) ;
КонецПроцедуры
Процедура ПриОжидании() 
	//установим период в отчете
	//с 01,12 по 30.04  или с 01.05 по 30.11 
	Если Месяц(ТекущаяДата())> 4 и  Месяц(ТекущаяДата())<12 тогда
		НачалоПериода  = Дата(Год(ТекущаяДата()), 5, 1, 0, 0, 0);	
		КонецПериода = Дата(Год(ТекущаяДата()), 11,30, 23, 59, 59);
		ПараметрСКД = КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("НачалоПериода");
		ПараметрСКД.Использование = Истина;
		ПараметрСКД.Значение  = НачалоПериода ;
		ПараметрСКД = КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("КонецПериода");
		ПараметрСКД.Использование = Истина;
		ПараметрСКД.Значение  = Конецпериода ;
		
	иначеЕсли Месяц(ТекущаяДата())=12 тогда	
		НачалоПериода  = Дата(Год(ТекущаяДата()), 12, 1, 0, 0, 0);	
		КонецПериода = Дата(Год(ТекущаяДата())+1, 04, 30, 23, 59, 59);
		ПараметрСКД = КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("НачалоПериода");
		ПараметрСКД.Использование = Истина;
		ПараметрСКД.Значение  = НачалоПериода ;
		ПараметрСКД = КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("КонецПериода");
		ПараметрСКД.Использование = Истина;
		ПараметрСКД.Значение  = Конецпериода ;
	иначе
		НачалоПериода  = Дата(Год(ТекущаяДата())-1, 12, 1, 0, 0, 0);	
		КонецПериода = Дата(Год(ТекущаяДата()), 04, 30, 23, 59, 59);
		ПараметрСКД = КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("НачалоПериода");
		ПараметрСКД.Использование = Истина;
		ПараметрСКД.Значение  = НачалоПериода ;
		ПараметрСКД = КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("КонецПериода");
		ПараметрСКД.Использование = Истина;
		ПараметрСКД.Значение  = Конецпериода ;
		ДатаОтчета = ТекущаяДата();
		ПараметрСКД = КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("ДатаОтчета");
		ПараметрСКД.Использование = Истина;
		ПараметрСКД.Значение  =НачалоМесяца(ДатаОтчета) ;
		
	конецесли;
	Если глТекущийПользователь <> Справочники.Пользователи.НайтиПоКоду("Малышев Егор")и глТекущийПользователь <> Справочники.Пользователи.НайтиПоКоду("Никитин М.И.") тогда
		менеджер = Новый СписокЗначений;
		менеджер.Добавить(глТекущийПользователь); 
		ПараметрСКД = КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("Менеджер");
		ПараметрСКД.Использование = Истина;
		ПараметрСКД.Значение  = менеджер ;
	конецЕсли;
	Если Найти(глТекущийПользователь.Наименование,"WG") тогда
		менеджер = Новый СписокЗначений;
		
		
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	Пользователи.Ссылка
		|ИЗ
		|	Справочник.Пользователи КАК Пользователи
		|ГДЕ
		|	Пользователи.Заблокирован = ЛОЖЬ
		|	И Пользователи.Наименование ПОДОБНО ""%WG%""";
		
		Результат = Запрос.Выполнить().Выгрузить();
		менеджер.ЗагрузитьЗначения(Результат.ВыгрузитьКолонку("Ссылка"));
		
		
		
		ПараметрСКД = КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("Менеджер");
		ПараметрСКД.Использование = Истина;
		ПараметрСКД.Значение  = менеджер ;
	конецЕсли;
	
	ЭлементыФормы.Результат.Очистить();
	ЭтотОбъект.СкомпоноватьРезультат(ЭлементыФормы.Результат);
конецПроцедуры	

Процедура МенеджерОчистка(Элемент, СтандартнаяОбработка)
		ПараметрСКД = КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("Менеджер");
		ПараметрСКД.Использование = Ложь;
		ПараметрСКД.Значение  = глТекущийПользователь ;

КонецПроцедуры

Процедура ДатаОтчетаПриИзменении(Элемент)
		ПараметрСКД = КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("ДатаОтчета");
		ПараметрСКД.Использование = Истина;
		ПараметрСКД.Значение  =НачалоМесяца(ДатаОтчета) ;
КонецПроцедуры


Процедура ЗаполнитьТабличнуюЧасть()

	Список.Очистить();

	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Параметр", КритерийОтбораСписок.Отбор.ЗначениеОтбора.Значение);
    Запрос.УстановитьПараметр("НачДата",НачДата);
	
	Запрос.Текст = "ВЫБРАТЬ
	               |	Договоры.Ссылка КАК Ссылка,
	               |	Договоры.Ссылка.Дата КАК Дата,
	               |	Договоры.Ссылка.Номер КАК Номер,
	               |	Договоры.Ссылка.ВалютаДокумента КАК Валюты,
	               |	Договоры.Ссылка.ВидОперации КАК ВидОперации,
	               |	Договоры.Ссылка.СуммаДокумента КАК Сумма,
	               |	Договоры.Ссылка.ВалютаДокумента КАК Валюта,
	               |	Договоры.Ссылка.Организация КАК Организация,
	               |	Договоры.Ссылка.Ответственный КАК Ответственный
	               |ИЗ
	               |	КритерийОтбора.ДокументыПоДоговоруКонтрагента(&Параметр) КАК Договоры
	               |ГДЕ
	               |	Договоры.Ссылка.Дата >= &НачДата
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Договоры.Ссылка.Дата";
   Список = Запрос.Выполнить().Выгрузить();

КонецПроцедуры

Процедура ПриОткрытии()

	Контрагент = ПараметрОтборПоЗначению.Владелец;
	КритерийОтбораСписок.Отбор.ЗначениеОтбора.Значение = ПараметрОтборПоЗначению;
	НачДата = ДобавитьМесяц( НачалоМесяца( ТекущаяДата() ), -1);   //01.06.2017
	ЗаполнитьТабличнуюЧасть();
	
КонецПроцедуры

Процедура КоманднаяПанельФормыОбновить(Кнопка)

	ЗаполнитьТабличнуюЧасть();

КонецПроцедуры

Процедура ОтборЗначениеОтбораПриИзменении(Элемент)

	ЗаполнитьТабличнуюЧасть();

КонецПроцедуры

Процедура ОтборЗначениеОтбораОчистка(Элемент, СтандартнаяОбработка)

	СтандартнаяОбработка = Ложь;

КонецПроцедуры

Процедура СписокПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)

	ОформлениеСтроки.Ячейки.Вид.ОтображатьТекст = Истина;
	ОформлениеСтроки.Ячейки.Вид.Текст = ДанныеСтроки.Ссылка.Метаданные().Синоним;

КонецПроцедуры

Процедура СписокВыбор(Элемент, ВыбраннаяСтрока, Колонка, СтандартнаяОбработка)

	СтандартнаяОбработка = Ложь;
	ВыбраннаяСтрока.Ссылка.ПолучитьФорму().Открыть();

КонецПроцедуры

Процедура КонтрагентПриИзменении(Элемент)

	// Если изменили контрагента, то установим отбор по основному 
	// договору выбранного контрагента.
	Если КритерийОтбораСписок.Отбор.ЗначениеОтбора.Значение.Владелец <> Контрагент Тогда
		КритерийОтбораСписок.Отбор.ЗначениеОтбора.Значение = Контрагент.ОсновнойДоговорКонтрагента;
		ЗаполнитьТабличнуюЧасть();
	КонецЕсли;

КонецПроцедуры

Процедура КонтрагентОчистка(Элемент, СтандартнаяОбработка)

	СтандартнаяОбработка = Ложь;

КонецПроцедуры






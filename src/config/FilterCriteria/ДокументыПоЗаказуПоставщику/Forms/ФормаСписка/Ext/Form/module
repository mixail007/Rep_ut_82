
Процедура ЗаполнитьТабличнуюЧасть()

	Список.Очистить();

	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Параметр", КритерийОтбораСписок.Отбор.ЗначениеОтбора.Значение);
    Запрос.УстановитьПараметр("НачДата",НачДата);
	Запрос.Текст = "ВЫБРАТЬ
	               |	Заказы.Ссылка КАК Ссылка,
	               |	Заказы.Ссылка.Дата КАК Дата,
	               |	Заказы.Ссылка.Номер КАК Номер,
	               |	Заказы.Ссылка.ВалютаДокумента КАК Валюты,
	               |	Заказы.Ссылка.ВидОперации КАК ВидОперации,
	               |	Заказы.Ссылка.СуммаДокумента КАК Сумма,
	               |	Заказы.Ссылка.ВалютаДокумента КАК Валюта,
	               |	Заказы.Ссылка.Организация КАК Организация,
	               |	Заказы.Ссылка.Ответственный КАК Ответственный
	               |ИЗ
	               |	КритерийОтбора.ДокументыПоЗаказуПоставщику(&Параметр) КАК Заказы
	               |ГДЕ
	               |	Заказы.Ссылка.Дата >= &НачДата
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Заказы.Ссылка.Дата";

	Список = Запрос.Выполнить().Выгрузить();

КонецПроцедуры

Процедура ПриОткрытии()

	КритерийОтбораСписок.Отбор.ЗначениеОтбора.Значение = ПараметрОтборПоЗначению;
	
	НачДата = НачалоДня(КритерийОтбораСписок.Отбор.ЗначениеОтбора.Значение.Дата);   //01.06.2017

	ЗаполнитьТабличнуюЧасть();
	//ЭлементыФормы.Список.СоздатьКолонки();

КонецПроцедуры

Процедура КоманднаяПанельФормыОбновить(Кнопка)

	ЗаполнитьТабличнуюЧасть();

КонецПроцедуры

Процедура ОтборЗначениеОтбораПриИзменении(Элемент)

	ЗаполнитьТабличнуюЧасть();

КонецПроцедуры

Процедура ОтборЗначениеОтбораОчистка(Элемент, СтандартнаяОбработка)

	ЗаполнитьТабличнуюЧасть();

КонецПроцедуры

Процедура СписокПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)

	ДокСсылка = ДанныеСтроки.Ссылка;
	Ячейки = ОформлениеСтроки.Ячейки;
	
	Ячейки.Вид.УстановитьТекст(ДокСсылка.Метаданные().Представление());

	ЯчейкаКартинки = Ячейки.Картинка;
	ЯчейкаКартинки.ОтображатьТекст    = Ложь;
	ЯчейкаКартинки.ОтображатьФлажок   = Ложь;
	ЯчейкаКартинки.ОтображатьКартинку = Истина;

	Если ДанныеСтроки.Ссылка = Неопределено Тогда
		ЯчейкаКартинки.ИндексКартинки = 3;
	Иначе
		Если ДокСсылка.Проведен Тогда
			ЯчейкаКартинки.ИндексКартинки = 0;
		ИначеЕсли ДокСсылка.ПометкаУдаления Тогда
			ЯчейкаКартинки.ИндексКартинки = 1;
		Иначе
			ЯчейкаКартинки.ИндексКартинки = 2;
		КонецЕсли; 
	КонецЕсли; 

КонецПроцедуры

Процедура СписокВыбор(Элемент, ВыбраннаяСтрока, Колонка, СтандартнаяОбработка)

	СтандартнаяОбработка = Ложь;
	ВыбраннаяСтрока.Ссылка.ПолучитьФорму().Открыть();

КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	// Если не задан параметр отбора, форму не открываем
	Если ЗначениеНеЗаполнено(ПараметрОтборПоЗначению) Тогда
		Если ЭтаФорма.ВладелецФормы.Метаданные().Имя = "ЗаказПоставщику" Тогда
			Предупреждение("Документ не записан!");
		КонецЕсли;
		Отказ = Истина;
	КонецЕсли;
	
	Если ПолучитьЗначениеПоУмолчанию(ПараметрыСеанса.ТекущийПользователь, "УчетТолькоПоПодразделениюПользователя") 
		И НЕ ПолучитьЗначениеПоУмолчанию(ПараметрыСеанса.ТекущийПользователь, "СтаршийМенеджерПодразделения") Тогда  //+++ 09.07.2014
		СообщитьОбОшибке("У Вас недостаточно прав для просмотра выбранных типов документов!");
		Возврат;
 	КонецЕсли;

КонецПроцедуры // ПередОткрытием()

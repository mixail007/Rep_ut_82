
Функция ОсновныеДействияФормыОтобрать(Кнопка)
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ЗаказыПокупателейСезонныеОстатки.Контрагент КАК Контрагент,
		|	ЗаказыПокупателейСезонныеОстатки.ЗаказПокупателяСезонный КАК ЗаказПокупателяСезонный,
		|	ЗаказыПокупателейСезонныеОстатки.Номенклатура КАК Номенклатура,
		|	ВЫБОР
		|		КОГДА ЗаказыПокупателейСезонныеОстатки.ВРезерве = ИСТИНА
		|			ТОГДА ЗаказыПокупателейСезонныеОстатки.КоличествоОстаток
		|		ИНАЧЕ -ЗаказыПокупателейСезонныеОстатки.КоличествоОстаток
		|	КОНЕЦ КАК Количество,
		|	ЗаказыПокупателейСезонныеОстатки.Аналог,
		|	ЗаказыПокупателейСезонныеОстатки.ЗаказПокупателя,
		|	ЗаказыПокупателейСезонныеОстатки.ВРезерве
		|ИЗ
		|	РегистрНакопления.ЗаказыПокупателейСезонные.Остатки(
		|			&МоментВремени,
		|			99 = 99
		|				И 98 = 98
		|				И 97 = 97
		|				И 96 = 96) КАК ЗаказыПокупателейСезонныеОстатки
		|
		|УПОРЯДОЧИТЬ ПО
		|	Контрагент,
		|	ЗаказПокупателяСезонный,
		|	Номенклатура";

	Запрос.УстановитьПараметр("МоментВремени", ?(Этаформа.ВладелецФормы.ДокументОбъект.МоментВремени()= Дата(1,1,1),ТекущаяДата(),Этаформа.ВладелецФормы.ДокументОбъект.МоментВремени()));
	Если ЗначениеЗаполнено(Контрагент) Тогда
		Запрос.Текст=СтрЗаменить(Запрос.Текст,"99 = 99", "Контрагент = &Контрагент");
		Запрос.УстановитьПараметр("контрагент",Контрагент);
	конецЕсли;	
	Если ЗначениеЗаполнено(СезонныйЗаказ) Тогда
		Запрос.Текст=СтрЗаменить(Запрос.Текст,"98 = 98", "ЗаказПокупателяСезонный = &СезонныйЗаказ");
		Запрос.УстановитьПараметр("СезонныйЗаказ",СезонныйЗаказ);
	конецЕсли;	
	Если ЗначениеЗаполнено(Номенклатура) Тогда
		Запрос.Текст=СтрЗаменить(Запрос.Текст,"97 = 97", "Номенклатура = &Номенклатура");
		Запрос.УстановитьПараметр("Номенклатура",Номенклатура);
	конецЕсли;	
	Если ТолькоПросроченные Тогда
		Запрос.Текст=СтрЗаменить(Запрос.Текст,"96 = 96", "ЗаказПокупателяСезонный.ДатаДействияПо < &Дата");
		Запрос.УстановитьПараметр("Дата",?(Этаформа.ВладелецФормы.ДокументОбъект.Дата= Дата(1,1,1),ТекущаяДата(),Этаформа.ВладелецФормы.ДокументОбъект.Дата));

	конецЕсли;	
	
	
	Результат = Запрос.Выполнить().Выгрузить();
 
	ОповеститьОВыборе(Результат);
КонецФункции

Процедура ПриОткрытии()
  ЭлементыФормы.ТолькоПросроченные.Значение =Истина;
КонецПроцедуры

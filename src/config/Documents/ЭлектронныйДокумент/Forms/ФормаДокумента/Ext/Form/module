
Перем ПрефиксСайтаДиадок;
Процедура ПриОткрытии()
	
	Если ТипДокумента = "XmlTorg12" ИЛИ ТипДокумента ="UniversalTransferDocument" Тогда
		 ЭлементыФормы.ОсновнаяПанель.Страницы.СтраницаУслуги.Видимость=Ложь;
		 ЭлементыФормы.ОсновнаяПанель.Страницы.СтраницаТовары.Заголовок="Товары ("+Строка(Товары.Количество())+")";
	ИначеЕсли 	ТипДокумента = "XmlAcceptanceCertificate" Тогда
		ЭлементыФормы.ОсновнаяПанель.Страницы.СтраницаТовары.Видимость=Ложь;
		ЭлементыФормы.ОсновнаяПанель.Страницы.СтраницаУслуги.Заголовок="Услуги ("+Строка(Услуги.Количество())+")";
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Контрагент) И НЕ ЗначениеЗаполнено(ОсновнойМенеджер) Тогда
		ОсновнойМенеджер = Контрагент.ОсновнойМенеджерКонтрагента;
	КонецЕсли;
	
	
	УстановитьВидимостьКнопок();
КонецПроцедуры

Функция МожетСогласовыватьДокументы()
	
Возврат	РольДоступна("ПолныеПрава") ИЛИ (ЗначениеЗаполнено(Контрагент) И  Контрагент.ОсновнойМенеджерКонтрагента=глТекущийпользователь)
КонецФункции


Функция МожетУтверждатьДокументы()
	
	Возврат	 РольДоступна("ПолныеПрава") 
КонецФункции


Процедура УстановитьВидимостьКнопок()
	
	Кнопки = ЭлементыФормы.ОсновныеДействияФормы.Кнопки;
	Если СтатусСогласования= Перечисления.СостоянияОбъектов.Подготовлен Тогда
		      Кнопки.Согласовать.Доступность= МожетСогласовыватьДокументы();
			  Кнопки.Отменить.Доступность= МожетСогласовыватьДокументы();
			  Кнопки.Утвердить.Доступность= Ложь;
		  ИначеЕсли СтатусСогласования= Перечисления.СостоянияОбъектов.Отклонен Тогда
			  Кнопки.Согласовать.Доступность= Ложь;
			  Кнопки.Отменить.Доступность= Ложь;
			  Кнопки.Утвердить.Доступность= Ложь;

		  ИначеЕсли  СтатусСогласования= Перечисления.СостоянияОбъектов.Согласован Тогда
			  Кнопки.Согласовать.Доступность= Ложь;
			  Кнопки.Отменить.Доступность= Ложь;
			  Кнопки.Утвердить.Доступность= МожетУтверждатьДокументы() ;
;

		  Иначе //СтатусСогласования= Перечисления.СостоянияОбъектов.Утвержден Тогда
			  Кнопки.Согласовать.Доступность= Ложь;
			  Кнопки.Отменить.Доступность= Ложь;
			  Кнопки.Утвердить.Доступность= Ложь;
 		  
		  КонецЕсли;	
		  

КонецПроцедуры	

Процедура ТоварыПередНачаломДобавления(Элемент, Отказ, Копирование)
	Отказ=Истина;
КонецПроцедуры

Процедура ТоварыПередУдалением(Элемент, Отказ)
	Отказ=Истина;

КонецПроцедуры

Процедура ОсновныеДействияФормыДействие(Кнопка)
		СтатусСогласования= Перечисления.СостоянияОбъектов.Согласован;
		ДатаСогласования=ТекущаяДата();
		Записать();
		Закрыть();
КонецПроцедуры

Процедура ОсновныеДействияФормыОтменить(Кнопка)
	Текст ="";
	ВвестиСтроку(Текст,"Введите причину отказа",0,истина);
	СтатусСогласования= Перечисления.СостоянияОбъектов.Отклонен;
	ДатаСогласования=ТекущаяДата();
	 ПричинаОтказа= Текст;
	Записать();
	Закрыть();
КонецПроцедуры

Процедура ОсновныеДействияФормыУтвердить(Кнопка)
	СтатусСогласования= Перечисления.СостоянияОбъектов.Утвержден;
	ДатаУтверждения=ТекущаяДата();
	Записать();
	Закрыть();

КонецПроцедуры

Процедура PathUrlНажатие(Элемент)
	
ЗапуститьПриложение(ПрефиксСайтаДиадок+"/"+Элемент.Значение);	
КонецПроцедуры

ПрефиксСайтаДиадок="https://diadoc.kontur.ru";

Процедура ПриОткрытии()
		
		Срок1 =  7; Процент1 = 100;  //защита от 0% во всех процентах
		Срок2 = 14; Процент2 = 0;
		Срок3 = 30; Процент3 = 0;
		
		УстановитьДаты();
		
КонецПроцедуры

Процедура ОКНажатие(Элемент)
	// Вставить содержимое обработчика.
	Если (Процент1+Процент2+Процент3)<>100 Тогда 
		Сообщить("Сумма процентов не равна 100, исправьте ее !!!",СтатусСообщения.Важное);
		Возврат;
	КонецЕсли;
	
	ВозвратнаяСтруктура = новый Структура;
	ВозвратнаяСтруктура.Вставить("Дата1",Дата1);
	ВозвратнаяСтруктура.Вставить("Дата2",Дата2);
	ВозвратнаяСтруктура.Вставить("Дата3",Дата3);
	ВозвратнаяСтруктура.Вставить("Срок1",Срок1);
	ВозвратнаяСтруктура.Вставить("Срок2",Срок2);
	ВозвратнаяСтруктура.Вставить("Срок3",Срок3);
	ВозвратнаяСтруктура.Вставить("Процент1",Процент1);
	ВозвратнаяСтруктура.Вставить("Процент2",Процент2);
	ВозвратнаяСтруктура.Вставить("Процент3",Процент3);	
	Закрыть(ВозвратнаяСтруктура);
	
КонецПроцедуры

Процедура ПроцентПриИзменении(Элемент)
	
	Если Процент3>100 или Процент2>100 или Процент1>100 Тогда 
		Сообщить("Процент не может быть больше 100%. Процент автоматически уменьшен.");
		Процент1=?(Процент1>100, 100, Процент1);
		Процент2=?(Процент2>100, 100, Процент2);
		Процент3=?(Процент3>100, 100, Процент3);
	КонецЕсли;
	
	
//если один из процентов = 0 то меняются 2 других (больший из 2х!)
	Если Процент3=0 и Процент1<>0 Тогда 
		Если (Процент2 + Процент1)>100 Тогда 
			Сообщить("Сумма процентов не может быть больше 100%. Процент3 автоматически уменьшен.");
			Процент2 = 100 - Процент1;
		КонецЕсли;
		Если Процент2<>0 тогда
			Процент3 = 100 - Процент2 - Процент1;
		иначе	
			Процент2 = 100 - Процент1;  //меняется 2-ой процент
		КонецЕсли;
		
	ИначеЕсли Процент2=0 и Процент1<>0 Тогда 
		Если (Процент3 + Процент1)>100 Тогда 
			Сообщить("Сумма процентов не может быть больше 100%. Процент3 автоматически уменьшен.");
			Процент3 = 100 - Процент1;
		КонецЕсли;
		
		Процент3 = 100 - Процент1;
			
	ИначеЕсли Процент1=0 и Процент2<>0 Тогда 
		Если (Процент3 + Процент2)>100 Тогда 
			Сообщить("Сумма процентов не может быть больше 100%. Процент3 автоматически уменьшен.");
			Процент3 = 100 - Процент2;
		КонецЕсли;
		
		Процент3 = 100 - Процент2;
			
	ИначеЕсли Процент1<>0 и Процент2<>0 и Процент3<>0 Тогда 
		
		Процент3 = 100 - Процент1 - Процент2;
		Сообщить("Сумма процентов должна быть 100%. Процент3 автоматически изменен.");
	
	КонецЕсли;
	
	
КонецПроцедуры

Процедура ПроцентРегулирование(Элемент, Направление, СтандартнаяОбработка)
	ПроцентПриИзменении(неопределено);
КонецПроцедуры

Процедура Дата1ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Если Дата1<=ТекущаяДата() Тогда 
		Сообщить("Надо ставить дату, больше текущей !!!",СтатусСообщения.Важное);
		Дата1='0001-01-01';
	КонецЕсли;
	
	УстановитьСроки();	
КонецПроцедуры

Процедура Дата2ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Если Дата2<=ТекущаяДата() Тогда 
		Сообщить("Надо ставить дату, больше текущей !!!",СтатусСообщения.Важное);
		Дата2='0001-01-01';
	КонецЕсли;
	
	УстановитьСроки();
КонецПроцедуры

Процедура Дата3ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Если Дата3<=ТекущаяДата() Тогда 
		Сообщить("Надо ставить дату, больше текущей !!!",СтатусСообщения.Важное);
		Дата3='0001-01-01';
	КонецЕсли;
	
	УстановитьСроки();	
КонецПроцедуры

Процедура УстановитьСроки()
	
	Если ЗначениеЗаполнено(Дата1) Тогда 
		Срок1 = РассчитатьКоличествоДней(ТекущаяДата(),Дата1);			
	Иначе  
		Срок1 = 1;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Дата2) Тогда 
		Срок2 = РассчитатьКоличествоДней(ТекущаяДата(),Дата2);			
	Иначе  
		Срок2 = 1;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Дата3) Тогда 
		Срок3 = РассчитатьКоличествоДней(ТекущаяДата(),Дата3);			
	Иначе  
		Срок3 = 1;
	КонецЕсли;
	
КонецПроцедуры

Процедура УстановитьДаты()
	Если Срок1>0 Тогда 
		Дата1 = ТекущаяДата()+Срок1*86400;			
	Иначе  
		Дата1 = ТекущаяДата();
	КонецЕсли;
	
	Если Срок2>0 Тогда 
		Дата2 = ТекущаяДата()+Срок2*86400;			
	Иначе  
		Дата2 = ТекущаяДата();
	КонецЕсли;
	
	Если Срок3>0 Тогда 
		Дата3 = ТекущаяДата()+Срок3*86400;			
	Иначе  
		Дата3 = ТекущаяДата();
	КонецЕсли;
КонецПроцедуры

Функция РассчитатьКоличествоДней(Дата1,Дата2)
    Если Дата1 > Дата2 Тогда
        Возврат Окр((Дата1 - Дата2)/86400)+1;
    Иначе
        Возврат Окр((Дата2 - Дата1)/86400)+1;
    КонецЕсли;
КонецФункции

Процедура Срок1ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	УстановитьДаты();
КонецПроцедуры

Процедура Срок2ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	УстановитьДаты();
КонецПроцедуры

Процедура Срок3ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	УстановитьДаты();
КонецПроцедуры

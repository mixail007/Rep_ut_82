// Процедура вызывается при выборе пункта подменю "Движения документа по регистрам" меню "Перейти".
// командной панели формы. Процедура отрабатывает печать движений документа по регистрам.
//
Процедура ДействияФормыДвиженияДокументаПоРегистрам(Кнопка)

	Если ЭтаФорма.ЭлементыФормы.ДокументСписок.ТекущаяСтрока = Неопределено тогда
		Возврат
	КонецЕсли;

	НапечататьДвиженияДокумента(ЭлементыФормы.ДокументСписок.ТекущиеДанные.Ссылка);

КонецПроцедуры // ДействияФормыДвиженияДокументаПоРегистрам()

// Процедура вызывается при выборе пункта подменю "Структура подчиненности" меню "Перейти".
Процедура ДействияФормыСтруктураПодчиненностиДокумента(Кнопка)
	
	Если ЭлементыФормы.ДокументСписок.ТекущиеДанные = Неопределено тогда
		Возврат
	КонецЕсли;
	
	ПоказатьСтруктуруПодчиненностиДокумента(ЭтаФорма.ЭлементыФормы.ДокументСписок.ТекущаяСтрока);
	
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	// Вставить содержимое обработчика.
	Если (Константы.ОплатыРаспределяютМенеджеры.Получить()) Тогда
		ЭлементыФормы.ДокументСписок.Колонки.СуммаДолга.Видимость = Истина;
	Иначе 
		ЭлементыФормы.ДокументСписок.Колонки.СуммаДолга.Видимость = Ложь;
	КонецЕсли;
	
	//+++( 26.04.2012
	//установка ограничения видимости помеченных на удаление документов
		ЭлементОтбора =ДокументСписок.Отбор.Найти("ПометкаУдаления");
		Если  ЭлементОтбора = Неопределено Тогда
			ЭлементОтбора = ДокументСписок.Отбор.Добавить("ПометкаУдаления"); // если нет - добавим в список отборов
		КонецЕсли;
		
		//по настройке пользователя !!!
		Если НЕ ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "ДокументыРазрешитьПросмотрПомеченныхНаУдаление") тогда
			ЭлементОтбора.Установить(Ложь); // установим видимость только НЕудаленных
	    	ЭлементыФормы.ДокументСписок.НастройкаОтбора.ПометкаУдаления.Доступность = ЛОЖЬ;
	 	иначе // можно видеть удаленные элементы
			ЭлементыФормы.ДокументСписок.НастройкаОтбора.ПометкаУдаления.Доступность = Истина;
        КонецЕсли;
	//+++)

КонецПроцедуры

Процедура ПриОткрытии()
	
	УстановитьОтборВЖурналеДокументов(ДокументСписок.Отбор, ЭлементыФормы.ДокументСписок);//+++ 03.10.2013

КонецПроцедуры

//+++ февраль 2012
//Процедура - обработчик внешнего события.
//
Процедура ВнешнееСобытие(Источник, Событие, Данные)
	Перем СписокДок;

	Если Не(ВводДоступен()) Тогда
		Возврат;
	КонецЕсли;

	Если глТорговоеОборудование <> Неопределено Тогда
		Если Событие = "BarCodeValue" Тогда
			Если глТорговоеОборудование.ПолучитьВсеДокументыПоШтрихКоду(Данные, СписокДок) Тогда
				Если СписокДок.Количество() = 1 Тогда
					ОткрытьЗначение(СписокДок[0].Ссылка);
				ИначеЕсли СписокДок.Количество() > 1 Тогда
					СтрокаДок = СписокДок.ВыбратьСтроку("Выберите один из найденных документов.");
					Если СтрокаДок<>Неопределено Тогда
						ОткрытьЗначение(СтрокаДок.Ссылка);
					КонецЕсли;
				КонецЕсли;
			КонецЕсли;
			глТорговоеОборудование.СканерПосылкаДанных(1);
		КонецЕсли;
	КонецЕсли;

КонецПроцедуры

Процедура ДокументСписокПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	
	//расцветка удаленных и просроченных заказов
	Если ДанныеСтроки.ссылка.ПометкаУдаления 
		или (ДанныеСтроки.ссылка.ДатаДействияПо>'00010101' 
		      и ДанныеСтроки.ссылка.ДатаДействияПо<НачалоДня( ТекущаяДата() )
			 )  тогда
		ОформлениеСтроки.ЦветФона = webЦвета.СветлоСерый;
	КонецЕсли;	

КонецПроцедуры




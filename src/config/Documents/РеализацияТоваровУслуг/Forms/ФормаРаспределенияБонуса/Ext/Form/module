
Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	Если НастройкаПериода.Редактировать() Тогда
		НачПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры

Процедура ОсновныеДействияФормыРассчитать(Кнопка)
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	Номенклатура.Ссылка
		|ПОМЕСТИТЬ бонусы
		|ИЗ
		|	Справочник.Номенклатура КАК Номенклатура
		|ГДЕ
		|	Номенклатура.Родитель = &Родитель
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВЫБОР
		|		КОГДА ПродажиОбороты.Номенклатура.НоменклатурнаяГруппа.Родитель = &группаАксы
		|			ТОГДА &Аксы
		|		ИНАЧЕ ПродажиОбороты.Номенклатура.НоменклатурнаяГруппа
		|	КОНЕЦ КАК НоменклатурнаяГруппа,
		|	ПродажиОбороты.Подразделение,
		|	СУММА(ПродажиОбороты.СтоимостьОборот) КАК СтоимостьОборот
		|ПОМЕСТИТЬ ПродажиНоменклатуры
		|ИЗ
		|	РегистрНакопления.Продажи.Обороты(
		|			&Нач,
		|			&Кон,
		|			,
		|			ВЫБОР
		|					КОГДА Номенклатура.НоменклатурнаяГруппа.Родитель = &группаАксы
		|						ТОГДА &Аксы
		|					ИНАЧЕ Номенклатура.НоменклатурнаяГруппа
		|				КОНЕЦ В (&Группы)
		|				И 99 = 99) КАК ПродажиОбороты
		|
		|СГРУППИРОВАТЬ ПО
		|	ПродажиОбороты.Подразделение,
		|	ВЫБОР
		|		КОГДА ПродажиОбороты.Номенклатура.НоменклатурнаяГруппа.Родитель = &группаАксы
		|			ТОГДА &Аксы
		|		ИНАЧЕ ПродажиОбороты.Номенклатура.НоменклатурнаяГруппа
		|	КОНЕЦ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СУММА(ПродажиНоменклатуры.СтоимостьОборот) КАК СтоимостьОборот
		|ПОМЕСТИТЬ база
		|ИЗ
		|	ПродажиНоменклатуры КАК ПродажиНоменклатуры
		|ГДЕ
		|	ПродажиНоменклатуры.СтоимостьОборот > 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПродажиНоменклатуры.НоменклатурнаяГруппа КАК НоменклатурнаяГруппа,
		|	ПродажиНоменклатуры.Подразделение,
		|	ВЫРАЗИТЬ(ПродажиНоменклатуры.СтоимостьОборот / база.СтоимостьОборот * &СуммаБонуса КАК ЧИСЛО(15, 2)) КАК Сумма,
		|	бонусы.Ссылка КАК Номенклатура
		|ИЗ
		|	ПродажиНоменклатуры КАК ПродажиНоменклатуры
		|		ПОЛНОЕ СОЕДИНЕНИЕ база КАК база
		|		ПО (ИСТИНА)
		|		ПОЛНОЕ СОЕДИНЕНИЕ бонусы КАК бонусы
		|		ПО ПродажиНоменклатуры.НоменклатурнаяГруппа = бонусы.Ссылка.НоменклатурнаяГруппа
		|ГДЕ
		|	ПродажиНоменклатуры.СтоимостьОборот > 0";

		Запрос.УстановитьПараметр("нач", начпериода);
	    Запрос.УстановитьПараметр("кон", конпериода);
		Запрос.УстановитьПараметр("Родитель", справочники.Номенклатура.НайтиПоКоду("9278960"));
        Запрос.УстановитьПараметр("группаАксы",справочники.номенклатурныегруппы.найтипокоду("Ф0070"));
		Запрос.УстановитьПараметр("Аксы", справочники.номенклатурныегруппы.найтипокоду("00073"));

		
		
	    список = новый списокзначений;
		список.ЗагрузитьЗначения(номенклатурныегруппы.ВыгрузитьКолонку("группа"));
		Запрос.УстановитьПараметр("группы", список);
        Запрос.УстановитьПараметр("СуммаБонуса", СуммаБонуса);

	    Результат = Запрос.Выполнить().Выгрузить();

		погрешность  = СуммаБонуса- Результат.Итог("Сумма"); 
		 Результат[0].Сумма = Результат[0].Сумма+погрешность;
		
		ОповеститьОВыборе(Результат);

	
	
	
	
КонецПроцедуры

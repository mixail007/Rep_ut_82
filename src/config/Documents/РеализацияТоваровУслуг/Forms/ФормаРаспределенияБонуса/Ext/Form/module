
Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	Если НастройкаПериода.Редактировать() Тогда
		НачПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры

Процедура ОсновныеДействияФормыРассчитать(Кнопка)
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	Номенклатура.Ссылка
		|ПОМЕСТИТЬ бонусы
		|ИЗ
		|	Справочник.Номенклатура КАК Номенклатура
		|ГДЕ
		|	Номенклатура.Родитель = &Родитель
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПродажиОбороты.Номенклатура.НоменклатурнаяГруппа,
		|	ПродажиОбороты.Подразделение,
		|	СУММА(ПродажиОбороты.СтоимостьОборот) КАК СтоимостьОборот
		|ПОМЕСТИТЬ ПродажиНоменклатуры
		|ИЗ
		|	РегистрНакопления.Продажи.Обороты(&Нач, &Кон, , Номенклатура.НоменклатурнаяГруппа В (&Группы)) КАК ПродажиОбороты
		|
		|СГРУППИРОВАТЬ ПО
		|	ПродажиОбороты.Подразделение,
		|	ПродажиОбороты.Номенклатура.НоменклатурнаяГруппа
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СУММА(ПродажиНоменклатуры.СтоимостьОборот) КАК СтоимостьОборот
		|ПОМЕСТИТЬ база
		|ИЗ
		|	ПродажиНоменклатуры КАК ПродажиНоменклатуры
		|ГДЕ
		|	ПродажиНоменклатуры.СтоимостьОборот > 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПродажиНоменклатуры.НоменклатураНоменклатурнаяГруппа КАК НоменклатурнаяГруппа,
		|	ПродажиНоменклатуры.Подразделение,
		|	ВЫРАЗИТЬ(ПродажиНоменклатуры.СтоимостьОборот / база.СтоимостьОборот * &СуммаБонуса КАК ЧИСЛО(15, 2)) КАК Сумма,
		|	бонусы.Ссылка КАК Номенклатура
		|ИЗ
		|	ПродажиНоменклатуры КАК ПродажиНоменклатуры
		|		ПОЛНОЕ СОЕДИНЕНИЕ база КАК база
		|		ПО (ИСТИНА)
		|		ПОЛНОЕ СОЕДИНЕНИЕ бонусы КАК бонусы
		|		ПО ПродажиНоменклатуры.НоменклатураНоменклатурнаяГруппа = бонусы.Ссылка.НоменклатурнаяГруппа
		|ГДЕ
		|	ПродажиНоменклатуры.СтоимостьОборот > 0";

		Запрос.УстановитьПараметр("нач", начпериода);
	    Запрос.УстановитьПараметр("кон", конпериода);
		Запрос.УстановитьПараметр("Родитель", справочники.Номенклатура.НайтиПоКоду("9278960"));

	    список = новый списокзначений;
		список.ЗагрузитьЗначения(номенклатурныегруппы.ВыгрузитьКолонку("группа"));
		Запрос.УстановитьПараметр("группы", список);
        Запрос.УстановитьПараметр("СуммаБонуса", СуммаБонуса);

	    Результат = Запрос.Выполнить().Выгрузить();

		погрешность  = СуммаБонуса- Результат.Итог("Сумма"); 
		 Результат[0].Сумма = Результат[0].Сумма+погрешность;
		
		ОповеститьОВыборе(Результат);

	
	
	
	
КонецПроцедуры

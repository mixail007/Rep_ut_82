
Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	Если НастройкаПериода.Редактировать() Тогда
		НачПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры

Процедура ОсновныеДействияФормыРассчитать(Кнопка)
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПродажиОбороты.Номенклатура.НоменклатурнаяГруппа,
		|	ПродажиОбороты.Подразделение,
		|	СУММА(ПродажиОбороты.СтоимостьОборот) КАК СтоимостьОборот
		|ПОМЕСТИТЬ ПродажиНоменклатуры
		|ИЗ
		|	РегистрНакопления.Продажи.Обороты(&Нач, &Кон, , Номенклатура.НоменклатурнаяГруппа В (&Группы)) КАК ПродажиОбороты
		|
		|СГРУППИРОВАТЬ ПО
		|	ПродажиОбороты.Подразделение,
		|	ПродажиОбороты.Номенклатура.НоменклатурнаяГруппа
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СУММА(ПродажиНоменклатуры.СтоимостьОборот) КАК СтоимостьОборот
		|ПОМЕСТИТЬ база
		|ИЗ
		|	ПродажиНоменклатуры КАК ПродажиНоменклатуры
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПродажиНоменклатуры.НоменклатураНоменклатурнаяГруппа КАК НоменклатурнаяГруппа,
		|	ПродажиНоменклатуры.Подразделение,
		|	ВЫРАЗИТЬ(ПродажиНоменклатуры.СтоимостьОборот / база.СтоимостьОборот * &СуммаБонуса КАК ЧИСЛО(15, 2)) КАК Сумма
		|ИЗ
		|	ПродажиНоменклатуры КАК ПродажиНоменклатуры
		|		ПОЛНОЕ СОЕДИНЕНИЕ база КАК база
		|		ПО (ИСТИНА)";

		Запрос.УстановитьПараметр("нач", начпериода);
	    Запрос.УстановитьПараметр("кон", конпериода);
	     список = новый списокзначений;
		 список.ЗагрузитьЗначения(номенклатурныегруппы.ВыгрузитьКолонку("группа"));
		Запрос.УстановитьПараметр("группы", список);
Запрос.УстановитьПараметр("СуммаБонуса", СуммаБонуса);

	Результат = Запрос.Выполнить().Выгрузить();

		ОповеститьОВыборе(Результат);

	
	
	
	
КонецПроцедуры

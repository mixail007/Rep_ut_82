
Перем СтруктДопОтбор Экспорт;

Процедура ПриОткрытии()
	
	СвойствоОбъектовСтатусПоступленияВозврата = ПланыВидовХарактеристик.СвойстваОбъектов.СтатусПоступленияВозврата;
	
	ОтборСтатусПодготовить();
	
	ПараметрыОтбораПрочитать();
	
	ДоступностьСтатусУстановить();
	ВидимостьПолеВводаСтатусУстановить();
	
КонецПроцедуры

Процедура ОтборСтатусПодготовить()
	
	СписокВидыСравнения = Новый СписокЗначений;
	СписокВидыСравнения.Добавить(ВидСравнения.Равно);
	СписокВидыСравнения.Добавить(ВидСравнения.НеРавно);
	СписокВидыСравнения.Добавить(ВидСравнения.ВСписке);
	СписокВидыСравнения.Добавить(ВидСравнения.НеВСписке);
	
	ЭлементыФормы.ПолеВыбораСтатусВидСравнения.СписокВыбора = СписокВидыСравнения;
	ЭлементыФормы.ПолеВыбораСтатусВидСравнения.Значение     = СписокВидыСравнения[0].Значение;
	
КонецПроцедуры // ОтборСтатусПодготовить()

Процедура ПараметрыОтбораПрочитать()
	
	ФлажокСтатус = СтруктДопОтбор.Статус;
	ПолеВыбораСтатусВидСравнения = СтруктДопОтбор.СтатусВидСравнения;
	
	Если СтруктДопОтбор.СтатусВидСравнения = ВидСравнения.Равно Тогда
		ПолеВводаСтатус = СтруктДопОтбор.СтатусЗначение;
	ИначеЕсли СтруктДопОтбор.СтатусВидСравнения = ВидСравнения.НеРавно Тогда
		ПолеВводаСтатус = СтруктДопОтбор.СтатусЗначение;
	ИначеЕсли СтруктДопОтбор.СтатусВидСравнения = ВидСравнения.ВСписке Тогда
		ПолеВводаСтатусСписок = СтруктДопОтбор.СтатусЗначение;
	Иначе
		ПолеВводаСтатусСписок = СтруктДопОтбор.СтатусЗначение;
	КонецЕсли;
	
КонецПроцедуры // ПараметрыОтбораПрочитать()

Процедура ДоступностьСтатусУстановить()
	
	ЭлементыФормы.ПолеВыбораСтатусВидСравнения.Доступность = ФлажокСтатус;
	ЭлементыФормы.ПолеВводаСтатус.Доступность			   = ФлажокСтатус;
	ЭлементыФормы.ПолеВводаСтатусСписок.Доступность        = ФлажокСтатус;
	
КонецПроцедуры // ДоступностьСтатусУстановить()

Процедура ВидимостьПолеВводаСтатусУстановить()
	
	Если ПолеВыбораСтатусВидСравнения = ВидСравнения.Равно Или ПолеВыбораСтатусВидСравнения = ВидСравнения.НеРавно Тогда
		ЭлементыФормы.ПолеВводаСтатус.Видимость       = Истина;
		ЭлементыФормы.ПолеВводаСтатусСписок.Видимость = Ложь;
	Иначе
		ЭлементыФормы.ПолеВводаСтатус.Видимость       = Ложь;
		ЭлементыФормы.ПолеВводаСтатусСписок.Видимость = Истина;
	КонецЕсли;
	
КонецПроцедуры // ВидимостьПолеВводаСтатусУстановить()


Процедура ФлажокСтатусПриИзменении(Элемент)
	
	ДоступностьСтатусУстановить();
	ВидимостьПолеВводаСтатусУстановить();
	
КонецПроцедуры


Процедура ПолеВыбораСтатусВидСравненияПриИзменении(Элемент)
	
	ВидимостьПолеВводаСтатусУстановить();
	
КонецПроцедуры


Процедура ОсновныеДействияФормыЗакрытьОК(Кнопка)
	
	ПараметрыОтбораЗаписать(ЭтаФорма, СтруктДопОтбор);
	
	Закрыть("ОК");
	
КонецПроцедуры

Процедура ПараметрыОтбораЗаписать(ФормаНастроекОтбора, СтруктДопОтбор) Экспорт
	
	СтруктДопОтбор.Статус             = ФормаНастроекОтбора.ФлажокСтатус;
	СтруктДопОтбор.СтатусВидСравнения = ФормаНастроекОтбора.ПолеВыбораСтатусВидСравнения;
	
	Если ФормаНастроекОтбора.ПолеВыбораСтатусВидСравнения = ВидСравнения.Равно Тогда
		Статус = ФормаНастроекОтбора.ПолеВводаСтатус;
	ИначеЕсли ФормаНастроекОтбора.ПолеВыбораСтатусВидСравнения = ВидСравнения.НеРавно Тогда
		Статус = ФормаНастроекОтбора.ПолеВводаСтатус;
	ИначеЕсли ФормаНастроекОтбора.ПолеВыбораСтатусВидСравнения = ВидСравнения.ВСписке Тогда
		Статус = ФормаНастроекОтбора.ПолеВводаСтатусСписок;
	Иначе
		Статус = ФормаНастроекОтбора.ПолеВводаСтатусСписок;
	КонецЕсли;
	
	СтруктДопОтбор.СтатусЗначение = Статус;
	
КонецПроцедуры // ПараметрыОтбораЗаписать()

Процедура ОсновныеДействияФормыЗакрытьОтмена(Кнопка)
	
	Закрыть();
	
КонецПроцедуры


Процедура ПолеВводаСтатусСписокНачалоВыбора(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	СтатусыСпис = СформироватьСписокВыбораСтатусов();
	ПолеВводаСтатусСписок.Очистить();
	
	Если СтатусыСпис.ОтметитьЭлементы("Укажите статусы") Тогда
		Для Каждого Элем Из СтатусыСпис Цикл
			Если Элем.Пометка Тогда
				ПолеВводаСтатусСписок.Добавить(Элем.Значение);
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
КонецПроцедуры

Функция СформироватьСписокВыбораСтатусов()
	
	Спис = Новый СписокЗначений();
	
	Выборка = Справочники.ЗначенияСвойствОбъектов.Выбрать(, СвойствоОбъектовСтатусПоступленияВозврата);
	
	Пока Выборка.Следующий() Цикл
		Спис.Добавить(Выборка.Ссылка);
	КонецЦикла;
	
	Возврат Спис;
	
КонецФункции // СформироватьСписокВыбораСтатусов()
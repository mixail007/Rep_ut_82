
Процедура ТоварыПриПолученииДанных(Элемент, ОформленияСтрок)
	Для каждого ОформлениеСтроки из ОформленияСтрок Цикл
		ДанныеСтроки = ОформлениеСтроки.ДанныеСтроки;
		ОформлениеСтроки.Ячейки.Код.УстановитьТекст(ДанныеСтроки.Номенклатура.Код);
		Если ДанныеСтроки.Дубль тогда
		 оформлениеСтроки.Ячейки.Дата1.ТолькоПросмотр = истина;
		 оформлениеСтроки.Ячейки.Дата2.ТолькоПросмотр = истина;
		 оформлениеСтроки.Ячейки.Дата3.ТолькоПросмотр = истина;
		конецесли;
		Если ДанныеСтроки.ВПроцессе тогда
		оформлениеСтроки.ЦветФона = WebЦвета.СветлоРозовый;	
		конецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

Процедура ТоварыРезультат1ПриИзменении(Элемент)
	ТекСтрока = ЭлементыФормы.Товары.ТекущиеДанные;
	Если  ТекСтрока.Результат1<=283 и ТекСтрока.ТестПройден1= Истина тогда
		Сообщить("Признак Тест пройден не может быть установлен для нагрузки 283 и менее.");
		ТекСтрока.ТестПройден1= Ложь;
ПроверитьОкончаниеВода();
	конецЕсли;
	ТекСтрока.Дата1 = ТекущаяДата();
КонецПроцедуры

Процедура ТоварыРезультат2ПриИзменении(Элемент)
	ТекСтрока = ЭлементыФормы.Товары.ТекущиеДанные;
	Если  ТекСтрока.Результат2<=283 и ТекСтрока.ТестПройден2= Истина тогда
		Сообщить("Признак Тест пройден не может быть установлен для нагрузки 283 и менее.");
		ТекСтрока.ТестПройден2= Ложь;
ПроверитьОкончаниеВода();
	конецЕсли;
	ТекСтрока.Дата2 = ТекущаяДата();
КонецПроцедуры

Процедура ТоварыРезультат3ПриИзменении(Элемент)
	ТекСтрока = ЭлементыФормы.Товары.ТекущиеДанные;
	Если  ТекСтрока.Результат3<=283 и ТекСтрока.ТестПройден3= Истина тогда
		Сообщить("Признак Тест пройден не может быть установлен для нагрузки 283 и менее.");
		ТекСтрока.ТестПройден3= Ложь;
ПроверитьОкончаниеВода();		
	конецЕсли;
	ТекСтрока.Дата3 = ТекущаяДата();
КонецПроцедуры

Процедура ДокументОснованиеНажатие(Элемент)
	форма = ДокументОснование.ПолучитьФорму();
	форма.Открыть();
КонецПроцедуры

Процедура ТоварыПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	// Вставить содержимое обработчика.
КонецПроцедуры

Процедура ТоварыНомерПартииПриИзменении(Элемент)
	текСтрока = ЭлементыФормы.Товары.ТекущиеДанные;

	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПровереннаяНагрузкаДисков.Документ,
		|	ПровереннаяНагрузкаДисков.Дата,
		|	ПровереннаяНагрузкаДисков.Номенклатура,
		|	ПровереннаяНагрузкаДисков.НомерПартии,
		|	ПровереннаяНагрузкаДисков.НомерКонтейнера,
		|	ПровереннаяНагрузкаДисков.ТестПройден,
		|	ПровереннаяНагрузкаДисков.ПрошедшаяНагрузка
		|ИЗ
		|	РегистрСведений.ПровереннаяНагрузкаДисков КАК ПровереннаяНагрузкаДисков
		|ГДЕ
		|	ПровереннаяНагрузкаДисков.Номенклатура = &Номенклатура
		|	И ПровереннаяНагрузкаДисков.НомерПартии = &НомерПартии
		|	И ПровереннаяНагрузкаДисков.Дата >= &Дата";

	Запрос.УстановитьПараметр("Дата", ДобавитьМесяц(Дата,-2));
	Запрос.УстановитьПараметр("Номенклатура", текСтрока.Номенклатура);
	Запрос.УстановитьПараметр("НомерПартии", текСтрока.НомерПартии);

	Результат = Запрос.Выполнить();

	Выборка = Результат.Выбрать();

	Если Выборка.Следующий() тогда
      текСтрока.Результат1 = Выборка.прошедшаяНагрузка;
	  текСтрока.тестПройден1 = Выборка.ТестПройден;
	  текСтрока.Дата1 = Выборка.Дата;
	  текСтрока.дубль = Истина;
	  текСтрока.впроцессе = ложь;
	конецесли;	
		
	Если Выборка.Следующий() тогда
      текСтрока.Результат2 = Выборка.прошедшаяНагрузка;
	  текСтрока.тестПройден2 = Выборка.ТестПройден;
	  текСтрока.Дата2 = Выборка.Дата;
	конецесли;	
	Если Выборка.Следующий() тогда
      текСтрока.Результат3 = Выборка.прошедшаяНагрузка;
	  текСтрока.тестПройден3 = Выборка.ТестПройден;
	  текСтрока.Дата3 = Выборка.Дата;
	конецесли;	
	
КонецПроцедуры

Процедура ТоварыПриОкончанииРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования)
		текСтрока = ЭлементыФормы.Товары.ТекущиеДанные;
		Если  текСтрока.Результат1<=283 и текСтрока.ТестПройден1= Истина тогда
			Сообщить("Признак Тест пройден не может быть установлен для нагрузки 283 и менее.");
			текСтрока.ТестПройден1= Ложь;
		конецЕсли;
		Если  текСтрока.Результат2<=283 и текСтрока.ТестПройден2= Истина тогда
			Сообщить("Признак Тест пройден не может быть установлен для нагрузки 283 и менее.");
			текСтрока.ТестПройден2= Ложь;
		конецЕсли;
		Если  текСтрока.Результат3<=283 и текСтрока.ТестПройден3= Истина тогда
			Сообщить("Признак Тест пройден не может быть установлен для нагрузки 283 и менее.");
			текСтрока.ТестПройден3= Ложь;
		конецЕсли;
		
        ПроверитьОкончаниеВода();
КонецПроцедуры
процедура ПроверитьОкончаниеВода()
	  //  текСтрока = ЭлементыФормы.Товары.ТекущиеДанные;
	  //  Если  текСтрока.тестПройден1 = Истина или текСтрока.тестПройден2 = истина или текСтрока.тестПройден3 = истина или
	  //  	(текСтрока.Дата1<>Дата(1,1,1)и текСтрока.Дата2<>Дата(1,1,1)и текСтрока.Дата3<>Дата(1,1,1))тогда
	  //  текстрока.впроцессе=ложь;	
	  //  Если  (текСтрока.тестПройден1 + текСтрока.тестПройден2 + текСтрока.тестПройден3) = 0 тогда
	  //  	  ТекСтрока.СуммаКомпенсации = ТекСтрока.Цена*ТекСтрока.Количество;
	  //  иначеЕсли (?(ЗначениеЗаполнено(текСтрока.Результат1),текСтрока.ТестПройден1,1)+?(ЗначениеЗаполнено(текСтрока.Результат2),текСтрока.ТестПройден2,1)+?(ЗначениеЗаполнено(текСтрока.Результат3),текСтрока.ТестПройден3,1)=2 или ?(ЗначениеЗаполнено(текСтрока.Результат1),текСтрока.ТестПройден1,1)+?(ЗначениеЗаполнено(текСтрока.Результат2),текСтрока.ТестПройден2,1)+?(ЗначениеЗаполнено(текСтрока.Результат3),текСтрока.ТестПройден3,1)=1)и поставщик = Справочники.Контрагенты.НайтиПоКоду("91735") тогда
	  //
	  // // иначеЕсли (?(ЗначениеЗаполнено(текСтрока.Результат1),текСтрока.ТестПройден1,1)+?(ЗначениеЗаполнено(текСтрока.Результат2),текСтрока.ТестПройден2,1)+?(ЗначениеЗаполнено(текСтрока.Результат3),текСтрока.ТестПройден3,1)=2 или ?(ЗначениеЗаполнено(текСтрока.Результат1),текСтрока.ТестПройден1,1)+?(ЗначениеЗаполнено(текСтрока.Результат2),текСтрока.ТестПройден2,1)+?(ЗначениеЗаполнено(текСтрока.Результат3),текСтрока.ТестПройден3,1)=1)и поставщик = Справочники.Контрагенты.НайтиПоКоду("91735") тогда
	  //  	Если ТекСтрока.Количество<8 тогда
	  //  	  ТекСтрока.СуммаКомпенсации = ТекСтрока.Цена*ТекСтрока.Количество;
	  //	Иначе
	  //  	  ТекСтрока.СуммаКомпенсации = ТекСтрока.Цена*8+(ТекСтрока.Количество-8)*5;
	  //	конецЕсли;
	  //  конецЕсли;	  
	  //  иначе
	  //  текстрока.впроцессе=истина;
	  //  ТекСтрока.СуммаКомпенсации = 0;
	  //  конецЕсли;
	  
	  текСтрока = ЭлементыФормы.Товары.ТекущиеДанные;
	  Если  текСтрока.тестПройден1 = Истина или текСтрока.тестПройден2 = истина или текСтрока.тестПройден3 = истина или
		  (текСтрока.Дата1<>Дата(1,1,1)и текСтрока.Дата2<>Дата(1,1,1)и текСтрока.Дата3<>Дата(1,1,1))тогда
		  текстрока.впроцессе=ложь;	
		  ТекСтрока.СуммаКомпенсации = 0;
		  Если ?(ЗначениеЗаполнено(текСтрока.Результат1),текСтрока.ТестПройден1,1)+?(ЗначениеЗаполнено(текСтрока.Результат2),текСтрока.ТестПройден2,1)+?(ЗначениеЗаполнено(текСтрока.Результат3),текСтрока.ТестПройден3,1)=2 и поставщик = Справочники.Контрагенты.НайтиПоКоду("91735") тогда
			  Если ТекСтрока.Количество<8 тогда
				  ТекСтрока.СуммаКомпенсации = ТекСтрока.Цена*ТекСтрока.Количество;
			  Иначе
				  ТекСтрока.СуммаКомпенсации = ТекСтрока.Цена*8+(ТекСтрока.Количество-8)*5;
			  конецЕсли;
		  иначеЕсли  текСтрока.тестПройден1 = 0 тогда
			  ТекСтрока.СуммаКомпенсации = ТекСтрока.Цена*ТекСтрока.Количество;			  
		  конецЕсли;	  
	  иначе
		  текстрока.впроцессе=истина;
		  ТекСтрока.СуммаКомпенсации = 0;
	  конецЕсли;
	  
	конецПроцедуры	

	Процедура ТоварыПередУдалением(Элемент, Отказ)
		Сообщить("Строки удалять нельзя!");
		отказ = Истина;
	КонецПроцедуры

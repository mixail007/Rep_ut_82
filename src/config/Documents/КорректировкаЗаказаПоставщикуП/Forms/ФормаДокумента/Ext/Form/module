////////////////////////////////////////////////////////////////////////////////
// ПЕРЕМЕННЫЕ МОДУЛЯ

// Хранит текущую дату документа - для проверки перехода документа в другой период установки номера
Перем мТекущаяДатаДокумента;

Перем мТекущаяВалютаВзаиморасчетов;

Перем мТекущаяОрганизация;

// Хранит текущее значение учетной политики розничная торговля облагается ЕНВД
Перем мРозничнаяТорговляОблагаетсяЕНВД;

// Хранит текущее значение склада для контроля учетной политики розничная торговля облагается ЕНВД
Перем мТекущийСклад;

// Переменные для кэширования коллекций колонок табличных полей.
Перем мКолонкиТовары, мКолонкиУслуги, мКолонкиПродажи;

// Автоотметка СкладОрдера без учета заполненности ТЧ.
Перем мСкладИзШапки;

// Хранит дерево кнопок подменю заполнение ТЧ
Перем мКнопкиЗаполненияТЧ;

// Флаги наличия реквизитов и табличных частей
Перем мВедениеУчетаЗатратПоПроектам;

Перем мКорректировкаПоступленияДопРасходов;

////////////////////////////////////////////////////////////////////////////////
// ЭКСПОРТНЫЕ ПРОЦЕДУРЫ 

// Заполняет текст про счет-фактуру в форме документа.
//   Вызывается из обработчика ПриОткрытии этой формы и из обработчика ПослеЗаписи
// формы счета-фактуры.
//
// Параметры:
//  Нет.
//
Процедура ЗаполнитьТекстПроСчетФактуру() Экспорт
	
	ЭлементыФормы.ГиперссылкаСчетФактура.Заголовок = ПолучитьТекстСчетаФактуры(
	                                                 НайтиПодчиненныйДокумент(Ссылка, "СчетФактураПолученный"));
	
КонецПроцедуры // ЗаполнитьТекстПроСчетФактуру()

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ОБЩЕГО НАЗНАЧЕНИЯ

// Процедура выполняет необходимые действия перед началом редактирования строки ТЧ.
//
Процедура ПриНачалеРедактированияСтрокиТЧ(Элемент, ИмяТабличнойЧасти, НоваяСтрока)
	
	Если НЕ НоваяСтрока Тогда
		Возврат;
	КонецЕсли;
	
	СтрокаТабличнойЧасти = ЭлементыФормы[ИмяТабличнойЧасти].ТекущиеДанные;
	
	СтрокаТабличнойЧасти.ЕстьВДокументеПоступления = Ложь;
		
	Если КорректироватьБУиНУ Тогда
		
		Если СтрокаТабличнойЧасти.Номенклатура = Неопределено Тогда
			СтрокаТабличнойЧасти.Номенклатура = Справочники.Номенклатура.ПустаяСсылка();
		КонецЕсли;
		
		СтрокаТабличнойЧасти.КоличествоДоКорректировки 	= 0;
		СтрокаТабличнойЧасти.ЦенаДоКорректировки 		= 0;
		СтрокаТабличнойЧасти.СуммаДоКорректировки 		= 0;
		СтрокаТабличнойЧасти.СуммаНДСДоКорректировки 	= 0;
		
		СтрокаТабличнойЧасти.КоличествоДоИзменения 		= 0;
		СтрокаТабличнойЧасти.ЦенаДоИзменения 			= 0;
		СтрокаТабличнойЧасти.СуммаДоИзменения 			= 0;
		СтрокаТабличнойЧасти.СуммаНДСДоИзменения 		= 0;
		СтрокаТабличнойЧасти.СтавкаНДСДоИзменения 		= Перечисления.СтавкиНДС.ПустаяСсылка();
		
	КонецЕсли;
	
	Если ИмяТабличнойЧасти = "Товары" Тогда
		
		ЗаполнитьСкладИОрдерТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);
		
		//Элемент.ТекущиеДанные.КлючСвязи  = 0;
		
	КонецЕсли;
	
КонецПроцедуры // ПриНачалеРедактированияСтрокиТЧ()

// Процедура выполняет проверку соответствия склада в строке табличной части и склада в приходном ордере. В случае
// несоответствия по выбору пользователя склад может быть изменен.
//
// Параметры:
//  СтрокаТабличнойЧасти - строка табличной части, для которой выполняется проверка
//
Процедура ПриИзмененииПриходногоОрдераВТабличнойЧасти(СтрокаТабличнойЧасти)
	
	Если СтрокаТабличнойЧасти.Склад<>СтрокаТабличнойЧасти.ПриходныйОрдер.Склад Тогда

		ТекстВопроса = "Склад в приходном ордере отличается от склада в текущей строке.
			|Изменить склад в текущей строке?";
		Ответ = Вопрос(ТекстВопроса, РежимДиалогаВопрос.ДаНет, , КодВозвратаДиалога.Да);
		Если Ответ = КодВозвратаДиалога.Да Тогда
			СтрокаТабличнойЧасти.Склад=СтрокаТабличнойЧасти.ПриходныйОрдер.Склад;
		КонецЕсли;

	КонецЕсли;
	
КонецПроцедуры

// Функция формирует список запросов для передачи в форму подбора.
//
// Параметры:
//  ТабличнаяЧасть - табличная часть, для подбора в которую формируется список запросов.
//
// Возвращаемое значение:
//  Список значений - список запросов.
//
Функция СформироватьСписокЗапросовДляПодбора(ТабличнаяЧасть)
	
	СписокЗапросов = Новый СписокЗначений();
	СписокЗапросов.Добавить(,"По справочнику");
	
	ПустойТипЦен = НЕ ЗначениеЗаполнено(ТипЦен);
	
	Если ТабличнаяЧасть = Товары Тогда
		
		Если ЗначениеЗаполнено(Контрагент) Тогда
			СписокЗапросов.Добавить("ПриходНоменклатураКонтрагента", "По номенклатуре контрагента");
		КонецЕсли;
		Если ЗначениеЗаполнено(ДоговорКонтрагента) Тогда
			СписокЗапросов.Добавить("ПриходЦеныКонтрагента", "По ценам контрагента");
		КонецЕсли;
		
	ИначеЕсли ТабличнаяЧасть = Услуги Тогда
		СписокЗапросов.Добавить("РасходУслуги", "По услугам предприятия");
		Если НЕ ПустойТипЦен ИЛИ (ЗначениеЗаполнено(ДоговорКонтрагента) И ДоговорКонтрагента.ВидУсловийДоговора = Перечисления.ВидыУсловийДоговоровВзаиморасчетов.СДополнительнымиУсловиями) Тогда
			СписокЗапросов.Добавить("ПриходЦеныУслуг", "По ценам и услугам контрагента");
		КонецЕсли;
	КонецЕсли;
	
	Возврат СписокЗапросов;
	
КонецФункции // СформироватьСписокЗапросовДляПодбора()

// Процедура обновляет параметры в форме подбора, если она открыта.
//
// Параметры:
//  Реквизит - измененный реквизит.
//
// Обработчик уставливается динамически методом "ПодключитьОбработчикИзмененияДанных"
// в процедуре "ОткрытьПодборНоменклатуры" общего модуля "ОбработкаТабличныхЧастей"
Процедура ОбновитьФормуПодбора(Реквизит)

	ОбновитьПараметрыИФормуПодбора(ЭтотОбъект, ЭтаФорма, Реквизит);

КонецПроцедуры // ОбновитьФормуПодбора()

// Процедура вызывает сервисный механизм для подбора номеклатуры в табличную часть.
//
// Параметры:
//  ТабличнаяЧасть - табличная часть, в которую осуществляется подбор.
//
Процедура ДействиеПодбор(ТабличнаяЧасть)

	Перем Команда, Валюта;

	ЕстьЦена               = Истина;
	ЕстьСерия              = Истина;
	Валюта                 = ВалютаДокумента;
	СпособЗаполненияЦен    = Перечисления.СпособыЗаполненияЦен.ПоЦенамНоменклатурыКонтрагентов;
	ПодбиратьУслуги        = Ложь;
	СкрыватьХарактеристику = Ложь;

	Если ТабличнаяЧасть = Товары Тогда
		Команда                = "ПодборВТабличнуюЧастьТовары";
		ИмяТабличнойЧасти      = "Товары";
		
	ИначеЕсли ТабличнаяЧасть = Услуги Тогда
		Команда                = "ПодборВТабличнуюЧастьУслуги";
		ЕстьСерия              = Ложь;
		ИмяТабличнойЧасти      = "Услуги";
		ПодбиратьУслуги        = Истина;
		СкрыватьХарактеристику = Истина;
	КонецЕсли;

	СписокВидовПодбора = СформироватьСписокЗапросовДляПодбора(ТабличнаяЧасть);
	ПредставлениеДок   = Метаданные().Представление();

	СтруктураПараметровПодбора = Новый Структура();
	СтруктураПараметровПодбора.Вставить("Команда"              , Команда);
	СтруктураПараметровПодбора.Вставить("СписокВидовПодбора"   , СписокВидовПодбора);

	// Параметры запросов.
	ВременнаяДатаРасчетов = ?(НачалоДня(Дата) = НачалоДня(ТекущаяДата()), Неопределено, Дата);
	СтруктураПараметровПодбора.Вставить("ДатаРасчетов"          , ВременнаяДатаРасчетов);
	СтруктураПараметровПодбора.Вставить("Склад"                 , СкладОрдер);
	СтруктураПараметровПодбора.Вставить("ТипЦен"                , ТипЦен);
	СтруктураПараметровПодбора.Вставить("Контрагент"            , Контрагент);
	СтруктураПараметровПодбора.Вставить("ДоговорКонтрагента"    , ДоговорКонтрагента);
	СтруктураПараметровПодбора.Вставить("Организация"           , Организация);
	СтруктураПараметровПодбора.Вставить("Сделка"                , Сделка);

	СтруктураПараметровПодбора.Вставить("СпособЗаполненияЦен"   , СпособЗаполненияЦен);
	СтруктураПараметровПодбора.Вставить("ЕстьЦена"              , ЕстьЦена);
	СтруктураПараметровПодбора.Вставить("ЕстьСерия"             , ЕстьСерия);
	СтруктураПараметровПодбора.Вставить("ВалютаДокумента"       , Валюта);
	СтруктураПараметровПодбора.Вставить("ПодбиратьУслуги"       , ПодбиратьУслуги);
	СтруктураПараметровПодбора.Вставить("СкрыватьХарактеристику", СкрыватьХарактеристику);
	СтруктураПараметровПодбора.Вставить("Заголовок"             , "Подбор номенклатуры в документ " + 
	                                    ПредставлениеДок + " № " + Номер + " (" + ИмяТабличнойЧасти + ")");

	ОткрытьПодборНоменклатуры(ЭтаФорма, СтруктураПараметровПодбора, Метаданные());

КонецПроцедуры // ДействиеПодбор()

// Производит заполнение документа переданными из формы подбора данными.
//
// Параметры:
//  ТабличнаяЧасть    - табличная часть, в которую надо добавлять подобранную позицию номенклатуры;
//  ЗначениеВыбора    - структура, содержащая параметры подбора.
//
Процедура ОбработкаПодбора(ТабличнаяЧасть, ЗначениеВыбора)Экспорт

	Перем СпособЗаполненияЦен, ВалютаЦены, ЕстьСкладВТабличнойЧасти;
	Перем Номенклатура, ЕдиницаИзмерения, Количество, КоличествоМест, Цена, Характеристика, Серия;

	// Получим параметры подбора из структуры подбора.
	ЗначениеВыбора.Свойство("СпособЗаполненияЦен", СпособЗаполненияЦен);
	ЗначениеВыбора.Свойство("ВалютаЦены"         , ВалютаЦены);
	ЗначениеВыбора.Свойство("Номенклатура"    , Номенклатура);
	ЗначениеВыбора.Свойство("ЕдиницаИзмерения", ЕдиницаИзмерения);
	ЗначениеВыбора.Свойство("Количество"      , Количество);
	ЗначениеВыбора.Свойство("Цена"            , Цена);
	ЗначениеВыбора.Свойство("Характеристика"  , Характеристика);
	ЗначениеВыбора.Свойство("Серия"           , Серия);
	
	Если мКорректировкаПоступленияДопРасходов Тогда
		// В этом случае изменять количество не следует
		Количество = 0;
	КонецЕсли;
	
	ЕстьСкладВТабличнойЧасти = мУказаниеСкладовВТЧ;
	
	Если ТабличнаяЧасть = Услуги Тогда
		ЕстьСкладВТабличнойЧасти = Ложь;
	КонецЕсли;	 
							 
	Если ТабличнаяЧасть = Товары И Номенклатура.Услуга Тогда
		Предупреждение("В данном контексте услуги не подбираются!");
		Возврат;
	ИначеЕсли ТабличнаяЧасть = Услуги И НЕ Номенклатура.Услуга Тогда
		Предупреждение("В данном контексте товары не подбираются!");
		Возврат;
	КонецЕсли;

	// Ищем выбранную позицию в таблице подобранной номенклатуры.
	//  Если найдем - увеличим количество; не найдем - добавим новую строку.
	СтруктураОтбора = Новый Структура();

	Если ТабличнаяЧасть = Товары Тогда
		СтруктураОтбора.Вставить("ЕдиницаИзмерения", ЕдиницаИзмерения);
		СтруктураОтбора.Вставить("ХарактеристикаНоменклатуры", Характеристика);
		СтруктураОтбора.Вставить("СерияНоменклатуры"         , Серия);
	Иначе
		СтруктураОтбора.Вставить("Номенклатура", Номенклатура);
	КонецЕсли;

	Если ЕстьСкладВТабличнойЧасти
		И ТабличнаяЧасть <> Услуги
		И ВидПоступления = Перечисления.ВидыПоступленияТоваров.НаСклад
		И ЗначениеЗаполнено(СкладОрдер)
	Тогда
		СтруктураОтбора.Вставить("Склад", СкладОрдер);
	КонецЕсли;

	СтрокаТабличнойЧасти = НайтиСтрокуТабЧасти(ТабличнаяЧасть, СтруктураОтбора);
	Если СтрокаТабличнойЧасти <> Неопределено Тогда

		Если ТабличнаяЧасть = Товары Тогда
			
			// Нашли, увеличиваем количество в первой найденной строке.
			СтрокаТабличнойЧасти.Количество = СтрокаТабличнойЧасти.Количество + Количество;
						
			// Рассчитать реквизиты табличной части.
			РассчитатьКоличествоМестТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);
			РассчитатьСуммуТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);
			РассчитатьСуммуНДСТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);
			
		ИначеЕсли ТабличнаяЧасть = Услуги Тогда
			
			// Нашли, увеличиваем количество в первой найденной строке.
			СтрокаТабличнойЧасти.Количество = СтрокаТабличнойЧасти.Количество + Количество;
						
			// Рассчитать реквизиты табличной части.
			РассчитатьКоличествоМестТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);
			РассчитатьСуммуТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);
			РассчитатьСуммуНДСТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);
			
		КонецЕсли;
		
	Иначе
		
		// Не нашли - добавляем новую строку.
		СтрокаТабличнойЧасти = ТабличнаяЧасть.Добавить();
		СтрокаТабличнойЧасти.Номенклатура     = Номенклатура;

		Если ТабличнаяЧасть = Товары Тогда

			СтрокаТабличнойЧасти.Количество       = Количество;
			СтрокаТабличнойЧасти.ЕдиницаИзмерения = ЕдиницаИзмерения;
			СтрокаТабличнойЧасти.Коэффициент      = СтрокаТабличнойЧасти.ЕдиницаИзмерения.Коэффициент;
			СтрокаТабличнойЧасти.ХарактеристикаНоменклатуры = Характеристика;
			СтрокаТабличнойЧасти.СерияНоменклатуры          = Серия;
			
			// Заполняем реквизиты табличной части.
			ЗаполнитьСтавкуНДСТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);

			// Пересчитаем цену в валюту документа.
			Цена = ПересчитатьЦенуПриИзмененииВалюты(Цена, ВалютаЦены, ВалютаДокумента, КурсДокумента(ЭтотОбъект, мВалютаРегламентированногоУчета), КратностьДокумента(ЭтотОбъект, мВалютаРегламентированногоУчета), Дата);

			СтрокаТабличнойЧасти.Цена = ПересчитатьЦенуПриИзмененииФлаговНалогов(Цена,
															СпособЗаполненияЦен,
															ТипЦен.ЦенаВключаетНДС,
															УчитыватьНДС,
															СуммаВключаетНДС,
															ПолучитьСтавкуНДС(СтрокаТабличнойЧасти.СтавкаНДС));

			// Рассчитываем реквизиты табличной части.
			//ЗаполнитьЕдиницуМестТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект, Ложь);
			РассчитатьСуммуТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);
			РассчитатьСуммуНДСТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);
			
		ИначеЕсли ТабличнаяЧасть = Услуги Тогда
			
			СтрокаТабличнойЧасти.Количество = Количество;
			
			// Заполняем реквизиты табличной части.
			ЗаполнитьСодержаниеТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);
			ЗаполнитьСтавкуНДСТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);

			// Пересчитаем цену в валюту документа.
			Цена = ПересчитатьЦенуПриИзмененииВалюты(Цена, ВалютаЦены, ВалютаДокумента, КурсДокумента(ЭтотОбъект, мВалютаРегламентированногоУчета), КратностьДокумента(ЭтотОбъект, мВалютаРегламентированногоУчета), Дата);

			СтрокаТабличнойЧасти.Цена = ПересчитатьЦенуПриИзмененииФлаговНалогов(Цена,
															СпособЗаполненияЦен,
															ТипЦен.ЦенаВключаетНДС,
															УчитыватьНДС,
															СуммаВключаетНДС,
															ПолучитьСтавкуНДС(СтрокаТабличнойЧасти.СтавкаНДС));

			// Рассчитываем реквизиты табличной части.
			РассчитатьСуммуТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);
			РассчитатьСуммуНДСТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);
			
			СтрокаТабличнойЧасти.СтатьяЗатрат = СтрокаТабличнойЧасти.Номенклатура.СтатьяЗатрат;
			СтрокаТабличнойЧасти.НоменклатурнаяГруппа = СтрокаТабличнойЧасти.Номенклатура.НоменклатурнаяГруппаЗатрат;
			
		КонецЕсли;
		
	КонецЕсли; // СтрокаТабличнойЧасти <> Неопределено

	Если ТабличнаяЧасть <> Услуги Тогда
		ЗаполнитьСкладИОрдерТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);
	КонецЕсли;

	ИмяТабличнойЧасти = ПолучитьИмяТабличнойЧастиПоСсылкеНаСтроку(СтрокаТабличнойЧасти);
	
	ТабличнаяЧастьИмя = "Товары";
	// Установим текущую строку
	ЭлементыФормы[ТабличнаяЧастьИмя].ТекущаяСтрока = СтрокаТабличнойЧасти;
	// Установим текущую колонку
	Если ЭлементыФормы[ТабличнаяЧастьИмя].Колонки["Количество"].Видимость Тогда
		ЭлементыФормы[ТабличнаяЧастьИмя].ТекущаяКолонка = ЭлементыФормы[ТабличнаяЧастьИмя].Колонки["Количество"];
	Иначе
		ЭлементыФормы[ТабличнаяЧастьИмя].ТекущаяКолонка = ЭлементыФормы[ТабличнаяЧастьИмя].Колонки["Сумма"];
	КонецЕсли;
	
	//УчетСерийныхНомеров.ОбработкаПодбораНоменклатурыПоСерийномуНомеру(ЗначениеВыбора, СерийныеНомера,
	//											ТабличнаяЧасть,
	//											СтрокаТабличнойЧасти,
	//											мПараметрыСвязиСтрокТЧ,
	//											ТабличнаяЧастьИмя,
	//											ЭтотОбъект);
	
КонецПроцедуры // ОбработкаПодбора()

// Обновляет текущее значение учетной политики розничная торговля облагается ЕНВД.
//
Процедура ПриИзмененииОблагаетсяЕНВД(РежимВызова = "")

	Если НЕ ЗначениеЗаполнено(РежимВызова) Тогда
		РозничнаяТорговляОблагаетсяЕНВД = УчетнаяПолитикаНалоговыйУчет("РозничнаяТорговляОблагаетсяЕНВД", Организация, Дата);
		Если ЗначениеЗаполнено(РозничнаяТорговляОблагаетсяЕНВД) Тогда
			мРозничнаяТорговляОблагаетсяЕНВД = РозничнаяТорговляОблагаетсяЕНВД;
		Иначе
			мРозничнаяТорговляОблагаетсяЕНВД = Ложь;
		КонецЕсли;

		Если ЗначениеЗаполнено(ВидПоступления) Тогда
			Если ВидПоступления = Перечисления.ВидыПоступленияТоваров.НаСклад Тогда
				мТекущийСклад = СкладОрдер;
			Иначе
				мТекущийСклад = СкладОрдер.Склад;
			КонецЕсли;
		Иначе
			мТекущийСклад = Справочники.Склады.ПустаяСсылка();
		КонецЕсли;
	Иначе
		СпособЗаполненияЦен = Перечисления.СпособыЗаполненияЦен.ПоЦенамНоменклатурыКонтрагентов;
		
		ПриИзмененииРозничнаяТорговляОблагаетсяЕНВД(ЭтотОбъект,
													мВалютаРегламентированногоУчета,
													СпособЗаполненияЦен,
													"Покупка",
													РежимВызова,
													"Товары",
													мРозничнаяТорговляОблагаетсяЕНВД,
													мТекущийСклад);
		УстановитьВидимость();
		
	КонецЕсли;

КонецПроцедуры // ПриИзмененииОблагаетсяЕНВД()

// Процедура устанавливает видимость для тех колонок в табличной части 
// "Товары", видимость которых определяется реквизитами документа.
//
// Параметры:
//  Нет.
//
Процедура УстановитьВидимость()
	
	ЭтоКомиссия = (ДоговорКонтрагента.ВидДоговора = Перечисления.ВидыДоговоровКонтрагентов.СКомитентом);
	
	ИсправлениеКорректировки = ЗначениеЗаполнено(ИсправляемыйДокументПоступления) 
								И (ТипЗнч(ИсправляемыйДокументПоступления) = Тип("ДокументСсылка.КорректировкаПоступления")) 
								И (ИсправляемыйДокументПоступления.ВидОперации = Перечисления.ВидыОперацийИсправленияПоступленияРеализации.СогласованноеИзменение)
								И (НЕ ВидОперации = Перечисления.ВидыОперацийИсправленияПоступленияРеализации.СогласованноеИзменение);
	
	СвойстваСклада = ПолучитьСвойстваСкладаВТабличнойЧасти();
	СвойстваЗаказа = ПолучитьСвойстваЗаказаПоставщикуВТабличнойЧасти();
	
	// Установим видимость колонок табличнх частей
	УстановитьСвойствоКолонокТЧ(
		"ПриходныйОрдер",
		"Видимость",
		(ВидПоступления = Перечисления.ВидыПоступленияТоваров.ПоОрдеру));
		
	УстановитьСвойствоКолонокТЧ(
		"СтавкаНДС, СуммаНДС, Всего, СуммаНДСДоИзменения, ВсегоДоИзменения",
		"Видимость",
		УчитыватьНДС);
		
	//УстановитьСвойствоКолонокТЧ(
	//	"Подразделение, ОтражатьТоварныйУчет",
	//	"Видимость",
	//	КорректироватьБУиНУ И ОтражатьВУправленческомУчете);
	
	УстановитьСвойствоКолонокТЧ(
		"Склад",
		"Видимость",
		СвойстваСклада.ВидимостьСклада);
		
	УстановитьСвойствоКолонокТЧ(
		"ЗаказПокупателя",
		"Видимость",
		КорректироватьБУиНУ);
			
	УстановитьСвойствоКолонокТЧ(
		"КоличествоДоКорректировки, СуммаДоКорректировки, СуммаНДСДоКорректировки, ЦенаДоКорректировки, ВсегоДоКорректировки",
		"Видимость",
		ИсправлениеКорректировки);
		
	УстановитьСвойствоКолонокТЧ(
		"СтавкаНДСДоИзменения",
		"Видимость",
		УчитыватьНДС И ВидОперации = Перечисления.ВидыОперацийИсправленияПоступленияРеализации.ИсправлениеОшибки);
		
	//УстановитьСвойствоКолонокТЧ(
	//	"ДокументПартии",
	//	"Видимость",
	//	мКорректировкаПоступленияДопРасходов);
		
	Если КорректироватьБУиНУ И мКорректировкаПоступленияДопРасходов Тогда
		
		УстановитьСвойствоКолонокТЧ(
			"Количество, КоличествоДоИзменения, КоличествоДоКорректировки, Цена, ЦенаДоизменения, ЦенаДоКорректировки",
			"Видимость",
			Ложь);
	Иначе
		
		УстановитьСвойствоКолонокТЧ(
			"Количество, КоличествоДоИзменения, Цена, ЦенаДоизменения",
			"Видимость",
			Истина);
			
	КонецЕсли;
	
	// Установим доступность колонок табличных частей
	УстановитьСвойствоКолонокТЧ(
		"КоличествоДоИзменения, СуммаДоИзменения, СуммаНДСДоИзменения, СтавкаНДСДоИзменения, ЦенаДоИзменения, СодержаниеДоИзменения,
		|КоличествоДоКорректировки, СуммаДоКорректировки, СуммаНДСДоКорректировки, ЦенаДоКорректировки",
		"Доступность",
		НЕ КорректироватьБУиНУ);
		
	// Установим положение колонок табличных частей
	
	УстановитьСвойствоКолонокТЧ(
		"Количество, Сумма, СуммаНДС, Цена, Всего",
		"Положение",ПоложениеКолонки.НаСледующейСтроке);
	
	УстановитьСвойствоКолонокТЧ(
		"КоличествоДоИзменения, СуммаДоИзменения, СуммаНДСДоИзменения, ЦенаДоИзменения, ВсегоДоИзменения",
		"Положение",
		?(ИсправлениеКорректировки, ПоложениеКолонки.НаСледующейСтроке, ПоложениеКолонки.НоваяКолонка));
		
	УстановитьСвойствоКолонокТЧ(
		"СтавкаНДС",
		"Положение",
		?(ВидОперации = Перечисления.ВидыОперацийИсправленияПоступленияРеализации.ИсправлениеОшибки, ПоложениеКолонки.НаСледующейСтроке, ПоложениеКолонки.НоваяКолонка));
		
		// Установим АвтоОтметкуНезаполненного колонок табличных частей 
	УстановитьСвойствоКолонокТЧ(
		"Номенклатура, Содержание",
		"АвтоОтметкаНезаполненного",
		КорректироватьБУиНУ);
		
	УстановитьСвойствоКолонокТЧ(
		"Склад",
		"АвтоотметкаНеЗаполненного",
		СвойстваСклада.ОбязательноеЗаполнениеСклада);
			
	// Установим видимость ТЧ "Услуги"
	ЭлементыФормы.ОсновнаяПанель.Страницы.Услуги.Видимость = НЕ (ЭтоКомиссия ИЛИ мКорректировкаПоступленияДопРасходов);
	
//	ЭлементыФормы.ВосстановитьНДС.Видимость = ЕстьНДСКВосстановлению();
	
	// Установим видимость счетов
	Если ЭтоКомиссия Тогда
		ВидимостьСчетов = Ложь;
	Иначе
		ВидимостьСчетов = Истина;
	КонецЕсли;
	
	ОписаниеТабличныхЧастей = Новый Структура();
	ОписаниеТабличныхЧастей.Вставить("Товары", мКолонкиТовары);
	ОписаниеТабличныхЧастей.Вставить("Услуги", мКолонкиУслуги);
	
КонецПроцедуры // УстановитьВидимость()

// Процедура формирует текст в информационной надписи об итогах документа.
//
// Параметры:
//  Нет.
//
Процедура ОбновитьПодвал()

	// При изменении данных обновим суммы в подвале.
	ЭлементыФормы.Всего.Значение    = ФорматСумм(ПолучитьСуммуДокументаСНДС(ЭтотОбъект));
	ЭлементыФормы.ВсегоНДС.Значение = ФорматСумм(ПолучитьНДСДокумента(ЭтотОбъект));
	
	Если НЕ ЗначениеЗаполнено(ДокументОбъект.ВалютаДокумента) Тогда
		ЭлементыФормы.НадписьВсего.Заголовок = "Всего (<>):";
	Иначе
		ЭлементыФормы.НадписьВсего.Заголовок = "Всего (" + СокрЛП(ДокументОбъект.ВалютаДокумента) +"):";
	КонецЕсли;

	Если СуммаВключаетНДС Тогда
		ЭлементыФормы.НадписьВсегоНДС.Заголовок = "НДС (в т. ч.):";
	Иначе
		ЭлементыФормы.НадписьВсегоНДС.Заголовок = "НДС (сверху):";
	КонецЕсли;

КонецПроцедуры // ОбновитьПодвал()

// Процедура выполняет необходимые действия при изменении количества в ТЧ.
//
Процедура ПриИзмененииКоличестваТЧ(Элемент, ИмяТабличнойЧасти, СуффиксИмениРеквизита = "")
	
	СтрокаТабличнойЧасти = ЭлементыФормы[ИмяТабличнойЧасти].ТекущиеДанные;
	
	Если КорректироватьБУиНУ И НЕ ЗначениеЗаполнено(СуффиксИмениРеквизита) Тогда // изменен реквизит Количество
		РассчитатьКоличествоМестТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);
	КонецЕсли;
	//Если ЭлементыФормы[ИмяТабличнойЧасти].Колонки.Найти("ОтражатьТоварныйУчет") <> Неопределено Тогда
	//	СтрокаТабличнойЧасти.ОтражатьТоварныйУчет = Истина;
	//КонецЕсли;
	
	// Рассчитать реквизиты табличной части.
	ПриИзмененииЦеныТЧ(Элемент, ИмяТабличнойЧасти, СуффиксИмениРеквизита);
	
КонецПроцедуры // ПриИзмененииКоличестваТЧ()

// Процедура выполняет необходимые действия при изменении цены в ТЧ.
//
Процедура ПриИзмененииЦеныТЧ(Элемент, ИмяТабличнойЧасти, СуффиксИмениРеквизита = "")
	
	СтрокаТабличнойЧасти = ЭлементыФормы[ИмяТабличнойЧасти].ТекущиеДанные;
	
	СтрокаТабличнойЧасти["Сумма" + СуффиксИмениРеквизита] =
		СтрокаТабличнойЧасти["Цена" + СуффиксИмениРеквизита] * СтрокаТабличнойЧасти["Количество" + СуффиксИмениРеквизита];
	
	СтрокаТабличнойЧасти["СуммаНДС" + СуффиксИмениРеквизита] =
		РассчитатьСуммуНДС(
			СтрокаТабличнойЧасти["Сумма" + СуффиксИмениРеквизита],
			УчитыватьНДС,
			СуммаВключаетНДС,
			ПолучитьСтавкуНДС(
				ПолучитьСтавкуНДССтрокиТабличнойЧасти(СтрокаТабличнойЧасти, СуффиксИмениРеквизита)));
	
КонецПроцедуры // ПриИзмененииЦеныТЧ()

// Процедура выполняет необходимые действия при изменении ставки НДС в ТЧ.
//
Процедура ПриИзмененииСтавкиНДСТЧ(Элемент, ИмяТабличнойЧасти, СуффиксИмениРеквизита = "")
	
	СтрокаТабличнойЧасти = ЭлементыФормы[ИмяТабличнойЧасти].ТекущиеДанные;
	
	Если НЕ ЗначениеЗаполнено(СуффиксИмениРеквизита) Тогда // изменет реквизит СтавкаНДС
		РассчитатьСуммуНДСТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);
	Иначе
		СтрокаТабличнойЧасти.СуммаНДСДоИзменения =
			РассчитатьСуммуНДС(
				СтрокаТабличнойЧасти.СуммаДоИзменения,
				УчитыватьНДС,
				СуммаВключаетНДС,
				ПолучитьСтавкуНДС(
					СтрокаТабличнойЧасти.СтавкаНДСДоИзменения));
		СтрокаТабличнойЧасти.СуммаНДСДоКорректировки =
			РассчитатьСуммуНДС(
				СтрокаТабличнойЧасти.СуммаДоКорректировки,
				УчитыватьНДС,
				СуммаВключаетНДС,
				ПолучитьСтавкуНДС(
					СтрокаТабличнойЧасти.СтавкаНДСДоИзменения));
	КонецЕсли;
	
КонецПроцедуры // ПриИзмененииСтавкиНДСТЧ()

// Процедура выполняет необходимые действия при изменении суммы в ТЧ.
//
Процедура ПриИзмененииСуммыТЧ(Элемент, ИмяТабличнойЧасти, СуффиксИмениРеквизита = "")
	
	СтрокаТабличнойЧасти = ЭлементыФормы[ИмяТабличнойЧасти].ТекущиеДанные;
	
	СтрокаТабличнойЧасти["Цена" + СуффиксИмениРеквизита] =
		?(СтрокаТабличнойЧасти["Количество" + СуффиксИмениРеквизита] = 0,
			0,
			СтрокаТабличнойЧасти["Сумма" + СуффиксИмениРеквизита] /
			СтрокаТабличнойЧасти["Количество" + СуффиксИмениРеквизита]);
	
	СтрокаТабличнойЧасти["СуммаНДС" + СуффиксИмениРеквизита] = 
		РассчитатьСуммуНДС(
			СтрокаТабличнойЧасти["Сумма" + СуффиксИмениРеквизита],
			УчитыватьНДС,
			СуммаВключаетНДС,
			ПолучитьСтавкуНДС(
				ПолучитьСтавкуНДССтрокиТабличнойЧасти(СтрокаТабличнойЧасти, СуффиксИмениРеквизита)));
	
КонецПроцедуры // ПриИзмененииСуммыТЧ()

// Функция возвращает поле строки ТЧ, содержащее ставку НДС
//
Функция ПолучитьСтавкуНДССтрокиТабличнойЧасти(СтрокаТабличнойЧасти, СуффиксИмениРеквизита = "")
	
	Возврат
		?(ЗначениеЗаполнено(СуффиксИмениРеквизита)
			И ВидОперации = Перечисления.ВидыОперацийИсправленияПоступленияРеализации.ИсправлениеОшибки,
				СтрокаТабличнойЧасти.СтавкаНДСДоИзменения,
				СтрокаТабличнойЧасти.СтавкаНДС);
	
КонецФункции

// Процедура выполняет действия, связанные с изменением организации
//
Процедура ПриИзмененииОрганизации()
	
	УстановитьНомерДокумента(ЭтотОбъект);

	ПриИзмененииЗначенияОрганизации(ЭтотОбъект);
	ПриИзмененииОблагаетсяЕНВД("Организация");
	
	мТекущаяОрганизация = Организация;
	
	УстановитьВидимость();
	
КонецПроцедуры

// Процедура устанавливает свойство ячеек оформления строки табличного поля
//
Процедура УстановитьСвойствоЯчеекСтрокиТЧ(ОформлениеСтроки, ИменаЯчеек, ИмяСвойства, ЗначениеСвойства)
	
	СтруктураКолонок = Новый Структура(ИменаЯчеек);
	
	Для Каждого КлючИЗначение Из СтруктураКолонок Цикл
		Если ОформлениеСтроки.Ячейки.Найти(КлючИЗначение.Ключ) <> Неопределено Тогда
			ОформлениеСтроки.Ячейки[КлючИЗначение.Ключ][ИмяСвойства] = ЗначениеСвойства;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

// Процедура устанавливает свойство колонок табличного поля
// 
Процедура УстановитьСвойствоКолонокТЧ(ИменаКолонок, ИмяСвойства, ЗначениеСвойства)
	
	СтруктураКолонок = Новый Структура(ИменаКолонок);
	
	Для Каждого КлючИЗначение Из СтруктураКолонок Цикл
		Если мКолонкиТовары.Найти(КлючИЗначение.Ключ) <> Неопределено Тогда
			мКолонкиТовары[КлючИЗначение.Ключ][ИмяСвойства] = ЗначениеСвойства;
		КонецЕсли;
		Если мКолонкиУслуги.Найти(КлючИЗначение.Ключ) <> Неопределено Тогда
			мКолонкиУслуги[КлючИЗначение.Ключ][ИмяСвойства] = ЗначениеСвойства;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

// Процедура выполняет необходимые действия при получении данных строк ТЧ.
//
Процедура ПриПолученииДанныхСтрокиТЧ(Элемент, ИмяТабличнойЧасти, ОформленияСтрок)
	
	Если ИмяТабличнойЧасти = "Товары" Тогда
		мКолонки = мКолонкиТовары;
	Иначе
		мКолонки = мКолонкиУслуги;
	КонецЕсли;
	
	Для Каждого ОформлениеСтроки Из ОформленияСтрок Цикл
		
		ДанныеСтроки = ОформлениеСтроки.ДанныеСтроки;
		
		Если мКолонки.ВсегоДоКорректировки.Видимость Тогда
			ТекСумма = ДанныеСтроки.СуммаДоКорректировки + ?(СуммаВключаетНДС, 0, ДанныеСтроки.СуммаНДСДоКорректировки);
			ОформлениеСтроки.Ячейки.ВсегоДоКорректировки.УстановитьТекст(ФорматСумм(ТекСумма));
		КонецЕсли;
		Если мКолонки.ВсегоДоИзменения.Видимость Тогда
			ТекСумма = ДанныеСтроки.СуммаДоИзменения + ?(СуммаВключаетНДС, 0, ДанныеСтроки.СуммаНДСДоИзменения);
			ОформлениеСтроки.Ячейки.ВсегоДоИзменения.УстановитьТекст(ФорматСумм(ТекСумма));
		КонецЕсли;
		Если мКолонки.Всего.Видимость Тогда
			ТекСумма = ДанныеСтроки.Сумма + ?(СуммаВключаетНДС, 0, ДанныеСтроки.СуммаНДС);
			ОформлениеСтроки.Ячейки.Всего.УстановитьТекст(ФорматСумм(ТекСумма));
		КонецЕсли;
		
		ЭтоНоменклатура = (ТипЗнч(ДанныеСтроки.Номенклатура) = Тип("СправочникСсылка.Номенклатура"));
		
		УстановитьСвойствоЯчеекСтрокиТЧ(ОформлениеСтроки,
			"Номенклатура, Склад, Заказ, ПриходныйОрдер,
			|НоменклатурнаяГруппа, Подразделение, СтатьяЗатрат, ХарактерЗатрат, Проект,
			|Заказ, ДокументПартии",
			"ТолькоПросмотр",
			ДанныеСтроки.ЕстьВДокументеПоступления И КорректироватьБУиНУ);
			
		УстановитьСвойствоЯчеекСтрокиТЧ(ОформлениеСтроки,
			"ХарактеристикаНоменклатуры,СерияНоменклатуры,Единица,ЕдиницаМест,КоличествоМест",
			"ТолькоПросмотр",
			(ДанныеСтроки.ЕстьВДокументеПоступления И КорректироватьБУиНУ) ИЛИ (НЕ ЭтоНоменклатура));
			
		УстановитьСвойствоЯчеекСтрокиТЧ(ОформлениеСтроки,
			"СтавкаНДС",
			"ТолькоПросмотр",
			(ДанныеСтроки.ЕстьВДокументеПоступления И КорректироватьБУиНУ) 
				И ВидОперации = Перечисления.ВидыОперацийИсправленияПоступленияРеализации.СогласованноеИзменение);
			
		УстановитьСвойствоЯчеекСтрокиТЧ(ОформлениеСтроки,
			"Количество",
			"ОтметкаНезаполненного",
			(НЕ ДанныеСтроки.ЕстьВДокументеПоступления) И (НЕ ЗначениеЗаполнено(ДанныеСтроки.Количество)));
			
		УстановитьСвойствоЯчеекСтрокиТЧ(ОформлениеСтроки,
			"Сумма",
			"ОтметкаНезаполненного",
			(НЕ ДанныеСтроки.ЕстьВДокументеПоступления) И (НЕ ЗначениеЗаполнено(ДанныеСтроки.Сумма)));
			
		УстановитьСвойствоЯчеекСтрокиТЧ(ОформлениеСтроки,
			"Цена",
			"ОтметкаНезаполненного",
			(НЕ ДанныеСтроки.ЕстьВДокументеПоступления) И (НЕ ЗначениеЗаполнено(ДанныеСтроки.Цена)));
			
			
		Если ИмяТабличнойЧасти = "Товары" Тогда
			
			Если ЭтоНоменклатура Тогда
				ПоказатьКодАртикул(мКолонкиТовары, ОформлениеСтроки.Ячейки, ДанныеСтроки.Номенклатура);
				ПоказатьКоэффициентМест(мКолонкиТовары, ОформлениеСтроки.Ячейки, ДанныеСтроки.ЕдиницаИзмеренияМест);
			КонецЕсли;
			
			Если ЗначениеЗаполнено(ДанныеСтроки.СерияНоменклатуры) Тогда
				Если мКолонкиТовары.НомерГТД.Видимость Тогда
					ОформлениеСтроки.Ячейки.НомерГТД.УстановитьТекст(ДанныеСтроки.СерияНоменклатуры.НомерГТД);
				КонецЕсли;
				Если мКолонкиТовары.СтранаПроисхождения.Видимость Тогда
					ОформлениеСтроки.Ячейки.СтранаПроисхождения.УстановитьТекст(ДанныеСтроки.СерияНоменклатуры.СтранаПроисхождения);
				КонецЕсли;
			КонецЕсли;
			
			УстановитьСвойствоЯчеекСтрокиТЧ(ОформлениеСтроки,
				"Единица,Коэффициент",
				"ОтметкаНезаполненного",
				ЭтоНоменклатура И НЕ ЗначениеЗаполнено(ДанныеСтроки.ЕдиницаИзмерения));
				
			УстановитьСвойствоЯчеекСтрокиТЧ(ОформлениеСтроки,
				"Количество, Цена",
				"ТолькоПросмотр",
				КорректироватьБУиНУ И мКорректировкаПоступленияДопРасходов);
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры // ПриПолученииДанныхСтрокиТЧ()

// Процедура заполняет текст про исправляемый документ
//
Процедура ЗаполнитьТекстИсправляемыйДокументПоступления()
	
	Если ЗначениеЗаполнено(ИсправляемыйДокументПоступления) Тогда
		ЭлементыФормы.ГиперссылкаИсправляемыйДокументПоступления.Гиперссылка = Истина;
		ЭлементыФормы.ГиперссылкаИсправляемыйДокументПоступления.Заголовок = Строка(ИсправляемыйДокументПоступления)
	Иначе
		ЭлементыФормы.ГиперссылкаИсправляемыйДокументПоступления.Гиперссылка = Ложь;
		ЭлементыФормы.ГиперссылкаИсправляемыйДокументПоступления.Заголовок = "Не указан";
	КонецЕсли;
	
КонецПроцедуры

Функция ЕстьНДСКВосстановлению()
	
	КорректировочныйСчетФактура = ВидОперации = Перечисления.ВидыОперацийИсправленияПоступленияРеализации.СогласованноеИзменение;
	ИсправлениеКорректировочногоСчетаФактуры = (ВидОперации = Перечисления.ВидыОперацийИсправленияПоступленияРеализации.ИсправлениеОшибки)
		И ТипЗнч(ИсправляемыйДокументПоступления) = Тип("ДокументСсылка.КорректировкаПоступления");
		
	Если НЕ КорректировочныйСчетФактура И НЕ ИсправлениеКорректировочногоСчетаФактуры Тогда
		Возврат Ложь;
	Иначе
		Возврат Истина;
	КонецЕсли;         	
	
КонецФункции	

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

// Процедура - обработчик события "ПередОткрытием" формы.
//
Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	// Установка кнопок заполнение ТЧ
	//УстановитьКнопкиПодменюЗаполненияТЧ();
	
КонецПроцедуры // ПередОткрытием()

// Процедура - обработчик события "ПриОткрытии" формы
//
Процедура ПриОткрытии()
	
	
	яштФормаДокументаПриОткрытии(ЭтотОбъект, ЭтаФорма);
	
	Если ЭтоНовый() Тогда // проверить объект на то, что он еще не внесен в ИБ

		// Заполнить реквизиты значениями по умолчанию.
		Если ЗначениеНеЗаполнено(ПараметрОснование) Тогда
			ЗаполнитьШапкуДокумента(ЭтотОбъект, глТекущийПользователь, мВалютаРегламентированногоУчета, "Покупка");
		КонецЕсли;
        ВидОперации = Перечисления.ВидыОперацийИсправленияПоступленияРеализации.СогласованноеИзменение;
		
		РегистрироватьЦеныПоставщика = ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "РегистрироватьЦеныПоставщика");
		УстановитьНомерДокумента(ЭтотОбъект);

		Если Не ЗначениеНеЗаполнено(ПараметрОснование)
		   И ТипЗнч(ПараметрОснование) = Тип("ДокументСсылка.ПриходныйОрдерНаТовары") Тогда
			ОтражатьВУправленческомУчете = Истина;
		КонецЕсли;

		Если НЕ ЗначениеНеЗаполнено(ДоговорКонтрагента)
		   И ДоговорКонтрагента.ВидДоговора = Перечисления.ВидыДоговоровКонтрагентов.СКомитентом Тогда
			ОтражатьВНалоговомУчете = Ложь;
		КонецЕсли;
		
		
	КонецЕсли;
	
	мДокументПоступленияСсылка = ПолучитьИсправляемыйДокументПоступления(ДокументПоступления, Истина);
	мКорректировкаПоступленияДопРасходов = (ТипЗнч(мДокументПоступленияСсылка) = Тип("ДокументСсылка.ПоступлениеДопРасходов"));
	
	СтруктураКолонок = Новый Структура();
	
	// Заполняем подменю, вызываемое нажатием кнопки "Операция" командной панели 
	// формы, значениями перечисления "Вид операции" данного вида документа.
	// В качестве обработки выбора вида операции назначается процедура 
	// ДействияФормыДействиеУстановитьОперацию модуля формы.
	УстановитьПодменюВыбораВидаОперации(ЭлементыФормы.ДействияФормы.Кнопки.ПодменюВидаОперации,
		ВидОперации.Метаданные().ЗначенияПеречисления,
		Новый Действие("ДействияФормыДействиеУстановитьОперацию"));
	
	УстановитьЗаголовокФормыДокумента(Строка(ВидОперации), ЭтотОбъект, ЭтаФорма);
	
	// Определить счет-фактуру, введенный на основании этого документа, если такой 
	// счет-фактура существует.
	ЗаполнитьТекстПроСчетФактуру();
	
	// Заполним гиперссылку на исправляемый документ
	ЗаполнитьТекстИсправляемыйДокументПоступления();
	
	// Запомнить текущие значения реквизитов формы.
	мТекущаяДатаДокумента        = Дата;
	мТекущаяОрганизация          = Организация; 
	мТекущаяВалютаВзаиморасчетов = ДоговорКонтрагента.ВалютаВзаиморасчетов;
	
	ПриИзмененииОблагаетсяЕНВД();
	
	// Установить видимость колонок "ХарактеристикаНоменклатуры" и "СерияНоменклатуры"
	УстановитьВидимостьХарактеристикиНоменклатуры(мКолонкиТовары);
	УстановитьВидимостьСерииНоменклатуры(мКолонкиТовары);
	
	// Установить доступность изменения реквизита КорректироватьБУиНУ 
	ЭлементыФормы.КорректироватьБУиНУ.Доступность = ДоступнаКорректировкаБУиНУ();
	
	// Установить видимость реквизитов и заголовков колонок.
	УстановитьВидимость();
	
КонецПроцедуры // ПриОткрытии()

// Процедура - обработчик события "ОбновлениеОтображения" формы.
//
Процедура ОбновлениеОтображения()

	// Пересчитаем сумму взаиморасчетов.
	Если КурсВзаиморасчетов = 0 Тогда
		ЭлементыФормы.СуммаВзаиморасчетов.Значение = 0;
	Иначе
		ЭлементыФормы.СуммаВзаиморасчетов.Значение = ФорматСумм(ПересчитатьИзВалютыВВалюту(ПолучитьСуммуДокументаСНДС(ЭтотОбъект),  
													ВалютаДокумента, мТекущаяВалютаВзаиморасчетов,
													КурсДокумента(ЭтотОбъект, мВалютаРегламентированногоУчета) , КурсВзаиморасчетов,
													КратностьДокумента(ЭтотОбъект, мВалютаРегламентированногоУчета), КратностьВзаиморасчетов));
	КонецЕсли;
	
	УстановитьНадписьСуммыВзаиморасчетов(ЭтотОбъект, ЭтаФорма);
	ЭлементыФормы.ИнфНадписьКурса.Заголовок = "   ( " + ПолучитьИнформациюКурсаВалютыСтрокой(мТекущаяВалютаВзаиморасчетов, 
	                                                                                           КурсВзаиморасчетов,
	                                                                                           КратностьВзаиморасчетов,
	                                                                                           мВалютаРегламентированногоУчета) + " )";
	
	ОбновитьПодвал();

	// Подсчитаем количество строк в табличных частях.
	СтраницаПанели = ЭлементыФормы.ОсновнаяПанель.Страницы;
	СтраницаПанели.Товары.Заголовок = "Товары (" + ДокументОбъект.Товары.Количество() + " поз.)";
	СтраницаПанели.Услуги.Заголовок = "Услуги (" + ДокументОбъект.Услуги.Количество() + " поз.)";
	СтраницаПанели.СебестоимостьРеализации.Заголовок = "Себестоимость реализации (" + ДокументОбъект.КорректировкаРеализации.Количество() + " поз.)";
	
	//ОбновитьПодвал();

	//// Подсчитаем количество строк в табличных частях.
	//СтраницаПанели = ЭлементыФормы.ОсновнаяПанель.Страницы;
	//СтраницаПанели.Товары.Заголовок = "Товары (" + ДокументОбъект.Товары.Количество() + " поз.)";
	//СтраницаПанели.Услуги.Заголовок = "Услуги (" + ДокументОбъект.Услуги.Количество() + " поз.)";
	
КонецПроцедуры // ОбновлениеОтображения()

// Процедура - обработчик события "ОбработкаВыбора" формы.
//
Процедура ОбработкаВыбора(ЗначениеВыбора, Источник)
	
	Перем Команда;
	
	Если ТипЗнч(ЗначениеВыбора) = Тип("Структура") Тогда
		ЗначениеВыбора.Свойство("Команда", Команда);
		
		Если Команда = "ПодборВТабличнуюЧастьТовары" Тогда
			ОбработкаПодбора(Товары, ЗначениеВыбора);
			
		ИначеЕсли Команда = "ПодборВТабличнуюЧастьУслуги" Тогда
			ОбработкаПодбора(Услуги, ЗначениеВыбора);
			
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры // ОбработкаВыбора()

// Процедура - обработчик события "ПослеЗаписи" формы.
//
Процедура ПослеЗаписи()
	
	// Вывести в заголовке формы вид операции и статус документа (новый, не проведен, проведен).
	УстановитьЗаголовокФормыДокумента(Строка(ВидОперации), ЭтотОбъект, ЭтаФорма);
	//МеханизмНумерацииОбъектов.ОбновитьПодсказкуКодНомерОбъекта(ЭтотОбъект.Метаданные(), ЭлементыФормы.ДействияФормы.Кнопки.Подменю1, ЭлементыФормы.Номер);

КонецПроцедуры // ПослеЗаписи()

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ДЕЙСТВИЯ КОМАНДНЫХ ПАНЕЛЕЙ ФОРМЫ

// Процедура вызывается при нажатии кнопки "Подбор" командной панели
// табличного поля "Товары", вызывает сервисный механизм для
// подбора номеклатуры в табличную часть "Товары".
//
Процедура КоманднаяПанельТоварыДействиеПодбор(Кнопка)

	ДействиеПодбор(Товары);

КонецПроцедуры // КоманднаяПанельТоварыДействиеПодбор()

// Процедура вызывается при нажатии кнопки "Подбор" командной панели
// табличного поля "Услуги", вызывает сервисный механизм для
// подбора номеклатуры в табличную часть "Услуги".
//
Процедура КоманднаяПанельУслугиДействиеПодбор(Кнопка)

	ДействиеПодбор(Услуги);

КонецПроцедуры // КоманднаяПанельУслугиДействиеПодбор()

// Процедура вызывается при выборе пункта подменю "ПодменюВидаОперации" командной панели
// формы. Процедура устанавливает значение реквизита ВидОперации.
//
// Обработчик уставливается динамически методом "Действие"
Процедура ДействияФормыДействиеУстановитьОперацию(Кнопка)
	
	ПредыдущийВидОперации = ВидОперации; //Сохраним пред. вид операции для его сравнения с новым
	
	Если Кнопка <> Неопределено Тогда // найти новое значение вида операции
		ВидОперации = Перечисления.ВидыОперацийИсправленияПоступленияРеализации[Кнопка.Имя];
	КонецЕсли;
	
	// Если операция не поменялась то выходим
	Если ПредыдущийВидОперации = ВидОперации Тогда 
		Возврат;
	КонецЕсли;
	
	КорректировкаКорректировочногоСчетаФактуры = Ложь;

	Если ВидОперации = Перечисления.ВидыОперацийИсправленияПоступленияРеализации.СогласованноеИзменение Тогда
		Если КорректировкаКорректировочногоСчетаФактуры Тогда
			ИсправляемыйДокументПоступления = ПолучитьИсправляемыйДокументПоступления(ДокументПоступления, Ложь);
		Иначе
			ИсправляемыйДокументПоступления = ПолучитьИсправляемыйДокументПоступления(ДокументПоступления, Истина);
		КонецЕсли;	
	Иначе
		ИсправляемыйДокументПоступления = ПолучитьИсправляемыйДокументПоступления(ДокументПоступления, Ложь);
	КонецЕсли;

	Если ВидОперации = Перечисления.ВидыОперацийИсправленияПоступленияРеализации.СогласованноеИзменение Тогда
		
		Для Каждого СтрокаТЧ из Товары Цикл
			Если СтрокаТЧ.ЕстьВДокументеПоступления И СтрокаТЧ.СтавкаНДС <> СтрокаТЧ.СтавкаНДСДоИзменения Тогда
				СтрокаТЧ.СтавкаНДС = СтрокаТЧ.СтавкаНДСДоИзменения;
			КонецЕсли;
		КонецЦикла;
		
		Для Каждого СтрокаТЧ из Услуги Цикл
			
			Если СтрокаТЧ.ЕстьВДокументеПоступления И СтрокаТЧ.СтавкаНДС <> СтрокаТЧ.СтавкаНДСДоИзменения Тогда
				СтрокаТЧ.СтавкаНДС = СтрокаТЧ.СтавкаНДСДоИзменения;
			КонецЕсли;
			
		КонецЦикла;
		
	КонецЕсли;
	
	// Отобразить в заголовке формы вид операции.
	УстановитьЗаголовокФормыДокумента(Строка(ВидОперации), ЭтотОбъект, ЭтаФорма);
	
	УстановитьВидимость();
	
КонецПроцедуры // ДействияФормыДействиеУстановитьОперацию()

// Процедура вызывается при выборе пункта подменю "Движения документа по регистрам" меню "Перейти".
// командной панели формы. Процедура отрабатывает печать движений документа по регистрам.
//
Процедура ДействияФормыДвиженияДокументаПоРегистрам(Кнопка)
	
	НапечататьДвиженияДокумента(Ссылка);
	
КонецПроцедуры // ДействияФормыДвиженияДокументаПоРегистрам()

// Процедура вызова структуры подчиненности документа
Процедура ДействияФормыСтруктураПодчиненностиДокумента(Кнопка)
	
	ПоказатьСтруктуруПодчиненностиДокумента(Ссылка);
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ ОБРАБОТКИ СВОЙСТВ И КАТЕГОРИЙ

// Процедура выполняет открытие формы работы со свойствами документа
//
Процедура ДействияФормыДействиеОткрытьСвойства(Кнопка)

	ОткрытьСвойстваДокумента(ЭтотОбъект, ЭтаФорма);

КонецПроцедуры

// Процедура выполняет открытие формы работы с категориями документа
//
Процедура ДействияФормыДействиеОткрытьКатегории(Кнопка)

	ОткрытьКатегорииДокумента(ЭтотОбъект, ЭтаФорма);

КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ РЕКВИЗИТОВ ШАПКИ

// Процедура - обработчик события "ПриИзменении" поля ввода даты документа.
//
Процедура ДатаПриИзменении(Элемент)
	
	ПроверитьНомерДокумента(ЭтотОбъект, мТекущаяДатаДокумента);
	//МеханизмНумерацииОбъектов.ОбновитьПодсказкуКодНомерОбъекта(ЭтотОбъект.Метаданные(), ЭлементыФормы.ДействияФормы.Кнопки.Подменю1, ЭлементыФормы.Номер);
	ПриИзмененииЗначенияДатыДокумента(ЭтотОбъект, мВалютаРегламентированногоУчета);
	ПриИзмененииОблагаетсяЕНВД("ДатаДокумента");

	мТекущаяДатаДокумента = Дата; // запомним текущую дату документа для контроля номера документа

КонецПроцедуры // ДатаПриИзменении()

// Процедура - обработчик события "ПриИзменении" поля ввода организации.
//
Процедура ОрганизацияПриИзменении(Элемент)
	
	Если ЗначениеЗаполнено(ДокументПоступления)
		И ЗначениеЗаполнено(Организация)
		И Организация <> ДокументПоступления.Организация Тогда
		
		Если Вопрос("Организация не соответствует организации основания. Основание будет очищено. Продолжить?", РежимДиалогаВопрос.ДаНет) = КодВозвратаДиалога.Нет Тогда
			Организация = мТекущаяОрганизация;
			Возврат;
		КонецЕсли;
		
		ДокументПоступления = Неопределено;
		
	КонецЕсли;
	
	ПриИзмененииОрганизации();
	
КонецПроцедуры // ОрганизацияПриИзменении()

// Процедура - обработчик события "ПриИзменении" поля ввода ДокументПоступления.
//
Процедура ДокументПоступленияПриИзменении(Элемент)
	
	СтруктураЗаполнения = Новый Структура();
	СтруктураЗаполнения.Вставить("ДокументОснование", ДокументПоступления);
	СтруктураЗаполнения.Вставить("ПерезаполнятьДокумент", Истина);
	СтруктураЗаполнения.Вставить("ИнтерактивноеЗаполнение", Истина);
	Заполнить(СтруктураЗаполнения);
	
	ЭлементыФормы.КорректироватьБУиНУ.Доступность = ДоступнаКорректировкаБУиНУ();
	мКорректировкаПоступленияДопРасходов = (ТипЗнч(мДокументПоступленияСсылка) = Тип("ДокументСсылка.ПоступлениеДопРасходов"));
	
	ЗаполнитьТекстИсправляемыйДокументПоступления();
	УстановитьВидимость();
	мТекущаяВалютаВзаиморасчетов = ДоговорКонтрагента.ВалютаВзаиморасчетов;
	Если Организация <> мТекущаяОрганизация Тогда
		ПриИзмененииОрганизации();
	КонецЕсли;
	
КонецПроцедуры

// Процедура - обработчик события "НачалоВыбора" поля ввода ДокументПоступления.
//
Процедура ДокументПоступленияНачалоВыбора(Элемент, СтандартнаяОбработка)
	
	Отбор = Новый Структура();
	Отбор.Вставить("Организация", Организация);
	
	НачалоВыбораЗначенияДокументаСоставногоТипа(ЭтотОбъект, ЭтаФорма, Элемент, СтандартнаяОбработка, Отбор, "");
	
КонецПроцедуры

Процедура ИсправляемыйДокументПоступленияНажатие(Элемент)
	
	Если ЗначениеЗаполнено(ИсправляемыйДокументПоступления) Тогда
		ИсправляемыйДокументПоступления.ПолучитьФорму().Открыть();
	КонецЕсли;
	
КонецПроцедуры

// Процедура - обработчик события "Нажатие" надписи о счете-фактуре.
//   Процедура выполняет либо ввод нового счета-фактуры, либо открывает
// форму уже существующего счета-фактуры, если тот был введен на основании
// текущего документа.
//
Процедура ГиперссылкаСчетФактураНажатие(Элемент)
	
	ВвестиСчетФактуру(ЭтотОбъект, ЭтаФорма, "СчетФактураПолученный");
	
КонецПроцедуры // ГиперссылкаСчетФактураНажатие()

// Процедура - обработчик события "ПриИзменении" переключателя КорректироватьБУиНУ
Процедура КорректироватьБУиНУПриИзменении(Элемент)
	
	Если КорректироватьБУиНУ И ЗначениеЗаполнено(ДокументПоступления) Тогда
		Если Вопрос("Перезаполнить документ по основанию?", РежимДиалогаВопрос.ДаНет) = КодВозвратаДиалога.Да Тогда
			ЗаполнитьСвойстваШапки();
			ЗаполнитьПоДокументу();
		Иначе
			КорректироватьБУиНУ = Ложь;
			Возврат;
		КонецЕсли;
	КонецЕсли;
	УстановитьВидимость();
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ РЕКВИЗИТОВ ТЧ ТОВАРЫ

// Процедура - обработчик события "ПриПолученииДанных" табличной части "Товары".
//
Процедура ТоварыПриПолученииДанных(Элемент, ОформленияСтрок)
	
	ПриПолученииДанныхСтрокиТЧ(Элемент, "Товары", ОформленияСтрок);
	
КонецПроцедуры

// Процедура - обработчик события "ПриНачалеРедактирования" поля табличной части "Товары"
//
Процедура ТоварыПриНачалеРедактирования(Элемент, НоваяСтрока)
	
	ПриНачалеРедактированияСтрокиТЧ(Элемент, "Товары", НоваяСтрока);
	
КонецПроцедуры // ТоварыПриНачалеРедактирования

// Процедура - обработчик события "ПередУдалением" табличной части "Товары"
//
Процедура ТоварыПередУдалением(Элемент, Отказ)
	
	СтрокаТЧ = ЭлементыФормы.Товары.ТекущиеДанные;
	Если СтрокаТЧ.ЕстьВДокументеПоступления И КорректироватьБУиНУ Тогда
		Отказ = Истина;
		Сообщить("Для удаления строки исходного документа необходимо очистить все суммовые и количественные показатели.");
	КонецЕсли;
	
КонецПроцедуры

// Процедура - обработчик события "НачалоВыбора" поля ввода номенклатуры
// в строке табличной части "Товары".
//
Процедура ТоварыНоменклатураНачалоВыбора(Элемент, СтандартнаяОбработка)
	
	СтрокаТабличнойЧасти = ЭлементыФормы.Товары.ТекущиеДанные;
	
	НачалоВыбораНоменклатурыКонтрагента(Элемент, СтандартнаяОбработка, Контрагент, СтрокаТабличнойЧасти.Номенклатура);
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода номенклатуры
// в строке табличной части "Товары".
//
Процедура ТоварыНоменклатураПриИзменении(Элемент)
	СтрокаТабличнойЧасти = ЭлементыФормы.Товары.ТекущиеДанные;

	// Выполнить общие действия для всех документов при изменении номенклатуры.
	ПриИзмененииНоменклатурыТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);

	// Заполняем реквизиты табличной части.
	ЗаполнитьСтавкуНДСТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект); 

	СтруктураШапкиДокумента = Новый Структура("Контрагент, ТипЦен, ДоговорКонтрагента, ДатаДокумента, ВалютаДокумента, УчитыватьНДС, СуммаВключаетНДС",
	                                         Контрагент, ТипЦен, ДоговорКонтрагента, Дата,ВалютаДокумента, УчитыватьНДС,СуммаВключаетНДС);
	ЗаполнитьЕдиницуЦенуПокупкиТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект, СтруктураШапкиДокумента, мВалютаРегламентированногоУчета); 

	// Рассчитываем реквизиты табличной части.
	РассчитатьСуммуТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);
	РассчитатьСуммуНДСТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);
	
КонецПроцедуры // ТоварыНоменклатураПриИзменении()

// Процедура - обработчик события "ПриИзменении" поля ввода характеристики номенклатуры
// в строке табличной части "Товары".
//
Процедура ТоварыХарактеристикаНоменклатурыПриИзменении(Элемент)

	СтрокаТабличнойЧасти = ЭлементыФормы.Товары.ТекущиеДанные;

	СтруктураШапкиДокумента = Новый Структура("Контрагент, ТипЦен, ДоговорКонтрагента, ДатаДокумента, ВалютаДокумента, УчитыватьНДС, СуммаВключаетНДС",
	                                         Контрагент, ТипЦен, ДоговорКонтрагента, Дата,ВалютаДокумента, УчитыватьНДС,СуммаВключаетНДС);
	ЗаполнитьЕдиницуЦенуПокупкиТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект, СтруктураШапкиДокумента, мВалютаРегламентированногоУчета); 

	// Рассчитываем реквизиты табличной части.
	РассчитатьСуммуТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);
	РассчитатьСуммуНДСТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);

КонецПроцедуры // ТоварыХарактеристикаНоменклатурыПриИзменении()

// Процедура - обработчик события "ПриИзменении" поля ввода серии номенклатуры
// в строке табличной части "Товары".
//
Процедура ТоварыСерияНоменклатурыПриИзменении(Элемент)

	СтрокаТабличнойЧасти = ЭлементыФормы.Товары.ТекущиеДанные;
	Если НЕ ЗначениеЗаполнено(СтрокаТабличнойЧасти.Номенклатура) Тогда
		СтрокаТабличнойЧасти.Номенклатура = Элемент.Значение.Владелец;
	КонецЕсли;

КонецПроцедуры // ТоварыЕдиницаПриИзменении()

// Процедура - обработчик события "ПриИзменении" поля ввода единицы
// в строке табличной части "Товары".
//
Процедура ТоварыЕдиницаПриИзменении(Элемент)

	// Выполнить общие действия для всех документов при изменении Единица.
	ПриИзмененииЕдиницыТабЧасти(ЭлементыФормы.Товары.ТекущиеДанные, ЭтотОбъект);

	// Рассчитать реквизиты табличной части.
	РассчитатьСуммуТабЧасти(ЭлементыФормы.Товары.ТекущиеДанные, ЭтотОбъект);
	РассчитатьСуммуНДСТабЧасти(ЭлементыФормы.Товары.ТекущиеДанные, ЭтотОбъект);

КонецПроцедуры // ТоварыЕдиницаПриИзменении()

// Процедура - обработчик события "ПриИзменении" поля ввода единицы мест
// в строке табличной части "Товары".
//
Процедура ТоварыЕдиницаМестПриИзменении(Элемент)

	// Выполнить общие действия для всех документов при изменении ЕдиницаМест.
	ПриИзмененииЕдиницыМестТабЧасти(ЭлементыФормы.Товары.ТекущиеДанные, ЭтотОбъект);

КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода цены
// в строке табличной части "Товары".
//
Процедура ТоварыЦенаПриИзменении(Элемент)
	
	ПриИзмененииЦеныТЧ(Элемент, "Товары");
	
КонецПроцедуры // ТоварыЦенаПриИзменении()

// Процедура - обработчик события "ПриИзменении" поля ввода количества
// в строке табличной части "Товары".
//
Процедура ТоварыКоличествоПриИзменении(Элемент)
	
	ПриИзмененииКоличестваТЧ(Элемент, "Товары");
	
КонецПроцедуры // ТоварыКоличествоПриИзменении()

// Процедура - обработчик события "ПриИзменении" поля ввода количества мест
// в строке табличной части "Товары".
//
Процедура ТоварыКоличествоМестПриИзменении(Элемент)

	// Рассчитать новое количество
	РассчитатьКоличествоТабЧасти(ЭлементыФормы.Товары.ТекущиеДанные, ЭтотОбъект);
	РассчитатьСуммуТабЧасти(ЭлементыФормы.Товары.ТекущиеДанные, ЭтотОбъект);
	РассчитатьСуммуНДСТабЧасти(ЭлементыФормы.Товары.ТекущиеДанные, ЭтотОбъект);

КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода ставки НДС
// в строке табличной части "Товары".
//
Процедура ТоварыСтавкаНДСПриИзменении(Элемент)
	
	ПриИзмененииСтавкиНДСТЧ(Элемент, "Товары");
	
КонецПроцедуры // ТоварыСтавкаНДСПриИзменении()

// Процедура - обработчик события "ПриИзменении" поля ввода суммы
// в строке табличной части "Товары".
//
Процедура ТоварыСуммаПриИзменении(Элемент)
	
	ПриИзмененииСуммыТЧ(Элемент, "Товары");
	
КонецПроцедуры // ТоварыСуммаПриИзменении()

// Процедура - обработчик события "НачалоВыбора" поля ввода ЗаказПокупателя
// в строке табличной части "Товары".
//
Процедура ТоварыЗаказПокупателяНачалоВыбора(Элемент, СтандартнаяОбработка)
		
	НачалоВыбораДокументаЗаказа(ЭтотОбъект, ЭтаФорма, Элемент, СтандартнаяОбработка, Новый Структура(), "Товары");
	
КонецПроцедуры

// Процедура - обработчик события "ПослеУдаления" поля табличной части "Товары"
//
Процедура ТоварыПослеУдаления(Элемент)
	
	//мПараметрыСвязиСтрокТЧ["Товары"].ФлагМодификации = Истина;
	
КонецПроцедуры //ТоварыПослеУдаления()

// Процедура - обработчик события "НачалоВыбора" поля ввода "Склад"
// в строке табличной части "Товары".
Процедура ТоварыСкладНачалоВыбора(Элемент, СтандартнаяОбработка)
	
	НачалоВыбораСкладаНТТ(ЭтотОбъект, ЭтаФорма, Элемент, СкладОрдер, ВидСравнения.НеРавно, СтандартнаяОбработка);
	
КонецПроцедуры

// Процедура - обработчик события "ОбработкаВыбора" табличной части "Товары"
//
Процедура ТоварыОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	
	ЭлементыФормы.Товары.ТекущаяСтрока.СерияНоменклатуры = ВыбранноеЗначение;
	
КонецПроцедуры

// Процедура - обработчик события "НачалоВыбора" поля ввода Приходного ордера
//
Процедура ТоварыПриходныйОрдерНачалоВыбора(Элемент, СтандартнаяОбработка)
	
	//НачалоВыбораПриходногоОрдера(Элемент, СтандартнаяОбработка, Организация, Перечисления.ВидыОперацийПриходныйОрдер.ОтПоставщика);
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода Приходного ордера
//
Процедура ТоварыПриходныйОрдерПриИзменении(Элемент)
	
	//если склад из шапки - значит его не видно в табличной части.
	//	ничего не надо спрашивать
	Если мСкладИзШапки Тогда
		Возврат;
	КонецЕсли;
	
	СтрокаТабличнойЧасти=ЭлементыФормы.Товары.ТекущиеДанные;
	
	ПриИзмененииПриходногоОрдераВТабличнойЧасти(СтрокаТабличнойЧасти);
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода КоличествоДоКорректировки
//
Процедура ТоварыКоличествоДоКорректировкиПриИзменении(Элемент)
	
	ПриИзмененииКоличестваТЧ(Элемент, "Товары", "ДоКорректировки");
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода КоличествоДоИзменения
//
Процедура ТоварыКоличествоДоИзмененияПриИзменении(Элемент)
	
	ПриИзмененииКоличестваТЧ(Элемент, "Товары", "ДоИзменения");
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода ЦенаДоКорректировки
//
Процедура ТоварыЦенаДоКорректировкиПриИзменении(Элемент)
	
	ПриИзмененииЦеныТЧ(Элемент, "Товары", "ДоКорректировки");
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода ЦенаДоИзменения
//
Процедура ТоварыЦенаДоИзмененияПриИзменении(Элемент)
	
	ПриИзмененииЦеныТЧ(Элемент, "Товары", "ДоИзменения");
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода СуммаДоКорректировки
//
Процедура ТоварыСуммаДоКорректировкиПриИзменении(Элемент)
	
	ПриИзмененииСуммыТЧ(Элемент, "Товары", "ДоКорректировки");
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода СуммаДоИзменения
//
Процедура ТоварыСуммаДоИзмененияПриИзменении(Элемент)
	
	ПриИзмененииСуммыТЧ(Элемент, "Товары", "ДоИзменения");
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода СтавкаНДСДоИзменения
//
Процедура ТоварыСтавкаНДСДоИзмененияПриИзменении(Элемент)
	
	ПриИзмененииСтавкиНДСТЧ(Элемент, "Товары", "ДоИзменения");
	
КонецПроцедуры

// Процедура - обработчик события "НачалоВыбора" поля ввода ДокументПартии
//
Процедура ТоварыДокументПартииНачалоВыбора(Элемент, СтандартнаяОбработка)
	
	НачалоВыбораЗначенияДокументаСоставногоТипа(ЭтотОбъект, ЭтаФорма, Элемент, СтандартнаяОбработка, Новый Структура(), "Товары");
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ РЕКВИЗИТОВ ТЧ УСЛУГИ

// Процедура - обработчик события "ПриПолученииДанных" поля табличной части "Услуги"
//
Процедура УслугиПриПолученииДанных(Элемент, ОформленияСтрок)
	
	ПриПолученииДанныхСтрокиТЧ(Элемент, "Услуги", ОформленияСтрок);
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода количества
// в строке табличной части "Товары".
//
Процедура УслугиКоличествоПриИзменении(Элемент)
	
	ПриИзмененииКоличестваТЧ(Элемент, "Услуги");
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода количества
// в строке табличной части "Товары".
//
Процедура УслугиЦенаПриИзменении(Элемент)
	
	ПриИзмененииЦеныТЧ(Элемент, "Услуги");
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода суммы
// в строке табличной части "Услуги".
//
Процедура УслугиСуммаПриИзменении(Элемент)
	
	ПриИзмененииСуммыТЧ(Элемент, "Услуги");
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода ставки НДС
// в строке табличной части "Услуги".
//
Процедура УслугиСтавкаНДСПриИзменении(Элемент)
	
	ПриИзмененииСтавкиНДСТЧ(Элемент, "Услуги");
	
КонецПроцедуры

// Процедура - обработчик события "НачалоВыбора" поля ввода "Заказ"
// в строке табличной части "Услуги".
//
Процедура УслугиЗаказНачалоВыбора(Элемент, СтандартнаяОбработка)
		
	НачалоВыбораДокументаЗаказа(ЭтотОбъект, ЭтаФорма, Элемент, СтандартнаяОбработка, Новый Структура(), "Услуги");
	
КонецПроцедуры // УслугиЗаказНачалоВыбора()

// Процедура - обработчик события "ПриИзменении" поля ввода "Номенклатура"
// в строке табличной части "Услуги".
//
Процедура УслугиНоменклатураПриИзменении(Элемент)
	
	СтрокаТабличнойЧасти = ЭлементыФормы.Услуги.ТекущиеДанные;

	// Заполняем реквизиты табличной части.
	ЗаполнитьСодержаниеТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);
	ЗаполнитьСтавкуНДСТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект); 
	СтруктураШапкиДокумента = Новый Структура("Контрагент, ТипЦен, ДоговорКонтрагента, ДатаДокумента, ВалютаДокумента, УчитыватьНДС, СуммаВключаетНДС",
	                                         Контрагент, ТипЦен, ДоговорКонтрагента, Дата,ВалютаДокумента, УчитыватьНДС,СуммаВключаетНДС);
	ЗаполнитьЦенуПокупкиТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект, СтруктураШапкиДокумента, мВалютаРегламентированногоУчета);

	// Рассчитываем реквизиты табличной части.
	РассчитатьСуммуТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);
	РассчитатьСуммуНДСТабЧасти(СтрокаТабличнойЧасти, ЭтотОбъект);

	Если НЕ ЗначениеЗаполнено(СтрокаТабличнойЧасти.СтатьяЗатрат) Тогда
		СтрокаТабличнойЧасти.СтатьяЗатрат = СтрокаТабличнойЧасти.Номенклатура.СтатьяЗатрат;
	КонецЕсли;
	Если НЕ ЗначениеЗаполнено(СтрокаТабличнойЧасти.НоменклатурнаяГруппа) Тогда
		СтрокаТабличнойЧасти.НоменклатурнаяГруппа = СтрокаТабличнойЧасти.Номенклатура.НоменклатурнаяГруппаЗатрат;
	КонецЕсли;
	
КонецПроцедуры // УслугиНоменклатураПриИзменении()

// Процедура - обработчик события "ПередУдалением" табличной части "Услуги".
//
Процедура УслугиПередУдалением(Элемент, Отказ)
	
	СтрокаТЧ = ЭлементыФормы.Услуги.ТекущиеДанные;
	Если СтрокаТЧ.ЕстьВДокументеПоступления И КорректироватьБУиНУ Тогда
		Отказ = Истина;
		Сообщить("Для удаления строки исходного документа необходимо очистить все суммовые и количественные показатели.");
	КонецЕсли;
	
КонецПроцедуры

// Процедура - обработчик события "ПриНачалеРедактирования" поля табличной части "Услуги"
//
Процедура УслугиПриНачалеРедактирования(Элемент, НоваяСтрока, Копирование)
	
	ПриНачалеРедактированияСтрокиТЧ(Элемент, "Услуги", НоваяСтрока);
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода КоличествоДоКорректировки
//
Процедура УслугиКоличествоДоКорректировкиПриИзменении(Элемент)
	
	ПриИзмененииКоличестваТЧ(Элемент, "Услуги", "ДоКорректировки");
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода КоличествоДоИзменения
//
Процедура УслугиКоличествоДоИзмененияПриИзменении(Элемент)
	
	ПриИзмененииКоличестваТЧ(Элемент, "Услуги", "ДоИзменения");
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода ЦенаДоКорректировки
//
Процедура УслугиЦенаДоКорректировкиПриИзменении(Элемент)
	
	ПриИзмененииЦеныТЧ(Элемент, "Услуги", "ДоКорректировки");
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода ЦенаДоИзменения
//
Процедура УслугиЦенаДоИзмененияПриИзменении(Элемент)
	
	ПриИзмененииЦеныТЧ(Элемент, "Услуги", "ДоИзменения");
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода СуммаДоКорректировки
//
Процедура УслугиСуммаДоКорректировкиПриИзменении(Элемент)
	
	ПриИзмененииСуммыТЧ(Элемент, "Услуги", "ДоКорректировки");
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода СуммаДоИзменения
//
Процедура УслугиСуммаДоИзмененияПриИзменении(Элемент)
	
	ПриИзмененииСуммыТЧ(Элемент, "Услуги", "ДоИзменения");
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода СтавкаНДСДоИзменения
//
Процедура УслугиСтавкаНДСДоИзмененияПриИзменении(Элемент)
	
	ПриИзмененииСтавкиНДСТЧ(Элемент, "Услуги", "ДоИзменения");
	
КонецПроцедуры

Процедура ТоварыПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	//Если ДанныеСтроки.КоличествоДоИзменения = ДанныеСтроки.Количество Тогда
	//	ОформлениеСтроки.Ячейки.ОтражатьТоварныйУчет.Текст = "";
	//КонецЕсли;
КонецПроцедуры

Процедура ТоварыПриАктивизацииЯчейки(Элемент)
	//ТекущиеДанные = ЭлементыФормы.Товары.ТекущиеДанные;
	//Если ТекущиеДанные <> Неопределено Тогда
		//Если ЭлементыФормы.Товары.ТекущаяКолонка.Имя = "ОтражатьТоварныйУчет" Тогда
		//	Если ТекущиеДанные.КоличествоДоИзменения = ТекущиеДанные.Количество Тогда
		//		Элемент.Колонки.ОтражатьТоварныйУчет.ТолькоПросмотр = Истина;
		//	Иначе
		//		Элемент.Колонки.ОтражатьТоварныйУчет.ТолькоПросмотр = Ложь;
		//	КонецЕсли;
		//КонецЕсли;
	//КонецЕсли;
КонецПроцедуры

Процедура УслугиПриАктивизацииЯчейки(Элемент)
	//ТекущиеДанные = ЭлементыФормы.Услуги.ТекущиеДанные;
	//Если ТекущиеДанные <> Неопределено Тогда
	//	Если ЭлементыФормы.Услуги.ТекущаяКолонка.Имя = "ОтражатьТоварныйУчет" Тогда
	//		Если ТекущиеДанные.КоличествоДоИзменения = ТекущиеДанные.Количество Тогда
	//			Элемент.Колонки.ОтражатьТоварныйУчет.ТолькоПросмотр = Истина;
	//		Иначе
	//			Элемент.Колонки.ОтражатьТоварныйУчет.ТолькоПросмотр = Ложь;
	//		КонецЕсли;
	//	КонецЕсли;
	//КонецЕсли;
КонецПроцедуры

Процедура УслугиПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	//Если ДанныеСтроки.КоличествоДоИзменения = ДанныеСтроки.Количество Тогда
	//	ОформлениеСтроки.Ячейки.ОтражатьТоварныйУчет.Текст = "";
	//КонецЕсли;
КонецПроцедуры

Процедура ТоварыПриАктивизацииКолонки(Элемент)
	
	//ТекущиеДанные = ЭлементыФормы.Товары.ТекущиеДанные;
	//Если ТекущиеДанные <> Неопределено Тогда
	//	Если ЭлементыФормы.Товары.ТекущаяКолонка.Имя = "ОтражатьТоварныйУчет" Тогда
	//		Если ТекущиеДанные.КоличествоДоИзменения = ТекущиеДанные.Количество Тогда
	//			Элемент.Колонки.ОтражатьТоварныйУчет.ТолькоПросмотр = Истина;
	//		Иначе
	//			Элемент.Колонки.ОтражатьТоварныйУчет.ТолькоПросмотр = Ложь;
	//		КонецЕсли;
	//	КонецЕсли;
	//КонецЕсли;
	
КонецПроцедуры

Процедура КоманднаяПанель1ДействиеЗаполнитьРеализацию(Кнопка)
	
	Если КорректировкаРеализации.Количество()>0 Тогда
		Если Вопрос("Себестоимость реализации будет перезаполнена", РежимДиалогаВопрос.ДаНет) = КодВозвратаДиалога.Нет Тогда
			Возврат;
		КонецЕсли;
	КонецЕсли;
	КорректировкаРеализации.Очистить();
	Для Каждого Стр из Товары Цикл
		Если Стр.Цена <> Стр.ЦенаДоИзменения Тогда
			НовСтр = КорректировкаРеализации.Добавить();
			НовСтр.Номенклатура = Стр.Номенклатура;
			НовСтр.ЦенаДоИзменения = Стр.ЦенаДоИзменения;
			НовСтр.Цена = Стр.Цена;
			НовСтр.Количество = Стр.Количество;
		//		НовСтр.Количество = 1;
		
		НовСтр.СуммаСебестоимостиДоИзменения = Стр.ЦенаДоИзменения*Стр.КоличествоДоИзменения;
			НовСтр.СуммаСебестоимости = Стр.Цена*Стр.Количество;
	//			НовСтр.СуммаСебестоимостиДоИзменения = Стр.ЦенаДоИзменения;
	//		НовСтр.СуммаСебестоимости = Стр.Цена;
		
		КонецЕсли;	
	КонецЦикла;	
		Если ТипЗнч(ДокументПоступления)=Тип("ДокументСсылка.ПоступлениеТоваровУслуг") Тогда 
		ЗаполнитьДокументыРеализации(ДокументПоступления,КорректировкаРеализации);
		ИначеЕсли   ТипЗнч(ДокументПоступления)=Тип("ДокументСсылка.КорректировкаПоступления") тогда
	    ЗаполнитьДокументыРеализации(ДокументПоступления.ДокументПоступления,КорректировкаРеализации);

	КонецЕсли;

	КорректировкаРеализацииКонтроль=КорректировкаРеализации.Выгрузить();
	КорректировкаРеализацииКонтроль.Очистить();
	Для Каждого Строка Из  КорректировкаРеализации Цикл
		Если  ТипЗнч(Строка.ДокументРеализации)=Тип("ДокументСсылка.КомплектацияНоменклатуры") ТОгда
	 ЗаполнитьДокументыРеализацииПоКомплектации(Строка,Строка.ДокументРеализации,КорректировкаРеализацииКонтроль);
//	 ИначеЕсли   ТипЗнч(ДокументПоступления)=Тип("ДокументСсылка.КорректировкаПоступления") тогда
  //    ЗаполнитьДокументыРеализацииПоКомплектации(Строка,ДокументПоступления.ДокументПоступления,КорректировкаРеализацииКонтроль);

	 КонецЕсли;
		КонецЦикла;	
		Для Каждого Строка Из КорректировкаРеализацииКонтроль Цикл
			НоваяСтрока=КорректировкаРеализации.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока,строка);
		    КонецЦикла;
		
	КонецПроцедуры
Процедура ЗаполнитьДокументыРеализацииПоКомплектации(Строка,ПервичныйДокументПоступления,КорректировкаРеализацииКонтроль)
Запрос=Новый Запрос;
 Запрос.УстановитьПараметр("Номенклатура",Строка.ДокументРеализации.Номенклатура);
Запрос.Текст=
"ВЫБРАТЬ
|	Партии.Регистратор КАК документРеализации,
|	Партии.Номенклатура,
|	Партии.КоличествоРасход,
|	Партии.СтоимостьРасход
|ИЗ
|	(ВЫБРАТЬ
|		ВЫБОР
|			КОГДА ПартииТоваровНаСкладахОбороты.Регистратор ССЫЛКА Документ.ПеремещениеТоваров
|				ТОГДА ЛОЖЬ
|			ИНАЧЕ ИСТИНА
|		КОНЕЦ КАК БРАТЬ,
|		ПартииТоваровНаСкладахОбороты.Регистратор КАК Регистратор,
|		ПартииТоваровНаСкладахОбороты.Номенклатура КАК Номенклатура,
|		ПартииТоваровНаСкладахОбороты.КоличествоРасход КАК КоличествоРасход,
|		ПартииТоваровНаСкладахОбороты.СтоимостьРасход КАК СтоимостьРасход
|	ИЗ
|		РегистрНакопления.ПартииТоваровНаСкладах.Обороты(
|				&ДатаНач,
|				&ДатаКон,
|				Регистратор,
|				ДокументОприходования = &ДокументОприходования
|					И Номенклатура = &Номенклатура) КАК ПартииТоваровНаСкладахОбороты
|	ГДЕ
|		НЕ ПартииТоваровНаСкладахОбороты.Регистратор = &ссылка) КАК Партии";
//|ГДЕ
//|	Партии.БРАТЬ";	

Запрос.УстановитьПараметр("ссылка",ЭтотОбъект.Ссылка);
Запрос.УстановитьПараметр("ДатаНач",ПервичныйДокументПоступления.Дата);
Запрос.УстановитьПараметр("ДатаКон",Дата);
Запрос.УстановитьПараметр("ДокументОприходования",ПервичныйДокументПоступления);
Рез=Запрос.Выполнить().Выбрать();
  // КорректировкаРеализацииКонтроль.Очистить();

   Пока рез.Следующий() Цикл
	   
	   НоваяСтрока= КорректировкаРеализацииКонтроль.Добавить();
	   НоваяСтрока.ДокументРеализации=Рез.ДокументРеализации;
	   НоваяСтрока.Количество=Рез.КоличествоРасход;
//	   НОваяСтрока.СуммаСебестоимостиДоИзменения=Рез.КоличествоРасход*Строка.ЦенаДоИзменения;
	   НОваяСтрока.СуммаСебестоимостиДоИзменения=Рез.СтоимостьРасход;
	   
	   НоваяСтрока.СуммаСебестоимости= Рез.СтоимостьРасход-Строка.СуммаСебестоимостиДоИзменения+Строка.СуммаСебестоимости;
	   Если Не НоваяСтрока.Количество=0 ТОгда
	   НОваяСтрока.Цена=НоваяСтрока.СуммаСебестоимости/НоваяСтрока.Количество;
   
   
	   НоваяСтрока.ЦенаДоИзменения=НОваяСтрока.СуммаСебестоимостиДоИзменения/НоваяСтрока.Количество;
   КонецЕсли;  
   НоваяСтрока.Номенклатура=Рез.Номенклатура;
	   НоваяСтрока.ДокументПартии=ПервичныйДокументПоступления;
 КонецЦикла;
	КонецПроцедуры
	
	
	
Процедура ЗаполнитьДокументыРеализации(ПервичныйДокументПоступления,ПервичнаяКорректировкаРеализации)
Таб=Новый ТаблицаЗначений;	
Таб=ПервичнаяКорректировкаРеализации.Выгрузить();
Запрос=Новый Запрос;
Запрос.МенеджерВременныхТаблиц=Новый МенеджерВременныхТаблиц;
Запрос.УстановитьПараметр("ТАБ",ТАБ);
Запрос.Текст=
"ВЫБРАТЬ РАЗЛИЧНЫЕ
|	ТАБ.Номенклатура,
|	ТАБ.ЦенаДоИзменения,
|	ТАБ.Цена
|ПОМЕСТИТЬ ТТ
|ИЗ
|	&ТАБ КАК ТАБ
|;
|
|////////////////////////////////////////////////////////////////////////////////
|ВЫБРАТЬ
|	Партии.Регистратор КАК документРеализации,
|	Партии.Номенклатура,
|	Партии.КоличествоРасход,
|	Партии.СтоимостьРасход,
|	ТТ.ЦенаДоИзменения,
|	ТТ.Цена
|ИЗ
|	(ВЫБРАТЬ
|		ВЫБОР
|			КОГДА ПартииТоваровНаСкладахОбороты.Регистратор ССЫЛКА Документ.ПеремещениеТоваров
|					ИЛИ ПартииТоваровНаСкладахОбороты.Регистратор ССЫЛКА Документ.КорректировкаПоступления
|					ИЛИ ПартииТоваровНаСкладахОбороты.Регистратор ССЫЛКА Документ.КорректировкаЗаписейРегистровНакопления
|				ТОГДА ЛОЖЬ
|			ИНАЧЕ ИСТИНА
|		КОНЕЦ КАК БРАТЬ,
|		ПартииТоваровНаСкладахОбороты.Регистратор КАК Регистратор,
|		ПартииТоваровНаСкладахОбороты.Номенклатура КАК Номенклатура,
|		ПартииТоваровНаСкладахОбороты.КоличествоРасход КАК КоличествоРасход,
|		ПартииТоваровНаСкладахОбороты.СтоимостьРасход КАК СтоимостьРасход
|	ИЗ
|		РегистрНакопления.ПартииТоваровНаСкладах.Обороты(&ДатаНач, &ДатаКон, Регистратор, ДокументОприходования = &ДокументОприходования) КАК ПартииТоваровНаСкладахОбороты
|	ГДЕ
|		НЕ ПартииТоваровНаСкладахОбороты.Регистратор = &ссылка) КАК Партии
|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ТТ КАК ТТ
|		ПО (ТТ.Номенклатура = Партии.Номенклатура)
|ГДЕ
|	Партии.БРАТЬ";	

Запрос.УстановитьПараметр("ссылка",ЭтотОбъект.Ссылка);
Запрос.УстановитьПараметр("ДатаНач",ПервичныйДокументПоступления.Дата);
Запрос.УстановитьПараметр("ДатаКон",Дата);
Запрос.УстановитьПараметр("ДокументОприходования",ПервичныйДокументПоступления);
Рез=Запрос.Выполнить().Выбрать();
   ПервичнаяКорректировкаРеализации.Очистить();

   Пока рез.Следующий() Цикл
	   
	   НоваяСтрока= ПервичнаяКорректировкаРеализации.Добавить();
	   НоваяСтрока.ДокументРеализации=Рез.ДокументРеализации;
	   НоваяСтрока.Количество=Рез.КоличествоРасход;
	   НОваяСтрока.СуммаСебестоимостиДоИзменения=Рез.КоличествоРасход*Рез.ЦенаДоИзменения;
	   НоваяСтрока.СуммаСебестоимости= Рез.КоличествоРасход*Рез.Цена;
	   НОваяСтрока.Цена=Рез.Цена;
	   НоваяСтрока.ЦенаДоИзменения=Рез.ЦенаДоИзменения;
	   НоваяСтрока.Номенклатура=Рез.Номенклатура;
	   НоваяСтрока.ДокументПартии=ПервичныйДокументПоступления;
 КонецЦикла;
	КонецПроцедуры
Процедура КорректировкаРеализацииКоличествоПриИзменении(Элемент)
	
	ТД = ЭлементыФормы.КорректировкаРеализации.ТекущиеДанные;
	ТД.СуммаСебестоимостиДоИзменения = ТД.Количество*ТД.ЦенаДоИзменения;
	ТД.СуммаСебестоимости = ТД.Количество*ТД.Цена;
	
КонецПроцедуры

Процедура КорректировкаРеализацииПриПолученииДанных(Элемент, ОформленияСтрок)
	
	Для Каждого ОформлениеСтроки Из ОформленияСтрок Цикл
		
		ДанныеСтроки = ОформлениеСтроки.ДанныеСтроки;
		
		Если мКолонкиПродажи.Разница.Видимость Тогда
			ТекСумма = ДанныеСтроки.СуммаСебестоимости - ДанныеСтроки.СуммаСебестоимостиДоИзменения;
			ОформлениеСтроки.Ячейки.Разница.УстановитьТекст(ФорматСумм(ТекСумма));
		КонецЕсли;
		ПоказатьКодАртикул(мКолонкиПродажи, ОформлениеСтроки.Ячейки, ДанныеСтроки.Номенклатура);
		
	КонецЦикла;		
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	//яштПроверитьДокументНаНулевоеВремя(ЭтотОбъект, РежимЗаписи, Отказ);
	
КонецПроцедуры


////////////////////////////////////////////////////////////////////////////////
// ОПЕРАТОРЫ ОСНОВНОЙ ПРОГРАММЫ

мКолонкиТовары = ЭлементыФормы.Товары.Колонки;
мКолонкиУслуги = ЭлементыФормы.Услуги.Колонки;
мКолонкиПродажи = ЭлементыФормы.КорректировкаРеализации.Колонки;
мСкладИзШапки  = НЕ мУказаниеСкладовВТЧ;

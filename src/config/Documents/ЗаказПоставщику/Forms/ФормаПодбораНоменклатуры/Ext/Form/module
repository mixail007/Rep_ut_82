
Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	Если НастройкаПериода.Редактировать() Тогда
		НачПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры

Процедура ОсновныеДействияФормыДействие(Кнопка)
	//Запрос=Новый Запрос;
	//Запрос.Текст="ВЫБРАТЬ
	//			 |	РеализацияТоваровУслугТовары.Номенклатура.Код КАК Код,
	//			 |	РеализацияТоваровУслугТовары.Номенклатура,
	//			 |	РеализацияТоваровУслугТовары.Количество,
	//			 |	РеализацияТоваровУслугТовары.Ссылка КАК Реализация,
	//			 |	РеализацияТоваровУслугТовары.Цена,
	//			 |	РеализацияТоваровУслугТовары.Склад КАК СкладРеализации,
	//			 |	ЛОЖЬ КАК флажок,
	//			 |	РеализацияТоваровУслугТовары.СтавкаНДС,
	//			 |	РеализацияТоваровУслугТовары.Коэффициент,
	//			 |	РеализацияТоваровУслугТовары.КоличествоМест,
	//			 |	РеализацияТоваровУслугТовары.ЕдиницаИзмерения,
	//			 |	РеализацияТоваровУслугТовары.ЕдиницаИзмеренияМест
	//			 |ИЗ
	//			 |	Документ.РеализацияТоваровУслуг.Товары КАК РеализацияТоваровУслугТовары
	//			 |ГДЕ
	//			 |	РеализацияТоваровУслугТовары.Ссылка.Проведен = ИСТИНА
	//			 |	И РеализацияТоваровУслугТовары.Ссылка.Дата МЕЖДУ &ДатаН И &ДатаК
	//			 |	И РеализацияТоваровУслугТовары.Ссылка.Контрагент = &Контрагент
	//			 |	//Заменить";
	//			 Запрос.УстановитьПараметр("ДатаН",НачПериода);
	//			 Запрос.УстановитьПараметр("ДатаК",КонецДня(КонПериода));
	//			 Запрос.УстановитьПараметр("Контрагент",Контрагент);
	//			 Запрос.УстановитьПараметр("Номенклатура",Номенклатура);
	//			 Если ЗначениеЗаполнено(Номенклатура) тогда
	//				 Запрос.Текст=СтрЗаменить(Запрос.Текст,"//Заменить","И РеализацияТоваровУслугТовары.Номенклатура = &Номенклатура");
	//			 КонецЕсли;
	//			 Рез=Запрос.Выполнить().Выгрузить();
	//			 Продажи=рез;
	//			 ЭлементыФормы.Продажи.СоздатьКолонки();
	//			 ЭлементыФормы.Продажи.Колонки.Добавить("фл","фл");
	//			 Колонки = ЭлементыФормы.Продажи.Колонки;
	//			 Индекс=Колонки.Индекс(Колонки["фл"]);
	//			 ЭлементыФормы.Продажи.Колонки.Сдвинуть(Колонки["фл"],-Индекс);
	//			 ЭлементыФормы.Продажи.Колонки.фл.РежимРедактирования=РежимРедактированияКолонки.Непосредственно;
	//			 ЭлементыФормы.Продажи.Колонки.фл.ДанныеФлажка="флажок";
	//			 ЭлементыФормы.Продажи.Колонки.флажок.Видимость=ложь;
	
	Запрос=Новый Запрос;
	Запрос.Текст="";
	Если СокрЛП(НомерВхДокумента)<>"" Тогда 
		Запрос.Текст="ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ЗаказПокупателяТовары.Номенклатура,
		|	ЗаказПокупателяТовары.Ссылка
		|ПОМЕСТИТЬ втНомИзЗаказаА
		|ИЗ
		|	Документ.ЗаказПокупателя.Товары КАК ЗаказПокупателяТовары
		|ГДЕ
		|	ЗаказПокупателяТовары.Ссылка.НомерВходящегоДокумента ПОДОБНО &НомерВходящегоДокумента
		|	И ЗаказПокупателяТовары.Ссылка.Контрагент = &Контрагент
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	втНомИзЗаказаА.Номенклатура,
		|	втНомИзЗаказаА.Ссылка,
		|	ЗаказПокупателяЗаказы.Ссылка КАК ЗаказПокупателя
		|ПОМЕСТИТЬ втНомИзЗаказа
		|ИЗ
		|	втНомИзЗаказаА КАК втНомИзЗаказаА
		|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЗаказПокупателя.Заказы КАК ЗаказПокупателяЗаказы
		|		ПО втНомИзЗаказаА.Ссылка = ЗаказПокупателяЗаказы.ЗаказПокупателя
		|;
		|";
	КонецЕсли;
	Запрос.Текст=Запрос.Текст+"ВЫБРАТЬ
	|	РеализацияТоваровУслугТовары.Ссылка КАК Реализация,
	|	РеализацияТоваровУслугТовары.Количество,
	|	РеализацияТоваровУслугТовары.Цена,
	|	РеализацияТоваровУслугТовары.Номенклатура.Код КАК Код,
	|	РеализацияТоваровУслугТовары.Номенклатура,
	|	РеализацияТоваровУслугТовары.Склад КАК СкладРеализации,
	|	РеализацияТоваровУслугТовары.СтавкаНДС,
	|	РеализацияТоваровУслугТовары.Коэффициент,
	|	РеализацияТоваровУслугТовары.КоличествоМест,
	|	РеализацияТоваровУслугТовары.ЕдиницаИзмерения,
	|	РеализацияТоваровУслугТовары.ЕдиницаИзмеренияМест,
	|	ЛОЖЬ КАК флажок,
	|	РеализацияТоваровУслугТовары.Цена КАК Цена1
	|ИЗ
	|	Документ.РеализацияТоваровУслуг.Товары КАК РеализацияТоваровУслугТовары
	|ГДЕ
	|	РеализацияТоваровУслугТовары.Ссылка.Проведен = ИСТИНА
	|	И РеализацияТоваровУслугТовары.Ссылка.Дата МЕЖДУ &ДатаН И &ДатаК
	|	И РеализацияТоваровУслугТовары.Ссылка.Контрагент = &Контрагент
	|	И РеализацияТоваровУслугТовары.Ссылка.Подразделение = &Подразделение
	|    //ЗаменитьНом";
	Если СокрЛП(НомерВхДокумента)<>"" Тогда 
		Запрос.Текст=Запрос.Текст+"
		|И РеализацияТоваровУслугТовары.Номенклатура В
		|			(ВЫБРАТЬ
		|				втномИзЗаказа.Номенклатура
		|			ИЗ
		|				втНомИзЗаказа КАК втномИзЗаказа)
		| И (РеализацияТоваровУслугТовары.Ссылка.Сделка В
		|		(ВЫБРАТЬ
		|			втномИзЗаказа.Ссылка
		|		ИЗ
		|			втНомИзЗаказа КАК втномИзЗаказа)
		|	ИЛИ РеализацияТоваровУслугТовары.Ссылка.Сделка В
		|		(ВЫБРАТЬ
		|			втномИзЗаказа.ЗаказПокупателя
		|		ИЗ
		|			втНомИзЗаказа КАК втномИзЗаказа))";
	КонецЕсли;
	Запрос.УстановитьПараметр("ДатаН",НачПериода);
	КонПер=?(КонПериода=Дата(1,1,1),ТекущаяДата(),КонецДня(КонПериода));
	Запрос.УстановитьПараметр("ДатаК",КонецДня(КонПер));
	Запрос.УстановитьПараметр("Контрагент",Контрагент);
	Запрос.УстановитьПараметр("Номенклатура",Номенклатура);
	Запрос.УстановитьПараметр("Подразделение",?(Подразделение=Справочники.Подразделения.ПустаяСсылка(),Справочники.Подразделения.НайтиПоКоду("00005"),Подразделение));
	Запрос.УстановитьПараметр("НомерВходящегоДокумента",НомерВхДокумента);
	
	
	Если ЗначениеЗаполнено(Номенклатура) тогда
		Запрос.Текст=СтрЗаменить(Запрос.Текст,"//ЗаменитьНом","И РеализацияТоваровУслугТовары.Номенклатура = &Номенклатура");
	КонецЕсли;
	
	Рез=Запрос.Выполнить().Выгрузить();
	Продажи=рез;
	ЭлементыФормы.Продажи.СоздатьКолонки();
	ЭлементыФормы.Продажи.Колонки.Добавить("фл","фл");
	Колонки = ЭлементыФормы.Продажи.Колонки;
	Индекс=Колонки.Индекс(Колонки["фл"]);
	ЭлементыФормы.Продажи.Колонки.Сдвинуть(Колонки["фл"],-Индекс);
	ЭлементыФормы.Продажи.Колонки.фл.РежимРедактирования=РежимРедактированияКолонки.Непосредственно;
	ЭлементыФормы.Продажи.Колонки.фл.ДанныеФлажка="флажок";
	ЭлементыФормы.Продажи.Колонки.флажок.Видимость=ложь;
	
	
КонецПроцедуры

Процедура ОсновныеДействияФормыПеренести(Кнопка)
	Парам=Новый Структура("Команда,ВыбранныеТовары");
	Парам.Команда="ПодборПроданныхТоваров";
	Парам.ВыбранныеТовары=Продажи;
	ОповеститьОВыборе(Парам);
КонецПроцедуры

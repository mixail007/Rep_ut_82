Перем мКолонкиТовары;

Процедура Панель1ПриСменеСтраницы(Элемент, ТекущаяСтраница)
	Если ЭтоНовый() Тогда 
		Возврат
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЗаказыПокупателей.Номенклатура,
	|	ЗаказыПокупателей.ЗаказПокупателя,
	|	ЗаказыПокупателей.Количество,
	|	ЗаказыПокупателей.Номенклатура.Код Код
	|ИЗ
	|	РегистрНакопления.ЗаказыПокупателей КАК ЗаказыПокупателей
	|ГДЕ
	|	ЗаказыПокупателей.Регистратор = &Ссылка";
	
	Запрос.УстановитьПараметр("Ссылка", Ссылка);
	
	РезультатЗапроса = Запрос.Выполнить().Выгрузить();
	СписанныеЗаказы = РезультатЗапроса;
		
КонецПроцедуры

Процедура КоманднаяПанельТоварыПодбор(Кнопка)
	
	Форма = ПолучитьФорму("ФормаВыбораНоменклатуры",ЭлементыФормы.Товары);
	Форма.Заголовок = "Выбор номенклатуры для отмены резерва";
	Форма.РежимВыбора = Истина; 
	Форма.ЗакрыватьПриВыборе = Ложь;
	Форма.Открыть();
	
КонецПроцедуры

Процедура ТоварыОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	
	Если Товары.Найти(ВыбранноеЗначение) <> Неопределено Тогда 
		Предупреждение("Товар """ + ВыбранноеЗначение + """ уже есть в списке.");
		Возврат;
	КонецЕсли;	
	
	НовСтр = Товары.Добавить();
	НовСтр.Номенклатура = ВыбранноеЗначение;
	
КонецПроцедуры

Процедура ТоварыПриПолученииДанных(Элемент, ОформленияСтрок)
	
	Для каждого ОформлениеСтроки из ОформленияСтрок Цикл
		
		ДанныеСтроки = ОформлениеСтроки.ДанныеСтроки;
		
		ПоказатьКодАртикул(мКолонкиТовары, ОформлениеСтроки.Ячейки, ДанныеСтроки.Номенклатура);
		
	КонецЦикла;

КонецПроцедуры

Процедура ПриОткрытии()
	
	Если ЭтоНовый() Тогда // проверить объект на то, что он еще не внесен в ИБ
		
		Контрагент = Справочники.Контрагенты.НайтиПоКоду("П004703");	
		Если Не ЗначениеЗаполнено(ДокументОбъект.Ответственный) Тогда
			ЭтотОбъект.Ответственный = ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "ОсновнойОтветственный");
		КонецЕсли;
		
	иначеЕсли НЕ ( РольДоступна("ПолныеПрава")
		или Контрагент.ОсновнойМенеджерКонтрагента = глТекущийПользователь  ) тогда
		ЭтаФорма.ТолькоПросмотр = истина;
		Предупреждение("У вас недостаточно прав для изменения документа!", 30);
	КонецЕсли;
	
КонецПроцедуры

Процедура КоманднаяПанельТоварыЗаполнитьИзБуфера(Кнопка)
	ЗаполнитьИзБуфера(ЭлементыФормы);
КонецПроцедуры

Процедура ЗаполнитьИзБуфера(ЭлементыФормы) 
	
	ЭлементыФормы.Добавить(Тип("ПолеHTMLДокумента"), "Поле_HTML_Документа_acb123", Ложь);
	Окно = ЭлементыФормы.Поле_HTML_Документа_acb123.Документ.ParentWindow;
	СодержимоеБуфера = Окно.ClipboardData.GetData("Text");
	ЭлементыФормы.Удалить(ЭлементыФормы.Индекс(ЭлементыФормы.Найти("Поле_HTML_Документа_acb123")));
	ТекстБуфера = СодержимоеБуфера; 
	
	СписокОтбора = Новый СписокЗначений;
	
	
	Для Счетчик = 1 По СтрЧислоСтрок(ТекстБуфера) Цикл
		ТекСтрока = СтрПолучитьСтроку(ТекстБуфера, Счетчик);
		СтрокаПоиска = СокрЛП(ТекСтрока);  
		Если СтрокаПоиска <> "" Тогда
			НовСтрокаТовары = Товары.Добавить();
			Разделитель = Найти(ТекСтрока,Символы.Таб);
			Если Разделитель = 0 Тогда
				КодТовара = СокрЛП(ТекСтрока);
			Иначе
				КодТовара = Лев(ТекСтрока,Разделитель-1);
			КонецЕсли;
			
			НовСтрокаТовары.Номенклатура = Справочники.Номенклатура.НайтиПоКоду(КодТовара);
			Если Разделитель = 0 Тогда
            Иначе
				ОстатокСтроки = Прав(ТекСтрока,СтрДлина(ТекСтрока)-Разделитель);
				Разделитель = Найти(ТекСтрока,Символы.Таб);
				Если Разделитель = 0 Тогда
					КоличествоТовара = Число(ОстатокСтроки);
				Иначе
					КоличествоТовара = Число(Лев(ОстатокСтроки,Разделитель-1));
				КонецЕсли;
                НовСтрокаТовары.Количество = КоличествоТовара;
            КонецЕсли;
 		КонецЕсли;	
	КонецЦикла;			

Конецпроцедуры



мКолонкиТовары = ЭлементыФормы.Товары.Колонки;



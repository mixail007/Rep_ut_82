
Процедура ПриОткрытии()
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	ЭтаФорма.Модифицированность = Ложь;
	
	ЭтаФорма.Закрыть();
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	Если ЭтоНовый() Тогда
		Если ЗаказПокупателя.Контрагент = Справочники.Контрагенты.НайтиПоКоду("П004703") тогда
			Сообщить("Нельзя вводить закрытие заказа на основании заказа по контрагенту ""Резерв для Им""" );
			Отказ = Истина;
		КонецЕсли;
	КонецЕсли;

КонецПроцедуры

Процедура ПослеЗаписи()   //отмена проведения ТОЛЬКО из Формы!
		
	//+++ 17.11.2016 закрытие ТоварыВОжиданииОтПоставщика
	Если Константы.ИспользоватьДележкуЗаказовВМинус.Получить() тогда

		Если НЕ Проведен тогда // обратное распроведение... 
			
		Запрос = Новый Запрос; // заказано есть... 
		Запрос.Текст = "ВЫБРАТЬ
		               |	ЗаказыПокупателей.Номенклатура,
		               |	0 КАК Количество
		               |ИЗ
		               |	РегистрНакопления.ЗаказыПокупателей.Остатки(, ЗаказПокупателя = &ЗаказПокупателя) КАК ЗаказыПокупателей";
 		Запрос.УстановитьПараметр("ЗаказПокупателя",  Ссылка.ЗаказПокупателя);
		ТаблТов = Запрос.Выполнить().Выгрузить();

		//--------- обратное распределение по этим товарам - на другие заказы ------------------	
		ОбменСУТИнтернетМагазин.ДвижениеТоваровВОжидании( таблТов,  Ссылка.ЗаказПокупателя.Подразделение );
		КонецЕсли;	
	КонецЕсли;

КонецПроцедуры

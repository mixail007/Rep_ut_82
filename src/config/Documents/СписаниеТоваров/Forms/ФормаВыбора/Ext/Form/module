// Процедура вызывается при выборе пункта подменю "Движения документа по регистрам" меню "Перейти".
// командной панели формы. Процедура отрабатывает печать движений документа по регистрам.
//
Процедура ДействияФормыДвиженияДокументаПоРегистрам(Кнопка)

	Если ЭлементыФормы.ДокументСписок.ТекущиеДанные = Неопределено тогда
		Возврат
	КонецЕсли;

	НапечататьДвиженияДокумента(ЭлементыФормы.ДокументСписок.ТекущиеДанные.Ссылка);

КонецПроцедуры // ДействияФормыДвиженияДокументаПоРегистрам()

// Процедура вызывается при выборе пункта подменю "Структура подчиненности" меню "Перейти".
Процедура ДействияФормыСтруктураПодчиненностиДокумента(Кнопка)
	
	Если ЭлементыФормы.ДокументСписок.ТекущиеДанные = Неопределено тогда
		Возврат
	КонецЕсли;
	
	ПоказатьСтруктуруПодчиненностиДокумента(ЭтаФорма.ЭлементыФормы.ДокументСписок.ТекущаяСтрока);
	
КонецПроцедуры

Процедура ПриОткрытии()
	
	Если ПолучитьЗначениеПоУмолчанию(ПараметрыСеанса.ТекущийПользователь, "УчетТолькоПоПодразделениюПользователя") Тогда
		Если Отбор.Найти("Подразделение") = Неопределено Тогда 
			Отбор.Добавить("Подразделение");
		КонецЕсли;
		Отбор["Подразделение"].Использование = Истина;
		Отбор["Подразделение"].ВидСравнения = ВидСравнения.Равно;
		Отбор["Подразделение"].Значение = ПараметрыСеанса.ТекущийПользователь.ОсновноеПодразделение;
		ЭлементыФормы.ДокументСписок.НастройкаОтбора["Подразделение"].Доступность = Ложь;
		//+++ 10.12.2014	
	ИначеЕсли ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "РазрешитьДобавлятьПриходСписаниеРекламнойПродукции") тогда
		
		Отбор["Склад"].Использование= Истина;
		Отбор["Склад"].ВидСравнения = ВидСравнения.ВИерархии;
		Отбор["Склад"].Значение     = справочники.Склады.НайтиПоНаименованию("Склады рекламной продукции"); // у каждого пользователя - свой склад!
		ЭлементыФормы.ДокументСписок.НастройкаОтбора["Склад"].Доступность = Ложь;
		
		// и подразделение ТОЖЕ!
		Отбор["Подразделение"].Использование = Истина;
		Отбор["Подразделение"].ВидСравнения = ВидСравнения.Равно;
		Отбор["Подразделение"].Значение = ПараметрыСеанса.ТекущийПользователь.ОсновноеПодразделение;
		ЭлементыФормы.ДокументСписок.НастройкаОтбора["Подразделение"].Доступность = Ложь;
		
	//  - чтоб ничего не видели... кому нельзя
ИначеЕсли НЕ (   РольДоступна("ПолныеПрава") 
			   или РольДоступна("яштФинДиректор")
			   или ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "РазрешитьДобавлятьСписаниеТоваров") ) тогда
		
		Отбор["Склад"].Использование= Истина;
		Отбор["Склад"].ВидСравнения = ВидСравнения.Равно;
		Отбор["Склад"].Значение     = Справочники.Склады.ПустаяСсылка(); // БезСклада - не бывает!
		ЭлементыФормы.ДокументСписок.НастройкаОтбора["Склад"].Доступность = Ложь;
	КонецЕсли;

КонецПроцедуры

//  Процедура печатает выбранный документ 
// Печатается та форма, которая была отпечатана при нажатии в документе кнопки
// печати по умолчанию
//
Процедура ДействияФормыДействиеПечать(Кнопка)

	Если ЭтаФорма.ЭлементыФормы.Список.ТекущаяСтрока = Неопределено тогда
		Возврат
	КонецЕсли;

	НапечататьДокументИзФормыСписка(ЭтаФорма.ЭлементыФормы.Список.ТекущаяСтрока.ПолучитьОбъект());

КонецПроцедуры // ДействиеПечать()

// Процедура вызывается при выборе пункта подменю "Движения документа по регистрам" меню "Перейти".
// командной панели формы. Процедура отрабатывает печать движений документа по регистрам.
//
Процедура ДействияФормыДвиженияДокументаПоРегистрам(Кнопка)

	Если ЭтаФорма.ЭлементыФормы.Список.ТекущаяСтрока = Неопределено тогда
		Возврат
	КонецЕсли;

	НапечататьДвиженияДокумента(ЭлементыФормы.Список.ТекущиеДанные.Ссылка);

КонецПроцедуры // ДействияФормыДвиженияДокументаПоРегистрам()

// Процедура вызывается при выборе пункта подменю "Структура подчиненности" меню "Перейти".
Процедура ДействияФормыСтруктураПодчиненностиДокумента(Кнопка)
	
	Если ЭлементыФормы.Список.ТекущиеДанные = Неопределено тогда
		Возврат
	КонецЕсли;
	
	ПоказатьСтруктуруПодчиненностиДокумента(ЭтаФорма.ЭлементыФормы.Список.ТекущаяСтрока);
	
КонецПроцедуры

Процедура СписокПередНачаломДобавления(Элемент, Отказ, Копирование)
	
	Если не(    ПолучитьЗначениеПоУмолчанию(глТекущийПользователь,"РазрешитьДобавлятьСписаниеТоваров")
		   или  ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "РазрешитьДобавлятьПриходСписаниеРекламнойПродукции") ) Тогда
		Предупреждение("Вы не имеете право на добавление документов списания.", 30);
		Отказ = истина;
	КонецЕсли;

КонецПроцедуры

Процедура ПриОткрытии()
	
	Если ПолучитьЗначениеПоУмолчанию(ПараметрыСеанса.ТекущийПользователь, "УчетТолькоПоПодразделениюПользователя") Тогда
		Если Отбор.Найти("Подразделение") = Неопределено Тогда 
			Отбор.Добавить("Подразделение");
		КонецЕсли;
		Отбор["Подразделение"].Использование = Истина;
		Отбор["Подразделение"].ВидСравнения = ВидСравнения.Равно;
		Отбор["Подразделение"].Значение = ПараметрыСеанса.ТекущийПользователь.ОсновноеПодразделение;
		ЭлементыФормы.Список.НастройкаОтбора["Подразделение"].Доступность = Ложь;
		
		//+++ 10.12.2014	
	ИначеЕсли ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "РазрешитьДобавлятьПриходСписаниеРекламнойПродукции") тогда
		
		Отбор["Склад"].Использование= Истина;
		Отбор["Склад"].ВидСравнения = ВидСравнения.ВИерархии;
		Отбор["Склад"].Значение     = справочники.Склады.НайтиПоНаименованию("Склады рекламной продукции"); // у каждого пользователя - свой склад!
		ЭлементыФормы.Список.НастройкаОтбора["Склад"].Доступность = Ложь;
		
		// и подразделение ТОЖЕ!
		Отбор["Подразделение"].Использование = Истина;
		Отбор["Подразделение"].ВидСравнения = ВидСравнения.Равно;
		Отбор["Подразделение"].Значение = Справочники.Подразделения.НайтиПоКоду("00010");
		ЭлементыФормы.Список.НастройкаОтбора["Подразделение"].Доступность = Ложь;
		
		//  - чтоб ничего не видели... кому нельзя
	ИначеЕсли НЕ (   РольДоступна("ПолныеПрава") 
		или РольДоступна("яштФинДиректор")
		или ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "РазрешитьДобавлятьСписаниеТоваров") ) тогда
		
		Отбор["Склад"].Использование= Истина;
		Отбор["Склад"].ВидСравнения = ВидСравнения.Равно;
		Отбор["Склад"].Значение     = Справочники.Склады.ПустаяСсылка(); // БезСклада - не бывает!
		ЭлементыФормы.Список.НастройкаОтбора["Склад"].Доступность = Ложь;
		
	ИначеЕсли РольДоступна("ПолныеПрава") 
		ИЛИ РольДоступна("яштФинДиректор")
		ИЛИ ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "РазрешитьДобавлятьСписаниеТоваров") Тогда
		
	Иначе 
		//***2018.02.04
		//ограничение, чтоб видели только свои документы
		Отбор["Ответственный"].Использование = Истина;
		Отбор["Ответственный"].ВидСравнения	 = ВидСравнения.Равно;
		Отбор["Ответственный"].Значение		 = ПараметрыСеанса.ТекущийПользователь;
		ЭлементыФормы.Список.НастройкаОтбора["Ответственный"].Доступность = Ложь;
		
	КонецЕсли;

КонецПроцедуры

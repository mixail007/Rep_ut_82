
перем ВсяГотПродукция, едИзм;

Процедура ПериодПриИзменении(Элемент)
	ПериодРасчета = НачалоМесяца( ПериодРасчета );	
	ПериодСтр = формат(ПериодРасчета, "ДФ='MMMM yyyy'")+"г.";
	ОбновитьНадпись();
КонецПроцедуры

процедура ЗаполнитьПоляПоУмолчанию()
	
	Ответственный = ПараметрыСеанса.ТекущийПользователь;
	
	Организация   = справочники.Организации.НайтиПоКоду("00001");
	Подразделение = справочники.Подразделения.НайтиПоНаименованию("Производство кованных дисков");
	
	НомГруппаЗатрат    = Справочники.НоменклатурныеГруппы.НайтиПоНаименованию("Производство кованных дисков");

	СпособРаспределенияДопЗатрат = перечисления.СпособыРаспределенияДопРасходов.ПоСумме;
		Дата = ТекущаяДата();
		ПериодРасчета = НачалоМесяца( Дата );
	    ВсяГотПродукция = 0;
КонецПроцедуры

Процедура ПриОткрытии()
	Если ЭтоНовый() тогда
		ЗаполнитьПоляПоУмолчанию();
	КонецЕсли;	
	ПериодСтр = формат(ПериодРасчета,"ДФ='MMMM yyyy'")+"г.";
КонецПроцедуры

процедура ОбновитьНадпись(ПолучатьДокументы = Истина)
	
	Если ПолучатьДокументы тогда
	ДокументыВыпускаПродукции.Очистить();
	таблДок = мПолучитьДокументы();	
	ДокументыВыпускаПродукции.Загрузить( таблДок );	 
	КонецЕсли;
	 
	ВсяГотПродукция=ДокументыВыпускаПродукции.Итог("ВсяГотПродукция"); едИзм = "";
	Если СпособРаспределенияДопЗатрат = перечисления.СпособыРаспределенияДопРасходов.ПоСумме тогда едИзм = "р.";
	ИначеЕсли СпособРаспределенияДопЗатрат = перечисления.СпособыРаспределенияДопРасходов.ПоКоличеству тогда едИзм ="шт.";
	ИначеЕсли СпособРаспределенияДопЗатрат = перечисления.СпособыРаспределенияДопРасходов.ПоВесу тогда	едИзм ="кг";
	КонецЕсли;
	 
	ЭлементыФормы.Надпись1.Заголовок = "Распределение на "+строка(ВсяГотПродукция) + едИзм+" ("+строка(таблДок.Количество())+" док)";
	
КонецПроцедуры

Процедура СпособРаспределенияДопЗатратПриИзменении(Элемент)
	ОбновитьНадпись(ЛОЖЬ);
КонецПроцедуры

Процедура ДокументыВыпускаПродукцииПриПолученииДанных(Элемент, ОформленияСтрок)
	ВсяГотПродукция = ДокументыВыпускаПродукции.Итог("ВсяГотПродукция");
	для каждого стр1 из ОформленияСтрок цикл
		стр1.Ячейки.доля.ОтображатьТекст = истина;
		стр1.Ячейки.доля.Текст = формат(100*стр1.ДанныеСтроки.ВсяГотПродукция / ВсяГотПродукция,"ЧДЦ=1")+"%";
	КонецЦикла;	
КонецПроцедуры


Процедура ДокументыВыпускаПродукцииВсяГотПродукцияПриИзменении(Элемент)
	ОбновитьНадпись(ЛОЖЬ);
КонецПроцедуры


Процедура КоманднаяПанель2Получить(Кнопка)
	ОбновитьНадпись();
КонецПроцедуры


Процедура МатериалыНоменклатураПриИзменении(Элемент)
	
	стр1 = ЭлементыФормы.Материалы.ТекущиеДанные;
	стр1.Количество = 0; стр1.Сумма=0;
	
	//ФИКС. СТАТЬИ - как в Требовании накладной!
	стр1.СтатьяМатЗатрат    = Справочники.СтатьиЗатрат.НайтиПоНаименованию("Производство кованных дисков");
	стр1.СтатьяМатЗатратУПР = Справочники.СтатьиЗатратУПР.НайтиПоНаименованию("Производство кованных дисков");

КонецПроцедуры


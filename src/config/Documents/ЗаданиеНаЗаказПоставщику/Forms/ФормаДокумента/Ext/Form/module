
Процедура ТоварыНоменклатураПриИзменении(Элемент)
	ОбновитьЗавод(ЭлементыФормы.Товары.ТекущаяСтрока);
КонецПроцедуры

Процедура ТоварыПриПолученииДанных(Элемент, ОформленияСтрок)
	Для каждого ОформлениеСтроки Из ОформленияСтрок Цикл
		ОформлениеСтроки.Ячейки.Код.ОтображатьТекст = истина;
		Данныестроки = ОформлениеСтроки.Данныестроки;
		ОформлениеСтроки.Ячейки.Код.Текст = Данныестроки.Номенклатура.Код;
   КонецЦикла;
КонецПроцедуры

Процедура КоманднаяПанель1кнОбновитьЗавод(Кнопка)
	Для каждого стр из товары Цикл
		ОбновитьЗавод(стр);
	КонецЦикла;
КонецПроцедуры

процедура ОбновитьЗавод(стр)
	МенеджерЗаписи = РегистрыСведений.СезонныйАссортимент.СоздатьМенеджерЗаписи();
	МенеджерЗаписи.Номенклатура = стр.Номенклатура;
	МенеджерЗаписи.Прочитать();
	Если МенеджерЗаписи.Выбран() тогда
		стр.Завод = МенеджерЗаписи.Завод;
	КонецЕсли;	
КонецПроцедуры

Процедура ДействияФормыкнАнализЗадания(Кнопка)
	ТекСсылка=Справочники.ВнешниеОбработки.НайтиПоКоду("546"); //План-факт задания поставщикам
	ИмяФайла = ПолучитьИмяВременногоФайла(); 
	ДвоичныеДанные = ТекСсылка.ХранилищеВнешнейОбработки.Получить(); 
	ДвоичныеДанные.Записать(ИмяФайла); 
	Если ТекСсылка.ВидОбработки = Перечисления.ВидыДополнительныхВнешнихОбработок.Отчет Тогда 
		Обработка = ВнешниеОтчеты.Создать(ИмяФайла,ложь); 
	Иначе 
		Обработка = ВнешниеОбработки.Создать(ИмяФайла,Ложь); 
	КонецЕсли;
	ФормаОтчета = Обработка.ПолучитьФорму("ФормаОтчета");
	ФормаОтчета.Параметр = Ссылка;
	ФормаОтчета.Открыть();
КонецПроцедуры

Процедура ДнейДоСогласования(Элемент)
	ДатаСогласования = КонецДня(Дата)+24*60*60*ДнейДоСогласования+1;
КонецПроцедуры

Процедура ДатаСогласованияПриИзменении(Элемент)
	Запрос = новый Запрос;
	Запрос.Текст="ВЫБРАТЬ РАЗНОСТЬДАТ(&Дата1, &Дата2, ДЕНЬ) КАК Разность";
	Запрос.УстановитьПараметр("Дата2",НачалоДня(ДатаСогласования));
	Запрос.УстановитьПараметр("Дата1",НачалоДня(Дата));
	ДнейДоСогласования = Запрос.Выполнить().Выгрузить()[0].Разность;
КонецПроцедуры

Процедура ПриЗаписи(Отказ)
	Если не Согласован тогда
		Документы.ЗаданиеНаЗаказПоставщику.ОтправитьНапоминание(Ссылка);
	КонецЕсли;
КонецПроцедуры

Процедура ДействияФормыРазделить(Кнопка)
	Запрос = Новый запрос;
	Запрос.Текст = 
	
	"ВЫБРАТЬ
	|	ТЧ.Номенклатура,
	|	ТЧ.количество,
	|	ТЧ.Завод
	|ПОМЕСТИТЬ ТабЧасть
	|ИЗ
	|	&ТЧ КАК ТЧ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ПровереннаяНагрузкаДисков.Номенклатура
	|ПОМЕСТИТЬ Проверки
	|ИЗ
	|	РегистрСведений.ПровереннаяНагрузкаДисков КАК ПровереннаяНагрузкаДисков
	|ГДЕ
	|	ПровереннаяНагрузкаДисков.Дата >= &Дата
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ТабЧасть.Номенклатура,
	|	ТабЧасть.количество,
	|	ТабЧасть.Завод,
	|	ВЫБОР
	|		КОГДА Проверки.Номенклатура ЕСТЬ NULL 
	|			ТОГДА ЛОЖЬ
	|		ИНАЧЕ ИСТИНА
	|	КОНЕЦ КАК БылаПроверка
	|ИЗ
	|	ТабЧасть КАК ТабЧасть
	|		ЛЕВОЕ СОЕДИНЕНИЕ Проверки КАК Проверки
	|		ПО ТабЧасть.Номенклатура = Проверки.Номенклатура" ;
	
	Запрос.УстановитьПараметр("ТЧ",ЭлементыФормы.Товары.Значение.Выгрузить());
	Запрос.УстановитьПараметр("Дата",Дата('20180301'));
	Результат = Запрос.Выполнить().Выгрузить();
	
	НеПровер=Результат.НайтиСтроки(Новый Структура("БылаПроверка",Ложь));
	Провер=Результат.НайтиСтроки(Новый Структура("БылаПроверка",Истина));
	
	Если провер.Количество()=0 тогда
	сообщить("Все диски не проверялись. Разделение не требуется");	
	Комментарий = Комментарий+" ++Диски без проверки. ";
	иначеЕсли неПровер.Количество()=0 тогда
	сообщить("Все диски проверялись. Разделение не требуется");	
	Комментарий = Комментарий+" ++Диски прошедшие проверку. ";
   иначе
	
	НовыйДок = ЭтотОбъект.Скопировать();
	новыйДок.Товары.Очистить();
	для каждого стр из провер цикл
		строка = новыйДок.Товары.Добавить();
		ЗаполнитьЗначенияСвойств(строка,стр);
	конецЦикла;
	новыйДок.Дата = ДАта;
	новыйДок.Комментарий = Комментарий+" ++Диски прошедшие проверку. ";
	новыйДок.Записать();
	фор=новыйДок.ПолучитьФорму();
	фор.Открыть();
	
	
	ТОВАРЫ.Очистить();
	для каждого стр из НЕпровер цикл
		строка = Товары.Добавить();
		ЗаполнитьЗначенияСвойств(строка,стр);
	конецЦикла;

	Комментарий = Комментарий+" ++Диски без проверки. ";
     Записать();
	конецЕсли;
КонецПроцедуры

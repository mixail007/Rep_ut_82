
Процедура ВложенияНаименованиеОткрытие(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = ложь;
	Хранилище = ЭлементыФормы.Вложения.ТекущаяСтрока.Вложение;
	
	ИмяВременногоФайла = КаталогВременныхФайлов() + Элемент.Значение;
	
	Если ТипЗнч(Хранилище) <> Тип("ДвоичныеДанные") Тогда
		ДвоичныеДанные = Хранилище.Получить();
	Иначе
		ДвоичныеДанные = Хранилище;
	КонецЕсли; 
	
	ДвоичныеДанные.Записать(ИмяВременногоФайла);
	
	ЗапуститьПриложение(ИмяВременногоФайла);
КонецПроцедуры

Процедура ВложенияНаименованиеНачалоВыбора(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = ложь;
	
	Диалог = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	Диалог.Заголовок = "Выберите файл";
	Диалог.ПолноеИмяФайла = "";
	Диалог.ПредварительныйПросмотр = Истина;
	Диалог.Фильтр = "Все файлы (*.*)";
	
	Если Диалог.Выбрать() Тогда
		ЭлементыФормы.Вложения.ТекущаяСтрока.Вложение = Новый ХранилищеЗначения(Новый ДвоичныеДанные(Диалог.ПолноеИмяФайла));
		Элемент.Значение = СтрЗаменить(Диалог.ПолноеИмяФайла,Диалог.Каталог,"");
	Иначе
		Возврат;
	КонецЕсли;

КонецПроцедуры

Процедура ДействияФормыПодготовить(Кнопка)
	Состояние = Перечисления.СостоянияОбъектов.Подготовлен;
	Записать(РежимЗаписиДокумента.Проведение);
	УстановитьВидимость();
КонецПроцедуры

Процедура ДействияФормыУтвердить(Кнопка)
	Состояние = Перечисления.СостоянияОбъектов.Утвержден;
	Записать(РежимЗаписиДокумента.Проведение);
	УстановитьВидимость();
КонецПроцедуры

Процедура ДействияФормыВыполнить(Кнопка)
	Состояние = Перечисления.СостоянияОбъектов.Выполнен;
	Записать(РежимЗаписиДокумента.Проведение);
	УстановитьВидимость();
КонецПроцедуры

Процедура ДействияФормыОтклонить(Кнопка)
	Состояние = Перечисления.СостоянияОбъектов.Отклонен;
	Записать(РежимЗаписиДокумента.Проведение);
	УстановитьВидимость();
КонецПроцедуры

Процедура УстановитьВидимость()
	Заголовок = Заголовок+" "+Состояние;
	
	Если ЗначениеЗаполнено(Состояние) тогда
		ЭтаФорма.ТолькоПросмотр = истина;
	КонецЕсли;
		
	ЭлементыФормы.ДействияФормы.Кнопки.Подготовить.Доступность=ЗначениеНеЗаполнено(Состояние);
	ЭлементыФормы.ДействияФормы.Кнопки.Утвердить.Доступность=(глТекущийПользователь = Справочники.Пользователи.НайтиПоКоду("Аверкина") и Состояние = Перечисления.СостоянияОбъектов.Подготовлен);
	ЭлементыФормы.ДействияФормы.Кнопки.Отклонить.Доступность=(глТекущийПользователь = Справочники.Пользователи.НайтиПоКоду("Аверкина") и Состояние = Перечисления.СостоянияОбъектов.Подготовлен);
	ЭлементыФормы.ДействияФормы.Кнопки.Выполнить.Доступность=(глТекущийПользователь = Справочники.Пользователи.НайтиПоКоду("Махова") и Состояние = Перечисления.СостоянияОбъектов.Утвержден);
	
КонецПроцедуры

Процедура ПриОткрытии()
	УстановитьВидимость();
	Если Этоновый() тогда
		Ответственный = глТекущийПользователь;
	иначеЕсли глТекущийПользователь = Справочники.Пользователи.НайтиПоКоду("Махова") 
			или глТекущийПользователь = Справочники.Пользователи.НайтиПоКоду("Аверкина")
			или глТекущийПользователь = Ответственный тогда
			иначе
				возврат;
	КонецЕсли;
КонецПроцедуры

Процедура ВложенияПередНачаломИзменения(Элемент, Отказ)
	Если Состояние = Перечисления.СостоянияОбъектов.Подготовлен 
		или не ЗначениеЗаполнено(Состояние) 
		или глТекущийПользователь = Справочники.Пользователи.НайтиПоКоду("Аверкина")
		или глТекущийПользователь = Справочники.Пользователи.НайтиПоКоду("Махова") тогда
	иначе
		отказ = истина;
	конецЕсли;
КонецПроцедуры


Процедура ВложенияПередУдалением(Элемент, Отказ)
	Если Состояние = Перечисления.СостоянияОбъектов.Подготовлен или не ЗначениеЗаполнено(Состояние) тогда
	иначе
		отказ = истина;
	конецЕсли;
КонецПроцедуры


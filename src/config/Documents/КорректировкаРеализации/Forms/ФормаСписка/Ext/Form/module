////////////////////////////////////////////////////////////////////////////////
// ПЕРЕМЕННЫЕ МОДУЛЯ

Перем мИспользоватьОбменЭД; // Переменная содержит значение функциональной опции "ИспользоватьОбменЭД"

//  Процедура печатает выбранный документ 
// Печатается та форма, которая была отпечатана при нажатии в документе кнопки
// печати по умолчанию
//
Процедура ДействияФормыДействиеПечать(Кнопка)

	Если ЭтаФорма.ЭлементыФормы.Список.ТекущаяСтрока = Неопределено тогда
		Возврат
	КонецЕсли;

	//УниверсальныеМеханизмы.НапечататьДокументИзФормыСписка(ЭтаФорма.ЭлементыФормы.Список.ТекущаяСтрока.ПолучитьОбъект());

КонецПроцедуры // ДействиеПечать()

// Процедура вызывается при выборе пункта подменю "Движения документа по регистрам" меню "Перейти".
// командной панели формы. Процедура отрабатывает печать движений документа по регистрам.
//
Процедура ДействияФормыДвиженияДокументаПоРегистрам(Кнопка)

	Если ЭтаФорма.ЭлементыФормы.Список.ТекущаяСтрока = Неопределено тогда
		Возврат
	КонецЕсли;

	НапечататьДвиженияДокумента(ЭлементыФормы.Список.ТекущиеДанные.Ссылка);

КонецПроцедуры // ДействияФормыДвиженияДокументаПоРегистрам()

// Процедура вызывается при выборе пункта подменю "Структура подчиненности" меню "Перейти".
Процедура ДействияФормыСтруктураПодчиненностиДокумента(Кнопка)
	
	Если ЭлементыФормы.Список.ТекущиеДанные = Неопределено тогда
		Возврат
	КонецЕсли;
	
	ПоказатьСтруктуруПодчиненностиДокумента(ЭлементыФормы.Список.ТекущиеДанные.Ссылка);
	
КонецПроцедуры

//////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ для работы с электронными документами

Процедура ДействияФормыПодписатьИОтправить(Кнопка)
	
	//Если ЭлементыФормы.Список.ТекущиеДанные = Неопределено Тогда
	//	Возврат;
	//КонецЕсли;
	
	//ЭлектронныеДокументыКлиент.СформироватьПодписатьОтправитьЭД(ЭлементыФормы.Список.ТекущиеДанные.Ссылка);

КонецПроцедуры

Процедура ДействияФормыСформироватьНовый(Кнопка)
	
	//Если ЭлементыФормы.Список.ТекущиеДанные = Неопределено Тогда
	//	Возврат;
	//КонецЕсли;
	//
	//ЭлектронныеДокументыКлиент.СформироватьНовыйЭД(ЭлементыФормы.Список.ТекущиеДанные.Ссылка);
	
КонецПроцедуры

Процедура ДействияФормыОткрытьАктуальныйЭД(Кнопка)
	
	//Если ЭлементыФормы.Список.ТекущиеДанные = Неопределено Тогда
	//	Возврат;
	//КонецЕсли;

	//ЭлектронныеДокументыКлиент.ОткрытьАктуальныйЭД(ЭлементыФормы.Список.ТекущиеДанные.Ссылка, ЭтаФорма);
	
КонецПроцедуры

Процедура ДействияФормыСписокЭлектронныхДокументов(Кнопка)
	
	//Если ЭлементыФормы.Список.ТекущиеДанные = Неопределено Тогда
	//	Возврат;
	//КонецЕсли;
	//
	//Ссылка = ЭлементыФормы.Список.ТекущиеДанные.Ссылка;
	//
	//ПараметрыОткрытия = Новый Структура;
	//ПараметрыОткрытия.Вставить("Уникальность", 	Ссылка.УникальныйИдентификатор());
	//ПараметрыОткрытия.Вставить("Источник", 		ЭтаФорма);
	//
	//ЭлектронныеДокументыКлиент.ОткрытьДеревоЭД(Ссылка, ПараметрыОткрытия)

КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	// Начало ЭлектронныеДокументы
	//РаботаСДиалогами.УдалитьКнопкуЭД(ЭлементыФормы.ДействияФормы.Кнопки, мИспользоватьОбменЭД);
	// Конец ЭлектронныеДокументы
КонецПроцедуры

Процедура ПриОткрытии()
	// Начало ЭлектронныеДокументы
	Если НЕ мИспользоватьОбменЭД Тогда 
		ЭлементыФормы.Список.Колонки.СостояниеЭД.Видимость = Ложь;
	КонецЕсли;
	// Конец ЭлектронныеДокументы
КонецПроцедуры

Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
	// Начало ЭлектронныеДокументы
	Если ИмяСобытия = "ОбновитьСостояниеЭД" Тогда
		ДокументСписок.Обновить();
	КонецЕсли;	
	// Конец ЭлектронныеДокументы
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ списка документов

Процедура СписокПриПолученииДанных(Элемент, ОформленияСтрок)
	
	Для Каждого ОформлениеСтроки Из ОформленияСтрок Цикл
		ОформлениеСтроки.Ячейки.КорректироватьБУиНУ.УстановитьФлажок(НЕ ОформлениеСтроки.ДанныеСтроки.КорректироватьБУиНУ);
	КонецЦикла;
	
	// Начало ЭлектронныеДокументы
	Если НЕ мИспользоватьОбменЭД ИЛИ НЕ Элемент.Колонки.СостояниеЭД.Видимость Тогда
		Возврат;
	КонецЕсли;
	
	//// Сформируем массив документов для получения состояния 
	//ДокументыДляПолученияСостояния = Новый Массив();
	//Для каждого ОформлениеСтроки из ОформленияСтрок Цикл
	//	ДокументыДляПолученияСостояния.Добавить(ОформлениеСтроки.ДанныеСтроки.Ссылка);
	//КонецЦикла;
	//
	//СостоянияЭД = ЭлектронныеДокументы.ПолучитьТекстСостоянияЭДПоВладельцам(ДокументыДляПолученияСостояния);
	//
	//Для каждого оформлениеСтроки из ОформленияСтрок Цикл
	//	ОформлениеСтроки.Ячейки.СостояниеЭД.УстановитьТекст(СостоянияЭД[ОформлениеСтроки.ДанныеСтроки.Ссылка]);
	//КонецЦикла
	// Конец ЭлектронныеДокументы

КонецПроцедуры



мИспользоватьОбменЭД = false;//ЭлектронныеДокументыСлужебныйВызовСервера.ПолучитьЗначениеФункциональнойОпции("ИспользоватьОбменЭД");
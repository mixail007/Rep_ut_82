
Процедура ОбработкаПроведения(Отказ, Режим)

	// регистр ПравилаУстановкиБонусовПоставщиков
	Движения.ПравилаУстановкиБонусовПоставщиков.Записывать = Истина;
	Движения.ПравилаУстановкиБонусовПоставщиков.Очистить();
	Если БонусОтПродаж и СписокИНН<>"" тогда  // список через ,
		масИНН = РазложитьСтрокуВМассивПодстрок(СписокИНН, ","); 
	иначе 
		масИНН = новый Массив;
		масИНН.Добавить("");
	КонецЕсли;
	КолИНН = масИНН.Количество();
	Для k=0 по КолИНН-1 цикл
		ИНН = СокрЛП( масИНН[k] );

		Если ДопУсловия.Количество()=0 тогда // 1 условие!
			i=0; дата1 = ДатаПо+86400;
			пока i<2 цикл
				Движение = Движения.ПравилаУстановкиБонусовПоставщиков.Добавить();
				Движение.Период    = дата1; 
				Движение.Приоритет = k+1; // 2 периода на 1 правило по каждому ИНН... = N правил
				
				Движение.Контрагент    = Контрагент;
				Движение.Производитель 		  = Производитель;
				Движение.НоменклатурнаяГруппа = НоменклатурнаяГруппа;
				Движение.ПроцентБонуса = i*ПроцентБонуса;
				
				//Модель, Диаметр, Номенклатура
				Движение.ИНН = ИНН;
				Движение.БонусОтПродаж = БонусОтПродаж;
				
				i=i+1; дата1 = ДатаС; 
			КонецЦикла;
		Иначе
			для каждого стр1 из ДопУсловия цикл	
			i=0; дата1 = ДатаПо+86400;  
				пока i<2 цикл
				Движение = Движения.ПравилаУстановкиБонусовПоставщиков.Добавить();
				Движение.Период     = дата1;
				Движение.Приоритет  = стр1.НомерСтроки + k * КолИНН; // 2 периода на <НомерСтроки> правило по 1 ИНН
				
				Движение.Контрагент = Контрагент;
				Движение.Производитель 		  = Производитель;
				Движение.НоменклатурнаяГруппа = НоменклатурнаяГруппа;
				Движение.ПроцентБонуса = i*стр1.ПроцентБонуса;
				
				Движение.Модель = стр1.Модель;
				Движение.Диаметр = стр1.Диаметр;
				Движение.Номенклатура = стр1.Номенклатура;
				
				Движение.ИНН = ИНН;
				Движение.БонусОтПродаж = БонусОтПродаж;
				
				i=i+1; дата1 = ДатаС; 
				КонецЦикла;
			КонецЦикла;
		КонецЕсли;
	КонецЦикла;//ИНН

КонецПроцедуры

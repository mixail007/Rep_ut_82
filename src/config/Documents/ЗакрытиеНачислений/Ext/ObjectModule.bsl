
Процедура ОбработкаПроведения(Отказ, Режим)

	Для Каждого ТекСтрокаПени Из Пени Цикл
		Движение = Движения.НачисленныеПени.Добавить();
		Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
		Движение.Период = Дата;
		Движение.Контрагент = Контрагент;
		Движение.ДоговорЗадолженности = ТекСтрокаПени.ДоговорЗадолженности;
		Движение.ДоговорНачисления = ТекСтрокаПени.ДоговорНачисления;
		Движение.Сделка = ТекСтрокаПени.Сделка;
		Движение.ДатаНачисления = ТекСтрокаПени.ДатаНачисления;
		Движение.ДокументНачисления = ТекСтрокаПени.ДокументНачисления;
		Движение.Сумма = ТекСтрокаПени.Сумма;
		Движение.Пени = ТекСтрокаПени.Пени;
	КонецЦикла;

	Движения.НачисленныеПени.Записать();
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	#Если Клиент Тогда
		Если РольДоступна("ПравоЗавершенияРаботыПользователей") //ИТ-отдел
			ИЛИ СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Горохов" 
			ИЛИ СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Серков" 
			ИЛИ СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Малышев Егор" 
			ИЛИ СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Пьянкова А.Н."  //***доступ для бухгалтерии добавлен 21.03.2016
			ИЛИ СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Миронова В.С."  //***доступ для бухгалтерии добавлен 27.07.2016
			ИЛИ СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Яковлева"
			ИЛИ СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Марешева (Новый)"  //Плотников, по служебке от Серкова
			ИЛИ СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Разживина Ю.Д."
			//ИЛИ СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Волкова А.С."
			ИЛИ СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Смирнова С.Е."

			Тогда
		Иначе
			Если НЕ РежимЗаписи = РежимЗаписиДокумента.Запись Тогда
				Сообщить("Вам доступна только запись документа");
				Отказ = Истина;
			КонецЕсли;
		КонецЕсли;
		
		Если НЕ Проведен И РежимЗаписи = РежимЗаписиДокумента.Проведение Тогда
			//при первом проведении устанавливать ответственного, кто провел
			Ответственный = ПараметрыСеанса.ТекущийПользователь;
		КонецЕсли;
	#КонецЕсли
		
	Если НЕ Отказ Тогда
		
		обЗаписатьПротоколИзменений(ЭтотОбъект);
		
	КонецЕсли; 

КонецПроцедуры


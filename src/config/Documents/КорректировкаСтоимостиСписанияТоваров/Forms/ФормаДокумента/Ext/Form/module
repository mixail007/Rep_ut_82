
Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.УстановитьПериод(ДатаНач, ?(ДатаКон='0001-01-01', ДатаКон, КонецДня(ДатаКон)));
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	Если НастройкаПериода.Редактировать() Тогда
		ДатаНач = НастройкаПериода.ПолучитьДатуНачала();
		ДатаКон = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры

Процедура КопейкиНажатие(Элемент)
	// Вставить содержимое обработчика.
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Дата",ДатаКон);
	Запрос.УстановитьПараметр("Параметр",ПараметрКопеек);
	Запрос.УстановитьПараметр("Параметр1",-ПараметрКопеек);
	Запрос.Текст = "ВЫБРАТЬ
	                |	ПартииТоваровНаСкладахОстатки.Номенклатура,
	                |	ПартииТоваровНаСкладахОстатки.Склад,
	                |	ПартииТоваровНаСкладахОстатки.ХарактеристикаНоменклатуры,
	                |	ПартииТоваровНаСкладахОстатки.СерияНоменклатуры,
	                |	ПартииТоваровНаСкладахОстатки.ДокументОприходования,
	                |	ПартииТоваровНаСкладахОстатки.СтатусПартии,
	                |	ПартииТоваровНаСкладахОстатки.Заказ,
	                |	ПартииТоваровНаСкладахОстатки.Качество,
	                |	ПартииТоваровНаСкладахОстатки.КоличествоОстаток,
	                |	ПартииТоваровНаСкладахОстатки.СтоимостьОстаток
	                |ИЗ
	                |	РегистрНакопления.ПартииТоваровНаСкладах.Остатки(&Дата, ) КАК ПартииТоваровНаСкладахОстатки
	                |Где КоличествоОстаток=0 и СтоимостьОстаток>=&Параметр1 и СтоимостьОстаток<=&Параметр";
	Выб = Запрос.Выполнить().Выбрать();
	
	Пока Выб.Следующий() Цикл
		Строчка = СкорректированныеКопейки.Добавить();
		Строчка.ДокументОприходования = Выб.ДокументОприходования;
		Строчка.Качество = Выб.Качество;
		Строчка.Номенклатура = Выб.Номенклатура;
	    Строчка.ХарактеристикаНоменклатуры = Выб.ХарактеристикаНоменклатуры;
	    Строчка.СерияНоменклатуры = Выб.СерияНоменклатуры;
	  	Строчка.СтатусПартии = Выб.СтатусПартии;
	    Строчка.Заказ = Выб.Заказ;
	    Строчка.Качество = Выб.Качество;
	    Строчка.Сумма = Выб.СтоимостьОстаток;		
		Строчка.Склад = Выб.Склад;		
	КонецЦикла;

КонецПроцедуры

Процедура КоманднаяПанель1Записать(Кнопка)
	// Вставить содержимое обработчика.
	Движение = Движения.ПартииТоваровНаСкладах;
		Если (СкорректированныеКопейки.Количество()>0) Тогда 
		Для Каждого Элемент из СкорректированныеКопейки Цикл
			кДвиж 							= Движение.Добавить();	
			кДвиж.Активность 				= Истина;
			кДвиж.ВидДвижения 				= ВидДвиженияНакопления.Приход;
			кДвиж.ДокументОприходования 	= Элемент.ДокументОприходования;
			кДвиж.Качество 					= Элемент.Качество;
			кДвиж.КодОперации 				= Перечисления.КодыОперацийПартииТоваров.СписаниеНаЗатраты;
			кДвиж.Номенклатура 				= Элемент.Номенклатура;
			кДвиж.Период 					= КонецДня(Дата);
			кДвиж.СерияНоменклатуры 		= Элемент.СерияНоменклатуры;
			кДвиж.ХарактеристикаНоменклатуры= Элемент.ХарактеристикаНоменклатуры;
			кДвиж.Склад						= Элемент.Склад;
			кДвиж.СписаниеПартий			= Истина;
			кДвиж.СтатусПартии				= Элемент.СтатусПартии;
			кДвиж.Стоимость					= -(Элемент.Сумма);
			кДвиж.ДокументДвижения			= Ссылка;
			кДвиж.Заказ						= Элемент.Заказ;
			Движение.Записать();                 
		КонецЦикла;
		КонецЕсли;		

КонецПроцедуры

Процедура ПриОткрытии()
	// Вставить содержимое обработчика.
	Если ПараметрКопеек = 0 и ЭтоНовый() Тогда
		ПараметрКопеек = 0.02;
	КонецЕсли;
	Если НЕ ЭтоНовый() Тогда
		
		УстановитьЭлементыИсторииКнопка(Ссылка, ЭтаФорма);
		
	КонецЕсли; 

	
КонецПроцедуры

Процедура ВыводИстории(Элемент)
	
	ВывестиИсторию(Ссылка, ЭтаФорма);
	
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	Если ПолучитьЗначениеПоУмолчанию(ПараметрыСеанса.ТекущийПользователь, "УчетТолькоПоПодразделениюПользователя") Тогда
		Сообщить("У вас недостаточно прав для просмотра документа!");
		отказ = Истина;
		возврат;
	КонецЕсли;
КонецПроцедуры
	
	

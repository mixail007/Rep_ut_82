

Процедура КоманднаяПанель1Действие1(Кнопка)
	// Вставить содержимое обработчика.
	
Запрос=Новый Запрос;	
Запрос.Текст=	"ВЫБРАТЬ
	|ЗатратыОбороты.Подразделение,
	|ЗатратыОбороты.СтатьяЗатрат,
	|ЗатратыОбороты.СуммаОборот
|ИЗ
	|РегистрНакопления.Затраты.Обороты(&НачДата, &КонДата, , ) КАК ЗатратыОбороты
|Автоупорядочивание	";

Запрос.УстановитьПараметр("НачДата",НачалоДня(ДатаНачала));
Запрос.УстановитьПараметр("КонДата",КонецДня(ДатаКонца));

Выб=Запрос.Выполнить().Выбрать();

Пока Выб.Следующий() Цикл
Отбор=Новый Структура ;
Отбор.Вставить("Подразделение",Выб.Подразделение);
Отбор.Вставить("СтатьяЗатрат",Выб.СтатьяЗатрат);
мас=Новый Массив;
мас= Затраты.НайтиСтроки(Отбор);
Если Затраты.НайтиСтроки(Отбор).Количество()>0 Тогда
  мас[0].СуммаФакт=Выб.СуммаОборот;
Иначе
стр=Затраты.Добавить();	
стр.Подразделение= Выб.Подразделение;
стр.СтатьяЗатрат = Выб.СтатьяЗатрат;
стр.СуммаФакт=Выб.СуммаОборот;
КонецЕсли;	
КонецЦикла;
КонецПроцедуры

Процедура КоманднаяПанель1Действие(Кнопка)
	// Вставить содержимое обработчика.
	Запрос= Новый Запрос;

	Запрос.Текст="ВЫБРАТЬ
	             |Подразделение,
	             |СтатьяЗатрат,
	             |СуммаПриход
	             |ИЗ
	             |	РегистрНакопления.УК_ЗатратыПланФакт.Обороты(&НачДата,&КонДата)
	             |ГДЕ
	             |	СуммаПриход > 0";

Запрос.УстановитьПараметр("НачДата",НачалоДня(ДатаНачала));
Запрос.УстановитьПараметр("КонДата",НачалоДня(ДатаКонца));

Выб=Запрос.Выполнить().Выбрать();

Пока Выб.Следующий() Цикл
Отбор=Новый Структура ;
Отбор.Вставить("Подразделение",Выб.Подразделение);
Отбор.Вставить("СтатьяЗатрат",Выб.СтатьяЗатрат);
мас=Новый Массив;
мас= Затраты.НайтиСтроки(Отбор);
Если Затраты.НайтиСтроки(Отбор).Количество()>0 Тогда
  мас[0].СуммаПлан=Выб.СуммаПриход;
Иначе
стр=Затраты.Добавить();	
стр.Подразделение= Выб.Подразделение;
стр.СтатьяЗатрат = Выб.СтатьяЗатрат;
стр.СуммаПлан=Выб.СуммаПриход;
КонецЕсли;	
КонецЦикла;


	
КонецПроцедуры

Процедура СтратегияПриИзменении(Элемент)
	 Затраты.Очистить();
	// Вставить содержимое обработчика.
	Если Стратегия.Период="День" Тогда
		ДатаКонца=КонецДня(ДатаНачала);
	ИначеЕсли 	Стратегия.Период="Неделя" Тогда
		ДатаКонца=НачалоДня(НачалоДня(ДатаНачала)+6*60*60*24+1);
	ИначеЕсли 	Стратегия.Период="Декада" Тогда
		ДатаКонца=КонецДня(НачалоДня(ДатаНачала)+9*60*60*24+1);
	ИначеЕсли 	Стратегия.Период="Месяц" Тогда
		ДатаКонца=КонецДня(ДобавитьМесяц(НачалоДня(ДатаНачала),1)-1);
	ИначеЕсли 	Стратегия.Период="Квартал" Тогда	
		ДатаКонца=КонецДня(ДобавитьМесяц(НачалоДня(ДатаНачала),3)-1);
	ИначеЕсли 	Стратегия.Период="Год" Тогда
		ДатаКонца=КонецДня(ДобавитьМесяц(НачалоДня(ДатаНачала),12)-1);
	КонецЕсли;	

КонецПроцедуры

Процедура ПриОткрытии()
	
	Если НЕ ЭтоНовый() Тогда
		
		УстановитьЭлементыИсторииКнопка(Ссылка, ЭтаФорма);
		
	КонецЕсли; 

	
КонецПроцедуры

Процедура ВыводИстории(Элемент)
	
	ВывестиИсторию(Ссылка, ЭтаФорма);
	
КонецПроцедуры
	
	


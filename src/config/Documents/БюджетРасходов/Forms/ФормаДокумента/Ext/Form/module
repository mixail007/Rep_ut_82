//"Подразделение1" = "Головное"
//"Подразделение2" = "Москва"
//"Подразделение3" = "Санкт-Петербург"
//"Подразделение4" = "Екатеринбург"
//"Подразделение5" = "Ростов-На-Дону"

Перем МассивПодразделений;
Перем Месяц;
Перем МесяцМ;

Процедура ПриОткрытии()
	// Вставить содержимое обработчика.
	Если не ЗначениеЗаполнено(ВидОперации) Тогда 
	 	ВидОперации = Перечисления.ВидБюджета.Полугодие;
		УстановитьЗаголовокВидаОпераци();		
	КонецЕсли;	 
	
	УстановитьЗаголовкиКолонок();
	
	Если не ЗначениеЗаполнено(Полугодие) Тогда 
		Если Месяц(ТекущаяДата())<6 Тогда 
			Полугодие = 1;
		Иначе 
			Полугодие = 2;
		Конецесли;
	КонецЕсли;
	
	УстановитьВидимость();	
	УстановитьПодвал();
	РассчитатьИтогоВподвале();

	Если ВидОперации = Перечисления.ВидБюджета.Месяц Тогда 
		Если НомерМесяца=0 и МесяцРасчета <> Дата(1,1,1) Тогда 
			НомерМесяца=Число(Формат(МесяцРасчета,"ДФ=MM"));
		КонецЕсли;
		МесяцМ = НомерМесяца;
	КонецЕсли;
	
	УстановитьЗаголовкиМесячные();
	
	Если ЗначениеЗаполнено(ДокументОснование) и ВидОперации<>Перечисления.ВидБюджета.Месяц Тогда 
		ВидОперации=Перечисления.ВидБюджета.Месяц;
		УстановитьЗаголовокВидаОпераци();		
		УстановитьВидимостьВидаБюджета();
	КонецЕсли;
	
	НадписьТМ = НайтиТекстМесяца("Месяц"+?(МесяцМ = неопределено,1,МесяцМ));
	НадписьТМ = СтрЗаменить(НадписьТМ,"(руб.)","");
	
	Если ИМ Тогда
		ЭлементыФормы.Затраты.Колонки.Статья.Видимость = Ложь;
		ЭлементыФормы.Затраты.Колонки.СтатьяУПР.Видимость = истина;
	КонецЕсли;
	
	ПроверитьДоступность();
	
	Если РольДоступна("яштФинДиректор") тогда
	 ЭлементыФормы.Ответственный.Доступность = Истина;	
	КонецЕсли;	
КонецПроцедуры

Процедура ПроверитьДоступность()
    Запрос = Новый Запрос;
	запрос.УстановитьПараметр("Период",ПериодПланирования);
	запрос.Текст ="ВЫБРАТЬ
	              |	БюджетДоходов.Ссылка
	              |ИЗ
	              |	Документ.БюджетДоходов КАК БюджетДоходов
	              |ГДЕ
	              |	БюджетДоходов.ПериодПланирования = &период
	              |	И БюджетДоходов.Проведен = ИСТИНА
	              |	И БюджетДоходов.ЗакрытьДокументы = ИСТИНА
	              |	И БюджетДоходов.ВидОперацииФинансовый = ИСТИНА";
	рез = запрос.Выполнить().Выгрузить();
	
	
	Если Рез.Количество()>0 и не найти(глТекущийПользователь.наименование,"Межерицкая")>0 Тогда
		ЭтаФорма.ТолькоПросмотр= истина;
		
	КонецЕсли;	
КонецПроцедуры

Процедура УстановитьЗаголовкиКолонок()
	
	//Для каждого Кол из ЭлементыФормы.Затраты.Колонки Цикл		
	//	Если Найти(Кол.Имя,"Месяц") Тогда 
	//		ТекстМесяца = НайтиТекстМесяца(Кол.Имя);
	//		Кол.ТекстШапки = СтрЗаменить(Кол.ТекстШапки,Лев(Кол.ТекстШапки,6),ТекстМесяца);
	//		Кол.ТекстШапки = СтрЗАменить(Кол.ТекстШапки,"сумма","Итого");
	//		Кол.Доступность = ложь;
	//	КонецЕсли;
	//	Если Найти(Кол.Имя,"Подразделение") Тогда 
	//		ТекстМесяца = НайтиТекстПодразделения(Кол.Имя);
	//		Кол.ТекстШапки = СтрЗаменить(Кол.ТекстШапки,Сред(Кол.Имя,Найти(Кол.Имя,"Подразделение"),14),ТекстМесяца);
	//		Кол.ТекстШапки = СтрЗАменить(Кол.ТекстШапки,"Итого","");
	//		Кол.ТекстШапки = СтрЗАменить(Кол.ТекстШапки,"подразделение1","Головное");
	//		Кол.ТекстШапки = СтрЗАменить(Кол.ТекстШапки,"подразделение2","Москва");
	//		Кол.ТекстШапки = СтрЗАменить(Кол.ТекстШапки,"подразделение3","Санкт-Петербург");
	//		Кол.ТекстШапки = СтрЗАменить(Кол.ТекстШапки,"подразделение4","Екатеринбург");
	//		Кол.ТекстШапки = СтрЗАменить(Кол.ТекстШапки,"подразделение5","Ростов-На-Дону");
	//		Кол.Доступность = истина;
	//	КонецЕсли;
	//КонецЦикла;	
	
	УстановитьЗаголовкиКолонокПериод();
	
	УстановитьЗаголовкиМесячные();
КонецПроцедуры

Процедура УстановитьЗаголовкиКолонокПериод()
	если ЗначениеЗаполнено(ПериодПланирования) Тогда
		
		для ии = 1 по 12 Цикл
				
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"Сумма"].Видимость = Истина;
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение1"].Видимость = Истина;
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение2"].Видимость = Истина;
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение3"].Видимость = Истина;
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение4"].Видимость = Истина;
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение5"].Видимость = Истина;
				
		КонецЦикла;
		
		соответствие = Новый Соответствие;
		соответствие.Вставить(1,"Январь");
		соответствие.Вставить(2,"Февраль");
		соответствие.Вставить(3,"Март");
		соответствие.Вставить(4,"Апрель");
		соответствие.Вставить(5,"Май");
		соответствие.Вставить(6,"Июнь");
		соответствие.Вставить(7,"Июль");
		соответствие.Вставить(8,"Август");
		соответствие.Вставить(9,"Сентябрь");
		соответствие.Вставить(10,"Октябрь");
		соответствие.Вставить(11,"Ноябрь");
		соответствие.Вставить(12,"Декабрь");
		
		Если Число(Формат(ПериодПланирования.ДатаНачала,"ДФ=yyyy")) = Число(Формат(ПериодПланирования.ДатаКонца,"ДФ=yyyy")) Тогда	
			КоличествоМесяцев = Число(Формат(ПериодПланирования.ДатаКонца,"ДФ=MM")) - Число(Формат(ПериодПланирования.ДатаНачала,"ДФ=MM")) +1;
		иначе
			КоличествоМесяцев = 12 - Число(Формат(ПериодПланирования.ДатаНачала,"ДФ=MM")) +1 + Число(Формат(ПериодПланирования.ДатаКонца,"ДФ=MM"));
		КонецЕсли;
				
		Датаии = ПериодПланирования.ДатаНачала;
		для ии = 1 по КоличествоМесяцев Цикл
						
			ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"Сумма"].ТекстШапки = соответствие.Получить(Число(Формат(Датаии,"ДФ=MM"))) + "(руб.)Итого";
			ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение1"].ТекстШапки = соответствие.Получить(Число(Формат(Датаии,"ДФ=MM")))+ "(руб.)Ярославль";
			ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение2"].ТекстШапки = соответствие.Получить(Число(Формат(Датаии,"ДФ=MM")))+ "(руб.)Москва";
			ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение3"].ТекстШапки = соответствие.Получить(Число(Формат(Датаии,"ДФ=MM")))+ "(руб.)Санкт-Петербург";
			ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение4"].ТекстШапки = соответствие.Получить(Число(Формат(Датаии,"ДФ=MM")))+ "(руб.)Екатеринбург";
			ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение5"].ТекстШапки = соответствие.Получить(Число(Формат(Датаии,"ДФ=MM")))+ "(руб.)Ростов на Дону";
			
			
						
			Датаии = ДобавитьМесяц(Датаии,1);
			
		КонецЦикла;
		
		Если ТолькоИтоги = 0 Тогда
			
			для ии = 1 по КоличествоМесяцев Цикл		
				//ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"Сумма"].Видимость = Ложь;
				
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение1"].Видимость = Ложь;
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение2"].Видимость = Ложь;
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение3"].Видимость = Ложь;
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение4"].Видимость = Ложь;
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение5"].Видимость = Ложь;						
			КонецЦикла;
			
			
		Иначе
			
			для ии = 1 по 12 Цикл
				
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"Сумма"].Видимость = Ложь;
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение1"].Видимость = Ложь;
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение2"].Видимость = Ложь;
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение3"].Видимость = Ложь;
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение4"].Видимость = Ложь;
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение5"].Видимость = Ложь;
				
			КонецЦикла;
			
			
			
		КонецЕсли;
	
			
			
		
		для ии = (КоличествоМесяцев +1) по 12 Цикл
			
			ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"Сумма"].Видимость = Ложь;
			ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение1"].Видимость = Ложь;
			ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение2"].Видимость = Ложь;
			ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение3"].Видимость = Ложь;
			ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение4"].Видимость = Ложь;
			ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение5"].Видимость = Ложь;
						
		КонецЦикла;
		
		
	иначе
		
		для ии = 1 по 12 Цикл
				
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"Сумма"].Видимость = Истина;
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение1"].Видимость = Истина;
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение2"].Видимость = Истина;
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение3"].Видимость = Истина;
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение4"].Видимость = Истина;
				ЭлементыФормы.Затраты.Колонки["Месяц"+Строка(ии)+"СуммаПодразделение5"].Видимость = Истина;
				
		КонецЦикла
		
	КонецЕсли;
	
КонецПроцедуры


Функция НайтиТекстМесяца(ИмяКолонки)
	
	соответствие = Новый Соответствие;
	соответствие.Вставить("Месяц1","Январь");
	соответствие.Вставить("Месяц2","Февраль");
	соответствие.Вставить("Месяц3","Март");
	соответствие.Вставить("Месяц4","Апрель");
	соответствие.Вставить("Месяц5","Май");
	соответствие.Вставить("Месяц6","Июнь");
	соответствие.Вставить("Месяц7","Июль");
	соответствие.Вставить("Месяц8","Август");
	соответствие.Вставить("Месяц9","Сентябрь");
	соответствие.Вставить("Месяц10","Октябрь");
	соответствие.Вставить("Месяц11","Ноябрь");
	соответствие.Вставить("Месяц12","Декабрь");
	
	ТекстМесяца = соответствие.Получить(ИмяКолонки);
	
	если ТекстМесяца = Неопределено тогда
		ТекстМесяца = "";
	КонецЕсли;
		
	ОбщийТекст = "";
	
	Если Найти(ИмяКолонки,"Количество") Тогда 
		ОбщийТекст = ТекстМесяца + "(шт.)";			
	Иначе 
		ОбщийТекст = ТекстМесяца + "(руб.)";			
	КонецЕсли;
	
	Возврат ОбщийТекст; 
	
КонецФункции

Процедура ДействияФормыДействиеПодготовить(Кнопка)
	// Вставить содержимое обработчика.
	Состояние=Перечисления.СостоянияОбъектов.Подготовлен;
	Записать(РежимЗаписиДокумента.Проведение);
	УстановитьВидимость();	
КонецПроцедуры

Процедура УстановитьВидимость()
	 ЭлементыФормы.НадписьПричинаОтклонения.Видимость=(Состояние=Перечисления.СостоянияОбъектов.Подготовлен) ИЛИ (Состояние=Перечисления.СостоянияОбъектов.Отклонен);
	 ЭлементыФормы.ПричинаОтклонения.Видимость=(Состояние=Перечисления.СостоянияОбъектов.Подготовлен) ИЛИ (Состояние=Перечисления.СостоянияОбъектов.Отклонен);
	 
	 ЭлементыФормы.ДействияФормы.Кнопки.ДействиеПодготовить.Доступность=ЗначениеНеЗаполнено(Состояние);
	 
	 ЭлементыФормы.ДействияФормы.Кнопки.ДействиеУтвердить.Доступность=(Состояние=Перечисления.СостоянияОбъектов.Подготовлен);
	 
	 ЭлементыФормы.ДействияФормы.Кнопки.ДействиеОтклонить.Доступность=(Состояние=Перечисления.СостоянияОбъектов.Подготовлен );
	 
	 ЭлементыФормы.ОсновныеДействияФормы.Кнопки.ОК.Доступность=ЗначениеНеЗаполнено(Состояние);
	 ЭлементыФормы.ОсновныеДействияФормы.Кнопки.Записать.Доступность=ЗначениеНеЗаполнено(Состояние);
	 
	 //Элементыформы.ПосмотретьСвод.Доступность = не (Состояние=Перечисления.СостоянияОбъектов.Подготовлен);
	 //Элементыформы.ЗаполнитьПоСводу.Доступность = не (Состояние=Перечисления.СостоянияОбъектов.Подготовлен);
	 
	 //Если (ТолькоИтоги=0) Тогда 
	 //	Для каждого Кол из ЭлементыФормы.Затраты.Колонки Цикл
	 //   	 Если Найти(Кол.имя,"Подразделение") Тогда
	 //   		Кол.Видимость = ложь;
	 //   	 Иначе 
	 //   		Кол.Видимость = Истина;	 
	 //   	 КонецЕсли;
	 //	КонецЦикла;	
	 //КонецЕсли;
	 
	 //Плотников
	 
	 
	 
	 УстановитьВидимостьВидаБюджета();
 Конецпроцедуры

Процедура Полугодие3ПриИзменении(Элемент)
	 // Вставить содержимое обработчика.
	 УстановитьЗаголовкиКолонок();
КонецПроцедуры

Процедура ДействияФормыДействиеУтвердить(Кнопка)
	 // Вставить содержимое обработчика.
	Состояние=Перечисления.СостоянияОбъектов.Утвержден;
	Записать(РежимЗаписиДокумента.Проведение);
	УстановитьВидимость();	 
КонецПроцедуры

Процедура ДействияФормыДействиеОтклонить(Кнопка)
	 // Вставить содержимое обработчика.
	Состояние=Перечисления.СостоянияОбъектов.Отклонен;
	Записать(РежимЗаписиДокумента.Проведение);
	УстановитьВидимость();	 
КонецПроцедуры

Процедура КоманднаяПанель1Заполнить(Кнопка)
	//// Вставить содержимое обработчика.
	////Запрос = Новый Запрос("Выбрать Ссылка из Справочник.СтатьиРасходов Где не ПометкаУдаления и Ответственный=&ТекПользователь Упорядочить по Наименование");
	////Запрос.УстановитьПараметр("Текпользователь",глТекущийПользователь);
	////Выб = Запрос.Выполнить().Выбрать();
	////
	////Затраты.Очистить();
	////
	////Пока Выб.Следующий() Цикл
	////	Стр = Затраты.Добавить();
	////	Стр.Статья = Выб.Ссылка;
	////КонеЦЦИкла;
	//
	//Если Модифицированность() Тогда
	//	Ответ = Вопрос("Перед заполнением необходимо записать документ.",РежимДиалогаВопрос.ДаНетОтмена);
	//	Если (Ответ = КодВозвратаДиалога.Да) Тогда 
	//		Записан = ЗаписатьВФорме();
	//		Если не Записан Тогда 
	//			Сообщить("Невозможно записать документ.",СтатусСообщения.Важное);
	//			Возврат;
	//		КонецЕсли;
	//	Иначе 
	//		Возврат;
	//	КонецЕсли;		
	//КонецЕсли;
	//
	//ИмяФормы = Справочники.ВнешниеОбработки.НайтиПоНаименованию("Заполнение бюджета расходов");
	//ИмяФайла = КаталогВременныхФайлов()+"TmpForm.tmp";
	//ОбъектВнешнейФормы = ИмяФормы.ПолучитьОбъект();
	//Если ОбъектВнешнейФормы = Неопределено Тогда
	//	Сообщить("Ошибка получения внешней формы для заполнения. Возможно форма была удалена", СтатусСообщения.Важное);
	//	Возврат;
	//КонецЕсли;
	//	
	//ДвоичныеДанные = ОбъектВнешнейФормы.ХранилищеВнешнейОбработки.Получить();
	//ДвоичныеДанные.Записать(ИмяФайла);
	//Обработка = ВнешниеОбработки.Создать(ИмяФайла);
	//Обработка.СсылкаНаОбъектОбщ = ЭтотОбъект.Ссылка;
	//Обработка.ПерезаполнитьДокумент();
	//ЭтотОбъект.Прочитать();
	//ЭтаФорма.Обновить();
	
	Затраты.Очистить();
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Польз",глТекущийПользователь);
	Запрос.Текст = "ВЫБРАТЬ
	               |	СтатьиЗатрат.Ссылка
	               |ИЗ
	               |	Справочник.СтатьиЗатрат КАК СтатьиЗатрат
	               |ГДЕ
	               |	СтатьиЗатрат.Ответственный = &Польз";
	Рез = Запрос.Выполнить().Выгрузить();			   
	Для каждого стр из рез Цикл
		Нов = Затраты.Добавить();
		Нов.Статья = стр.Ссылка;
	КонецЦикла;
	
	ЭтаФорма.Обновить();	
КонецПроцедуры

Процедура КоманднаяПанель1ЗаполнитьИзExcel(Кнопка)
	// Вставить содержимое обработчика.
	Если Модифицированность() Тогда
		Ответ = Вопрос("Перед заполнением необходимо записать документ.",РежимДиалогаВопрос.ДаНетОтмена);
		Если (Ответ = КодВозвратаДиалога.Да) Тогда 
			Записан = ЗаписатьВФорме();
			Если не Записан Тогда 
				Сообщить("Невозможно записать документ.",СтатусСообщения.Важное);
				Возврат;
			КонецЕсли;
		Иначе 
			Возврат;
		КонецЕсли;		
	КонецЕсли;
	
	ИмяФормы = Справочники.ВнешниеОбработки.НайтиПоНаименованию("Заполнение бюджета расходов");
	ИмяФайла = КаталогВременныхФайлов()+"TmpForm.tmp";
	ОбъектВнешнейФормы = ИмяФормы.ПолучитьОбъект();
	Если ОбъектВнешнейФормы = Неопределено Тогда
		Сообщить("Ошибка получения внешней формы для заполнения. Возможно форма была удалена", СтатусСообщения.Важное);
		Возврат;
	КонецЕсли;
		
	ДвоичныеДанные = ОбъектВнешнейФормы.ХранилищеВнешнейОбработки.Получить();
	ДвоичныеДанные.Записать(ИмяФайла);
	Обработка = ВнешниеОбработки.Создать(ИмяФайла);
	Обработка.СсылкаНаОбъектОбщ = Ссылка;
	Форма = Обработка.ПолучитьФорму("ЗаполнениеИзЭксель");
	Форма.СсылкаНаОбъект = Ссылка;
	Форма.ОткрытьМодально();
	ЭтотОбъект.Прочитать();
    ЭтаФорма.Обновить();
	
КонецПроцедуры

Процедура ЗатратыПриОкончанииРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования)
	
	если Найти(Элемент.ТекущаяКолонка.Имя,"Подразделение") > 0  Тогда

		Элемент.ТекущаяСтрока[Лев(Элемент.ТекущаяКолонка.Имя,Найти(Элемент.ТекущаяКолонка.Имя,"Подразделение")-1)] =
		
		Элемент.ТекущаяСтрока[Лев(Элемент.ТекущаяКолонка.Имя,СтрДлина(Элемент.ТекущаяКолонка.Имя)-1) + "1"]  
		+Элемент.ТекущаяСтрока[Лев(Элемент.ТекущаяКолонка.Имя,СтрДлина(Элемент.ТекущаяКолонка.Имя)-1) + "2"]
		+Элемент.ТекущаяСтрока[Лев(Элемент.ТекущаяКолонка.Имя,СтрДлина(Элемент.ТекущаяКолонка.Имя)-1) + "3"]
		+Элемент.ТекущаяСтрока[Лев(Элемент.ТекущаяКолонка.Имя,СтрДлина(Элемент.ТекущаяКолонка.Имя)-1) + "4"]
		+Элемент.ТекущаяСтрока[Лев(Элемент.ТекущаяКолонка.Имя,СтрДлина(Элемент.ТекущаяКолонка.Имя)-1) + "5"];
		
	//иначеЕсли Найти(Элемент.ТекущаяКолонка.Имя,"Статья") = 0  Тогда
	//	Сум = Элемент.ТекущаяСтрока[Элемент.ТекущаяКолонка.Имя+"Подразделение1"]  
	//	+Элемент.ТекущаяСтрока[Элемент.ТекущаяКолонка.Имя+"Подразделение2"]
	//	+Элемент.ТекущаяСтрока[Элемент.ТекущаяКолонка.Имя+"Подразделение3"]
	//	+Элемент.ТекущаяСтрока[Элемент.ТекущаяКолонка.Имя+"Подразделение4"]
	//	+Элемент.ТекущаяСтрока[Элемент.ТекущаяКолонка.Имя+"Подразделение5"];
	//	
	//	Разница = Элемент.ТекущаяСтрока[Элемент.ТекущаяКолонка.Имя] - Сум;
	//	
	//	Элемент.ТекущаяСтрока[Элемент.ТекущаяКолонка.Имя+"Подразделение1"] = Элемент.ТекущаяСтрока[Элемент.ТекущаяКолонка.Имя+"Подразделение1"] + Разница;
			
	КонецЕсли;
	
КонецПроцедуры

Процедура Полугодие1ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	УстановитьЗаголовкиКолонок();
КонецПроцедуры

Процедура ВсеПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Если (ТолькоИтоги=1) Тогда 
		// выводим форму выбора месяца
		соответствие = Новый Соответствие;
		соответствие.Вставить(1,"Январь");
		соответствие.Вставить(2,"Февраль");
		соответствие.Вставить(3,"Март");
		соответствие.Вставить(4,"Апрель");
		соответствие.Вставить(5,"Май");
		соответствие.Вставить(6,"Июнь");
		соответствие.Вставить(7,"Июль");
		соответствие.Вставить(8,"Август");
		соответствие.Вставить(9,"Сентябрь");
		соответствие.Вставить(10,"Октябрь");
		соответствие.Вставить(11,"Ноябрь");
		соответствие.Вставить(12,"Декабрь");
		
		Попытка
			
			Если Число(Формат(ПериодПланирования.ДатаНачала,"ДФ=yyyy")) = Число(Формат(ПериодПланирования.ДатаКонца,"ДФ=yyyy")) Тогда	
				КоличествоМесяцев = Число(Формат(ПериодПланирования.ДатаКонца,"ДФ=MM")) - Число(Формат(ПериодПланирования.ДатаНачала,"ДФ=MM")) +1;
			иначе
				КоличествоМесяцев = 12 - Число(Формат(ПериодПланирования.ДатаНачала,"ДФ=MM")) +1 + Число(Формат(ПериодПланирования.ДатаКонца,"ДФ=MM"));
			КонецЕсли;
			
		Исключение
			
			Возврат;
			
		КонецПопытки;
		
		Месяцы = Новый СписокЗначений;
		
		Датаии = ПериодПланирования.ДатаНачала;
		
		для ии = 1 по КоличествоМесяцев Цикл
			
			Месяцы.Добавить(соответствие.Получить(Число(Формат(Датаии,"ДФ=MM"))));
						
			Датаии = ДобавитьМесяц(Датаии,1);
			
		КонецЦикла;
    
		Месяц= ВыбратьИзСписка(Месяцы,Элемент);			
		МесяцМ = НайтиНомерМесяца(Месяц);
		УстановитьМесяц(МесяцМ);
		// Делаем распределенеи по колонкам 
		Если Месяц<>неопределено Тогда 
			Для каждого Кол из ЭлементыФормы.Затраты.Колонки Цикл
				Если Найти(Кол.ТекстШапки,Месяц) Тогда 
					Кол.Видимость = истина;
				ИначеЕсли Кол.ТекстШапки<>"Статья" тогда
					Кол.Видимость = ложь;
				КонецЕсли;
			конеЦЦикла;
		КонецЕсли;
		
		УстановитьЗаголовкиМесячные();
	Иначе 
		МесяцМ = 1;
		УстановитьМесяц(МесяцМ);
		УстановитьВидимость();		
		УстановитьЗаголовкиКолонок();
	КонецЕсли;
	
	УстановитьЗаголовкиМесячные();
	
	НадписьТМ = НайтиТекстМесяца("Месяц"+?(МесяцМ = неопределено,1,МесяцМ));
	НадписьТМ = СтрЗаменить(НадписьТМ,"(руб.)","");	
КонецПроцедуры

Функция НайтиТекстПодразделения(Имя)
	
	Если (Найти(Имя,"Подразделение1")) Тогда
		ТекстМесяца = "Головное";
	КонецЕсли;
	
	Если (Найти(Имя,"Подразделение2")) Тогда
		ТекстМесяца = "Москва";
	КонецЕсли;

	Если (Найти(Имя,"Подразделение3")) Тогда
		ТекстМесяца = "Санкт-Петербург";
	КонецЕсли;
	
	Если (Найти(Имя,"Подразделение4")) Тогда
		ТекстМесяца = "Екатеринбург";
	КонецЕсли;
	
	Если (Найти(Имя,"Подразделение5")) Тогда
		ТекстМесяца = "Ростов-На-Дону";
	КонецЕсли;
	
	ОбщийТекст = ТекстМесяца + "(шт.)";			
	
	Возврат ОбщийТекст; 
	
	
конецФункции

Процедура ЗатратыМесяц1СуммаПодразделение1ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц1Сумма = СуммироватьПоподразделениямСтроки("Месяц1",Текущаястрока);
КонецПроцедуры

Функция СуммироватьПоПодразделениямСтроки(Месяц,Текущаястрока)
	Возврат Текущаястрока[Месяц+"СуммаПодразделение1"] + Текущаястрока[Месяц+"СуммаПодразделение2"] + Текущаястрока[Месяц+"СуммаПодразделение3"] + Текущаястрока[Месяц+"СуммаПодразделение4"] + Текущаястрока[Месяц+"СуммаПодразделение5"];
КонецФункции

Процедура ЗатратыМесяц1СуммаПодразделение2ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц1Сумма = СуммироватьПоподразделениямСтроки("Месяц1",Текущаястрока);
КонецПроцедуры

Процедура ЗатратыМесяц1СуммаПодразделение3ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц1Сумма = СуммироватьПоподразделениямСтроки("Месяц1",Текущаястрока);	
КонецПроцедуры

Процедура ЗатратыМесяц1СуммаПодразделение4ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц1Сумма = СуммироватьПоподразделениямСтроки("Месяц1",Текущаястрока);		
КонецПроцедуры

Процедура ЗатратыМесяц1СуммаПодразделение5ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц1Сумма = СуммироватьПоподразделениямСтроки("Месяц1",Текущаястрока);		
КонецПроцедуры

Процедура ЗатратыМесяц2СуммаПодразделение1ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц2Сумма = СуммироватьПоподразделениямСтроки("Месяц2",Текущаястрока);	
КонецПроцедуры

Процедура ЗатратыМесяц2СуммаПодразделение2ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц2Сумма = СуммироватьПоподразделениямСтроки("Месяц2",Текущаястрока);		
КонецПроцедуры

Процедура ЗатратыМесяц2СуммаПодразделение3ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц2Сумма = СуммироватьПоподразделениямСтроки("Месяц2",Текущаястрока);		
КонецПроцедуры

Процедура ЗатратыМесяц2СуммаПодразделение4ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц2Сумма = СуммироватьПоподразделениямСтроки("Месяц2",Текущаястрока);		
КонецПроцедуры

Процедура ЗатратыМесяц2СуммаПодразделение5ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц2Сумма = СуммироватьПоподразделениямСтроки("Месяц2",Текущаястрока);		
КонецПроцедуры

Процедура ЗатратыМесяц3СуммаПодразделение1ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц3Сумма = СуммироватьПоподразделениямСтроки("Месяц3",Текущаястрока);		
КонецПроцедуры

Процедура ЗатратыМесяц3СуммаПодразделение2ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц3Сумма = СуммироватьПоподразделениямСтроки("Месяц3",Текущаястрока);			
КонецПроцедуры

Процедура ЗатратыМесяц3СуммаПодразделение3ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц3Сумма = СуммироватьПоподразделениямСтроки("Месяц3",Текущаястрока);				
КонецПроцедуры

Процедура ЗатратыМесяц3СуммаПодразделение4ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц3Сумма = СуммироватьПоподразделениямСтроки("Месяц3",Текущаястрока);				
КонецПроцедуры

Процедура ЗатратыМесяц3СуммаПодразделение5ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц3Сумма = СуммироватьПоподразделениямСтроки("Месяц3",Текущаястрока);				
КонецПроцедуры

Процедура ЗатратыМесяц4СуммаПодразделение1ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц4Сумма = СуммироватьПоподразделениямСтроки("Месяц4",Текущаястрока);					
КонецПроцедуры

Процедура ЗатратыМесяц4СуммаПодразделение2ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц4Сумма = СуммироватьПоподразделениямСтроки("Месяц4",Текущаястрока);						
КонецПроцедуры

Процедура ЗатратыМесяц4СуммаПодразделение3ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц4Сумма = СуммироватьПоподразделениямСтроки("Месяц4",Текущаястрока);						
КонецПроцедуры

Процедура ЗатратыМесяц4СуммаПодразделение4ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц4Сумма = СуммироватьПоподразделениямСтроки("Месяц4",Текущаястрока);						
КонецПроцедуры

Процедура ЗатратыМесяц4СуммаПодразделение5ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц4Сумма = СуммироватьПоподразделениямСтроки("Месяц4",Текущаястрока);						
КонецПроцедуры

Процедура ЗатратыМесяц5СуммаПодразделение1ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц5Сумма = СуммироватьПоподразделениямСтроки("Месяц5",Текущаястрока);						
КонецПроцедуры

Процедура ЗатратыМесяц5СуммаПодразделение2ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц5Сумма = СуммироватьПоподразделениямСтроки("Месяц5",Текущаястрока);							
КонецПроцедуры

Процедура ЗатратыМесяц5СуммаПодразделение3ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц5Сумма = СуммироватьПоподразделениямСтроки("Месяц5",Текущаястрока);							
КонецПроцедуры

Процедура ЗатратыМесяц5СуммаПодразделение4ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц5Сумма = СуммироватьПоподразделениямСтроки("Месяц5",Текущаястрока);							
КонецПроцедуры

Процедура ЗатратыМесяц5СуммаПодразделение5ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц5Сумма = СуммироватьПоподразделениямСтроки("Месяц5",Текущаястрока);							
КонецПроцедуры

Процедура ЗатратыМесяц6СуммаПодразделение1ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц6Сумма = СуммироватьПоподразделениямСтроки("Месяц6",Текущаястрока);							
КонецПроцедуры

Процедура ЗатратыМесяц6СуммаПодразделение2ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц6Сумма = СуммироватьПоподразделениямСтроки("Месяц6",Текущаястрока);								
КонецПроцедуры

Процедура ЗатратыМесяц6СуммаПодразделение3ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц6Сумма = СуммироватьПоподразделениямСтроки("Месяц6",Текущаястрока);								
КонецПроцедуры

Процедура ЗатратыМесяц6СуммаПодразделение4ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц6Сумма = СуммироватьПоподразделениямСтроки("Месяц6",Текущаястрока);								
КонецПроцедуры

Процедура ЗатратыМесяц6СуммаПодразделение5ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	Текущаястрока.Месяц6Сумма = СуммироватьПоподразделениямСтроки("Месяц6",Текущаястрока);								
КонецПроцедуры

Процедура КоманднаяПанель1ЗаполнитьРазные(Кнопка)
	// Вставить содержимое обработчика.
	Если Модифицированность() Тогда
		Ответ = Вопрос("Перед заполнением необходимо записать документ.",РежимДиалогаВопрос.ДаНетОтмена);
		Если (Ответ = КодВозвратаДиалога.Да) Тогда 
			Записан = ЗаписатьВФорме();
			Если не Записан Тогда 
				Сообщить("Невозможно записать документ.",СтатусСообщения.Важное);
				Возврат;
			КонецЕсли;
		Иначе 
			Возврат;
		КонецЕсли;		
	КонецЕсли;
	
	ИмяФормы = Справочники.ВнешниеОбработки.НайтиПоНаименованию("Заполнение бюджета расходов");
	ИмяФайла = КаталогВременныхФайлов()+"TmpForm.tmp";
	ОбъектВнешнейФормы = ИмяФормы.ПолучитьОбъект();
	Если ОбъектВнешнейФормы = Неопределено Тогда
		Сообщить("Ошибка получения внешней формы для заполнения. Возможно форма была удалена", СтатусСообщения.Важное);
		Возврат;
	КонецЕсли;
		
	ДвоичныеДанные = ОбъектВнешнейФормы.ХранилищеВнешнейОбработки.Получить();
	ДвоичныеДанные.Записать(ИмяФайла);
	Обработка = ВнешниеОбработки.Создать(ИмяФайла);
	Обработка.СсылкаНаОбъектОбщ = ЭтотОбъект.Ссылка;
	МассивЗаполнения = Обработка.Заполнение(ТолькоИтоги);
	
	Если ЗначениеЗаполнено(МассивЗаполнения) Тогда 
		й=0;
		Если (МассивЗаполнения.количество()>1) Тогда 
			Для Каждого Стр из МассивЗаполнения Цикл
				й = й+1;
				Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
				Если Не ЗначениеЗаполнено(стр.Москва) Тогда 
					ТЕкущаястрока["Месяц"+й+"СуммаПодразделение1"] = стр.Головное;
					ТЕкущаястрока["Месяц"+й+"Сумма"] = стр.Головное;					
				Иначе 
					ТЕкущаястрока["Месяц"+й+"СуммаПодразделение1"] = стр.Головное;
					ТЕкущаястрока["Месяц"+й+"СуммаПодразделение2"] = стр.Москва;
					ТЕкущаястрока["Месяц"+й+"СуммаПодразделение3"] = стр.СПБ;
					ТЕкущаястрока["Месяц"+й+"СуммаПодразделение4"] = стр.ЕКБ;
					ТЕкущаястрока["Месяц"+й+"СуммаПодразделение5"] = стр.РНД;
					ТЕкущаястрока["Месяц"+й+"Сумма"] = стр.Головное + стр.Москва + стр.СПБ + стр.ЕКБ + стр.РНД;
				КонецЕсли;
			КонецЦикла;
		Иначе 			
			Если ТолькоИтоги=1 Тогда 
				Стр = МассивЗаполнения[0];
				Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
				Текущаястрока["Месяц"+НайтиНомерМесяца(Месяц)+"СуммаПодразделение"+1] = стр.Головное;
				Текущаястрока["Месяц"+НайтиНомерМесяца(Месяц)+"СуммаПодразделение"+2] = стр.Москва;
				Текущаястрока["Месяц"+НайтиНомерМесяца(Месяц)+"СуммаПодразделение"+3] = стр.СПБ;
				Текущаястрока["Месяц"+НайтиНомерМесяца(Месяц)+"СуммаПодразделение"+4] = стр.ЕКБ;
				Текущаястрока["Месяц"+НайтиНомерМесяца(Месяц)+"СуммаПодразделение"+5] = стр.РНД;				
				ТЕкущаястрока["Месяц"+НайтиНомерМесяца(Месяц)+"Сумма"] = стр.Головное + стр.Москва + стр.СПБ + стр.ЕКБ + стр.РНД;
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	//Если ТолькоИтоги = 0 Тогда 
	//	Если ЗначениеЗаполнено(МассивЗаполнения) Тогда 
	//		// Распределяем
	//		Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	//		Если ЗначениеЗаполнено(Текущаястрока) Тогда 
	//			Попытка 
	//				й = 0;
	//				Для каждого СтрХ из МассивЗаполнения Цикл
	//					й = й + 1;
	//					Текущаястрока["Месяц"+й+"СуммаПодразделение1"] = СтрХ;
	//					Текущаястрока["Месяц"+й+"Сумма"] = СтрХ + Текущаястрока["Месяц"+й+"СуммаПодразделение2"] + Текущаястрока["Месяц"+й+"СуммаПодразделение3"] + Текущаястрока["Месяц"+й+"СуммаПодразделение4"] + Текущаястрока["Месяц"+й+"СуммаПодразделение5"];
	//				КонецЦикла;	
	//			Исключение
	//					;
	//			КонецПопытки;	
	//		КонецЕсли;
	//	КонецЕсли;
	//Иначе 
	//	Если ЗначениеЗаполнено(МассивЗаполнения) Тогда 
	//		// Распределяем
	//		Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	//		Если ЗначениеЗаполнено(Текущаястрока) Тогда 
	//			Попытка 
	//				й = 0;
	//				Сумма = 0;
	//				Для каждого СтрХ из МассивЗаполнения Цикл
	//					й = й + 1;
	//					Текущаястрока["Месяц"+НайтиНомерМесяца(Месяц)+"СуммаПодразделение"+й] = СтрХ;
	//					Сумма = Сумма + СтрХ;
	//				КонецЦикла;	
	//				Текущаястрока["Месяц"+НайтиНомерМесяца(Месяц)+"Сумма"] = Сумма;
	//			Исключение
	//					;
	//			КонецПопытки;	
	//		КонецЕсли;
	//	КонецЕсли;					
	//КонецЕсли;	
	
//	ЭтотОбъект.Прочитать();
//  ЭтаФорма.Обновить();
КонецПроцедуры

Функция НайтиНомерМесяца(МесяцХ)
	Если типзнч(МесяцХ)=типЗнч("") Тогда 
	Иначе 
		Месяц = МесяцХ.Значение;
	КонецЕсли;
	Если (Месяц="Январь" или Месяц="Июль") Тогда 
		Возврат 1;
	ИначеЕсли (Месяц="Февраль" или Месяц="Август") Тогда 
		Возврат 2;	
	ИначеЕсли (Месяц="Март" или Месяц="Сентябрь") Тогда 
		Возврат 3;	
	ИначеЕсли (Месяц="Апрель" или Месяц="Октябрь") Тогда 
		Возврат 4;	
	ИначеЕсли (Месяц="Май" или Месяц="Ноябрь") Тогда 
		Возврат 5;	
	ИначеЕсли (Месяц="Июнь" или Месяц="Декабрь") Тогда 
		Возврат 6;	
	КонецЕсли;
КонецФункции

Процедура КоманднаяПанель1ЗаполнитьПоМесяцу(Кнопка)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.Затраты.ТекущиеДанные;
	
	Если ТолькоИтоги=1 Тогда
		Если (Месяц="Январь" или Месяц="Июль") Тогда 
			СуммаОбщ = текущаястрока.Месяц1Сумма;
			Подр1= текущаястрока.Месяц1СуммаПодразделение1;
			Подр2= текущаястрока.Месяц1СуммаПодразделение2;
			Подр3= текущаястрока.Месяц1СуммаПодразделение3;
			Подр4= текущаястрока.Месяц1СуммаПодразделение4;
			Подр5= текущаястрока.Месяц1СуммаПодразделение5;
		ИначеЕсли (Месяц="Февраль" или Месяц="Август") Тогда 
			СуммаОбщ = текущаястрока.Месяц2Сумма;
			Подр1= текущаястрока.Месяц2СуммаПодразделение1;
			Подр2= текущаястрока.Месяц2СуммаПодразделение2;
			Подр3= текущаястрока.Месяц2СуммаПодразделение3;
			Подр4= текущаястрока.Месяц2СуммаПодразделение4;
			Подр5= текущаястрока.Месяц2СуммаПодразделение5;
		ИначеЕсли (Месяц="Март" или Месяц="Сентябрь") Тогда 
			СуммаОбщ = текущаястрока.Месяц3Сумма;
			Подр1= текущаястрока.Месяц3СуммаПодразделение1;
			Подр2= текущаястрока.Месяц3СуммаПодразделение2;
			Подр3= текущаястрока.Месяц3СуммаПодразделение3;
			Подр4= текущаястрока.Месяц3СуммаПодразделение4;
			Подр5= текущаястрока.Месяц3СуммаПодразделение5;
		ИначеЕсли (Месяц="Апрель" или Месяц="Октябрь") Тогда 
			СуммаОбщ = текущаястрока.Месяц4Сумма;
			Подр1= текущаястрока.Месяц4СуммаПодразделение1;
			Подр2= текущаястрока.Месяц4СуммаПодразделение2;
			Подр3= текущаястрока.Месяц4СуммаПодразделение3;
			Подр4= текущаястрока.Месяц4СуммаПодразделение4;
			Подр5= текущаястрока.Месяц4СуммаПодразделение5;			
		ИначеЕсли (Месяц="Май" или Месяц="Ноябрь") Тогда 
			СуммаОбщ = текущаястрока.Месяц5Сумма;
			Подр1= текущаястрока.Месяц5СуммаПодразделение1;
			Подр2= текущаястрока.Месяц5СуммаПодразделение2;
			Подр3= текущаястрока.Месяц5СуммаПодразделение3;
			Подр4= текущаястрока.Месяц5СуммаПодразделение4;
			Подр5= текущаястрока.Месяц5СуммаПодразделение5;			
		ИначЕ
			СуммаОбщ = текущаястрока.Месяц6Сумма;
			Подр1= текущаястрока.Месяц6СуммаПодразделение1;
			Подр2= текущаястрока.Месяц6СуммаПодразделение2;
			Подр3= текущаястрока.Месяц6СуммаПодразделение3;
			Подр4= текущаястрока.Месяц6СуммаПодразделение4;
			Подр5= текущаястрока.Месяц6СуммаПодразделение5;			
		КонецЕсли;
		
		Для  й = 1 по 6 Цикл
			текущаястрока["Месяц"+й+"Сумма"] = СуммаОбщ;
			текущаястрока["Месяц"+й+"СуммаПодразделение1"] = Подр1;
			текущаястрока["Месяц"+й+"СуммаПодразделение2"] = Подр2;
			текущаястрока["Месяц"+й+"СуммаПодразделение3"] = Подр3;			
			текущаястрока["Месяц"+й+"СуммаПодразделение4"] = Подр4;
			текущаястрока["Месяц"+й+"СуммаПодразделение5"] = Подр5;			
		КонецЦикла;	
	Иначе
		Для й=2 по 6 Цикл
			Для каждого стрХ из Затраты Цикл
				стрХ["Месяц"+й+"Сумма"] = СтрХ["Месяц1Сумма"];
				стрХ["Месяц"+й+"СуммаПодразделение1"] = стрХ["Месяц1СуммаПодразделение1"];
				стрХ["Месяц"+й+"СуммаПодразделение2"] = стрХ["Месяц1СуммаПодразделение2"];
				стрХ["Месяц"+й+"СуммаПодразделение3"] = стрХ["Месяц1СуммаПодразделение3"];
				стрХ["Месяц"+й+"СуммаПодразделение4"] = стрХ["Месяц1СуммаПодразделение4"];
				стрХ["Месяц"+й+"СуммаПодразделение5"] = стрХ["Месяц1СуммаПодразделение5"];
			КонецЦикла;
		КонецЦикла;		
	КонецЕсли;
КонецПроцедуры

Процедура ЗатратыПередОкончаниемРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования, Отказ)
	// Вставить содержимое обработчика.
	РассчитатьИтогоВподвале();
КонецПроцедуры

Процедура ЗатратыПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	// Вставить содержимое обработчика.
	ОформлениеСтроки.Ячейки.Итого.ОтображатьТЕкст=Истина;
	ОформлениеСтроки.Ячейки.Итого.Текст = Строка(Данныестроки.Месяц1Сумма + Данныестроки.Месяц2Сумма + Данныестроки.Месяц3Сумма + Данныестроки.Месяц4Сумма + Данныестроки.Месяц5Сумма + Данныестроки.Месяц6Сумма
	+Данныестроки.Месяц7Сумма + Данныестроки.Месяц8Сумма + Данныестроки.Месяц9Сумма + Данныестроки.Месяц10Сумма + Данныестроки.Месяц11Сумма + Данныестроки.Месяц12Сумма);
	Если (ОформлениеСтроки.Ячейки.Итого.Значение = "0") Тогда 
		ОформлениеСтроки.Ячейки.Итого.Значение = "";
	КонецЕсли;
	РассчитатьИтогоВподвале();
КонецПроцедуры

Процедура УстановитьПодвал()
	ЭлементыФормы.Затраты.Колонки["Месяц1Сумма"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц2Сумма"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц3Сумма"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц4Сумма"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц5Сумма"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц6Сумма"].ОтображатьИтогиВПодвале = Истина;
	
	ЭлементыФормы.Затраты.Колонки["Месяц7Сумма"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц8Сумма"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц9Сумма"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц10Сумма"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц11Сумма"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц12Сумма"].ОтображатьИтогиВПодвале = Истина;
	
	ЭлементыФормы.Затраты.Колонки["Месяц1СуммаПодразделение1"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц1СуммаПодразделение2"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц1СуммаПодразделение3"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц1СуммаПодразделение4"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц1СуммаПодразделение5"].ОтображатьИтогиВПодвале = Истина;
	
	ЭлементыФормы.Затраты.Колонки["Месяц2СуммаПодразделение1"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц2СуммаПодразделение2"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц2СуммаПодразделение3"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц2СуммаПодразделение4"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц2СуммаПодразделение5"].ОтображатьИтогиВПодвале = Истина;
	
	ЭлементыФормы.Затраты.Колонки["Месяц3СуммаПодразделение1"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц3СуммаПодразделение2"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц3СуммаПодразделение3"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц3СуммаПодразделение4"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц3СуммаПодразделение5"].ОтображатьИтогиВПодвале = Истина;
	
	ЭлементыФормы.Затраты.Колонки["Месяц4СуммаПодразделение1"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц4СуммаПодразделение2"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц4СуммаПодразделение3"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц4СуммаПодразделение4"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц4СуммаПодразделение5"].ОтображатьИтогиВПодвале = Истина;
	
	ЭлементыФормы.Затраты.Колонки["Месяц5СуммаПодразделение1"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц5СуммаПодразделение2"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц5СуммаПодразделение3"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц5СуммаПодразделение4"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц5СуммаПодразделение5"].ОтображатьИтогиВПодвале = Истина;
	
	ЭлементыФормы.Затраты.Колонки["Месяц6СуммаПодразделение1"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц6СуммаПодразделение2"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц6СуммаПодразделение3"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц6СуммаПодразделение4"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц6СуммаПодразделение5"].ОтображатьИтогиВПодвале = Истина;
	
	ЭлементыФормы.Затраты.Колонки["Месяц7СуммаПодразделение1"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц7СуммаПодразделение2"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц7СуммаПодразделение3"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц7СуммаПодразделение4"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц7СуммаПодразделение5"].ОтображатьИтогиВПодвале = Истина;
	
		
	ЭлементыФормы.Затраты.Колонки["Месяц8СуммаПодразделение1"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц8СуммаПодразделение2"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц8СуммаПодразделение3"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц8СуммаПодразделение4"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц8СуммаПодразделение5"].ОтображатьИтогиВПодвале = Истина;
	
	ЭлементыФормы.Затраты.Колонки["Месяц9СуммаПодразделение1"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц9СуммаПодразделение2"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц9СуммаПодразделение3"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц9СуммаПодразделение4"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц9СуммаПодразделение5"].ОтображатьИтогиВПодвале = Истина;
	
	ЭлементыФормы.Затраты.Колонки["Месяц10СуммаПодразделение1"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц10СуммаПодразделение2"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц10СуммаПодразделение3"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц10СуммаПодразделение4"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц10СуммаПодразделение5"].ОтображатьИтогиВПодвале = Истина;
	
	ЭлементыФормы.Затраты.Колонки["Месяц11СуммаПодразделение1"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц11СуммаПодразделение2"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц11СуммаПодразделение3"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц11СуммаПодразделение4"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц11СуммаПодразделение5"].ОтображатьИтогиВПодвале = Истина;
	
	ЭлементыФормы.Затраты.Колонки["Месяц12СуммаПодразделение1"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц12СуммаПодразделение2"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц12СуммаПодразделение3"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц12СуммаПодразделение4"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.Затраты.Колонки["Месяц12СуммаПодразделение5"].ОтображатьИтогиВПодвале = Истина;

	
	//ЭлементыФормы.Затраты.Колонки["Итого"].ОтображатьИтогиВПодвале = Истина;
	
	ЭлементыФормы.ТаблицаЗатрат.Колонки["Месяц1Сумма"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.ТаблицаЗатрат.Колонки["Месяц1СуммаПодразделение1"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.ТаблицаЗатрат.Колонки["Месяц1СуммаПодразделение2"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.ТаблицаЗатрат.Колонки["Месяц1СуммаПодразделение3"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.ТаблицаЗатрат.Колонки["Месяц1СуммаПодразделение4"].ОтображатьИтогиВПодвале = Истина;
	ЭлементыФормы.ТаблицаЗатрат.Колонки["Месяц1СуммаПодразделение5"].ОтображатьИтогиВПодвале = Истина;
	
КонецПроцедуры

Процедура РассчитатьИтогоВподвале()
	ЭлементыФормы.Затраты.Колонки.итого.ТекстПодвала = Строка(Затраты.Итог("Месяц1Сумма") + Затраты.Итог("Месяц2Сумма") + Затраты.Итог("Месяц3Сумма") + Затраты.Итог("Месяц4Сумма") + Затраты.Итог("Месяц5Сумма") + Затраты.Итог("Месяц6Сумма")
	+Затраты.Итог("Месяц7Сумма") + Затраты.Итог("Месяц8Сумма") + Затраты.Итог("Месяц9Сумма") + Затраты.Итог("Месяц10Сумма") + Затраты.Итог("Месяц11Сумма") + Затраты.Итог("Месяц12Сумма"));
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	// Вставить содержимое обработчика.
	РассчитатьИтогоВподвале();
КонецПроцедуры

Процедура ДействияФормыВидОперации(Кнопка)
	// Вставить содержимое обработчика.
КонецПроцедуры

Процедура ДействияФормыПолугодовойБюджет(Кнопка)
	// Вставить содержимое обработчика.
	Если Не ЗначениеЗаполнено(ДокументОснование) Тогда 
		ВидОперации = Перечисления.ВидБюджета.Полугодие;
	Иначе 
		Сообщить("Нельзя устанавливать для этого документа вид операции ""полугодие""",СтатусСообщения.Важное);
		ВидОперации = Перечисления.ВидБюджета.Месяц;
	КонецЕсли;
	
	УстановитьВидимостьВидаБюджета();
КонецПроцедуры

Процедура ДействияФормыМесячныйБюджет(Кнопка)
	// Вставить содержимое обработчика.
	ВидОперации = Перечисления.ВидБюджета.Месяц;
	УстановитьВидимостьВидаБюджета();
КонецПроцедуры

Процедура УстановитьВидимостьВидаБюджета()
	 Если ВидОперации = Перечисления.ВидБюджета.Полугодие Тогда 
		 ЭлементыФормы.ЗатратыМесяц.Страницы.Страница1.Видимость = Ложь;
		 ЭлементыФормы.ЗатратыМесяц.Страницы.Страница1.Доступность = Ложь;
		 ЭлементыФормы.ЗатратыМесяц.Страницы.Затраты.Видимость = Истина;
		 ЭлементыФормы.ЗатратыМесяц.Страницы.Затраты.Доступность = Истина;
		 ЭлементыФормы.НадписьТМ.Видимость = ложь;
	 Иначе 
		 ЭлементыФормы.ЗатратыМесяц.Страницы.Страница1.Видимость = Истина;
		 ЭлементыФормы.ЗатратыМесяц.Страницы.Страница1.Доступность = Истина;
		 ЭлементыФормы.ЗатратыМесяц.Страницы.Затраты.Видимость = Ложь;
		 ЭлементыФормы.ЗатратыМесяц.Страницы.Затраты.Доступность = Ложь;		 
		 ЭлементыФормы.НадписьТМ.Видимость = истина;
	 КонецЕсли;	
	 УстановитьЗаголовокВидаОпераци();
КонецПроцедуры	

Процедура УстановитьЗаголовкиМесячные()
	Для каждого Кол из ЭлементыФормы.ТаблицаЗатрат.Колонки Цикл		
		Если Найти(Кол.Имя,"Месяц") Тогда 
			ТекстМесяца = НайтиТекстМесяца("Месяц"+?(МесяцМ = неопределено,1,МесяцМ));
			Кол.ТекстШапки = СтрЗаменить(Кол.Имя,"Месяц1",ТекстМесяца);
			Кол.ТекстШапки = СтрЗАменить(Кол.ТекстШапки,"Сумма","Итого");
			Кол.Доступность = ложь;
		КонецЕсли;
		Если Найти(Кол.Имя,"Подразделение") Тогда 
			ТекстМесяца = НайтиТекстПодразделения(Кол.Имя);
			Кол.ТекстШапки = СтрЗаменить(Кол.ТекстШапки,Сред(Кол.Имя,Найти(Кол.Имя,"Подразделение"),14),ТекстМесяца);
			Кол.ТекстШапки = СтрЗАменить(Кол.ТекстШапки,"Итого","");
			Кол.ТекстШапки = СтрЗАменить(Кол.ТекстШапки,"подразделение1"," Головное");
			Кол.ТекстШапки = СтрЗАменить(Кол.ТекстШапки,"подразделение2"," Москва");
			Кол.ТекстШапки = СтрЗАменить(Кол.ТекстШапки,"подразделение3"," Санкт-Петербург");
			Кол.ТекстШапки = СтрЗАменить(Кол.ТекстШапки,"подразделение4"," Екатеринбург");
			Кол.ТекстШапки = СтрЗАменить(Кол.ТекстШапки,"подразделение5"," Ростов-На-Дону");
			Кол.Доступность = истина;
			Кол.ТекстШапки = СтрЗаменить(Кол.ТекстШапки,"(шт.)","");
		КонецЕсли;
	КонецЦикла;			
КонецПроцедуры

Процедура УстановитьЗаголовокВидаОпераци()
	Если ВидОперации = Перечисления.ВидБюджета.Полугодие Тогда 
		ЭлементыФормы.ДействияФормы.кнопки.ВидОперации.Текст = "Полугодие";
	Иначе 
		ЭлементыФормы.ДействияФормы.кнопки.ВидОперации.Текст = "Месяц";		
	КонецЕсли;
КонецПроцедуры

Процедура ТаблицаЗатратПередОкончаниемРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования, Отказ)
	// Вставить содержимое обработчика.
	РассчитатьИтогоВподвалеМесячный();
	Попытка 
		//Текущаястрока = ЭлементыФормы.ТаблицаЗатрат.ТекущаяСтрока;
		//Если МесяцМ = Неопределено Тогда 
		//	Текущаястрока.номермесяца = 1;
		//Иначе 
		//	Текущаястрока.номермесяца = МесяцМ;
		//КонецЕсли;
	Исключение
		;
	КонецПопытки;
КонецПроцедуры

Процедура РассчитатьИтогоВподвалеМесячный()
	Попытка 
		ЭлементыФормы.ТаблицаЗатрат.Колонки.итого.ТекстПодвала = Строка(ЗатратыМесяц.Итог("Месяц1Сумма"));
	Исключение
		;
	КонецПопытки;
КонецПроцедуры

Процедура ТаблицаЗатратПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	// Вставить содержимое обработчика.
	Попытка
		ОформлениеСтроки.Ячейки.Итого.Значение = Строка(Данныестроки.Месяц1Сумма);
		Если (ОформлениеСтроки.Ячейки.Итого.Значение = "0") Тогда 
			ОформлениеСтроки.Ячейки.Итого.Значение = "";
		КонецЕсли;
	Исключение
		;
	КонецПопытки;
	
КонецПроцедуры

Процедура ТаблицаЗатратМесяц1СуммаПодразделение1ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.ТаблицаЗатрат.ТекущиеДанные;
	Текущаястрока.Месяц1Сумма = СуммироватьПоподразделениямСтрокиМес("Месяц1",Текущаястрока);		
КонецПроцедуры

Функция СуммироватьПоПодразделениямСтрокиМес(Месяц,Текущаястрока)
	Возврат Текущаястрока[Месяц+"СуммаПодразделение1"] + Текущаястрока[Месяц+"СуммаПодразделение2"] + Текущаястрока[Месяц+"СуммаПодразделение3"] + Текущаястрока[Месяц+"СуммаПодразделение4"] + Текущаястрока[Месяц+"СуммаПодразделение5"];
КонецФункции


Процедура ТаблицаЗатратМесяц1СуммаПодразделение2ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.ТаблицаЗатрат.ТекущиеДанные;
	Текущаястрока.Месяц1Сумма = СуммироватьПоподразделениямСтрокиМес("Месяц1",Текущаястрока);			
КонецПроцедуры


Процедура ТаблицаЗатратМесяц1СуммаПодразделение3ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.ТаблицаЗатрат.ТекущиеДанные;
	Текущаястрока.Месяц1Сумма = СуммироватьПоподразделениямСтрокиМес("Месяц1",Текущаястрока);			
КонецПроцедуры


Процедура ТаблицаЗатратМесяц1СуммаПодразделение4ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.ТаблицаЗатрат.ТекущиеДанные;
	Текущаястрока.Месяц1Сумма = СуммироватьПоподразделениямСтрокиМес("Месяц1",Текущаястрока);			
КонецПроцедуры


Процедура ТаблицаЗатратМесяц1СуммаПодразделение5ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	Текущаястрока = ЭлементыФормы.ТаблицаЗатрат.ТекущиеДанные;
	Текущаястрока.Месяц1Сумма = СуммироватьПоподразделениямСтрокиМес("Месяц1",Текущаястрока);			
КонецПроцедуры

Процедура УстановитьМесяц(МесяцМ)
	НомерМесяца = МесяцМ;
	//Для каждого стрх из ЗатратыМесяц Цикл
	//	СтрХ.НомерМесяца = МесяцМ;
	//КонецЦикла;
КонецПроцедуры

//Процедура КоманднаяПанель2ОтменитьМесяцПоВсем(Кнопка)
//	// Вставить содержимое обработчика.
//	Для каждого СтрХ из ЗатратыМесяц Цикл
//		СтрХ.ОтменитьМесяц = Не СтрХ.ОтменитьМесяц;
//	КонеЦЦикла;
//	
//КонецПроцедуры

Процедура КоманднаяПанель2ОтменитьМесяц(Кнопка)
	// Вставить содержимое обработчика.
	//ЗатратыМесяц.Очистить();
	//Для каждого СтрХ из ДокументОснование.Затраты Цикл
	//	СтрУ = ЗатратыМесяц.Добавить();
	//	СтрУ.Статья = СтрХ.Статья;
	//	СтрУ.Месяц1Сумма = -СтрХ["Месяц"+НомерМесяца+"Сумма"];
	//	СтрУ.Месяц1СуммаПодразделение1 = -СтрХ["Месяц"+НомерМесяца+"СуммаПодразделение1"];
	//	СтрУ.Месяц1СуммаПодразделение2 = -СтрХ["Месяц"+НомерМесяца+"СуммаПодразделение2"];
	//	СтрУ.Месяц1СуммаПодразделение3 = -СтрХ["Месяц"+НомерМесяца+"СуммаПодразделение3"];
	//	СтрУ.Месяц1СуммаПодразделение4 = -СтрХ["Месяц"+НомерМесяца+"СуммаПодразделение4"];
	//	СтрУ.Месяц1СуммаПодразделение5 = -СтрХ["Месяц"+НомерМесяца+"СуммаПодразделение5"];
	//КонеЦЦикла;
КонецПроцедуры

Процедура КоманднаяПанель2ЗаполнитьСтатьи(Кнопка)
	// Вставить содержимое обработчика.
	ЗатратыМесяц.Очистить();
	Для каждого СтрХ из ДокументОснование.Затраты Цикл
		СтрУ = ЗатратыМесяц.Добавить();
		СтрУ.Статья = СтрХ.Статья;
	КонеЦЦикла;
КонецПроцедуры

Процедура КоманднаяПанель2ЗаполнитьРазные(Кнопка)
	// Вставить содержимое обработчика.
	Если Модифицированность() Тогда
		Ответ = Вопрос("Перед заполнением необходимо записать документ.",РежимДиалогаВопрос.ДаНетОтмена);
		Если (Ответ = КодВозвратаДиалога.Да) Тогда 
			Записан = ЗаписатьВФорме();
			Если не Записан Тогда 
				Сообщить("Невозможно записать документ.",СтатусСообщения.Важное);
				Возврат;
			КонецЕсли;
		Иначе 
			Возврат;
		КонецЕсли;		
	КонецЕсли;
	
	ИмяФормы = Справочники.ВнешниеОбработки.НайтиПоНаименованию("Заполнение бюджета расходов");
	ИмяФайла = КаталогВременныхФайлов()+"TmpForm.tmp";
	ОбъектВнешнейФормы = ИмяФормы.ПолучитьОбъект();
	Если ОбъектВнешнейФормы = Неопределено Тогда
		Сообщить("Ошибка получения внешней формы для заполнения. Возможно форма была удалена", СтатусСообщения.Важное);
		Возврат;
	КонецЕсли;
		
	ДвоичныеДанные = ОбъектВнешнейФормы.ХранилищеВнешнейОбработки.Получить();
	ДвоичныеДанные.Записать(ИмяФайла);
	Обработка = ВнешниеОбработки.Создать(ИмяФайла);
	Обработка.СсылкаНаОбъектОбщ = ЭтотОбъект.Ссылка;
	МассивЗаполнения = Обработка.Заполнение(ТолькоИтоги);
	
	Если ЗначениеЗаполнено(МассивЗаполнения) Тогда 
		Если (МассивЗаполнения.количество()>0) Тогда 
			Текущаястрока = ЭлементыФормы.ТаблицаЗатрат.ТекущиеДанные;
			стр = МассивЗаполнения[0];
			Текущаястрока["Месяц1СуммаПодразделение1"] = стр.Головное;
			Текущаястрока["Месяц1СуммаПодразделение2"] = стр.Москва;
			Текущаястрока["Месяц1СуммаПодразделение3"] = стр.СПБ;
			Текущаястрока["Месяц1СуммаПодразделение4"] = стр.ЕКБ;
			Текущаястрока["Месяц1СуммаПодразделение5"] = стр.РНД;				
			ТЕкущаястрока["Месяц1Сумма"] = стр.Головное + стр.Москва + стр.СПБ + стр.ЕКБ + стр.РНД;
		КонецЕсли;
	КонецЕсли;
		
КонецПроцедуры

Процедура КоманднаяПанель2ЗаполнитьСтатьиПоМесяцу(Кнопка)
	// Вставить содержимое обработчика.
	ЗатратыМесяц.Очистить();
	
	ПериодПланирования = ДокументОснование.ПериодПланирования;
	
	Если Число(Формат(ПериодПланирования.ДатаНачала,"ДФ=yyyy")) = Число(Формат(ПериодПланирования.ДатаКонца,"ДФ=yyyy")) Тогда	
		КоличествоМесяцев = Число(Формат(ПериодПланирования.ДатаКонца,"ДФ=MM")) - Число(Формат(ПериодПланирования.ДатаНачала,"ДФ=MM")) +1;
	иначе
		КоличествоМесяцев = 12 - Число(Формат(ПериодПланирования.ДатаНачала,"ДФ=MM")) +1 + Число(Формат(ПериодПланирования.ДатаКонца,"ДФ=MM"));
	КонецЕсли;
	
	ДатаН = ПериодПланирования.ДатаНачала;
	
	Соответствие = Новый Соответствие;
	
	Для ии = 1 по КоличествоМесяцев Цикл
		ДатаК = ДобавитьМесяц(ДатаН,ии-1);
		Соответствие.Вставить(Число(Формат(ДатаК,"ДФ=MM")),ии);	
	КонецЦикла;
	
	Для каждого СтрХ из ДокументОснование.Затраты Цикл
		СтрУ = ЗатратыМесяц.Добавить();
		СтрУ.Статья = СтрХ.Статья;
		СтрУ.Месяц1Сумма = СтрХ["Месяц"+Соответствие.Получить(НомерМесяца)+"Сумма"];
		СтрУ.Месяц1СуммаПодразделение1 = СтрХ["Месяц"+Соответствие.Получить(НомерМесяца)+"СуммаПодразделение1"];
		СтрУ.Месяц1СуммаПодразделение2 = СтрХ["Месяц"+Соответствие.Получить(НомерМесяца)+"СуммаПодразделение2"];
		СтрУ.Месяц1СуммаПодразделение3 = СтрХ["Месяц"+Соответствие.Получить(НомерМесяца)+"СуммаПодразделение3"];
		СтрУ.Месяц1СуммаПодразделение4 = СтрХ["Месяц"+Соответствие.Получить(НомерМесяца)+"СуммаПодразделение4"];
		СтрУ.Месяц1СуммаПодразделение5 = СтрХ["Месяц"+Соответствие.Получить(НомерМесяца)+"СуммаПодразделение5"];
	КонеЦЦикла;	
КонецПроцедуры

Процедура ЗатратыМесяцПриСменеСтраницы(Элемент, ТекущаяСтраница)
	// Вставить содержимое обработчика.
КонецПроцедуры

Процедура ПолеВвода1ПриИзменении(Элемент)
	УстановитьЗаголовкиКолонок();
КонецПроцедуры


Процедура ПолеВвода2ПриИзменении(Элемент)
	Если ВидОперации = Перечисления.ВидБюджета.Месяц Тогда 
		Если МесяцРасчета <> Дата(1,1,1) Тогда 
			НомерМесяца=Число(Формат(МесяцРасчета,"ДФ=MM"));
		КонецЕсли;
		МесяцМ = НомерМесяца;
	КонецЕсли;
	
	УстановитьЗаголовкиМесячные();
	
	Если ЗначениеЗаполнено(ДокументОснование) и ВидОперации<>Перечисления.ВидБюджета.Месяц Тогда 
		ВидОперации=Перечисления.ВидБюджета.Месяц;
		УстановитьЗаголовокВидаОпераци();		
		УстановитьВидимостьВидаБюджета();
	КонецЕсли;
	
	НадписьТМ = НайтиТекстМесяца("Месяц"+?(МесяцМ = неопределено,1,МесяцМ));
	НадписьТМ = СтрЗаменить(НадписьТМ,"(руб.)","");
КонецПроцедуры


Процедура ЗатратыМесяц1СуммаПриИзменении(Элемент)
    ЭлементыФормы.затраты.ТекущаяСтрока["Месяц1СуммаПодразделение1"] = ЭлементыФормы.затраты.ТекущаяСтрока["Месяц1Сумма"] 
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц1СуммаПодразделение2"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц1СуммаПодразделение3"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц1СуммаПодразделение4"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц1СуммаПодразделение5"];	
КонецПроцедуры


Процедура ЗатратыМесяц2СуммаПриИзменении(Элемент)
	 ЭлементыФормы.затраты.ТекущаяСтрока["Месяц2СуммаПодразделение1"] = ЭлементыФормы.затраты.ТекущаяСтрока["Месяц2Сумма"] 
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц2СуммаПодразделение2"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц2СуммаПодразделение3"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц2СуммаПодразделение4"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц2СуммаПодразделение5"];
КонецПроцедуры

Процедура ЗатратыМесяц3СуммаПриИзменении(Элемент)
	ЭлементыФормы.затраты.ТекущаяСтрока["Месяц3СуммаПодразделение1"] = ЭлементыФормы.затраты.ТекущаяСтрока["Месяц3Сумма"] 
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц3СуммаПодразделение2"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц3СуммаПодразделение3"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц3СуммаПодразделение4"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц3СуммаПодразделение5"];
КонецПроцедуры

Процедура ЗатратыМесяц4СуммаПриИзменении(Элемент)
	ЭлементыФормы.затраты.ТекущаяСтрока["Месяц4СуммаПодразделение1"] = ЭлементыФормы.затраты.ТекущаяСтрока["Месяц4Сумма"] 
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц4СуммаПодразделение2"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц4СуммаПодразделение3"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц4СуммаПодразделение4"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц4СуммаПодразделение5"];
КонецПроцедуры

Процедура ЗатратыМесяц5СуммаПриИзменении(Элемент)
	ЭлементыФормы.затраты.ТекущаяСтрока["Месяц5СуммаПодразделение1"] = ЭлементыФормы.затраты.ТекущаяСтрока["Месяц5Сумма"] 
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц5СуммаПодразделение2"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц5СуммаПодразделение3"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц5СуммаПодразделение4"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц5СуммаПодразделение5"];
КонецПроцедуры

Процедура ЗатратыМесяц6СуммаПриИзменении(Элемент)
	ЭлементыФормы.затраты.ТекущаяСтрока["Месяц6СуммаПодразделение1"] = ЭлементыФормы.затраты.ТекущаяСтрока["Месяц6Сумма"] 
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц6СуммаПодразделение2"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц6СуммаПодразделение3"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц6СуммаПодразделение4"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц6СуммаПодразделение5"];
КонецПроцедуры

Процедура ЗатратыМесяц7СуммаПриИзменении(Элемент)
	ЭлементыФормы.затраты.ТекущаяСтрока["Месяц7СуммаПодразделение1"] = ЭлементыФормы.затраты.ТекущаяСтрока["Месяц7Сумма"] 
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц7СуммаПодразделение2"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц7СуммаПодразделение3"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц7СуммаПодразделение4"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц7СуммаПодразделение5"];
КонецПроцедуры

Процедура ЗатратыМесяц8СуммаПриИзменении(Элемент)
	ЭлементыФормы.затраты.ТекущаяСтрока["Месяц8СуммаПодразделение1"] = ЭлементыФормы.затраты.ТекущаяСтрока["Месяц8Сумма"] 
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц8СуммаПодразделение2"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц8СуммаПодразделение3"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц8СуммаПодразделение4"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц8СуммаПодразделение5"];
КонецПроцедуры

Процедура ЗатратыМесяц9СуммаПриИзменении(Элемент)
	ЭлементыФормы.затраты.ТекущаяСтрока["Месяц9СуммаПодразделение1"] = ЭлементыФормы.затраты.ТекущаяСтрока["Месяц9Сумма"] 
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц9СуммаПодразделение2"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц9СуммаПодразделение3"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц9СуммаПодразделение4"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц9СуммаПодразделение5"];
КонецПроцедуры

Процедура ЗатратыМесяц10СуммаПриИзменении(Элемент)
	ЭлементыФормы.затраты.ТекущаяСтрока["Месяц10СуммаПодразделение1"] = ЭлементыФормы.затраты.ТекущаяСтрока["Месяц10Сумма"] 
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц10СуммаПодразделение2"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц10СуммаПодразделение3"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц10СуммаПодразделение4"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц10СуммаПодразделение5"];
КонецПроцедуры

Процедура ЗатратыМесяц11СуммаПриИзменении(Элемент)
	ЭлементыФормы.затраты.ТекущаяСтрока["Месяц11СуммаПодразделение1"] = ЭлементыФормы.затраты.ТекущаяСтрока["Месяц11Сумма"] 
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц11СуммаПодразделение2"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц11СуммаПодразделение3"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц11СуммаПодразделение4"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц11СуммаПодразделение5"];
КонецПроцедуры

Процедура ЗатратыМесяц12СуммаПриИзменении(Элемент)
	ЭлементыФормы.затраты.ТекущаяСтрока["Месяц12СуммаПодразделение1"] = ЭлементыФормы.затраты.ТекущаяСтрока["Месяц12Сумма"] 
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц12СуммаПодразделение2"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц12СуммаПодразделение3"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц12СуммаПодразделение4"]
	-ЭлементыФормы.затраты.ТекущаяСтрока["Месяц12СуммаПодразделение5"];

КонецПроцедуры

Процедура СтатьиЗатратИМПриИзменении(Элемент)
		ЭлементыФормы.Затраты.Колонки.Статья.Видимость = не ИМ;
		ЭлементыФормы.Затраты.Колонки.СтатьяУПР.Видимость = ИМ;
КонецПроцедуры

Процедура КоманднаяПанель1ЗаполнитьПоСтатьямУПР(Кнопка)
	Форма = документы.ПланЗатратПоСтатьям.ПолучитьФормуВыбора();
	Рез = Форма.ОткрытьМодально();
	
	ТЗ = Рез.статьиЗатрат.Выгрузить();
		
	ПоСтатьям = ТЗ.Скопировать();
	ПоСтатьям.Свернуть("СтатьяЗатрат");
	Затраты.Очистить();
	Для каждого стр из ПоСтатьям Цикл
		Отбор = НОвый Структура;
		отбор.Вставить("СтатьяЗатрат",Стр.СтатьяЗатрат);
		
		Строки = ТЗ.Скопировать(отбор);
		
		НужнаяСтатья = РегистрыСведений.СоответствиеСтатейЗатратИМ.СоздатьНаборЗаписей();
		НужнаяСтатья.Отбор.СтатьяЗатратИМ.Установить(стр.СтатьяЗатрат);
		НужнаяСтатья.Прочитать();
		
		Если НужнаяСтатья.Количество()>0 и Строки.Количество()>0 Тогда
			
			НС = НужнаяСтатья[0].СтатьяЗатрат;
			НовСтр = Затраты.Добавить();
			НовСтр.Статья = НС;
			
			Если Число(Формат(ПериодПланирования.ДатаНачала,"ДФ=yyyy")) = Число(Формат(ПериодПланирования.ДатаКонца,"ДФ=yyyy")) Тогда	
				КоличествоМесяцев = Число(Формат(ПериодПланирования.ДатаКонца,"ДФ=MM")) - Число(Формат(ПериодПланирования.ДатаНачала,"ДФ=MM")) +1;
			иначе
				КоличествоМесяцев = 12 - Число(Формат(ПериодПланирования.ДатаНачала,"ДФ=MM")) +1 + Число(Формат(ПериодПланирования.ДатаКонца,"ДФ=MM"));
			КонецЕсли;
			
			ДатаН = ПериодПланирования.ДатаНачала;
			
			Соответствие = Новый Соответствие;
			
			Для ии = 1 по КоличествоМесяцев Цикл
				ДатаК = ДобавитьМесяц(ДатаН,ии-1);
				Соответствие.Вставить(Число(Формат(ДатаК,"ДФ=MM")),Строка(ии));	
			КонецЦикла;
			
			
			Для каждого стр11 из Строки Цикл
				Попытка
					НовСтр["Месяц"+Соответствие.Получить(Число(Формат(Стр11.Месяц,"ДФ=MM")))+"Сумма"] = стр11.Сумма;
					НовСтр["Месяц"+Соответствие.Получить(Число(Формат(Стр11.Месяц,"ДФ=MM")))+"СуммаПодразделение1"] = стр11.Сумма;
				Исключение
				КонецПопытки;
			КонецЦикла;
			
		КонецЕсли;
	КонецЦикла;
	
	
	// Вставить содержимое обработчика.
КонецПроцедуры

Процедура КоманднаяПанель1Действие9(Кнопка)
	колМес =Месяц(ПериодПланирования.ДатаКонца)-Месяц(ПериодПланирования.ДатаНачала)+1;	
	Если КолМес<0 тогда
		Колмес = 12+колмес;
	конецЕсли;	
		
	порядокМесяцев = Новый Соответствие;
	сч=1;
	Пока сч<=колМес Цикл
	порядокМесяцев.Вставить(Месяц(ДобавитьМесяц(ПериодПланирования.ДатаНачала,сч-1)),сч);	
	сч=сч+1;	
	конецЦикла;
	
	
	Затраты.Очистить();
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	СтатьиЗатрат.Ссылка
		|ПОМЕСТИТЬ ВТ_Статьи
		|ИЗ
		|	Справочник.СтатьиЗатрат КАК СтатьиЗатрат
		|ГДЕ
		|	СтатьиЗатрат.Ответственный = &Польз
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ЗатратыОбороты.СтатьяЗатрат КАК СтатьяЗатрат,
		|	ЗатратыОбороты.Период,
		|	ЗатратыОбороты.СуммаОборот
		|ИЗ
		|	РегистрНакопления.Затраты.Обороты(
		|			&Нач,
		|			&Кон,
		|			Месяц,
		|			СтатьяЗатрат В
		|				(ВЫБРАТЬ
		|					ВТ_Статьи.Ссылка
		|				ИЗ
		|					ВТ_Статьи КАК ВТ_Статьи)) КАК ЗатратыОбороты
		|ИТОГИ ПО
		|	СтатьяЗатрат";

	Запрос.УстановитьПараметр("Кон", КонецДня(ДобавитьМесяц(ПериодПланирования.ДатаКонца,-12)));
	Запрос.УстановитьПараметр("Нач", ДобавитьМесяц(ПериодПланирования.ДатаНачала,-12));
	Запрос.УстановитьПараметр("Польз",?(Ответственный<> Справочники.Пользователи.ПустаяСсылка(),Ответственный,глТекущийПользователь));
	Результат = Запрос.Выполнить();

	ВыборкаСтатьяЗатрат = Результат.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);

	Пока ВыборкаСтатьяЗатрат.Следующий() Цикл
		Нов = Затраты.Добавить();
		Нов.Статья = ВыборкаСтатьяЗатрат.СтатьяЗатрат;
		Выборка = ВыборкаСтатьяЗатрат.Выбрать();
		Пока Выборка.Следующий() Цикл
		НомерКолонки = порядокМесяцев.Получить(Месяц(Выборка.Период));
		Нов["Месяц"+НомерКолонки+"Сумма"]=Выборка.СуммаОборот;
		КонецЦикла;
	КонецЦикла;

	ЭтаФорма.Обновить();	
КонецПроцедуры

Процедура ПосмотретьСводНажатие(Элемент)
			Форма = ПолучитьФорму("ФормаСвода");
			форма.Ответсвенный = Ответственный;
			Форма.ПериодПланирования = ПериодПланирования;
		    форма.Открыть();
КонецПроцедуры

Процедура ЗаполнитьПоСводуНажатие(Элемент)

	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПланированиеЗатратПодразделения.Подразделение,
		|	ПланированиеЗатратПодразделения.СтатьяЗатрат,
		|	ПланированиеЗатратПодразделения.СуммаЗатрат,
		|	ПланированиеЗатратПодразделения.Месяц
		|ИЗ
		|	РегистрСведений.ПланированиеЗатратПодразделения КАК ПланированиеЗатратПодразделения
		|ГДЕ
		|	ПланированиеЗатратПодразделения.ПериодПланирования = &ПериодПланирования
		|	И ПланированиеЗатратПодразделения.СтатьяЗатрат.Ответственный = &Ответственный";

	Запрос.УстановитьПараметр("Ответственный", Ответственный);
	Запрос.УстановитьПараметр("ПериодПланирования", ПериодПланирования);

	Результат = Запрос.Выполнить();

	ВыборкаДетальныеЗаписи = Результат.Выбрать();

	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		// Вставить обработку выборки ВыборкаДетальныеЗаписи
	КонецЦикла;
КонецПроцедуры





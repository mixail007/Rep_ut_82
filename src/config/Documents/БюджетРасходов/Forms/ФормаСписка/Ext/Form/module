
Процедура ПриОткрытии()
	// Вставить содержимое обработчика.
	УстановитьФильтрПоФамилииМенеджера();
КонецПроцедуры

Процедура УстановитьФильтрПоФамилииМенеджера()
	
	Если Отбор.Найти("Ответственный") = Неопределено Тогда
	    Отбор.Добавить("Ответственный");
	КонецЕсли;
		
	Отбор["Ответственный"].Использование = Истина;
	Отбор["Ответственный"].Значение      = глТекущийПользователь;
	Отбор["Ответственный"].ВидСравнения  = ВидСравнения.Равно;

КонецПроцедуры

Процедура ДействияФормыПоказатьБюджет(Кнопка)
	// Вставить содержимое обработчика.
	Форма = Документы.БюджетРасходов.ПолучитьФорму("ФормаВыводаБюджета");
	Форма.Полугодие = ПолучитьТекущееПолугодие();
	Форма.Месяц = ПолучитьТекущийМесяц();
	Форма.ОткрытьМодально();
КонецПроцедуры

Функция ПолучитьТекущееПолугодие()
	Если Месяц(ТекущаяДата())>6 Тогда 
		Возврат 2;
	Иначе 
		Возврат 1;
	КонецЕсли;
КонецФункции

Функция ПолучитьТекущийМесяц()
	
	Месяц = Месяц(ТекущаяДата());
	
	Если Месяц=1 или Месяц=7 Тогда 
		Возврат 1;
	ИначеЕсли Месяц=2 или Месяц=8 Тогда  	
		Возврат 2;
	ИначеЕсли Месяц=3 или Месяц=9 Тогда  	
		Возврат 3;
	ИначеЕсли Месяц=4 или Месяц=10 Тогда  	
		Возврат 4;
	ИначеЕсли Месяц=5 или Месяц=11 Тогда  	
		Возврат 5;
	ИначеЕсли Месяц=6 или Месяц=12 Тогда  	
		Возврат 6;
	КонецЕсли;
	
КонецФункции

Процедура ДействияФормыПолугодовой(Кнопка)
	// Вставить содержимое обработчика.
	
	ИмяФормы = Справочники.ВнешниеОбработки.НайтиПоКоду(384);
	ИмяФайла = КаталогВременныхФайлов()+"TmpForm.tmp";
	ОбъектВнешнейФормы = ИмяФормы.ПолучитьОбъект();
	Если ОбъектВнешнейФормы = Неопределено Тогда
		Сообщить("Ошибка получения внешней формы для заполнения. Возможно форма была удалена", СтатусСообщения.Важное);
		Возврат;
	КонецЕсли;
		
	ДвоичныеДанные = ОбъектВнешнейФормы.ХранилищеВнешнейОбработки.Получить();
	ДвоичныеДанные.Записать(ИмяФайла);
	Обработка = ВнешниеОтчеты.Создать(ИмяФайла);
	Форма = Обработка.ПолучитьФорму();
	Форма.ОтчетИнициализация();
	Построитель = Форма.ПостроительОтчетаОтчет;
	Отбор1 = Построитель.Отбор;
	
	Для каждого Эл Из Отбор1 Цикл
		Отбор1.Удалить(0);	
	КонеЦЦикла;
	
	Отбор1.Добавить("Ответственный");
	Отбор1["Ответственный"].Использование = Истина;
	Отбор1["Ответственный"].ВидСравнения = ВидСравнения.Равно;
	Отбор1["Ответственный"].Значение = глТекущийПользователь;
  	//Форма.СсылкаНаОбъект = Ссылка;
	Форма.Открыть();
	Форма.ОтчетВывести();
	
КонецПроцедуры

Процедура ДокументСписокПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	// Вставить содержимое обработчика.
	//Полугодие = Данныестроки.Ссылка.Полугодие;
	//
	//Ячейка = ОформлениеСтроки.Ячейки.Период;
	//Ячейка.ОтображатьТекст = Истина;
	//
	//Если (Данныестроки.Ссылка.ВидОперации = перечисления.ВидБюджета.Месяц) Тогда 
	//	НадписьТМ = НайтиТекстМесяца("Месяц"+?(Данныестроки.Ссылка.НомерМесяца = 0,1,Данныестроки.Ссылка.НомерМесяца),Полугодие);
	//	НадписьТМ = СтрЗаменить(НадписьТМ,"(руб.)","");
	//	Ячейка.Текст = НадписьТМ + ", " + Формат(Данныестроки.Ссылка.год,"ЧГ=0") +" г.";
	//Иначе 
	//	Ячейка.Текст = Строка(Полугодие) + " полугодие," + Формат(Данныестроки.Ссылка.год,"ЧГ=0") + " г.";
	//КонецЕсли;
	
КонецПроцедуры

Функция НайтиТекстМесяца(ИмяКолонки,Полугодие)
	
	Если (Найти(ИмяКолонки,"Месяц1")) Тогда
		ТекстМесяца = ?(Полугодие=1,"Январь","Июль");
	КонецЕсли;
	
	Если (Найти(ИмяКолонки,"Месяц2")) Тогда
		ТекстМесяца = ?(Полугодие=1,"Февраль","Август");
	КонецЕсли;

	Если (Найти(ИмяКолонки,"Месяц3")) Тогда
		ТекстМесяца = ?(Полугодие=1,"Март","Сентябрь");
	КонецЕсли;
	
	Если (Найти(ИмяКолонки,"Месяц4")) Тогда
		ТекстМесяца = ?(Полугодие=1,"Апрель","Октябрь");
	КонецЕсли;
	
	Если (Найти(ИмяКолонки,"Месяц5")) Тогда
		ТекстМесяца = ?(Полугодие=1,"Май","Ноябрь");
	КонецЕсли;
	
	Если (Найти(ИмяКолонки,"Месяц6")) Тогда
		ТекстМесяца = ?(Полугодие=1,"Июнь","Декабрь");
	КонецЕсли;
	
	ОбщийТекст = "";
	
	Если Найти(ИмяКолонки,"Количество") Тогда 
		ОбщийТекст = ТекстМесяца + "(шт.)";			
	Иначе 
		ОбщийТекст = ТекстМесяца + "(руб.)";			
	КонецЕсли;
	
	Возврат ОбщийТекст; 
	
КонецФункции


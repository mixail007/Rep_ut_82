// Настройка периода
Перем НП;

Процедура ЗаявкиНаРасходованиеСредствЗаявкаНачалоВыбора(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка=Ложь;
	ФормаВыбора = Документы["ЗаявкаНаРасходованиеСредств"].ПолучитьФормуВыбора(,Элемент,);
	
	ФормаВыбора.Отбор.ЦФО.Значение = ЦФО;
	ФормаВыбора.Отбор.ЦФО.Использование = ОтборЦФО;
	ФормаВыбора.ЭлементыФормы.ДокументСписок.НастройкаОтбора.ЦФО.Доступность=НЕ ОтборЦФО;
	
	ФормаВыбора.Отбор.Контрагент.Значение = Контрагент;
	ФормаВыбора.Отбор.Контрагент.Использование = ОтборКонтрагент;
	ФормаВыбора.ЭлементыФормы.ДокументСписок.НастройкаОтбора.Контрагент.Доступность=НЕ ОтборКонтрагент;
			
	ФормаВыбора.Отбор.Ответственный.Значение = ОтветственныйЗаявка;
	ФормаВыбора.Отбор.Ответственный.Использование = ОтборОтветственный;
	ФормаВыбора.ЭлементыФормы.ДокументСписок.НастройкаОтбора.Ответственный.Доступность=НЕ ОтборОтветственный;
		
	Если НЕ (ОтборДатаНач='00010101' ИЛИ ОтборДатаКон='00010101') Тогда
		
		ФормаВыбора.Отбор.ДатаРасхода.ВидСравнения=ВидСравнения.ИнтервалВключаяГраницы;
		ФормаВыбора.Отбор.ДатаРасхода.ЗначениеС=НачалоДня(ОтборДатаНач);
		ФормаВыбора.Отбор.ДатаРасхода.ЗначениеПо=КонецДня(ОтборДатаКон);
		ФормаВыбора.Отбор.ДатаРасхода.Использование=Истина;
		ФормаВыбора.ЭлементыФормы.ДокументСписок.НастройкаОтбора.ДатаРасхода.Доступность=Ложь;
		
	ИначеЕсли НЕ ОтборДатаНач='00010101' Тогда
		
		ФормаВыбора.Отбор.ДатаРасхода.ВидСравнения=ВидСравнения.БольшеИлиРавно;
		ФормаВыбора.Отбор.ДатаРасхода.Значение=НачалоДня(ОтборДатаНач);
		ФормаВыбора.Отбор.ДатаРасхода.Использование=Истина;
		ФормаВыбора.ЭлементыФормы.ДокументСписок.НастройкаОтбора.ДатаРасхода.Доступность=Ложь;
		
	ИначеЕсли НЕ ОтборДатаКон='00010101' Тогда
		
		ФормаВыбора.Отбор.ДатаРасхода.ВидСравнения=ВидСравнения.МеньшеИлиРавно;
		ФормаВыбора.Отбор.ДатаРасхода.Значение=КонецДня(ОтборДатаКон);
		ФормаВыбора.Отбор.ДатаРасхода.Использование=Истина;
		ФормаВыбора.ЭлементыФормы.ДокументСписок.НастройкаОтбора.ДатаРасхода.Доступность=Ложь;
		
	КонецЕсли;
	
	Если Не ЗначениеНеЗаполнено(ЭлементыФормы.ЗаявкиНаРасходованиеСредств.ТекущиеДанные.Заявка)Тогда
		ФормаВыбора.ПараметрТекущаяСтрока=ЭлементыФормы.ЗаявкиНаРасходованиеСредств.ТекущиеДанные.Заявка;
	КонецЕсли;
 
	ФормаВыбора.Открыть();
		
КонецПроцедуры

// Процедура - обработчик нажатия кнопки настройки периода
//
Процедура КнопкаНастройкаПериодаНажатие(Элемент)
		
	Если НП.Редактировать() Тогда
		
		ОтборДатаНач = НП.ПолучитьДатуНачала();
		ОтборДатаКон = НП.ПолучитьДатуОкончания();
		
	КонецЕсли;
	
КонецПроцедуры // КнопкаНастройкаПериодаНажатие()

Процедура КоманднаяПанель1Заполнить(Кнопка)
	
	Если ЗаявкиНаРасходованиеСредств.Количество() > 0 Тогда
		
		ТекстВопроса = "Перед заполнением табличная часть будет очищена. Заполнить?";
		Ответ = Вопрос(ТекстВопроса, РежимДиалогаВопрос.ДаНет, , КодВозвратаДиалога.Да, Метаданные().Имя);
		Если Ответ <> КодВозвратаДиалога.Да Тогда
			Возврат;
		КонецЕсли; 
		
		ЗаявкиНаРасходованиеСредств.Очистить();
		
	КонецЕсли;

	ЗаполнитьЗаявкиПоОстаткам();
		
КонецПроцедуры

Процедура ЗаявкиНаРасходованиеСредствЗаявкаПриИзменении(Элемент)
	
	Запрос=СформироватьЗапрос(Элемент.Значение);
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда

		ЭлементыФормы.ЗаявкиНаРасходованиеСредств.ТекущиеДанные.Заявка = Выборка.Заявка;
		ЭлементыФормы.ЗаявкиНаРасходованиеСредств.ТекущиеДанные.ВалютаЗаявка=Выборка.ВалютаЗаявка;
		ЭлементыФормы.ЗаявкиНаРасходованиеСредств.ТекущиеДанные.ОстатокЗаявка=Выборка.ОстатокЗаявка;
		ЭлементыФормы.ЗаявкиНаРасходованиеСредств.ТекущиеДанные.ОстатокРезерв=Выборка.ОстатокРезерв;
		ЭлементыФормы.ЗаявкиНаРасходованиеСредств.ТекущиеДанные.ОстатокРазмещение=Выборка.ОстатокРазмещение;
		ЭлементыФормы.ЗаявкиНаРасходованиеСредств.ТекущиеДанные.Контрагент=Выборка.Контрагент;
		ЭлементыФормы.ЗаявкиНаРасходованиеСредств.ТекущиеДанные.Ответственный=Выборка.Ответственный;

	КонецЕсли;
		
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	Если Ответственный.Пустая() Тогда
		Ответственный     = глТекущийПользователь;
	КонецЕсли;
	
	яштСменаПользователя(ЭтотОбъект, ЭтаФорма, глТекущийПользователь);
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ ОБРАБОТКИ СВОЙСТВ И КАТЕГОРИЙ

// Процедура выполняет открытие формы работы со свойствами документа
//
Процедура ДействияФормыДействиеОткрытьСвойства(Кнопка)

	ОткрытьСвойстваДокумента(ЭтотОбъект, ЭтаФорма);

КонецПроцедуры

// Процедура выполняет открытие формы работы с категориями документа
//
Процедура ДействияФормыДействиеОткрытьКатегории(Кнопка)

	ОткрытьКатегорииДокумента(ЭтотОбъект, ЭтаФорма);

КонецПроцедуры

// Процедура вызывается при выборе пункта подменю "Движения документа по регистрам" меню "Перейти".
// командной панели формы. Процедура отрабатывает печать движений документа по регистрам.
//
Процедура ДействияФормыДвиженияДокументаПоРегистрам(Кнопка)

	НапечататьДвиженияДокумента(Ссылка);

КонецПроцедуры // ДействияФормыДвиженияДокументаПоРегистрам()

Процедура ПриОткрытии()
	
	Если ЭтоНовый() Тогда
		ЭтотОбъект.УстановитьВремя(РежимАвтоВремя.ТекущееИлиПоследним);
		
		Если ЗначениеНеЗаполнено(Ответственный) Тогда
			Ответственный = глТекущийПользователь;
		КонецЕсли;
		
		Если ЗначениеНеЗаполнено(Состояние) Тогда
			Состояние = Перечисления.СостоянияОбъектов.Подготовлен;
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

// Процедура вызова структуры подчиненности документа
Процедура ДействияФормыСтруктураПодчиненностиДокумента(Кнопка)
	ПоказатьСтруктуруПодчиненностиДокумента(Ссылка);
КонецПроцедуры

НП = Новый НастройкаПериода;
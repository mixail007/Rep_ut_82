
Перем периодПланирования Экспорт;

Перем таблицаСуммИПроцентов Экспорт;

Процедура КоманднаяПанель1Распределить(Кнопка)
	// Вставить содержимое обработчика.
	//СуммаПроцентов = Проценты[0].колонка1 + Проценты[0].колонка11 + Проценты[0].колонка12 + Проценты[0].колонка13 + Проценты[0].колонка14 + Проценты[0].колонка15;
	
	Таблица = Новый ТаблицаЗначений;
	Таблица.Колонки.Добавить("Сумма");
	Таблица.Колонки.Добавить("Процент");
	
	СтрУ 			= Таблица.Добавить();
	СтрУ.Процент 	= Проценты[0].колонка1;
	СтрУ.Сумма 		= Проценты[0].колонка1;
	
	СтрУ 			= Таблица.Добавить();
	СтрУ.Процент 	= Проценты[0].колонка2;
	СтрУ.Сумма 		= Проценты[0].колонка2;
	
	СтрУ 			= Таблица.Добавить();
	СтрУ.Процент 	= Проценты[0].колонка3;
	СтрУ.Сумма 		= Проценты[0].колонка3;
	
	СтрУ 			= Таблица.Добавить();
	СтрУ.Процент 	= Проценты[0].колонка4;
	СтрУ.Сумма 		= Проценты[0].колонка4;
	
	СтрУ 			= Таблица.Добавить();
	СтрУ.Процент 	= Проценты[0].колонка5;
	СтрУ.Сумма 		= Проценты[0].колонка5;
	
	СтрУ 			= Таблица.Добавить();
	СтрУ.Процент 	= Проценты[0].колонка6;
	СтрУ.Сумма 		= Проценты[0].колонка6;
	
	СтрУ 			= Таблица.Добавить();
	СтрУ.Процент 	= Проценты[0].колонка7;
	СтрУ.Сумма 		= Проценты[0].колонка7;
	
	СтрУ 			= Таблица.Добавить();
	СтрУ.Процент 	= Проценты[0].колонка8;
	СтрУ.Сумма 		= Проценты[0].колонка8;
	
	СтрУ 			= Таблица.Добавить();
	СтрУ.Процент 	= Проценты[0].колонка9;
	СтрУ.Сумма 		= Проценты[0].колонка9;
	
	СтрУ 			= Таблица.Добавить();
	СтрУ.Процент 	= Проценты[0].колонка10;
	СтрУ.Сумма 		= Проценты[0].колонка10;
	
	СтрУ 			= Таблица.Добавить();
	СтрУ.Процент 	= Проценты[0].колонка11;
	СтрУ.Сумма 		= Проценты[0].колонка11;
	
	СтрУ 			= Таблица.Добавить();
	СтрУ.Процент 	= Проценты[0].колонка12;
	СтрУ.Сумма 		= Проценты[0].колонка12;
	
	СтрУ 			= Таблица.Добавить();
	СтрУ.Процент 	= Сумма;
	СтрУ.Сумма 		= Сумма;
	
	Закрыть(Таблица);	
КонецПроцедуры

Процедура ПриОткрытии()
	
	н = Проценты.Добавить();
	
	если таблицаСуммИПроцентов <> неопределено Тогда
		Если таблицаСуммИПроцентов.Количество()>0 Тогда
			й = 1;
			Для каждого стр из таблицаСуммИПроцентов Цикл
				если й > 12 Тогда
					Прервать;
				КонецЕсли;
				Н["Колонка"+Строка(й)]=стр.Процент;
				
				й = й + 1;
			КонецЦикла;
		Иначе
			Н.Колонка1 = 0;
			Н.Колонка2 = 0;
			Н.Колонка3 = 0;
			Н.Колонка4 = 0;
			Н.Колонка5 = 0;
			Н.Колонка6 = 0;
			Н.Колонка7 = 0;
			Н.Колонка8 = 0;
			Н.Колонка9 = 0;
			Н.Колонка10 = 0;
			Н.Колонка11 = 0;
			Н.Колонка12 = 0;
		КонецЕсли;
	иначе
		
		Н.Колонка1 = 0;
		Н.Колонка2 = 0;
		Н.Колонка3 = 0;
		Н.Колонка4 = 0;
		Н.Колонка5 = 0;
		Н.Колонка6 = 0;
		Н.Колонка7 = 0;
		Н.Колонка8 = 0;
		Н.Колонка9 = 0;
		Н.Колонка10 = 0;
		Н.Колонка11 = 0;
		Н.Колонка12 = 0;
		
	КонецЕсли; 
	
	если ЗначениеЗаполнено(ПериодПланирования) Тогда
		соответствие = Новый Соответствие;
		соответствие.Вставить(1,"Январь");
		соответствие.Вставить(2,"Февраль");
		соответствие.Вставить(3,"Март");
		соответствие.Вставить(4,"Апрель");
		соответствие.Вставить(5,"Май");
		соответствие.Вставить(6,"Июнь");
		соответствие.Вставить(7,"Июль");
		соответствие.Вставить(8,"Август");
		соответствие.Вставить(9,"Сентябрь");
		соответствие.Вставить(10,"Октябрь");
		соответствие.Вставить(11,"Ноябрь");
		соответствие.Вставить(12,"Декабрь");
		
		Если Число(Формат(ПериодПланирования.ДатаНачала,"ДФ=yyyy")) = Число(Формат(ПериодПланирования.ДатаКонца,"ДФ=yyyy")) Тогда	
			КоличествоМесяцев = Число(Формат(ПериодПланирования.ДатаКонца,"ДФ=MM")) - Число(Формат(ПериодПланирования.ДатаНачала,"ДФ=MM")) +1;
		иначе
			КоличествоМесяцев = 12 - Число(Формат(ПериодПланирования.ДатаНачала,"ДФ=MM")) +1 + Число(Формат(ПериодПланирования.ДатаКонца,"ДФ=MM"));
		КонецЕсли;
				
		Датаии = ПериодПланирования.ДатаНачала;
		для ии = 1 по КоличествоМесяцев Цикл
			
			ЭлементыФормы.Проценты.Колонки["Колонка"+Строка(ии)].ТекстШапки = соответствие.Получить(Число(Формат(Датаии,"ДФ=MM")));
						
			Датаии = ДобавитьМесяц(Датаии,1);
			
		КонецЦикла;
		
		для ии = (КоличествоМесяцев +1) по 12 Цикл
			
			ЭлементыФормы.Проценты.Колонки["Колонка"+Строка(ии)].Видимость = Ложь;
					
		КонецЦикла;
		
	КонецЕсли;

КонецПроцедуры

Процедура ПроцентыПередНачаломДобавления(Элемент, Отказ, Копирование)
	// Вставить содержимое обработчика.
	Отказ = истина;
КонецПроцедуры

Процедура ПрочитатьКомментарий()
	Попытка 
		Начало1 = Найти(Комментарий,"№1-");
		Конец1 	= Найти(Комментарий,"~1");
		Процент1 = Число(Сред(Комментарий,Начало1+3,Конец1-Начало1-3));
	Исключение
		;
	КонецПопытки;
	
	Попытка 	
		Начало2 = Найти(Комментарий,"№2-");
		Конец2 	= Найти(Комментарий,"~2");
		Процент2 = Число(Сред(Комментарий,Начало2+3,Конец2-Начало2-3));
	Исключение
		;
	КонецПопытки;
		
	Попытка 	
		Начало3 = Найти(Комментарий,"№3-");
		Конец3 	= Найти(Комментарий,"~3");
		Процент3 = Число(Сред(Комментарий,Начало3+3,Конец3-Начало3-3));
	Исключение
		;
	КонецПопытки;
	
	Попытка 
		Начало4 = Найти(Комментарий,"№4-");
		Конец4 	= Найти(Комментарий,"~4");
		Процент4 = Число(Сред(Комментарий,Начало4+3,Конец4-Начало4-3));
	Исключение
		;
	КонецПопытки;
		
	Попытка 	
		Начало5 = Найти(Комментарий,"№5-");
		Конец5 	= Найти(Комментарий,"~5");
		Процент5 = Число(Сред(Комментарий,Начало5+3,Конец5-Начало5-3));
	Исключение
		;
	КонецПопытки;
		
	Попытка 		
		Начало6 = Найти(Комментарий,"№6-");
		Конец6 	= Найти(Комментарий,"~6");
		Процент6 = Число(Сред(Комментарий,Начало6+3,Конец6-Начало6-3));
	Исключение
		;
	КонецПопытки;
	
	Проценты[0].Колонка1 = Процент1;
	Проценты[0].Колонка11 = Процент2;
	Проценты[0].Колонка12 = Процент3;
	Проценты[0].Колонка13 = Процент4;
	Проценты[0].Колонка14 = Процент5;
	Проценты[0].Колонка15 = Процент6;
	
КонецПроцедуры

//Процедура ПроцентыКолонка14ПриИзменении(Элемент)
//	// Вставить содержимое обработчика.
//	ПересчетПроцентов();
//КонецПроцедуры

//Процедура ПроцентыКолонка1ПриИзменении(Элемент)
//	ПересчетПроцентов();
//КонецПроцедуры

//Процедура ПроцентыКолонка11ПриИзменении(Элемент)
//	// Вставить содержимое обработчика.
//	ПересчетПроцентов();
//КонецПроцедуры

//Процедура ПроцентыКолонка12ПриИзменении(Элемент)
//	// Вставить содержимое обработчика.
//	ПересчетПроцентов();
//КонецПроцедуры

//Процедура ПроцентыКолонка13ПриИзменении(Элемент)
//	// Вставить содержимое обработчика.
//	ПересчетПроцентов();
//КонецПроцедуры

//Процедура ПроцентыКолонка15ПриИзменении(Элемент)
	// Вставить содержимое обработчика.
//	ПересчетПроцентов();
//КонецПроцедуры

Процедура ПересчетПроцентов()
	//Проценты[0].Колонка15 = 100 - (Проценты[0].Колонка1 + Проценты[0].Колонка11 + Проценты[0].Колонка12 + Проценты[0].Колонка13 + Проценты[0].Колонка14); 
КонецПроцедуры

Процедура ПроцентыПриПолученииДанных(Элемент, ОформленияСтрок)
	Сумма  = 100 - Проценты[0].Колонка1 - Проценты[0].Колонка2 - Проценты[0].Колонка3 - Проценты[0].Колонка4 -Проценты[0].Колонка5 - Проценты[0].Колонка6
	- Проценты[0].Колонка7 - Проценты[0].Колонка8 - Проценты[0].Колонка9 - Проценты[0].Колонка10 -Проценты[0].Колонка11 - Проценты[0].Колонка12;
КонецПроцедуры

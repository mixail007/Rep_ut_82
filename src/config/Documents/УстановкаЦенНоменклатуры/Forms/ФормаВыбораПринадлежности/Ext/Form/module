
Процедура ЗаполнитьСписокОбъектов()
	
	Запрос = новый Запрос;
	Запрос.УстановитьПараметр("Пользователь",глТекущийПользователь);
	Запрос.УстановитьПараметр("Алгоритм",Перечисления.ВидыДополнительныхВнешнихОбработок.АлгоритмЦенообразования);
	
	Запрос.ТЕкст = "
	|Выбрать Ссылка из Справочник.ВнешниеОбработки.Принадлежность
	|Где Ссылка.ПометкаУдаления=Ложь и Пользователь=&Пользователь и Ссылка.ВидОбработки=&Алгоритм";
	
	Выб = Запрос.Выполнить().Выбрать();
	
	Пока Выб.Следующий() Цикл
		Алгоритм.Добавить(Выб.Ссылка);
	КонецЦикла;
		
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	ЗаполнитьСписокОбъектов();
КонецПроцедуры

Процедура ОсновныеДействияФормыКнопкаОК(Кнопка)	
	ОповеститьОВыборе(ЭлементыФормы.СписокДокументов.ТекущаяСтрока.Значение);
КонецПроцедуры

Процедура СписокДокументовВыбор(Элемент, ВыбраннаяСтрока, Колонка, СтандартнаяОбработка)
	ВыбрАлгоритм = Выбраннаястрока.Значение;
КонецПроцедуры

Процедура СписокСправочниковВыбор(Элемент, ВыбраннаяСтрока, Колонка, СтандартнаяОбработка)
	ОповеститьОВыборе(ЭлементыФормы.СписокСправочников.ТекущаяСтрока.Значение);
КонецПроцедуры

Процедура ПриПовторномОткрытии(СтандартнаяОбработка)
	ЗаполнитьСписокОбъектов(); 
КонецПроцедуры

Процедура ВыполнитьНажатие(Элемент)
	// Получить форму и 
	// выполнить алгоритм
	Результат = Неопределено;
	
	Попытка
		ИмяФайла = КаталогВременныхФайлов()+"PrnForm.tmp";
		ДвоичныеДанные = ВыбрАлгоритм.ХранилищеВнешнейОбработки.Получить();
		ДвоичныеДанные.Записать(ИмяФайла);
		ВнОбработка = ВнешниеОбработки.Создать(ИмяФайла);
		ВнОбработка.СписокНоменклатуры = СписокНоменклатуры;
		ВнОбработка.СписокЦен = СписокЦен;
		РезультатНом = ВнОбработка.ВыполнитьАлгоритм();
	Исключение
		Предупреждение("Выбранный файл не является внешней обработкой.
					   |Либо, данная обработка не предназначена для
					   |запуска в этой конфигурации.");
	КонецПопытки; 
	СтандартнаяОбработка = Ложь;

	Закрыть(РезультатНом);
	
КонецПроцедуры







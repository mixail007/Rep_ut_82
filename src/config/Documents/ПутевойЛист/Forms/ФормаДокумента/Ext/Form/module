Процедура ОбновитьПробег(Элемент=Неопределено)
	ЭлементыФормы.НадписьПробег.Заголовок = "Пробег: "+?(ПробегПриВыезде>ПробегПриВозвращении,"не определен",Строка(ПробегПриВозвращении-ПробегПриВыезде)+" км");
КонецПроцедуры

Процедура ПриОткрытии()
	ОбновитьПробег();
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Дата",Дата);
	Запрос.УстановитьПараметр("Автомобиль",Автомобиль);
	Запрос.Текст = "ВЫБРАТЬ
	               |	КоэффициентРасходаТопливаСрезПоследних.Коэффициент,
	               |	НормыРасходаМатериаловСрезПоследних.Количество
	               |ИЗ
	               |	РегистрСведений.КоэффициентРасходаТоплива.СрезПоследних(&Дата, Автомобиль = &Автомобиль) КАК КоэффициентРасходаТопливаСрезПоследних
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.НормыРасходаМатериалов.СрезПоследних(&Дата, Автомобиль = &Автомобиль) КАК НормыРасходаМатериаловСрезПоследних
	               |		ПО КоэффициентРасходаТопливаСрезПоследних.Автомобиль = НормыРасходаМатериаловСрезПоследних.Автомобиль";
	
	Если Запрос.Выполнить().Пустой() Тогда
		Отказ = Истина;
#Если Клиент Тогда		
		Сообщить("Установите норму и коэффициент расхода топлива для '"+Автомобиль+"' на "+Формат(Дата,"ДФ=dd.MM.yyyy"),СтатусСообщения.Важное);
#КонецЕсли
	КонецЕсли;
	
КонецПроцедуры

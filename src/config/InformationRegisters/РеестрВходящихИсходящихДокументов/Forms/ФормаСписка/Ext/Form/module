
Процедура РегистрСведенийСписокПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	ОформлениеСтроки.Ячейки.Картинка.ОтображатьКартинку = Истина;
	ОформлениеСтроки.Ячейки.Картинка.ИндексКартинки = ?(ДанныеСтроки.Входящий, 1, 0);
КонецПроцедуры

Процедура ДействияФормыНайтиПоШК(Кнопка)
	
ШК="";

Если ВвестиСтроку(ШК, "Сосканируйте Штрих-код документа") тогда
	
	Если стрДлина(ШК)<8 тогда
		Предупреждение("Неправильный формат штрих-кода!",30);
		возврат;
	КонецЕсли;	
	
	ВидПФ    = Сред( ШК, 3, 1);    
	ПечФорма1 = ПолучитьВидПечатнойФормы( ВидПФ );
	
	Док = ПолучитьДокументПоШК( ШК );
	Если Док = Неопределено тогда
		Предупреждение("Не найден документ по Штрих-Коду !", 30);
		Возврат;
	КонецЕсли;
	
	ЭлОтбор = ЭлементыФормы.РегистрСведенийСписок.Значение.Отбор;
	
	ЭлОтбор.Документ.ВидСравнения = ВидСравнения.Равно;
	ЭлОтбор.Документ.Значение = Док;
	ЭлОтбор.Документ.Использование = истина;
	
	ЭлОтбор.ПечФорма.ВидСравнения  = ВидСравнения.Равно;
	ЭлОтбор.ПечФорма.Значение      = ПечФорма1;
	ЭлОтбор.ПечФорма.Использование = истина;
	
	ЭлОтбор.период.ЗначениеС  = '00010101';
	ЭлОтбор.период.ЗначениеПо = ТекущаяДата();
	
КонецЕсли;
	
КонецПроцедуры

Процедура ОбновлениеОтображения()
	
	входящий = ЭлементыФормы.РегистрСведенийСписок.Значение.Отбор.Входящий;
	
	Если входящий.Использование тогда
		Если входящий.Значение тогда
			вх = "Входящих";
		иначе	
			вх = "Исходящих";
		КонецЕсли;	
		ЭтаФорма.Заголовок = "Реестр "+вх+" документов";
	Иначе
		ЭтаФорма.Заголовок = "Реестр входящих / исходящих документов";
	КонецЕсли;	
	
 КонецПроцедуры

 Процедура ДействияФормыДействие(Кнопка)
	 
	Входящий = ЭлементыФормы.РегистрСведенийСписок.Значение.Отбор.Входящий;
	
	вх = Истина; // Входящий по умолчанию!
	
	Если входящий.Использование тогда
		вх = входящий.Значение;
	КонецЕсли;
	
	регСв = РегистрыСведений.РеестрВходящихИсходящихДокументов.СоздатьМенеджерЗаписи();
	регСв.Входящий = вх;
	регСв.ПолучитьФорму("ФормаЗаписи").ОткрытьМодально();
	
КонецПроцедуры

функция  получитьФормуВнешнейОбработки(номерВнОбр= 233, имяФормы = "Форма")
	ЭтоОбработка = истина;
	ИмяФайла = ПолучитьИмяВременногоФайла();
	
	файл = новый файл(ИмяФайла);
		обр = справочники.ВнешниеОбработки.НайтиПоКоду(номерВнОбр); // разбор на ГТД
		ДвоичныеДанные = обр.ХранилищеВнешнейОбработки.Получить();
		ДвоичныеДанные.Записать(ИмяФайла);
 	
    Если ЭтоОбработка Тогда
		Обработка = ВнешниеОбработки.Создать(ИмяФайла);
	Иначе
		Обработка = ВнешниеОтчеты.Создать(ИмяФайла);
	КонецЕсли;
			
	Если имяФормы="" тогда //19.08.2016 по умолчанию для любой обработки или отчета - названия НЕ надо!
		Форма = Обработка.ПолучитьФорму();
	иначе
		Форма = Обработка.ПолучитьФорму(имяФормы);
	КонецЕсли;
 возврат Форма;
КонецФункции

функция получитьТабл()
	текДата = НачалоДня(ТекущаяДата());
	Если не ВвестиДату( текДата, "Введите дату исх.документов", ЧастиДаты.ДатаВремя ) тогда
		возврат неопределено;
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ
	               |	РеестрВходящихИсходящихДокументов.Контрагент,
	               |	РеестрВходящихИсходящихДокументов.Период
				   |ИЗ
	               |	РегистрСведений.РеестрВходящихИсходящихДокументов КАК РеестрВходящихИсходящихДокументов
	               |ГДЕ
	               |	РеестрВходящихИсходящихДокументов.Период МЕЖДУ &Период0 И &Период1
	               |	И РеестрВходящихИсходящихДокументов.Входящий = ЛОЖЬ
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	РеестрВходящихИсходящихДокументов.Период
	               |АВТОУПОРЯДОЧИВАНИЕ";
			   
	Запрос.УстановитьПараметр("Период0", текДата );
	Запрос.УстановитьПараметр("Период1", КонецДня(текДата) );
	Результат = Запрос.Выполнить();
	табл = Результат.Выгрузить();
	
возврат табл;
КонецФункции

Процедура ДействияФормыПечатьАдресов(Кнопка)
	текДата = НачалоДня(ТекущаяДата());
	табл = получитьТабл();
	если табл=неопределено тогда
		возврат;
	КонецЕсли;
	
	табл.Свернуть("Контрагент"); //без повторов
	
	//============= получим исходящие документы за сегодня ======================
	Если табл.Количество()=0 тогда
		Предупреждение("Нет исходящих докуменентов за "+формат(текДата,"ДЛФ=DD"), 30);
		Сигнал();
		Возврат;
	КонецЕсли;	
	
	Форма = получитьФормуВнешнейОбработки(233,"Форма");
	
	Форма.ТабличноеПоле1 = табл.Скопировать();   //табл.Значений
	Форма.Заголовок = "Печать конвертов по исх. документам за "+формат(текДата,"ДЛФ=DD");
	
	Форма.Открыть();

КонецПроцедуры
  
Процедура ДействияФормыВыгрузкаВExcel(Кнопка)
	табл = получитьТабл();
	если табл=неопределено тогда
		возврат;
	КонецЕсли;
	Если табл.Количество()=0 тогда 
		возврат;
	КонецЕсли;
	
	Форма = получитьФормуВнешнейОбработки(235, "ВыгрузкаПисемВExcel");
	Форма.Открыть();
	
	Форма.ДатаСреза = табл[0].Период;
	Форма.КоманднаяПанель2Получить(неопределено);
	
КонецПроцедуры


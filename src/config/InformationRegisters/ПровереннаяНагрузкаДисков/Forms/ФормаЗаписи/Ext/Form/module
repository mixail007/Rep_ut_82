
Процедура НомерКонтейнераНачалоВыбора(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ЗакупкиОбороты.ЗаказПоставщику.НомерКонтейнера КАК НомерКонтейнера,
	|	ЗакупкиОбороты.Регистратор.Дата
	|ИЗ
	|	РегистрНакопления.Закупки.Обороты(&Нач, &Кон, Регистратор, ) КАК ЗакупкиОбороты
	|ГДЕ
	|	ЗакупкиОбороты.Номенклатура = &Номенклатура
	|	И ЗакупкиОбороты.Регистратор ССЫЛКА Документ.ПоступлениеТоваровУслуг
	|	И ЗакупкиОбороты.ЗаказПоставщику.НомерКонтейнера <> """"";
	
	Запрос.УстановитьПараметр("Кон", ТекущаяДата());
	Запрос.УстановитьПараметр("Нач", ДобавитьМесяЦ(ТекущаяДата(),-3));
	Запрос.УстановитьПараметр("Номенклатура", Номенклатура);
	
	Результат = Запрос.Выполнить().Выгрузить();
	
	ВыбСтрока = Результат.ВыбратьСтроку();
	Если ВыбСтрока <> Неопределено Тогда
		НомерКонтейнера = ВыбСтрока.НомерКонтейнера;	
	КонецЕсли;
	
КонецПроцедуры

Процедура ПриОткрытии()
	
	Если НЕ ЗначениеЗаполнено(Номенклатура) Тогда
		Номенклатура = НоменклатураВладелец;
		Если ЗначениеЗаполнено(НоменклатураВладелец) Тогда
			ЭлементыФормы.Номенклатура.Доступность = Ложь;	
		КонецЕсли;	
	КонецЕсли;
	
КонецПроцедуры

Процедура ПриЗаписи(Отказ)
	
	Если НЕ ТестПройден И ПрошедшаяНагрузка <> 0 Тогда
		ПоместитьВСтопЛист();
	КонецЕсли; 
	
	//Если ПрошедшаяНагрузка <= 283 Тогда
	//	ПоместитьВСтопЛист();
	//КонецЕсли;
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ)
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Номенклатура", Номенклатура);
	Запрос.УстановитьПараметр("Дата", Дата);
	Запрос.УстановитьПараметр("Дата", Документ);

	Запрос.Текст = "ВЫБРАТЬ
	               |	ПровереннаяНагрузкаДисков.Дата
	               |ИЗ
	               |	РегистрСведений.ПровереннаяНагрузкаДисков КАК ПровереннаяНагрузкаДисков
	               |ГДЕ
	               |	ПровереннаяНагрузкаДисков.Дата = &Дата
	               |	И ПровереннаяНагрузкаДисков.Номенклатура = &Номенклатура
	               |	И ПровереннаяНагрузкаДисков.Документ = &Документ";
	Результат = Запрос.Выполнить().Выбрать();
	Если Результат.Количество() > 0 Тогда
		Сообщить("Уже есть запись для этого товара с такой датой/временем. Установите другую дату/время");
		Отказ = Истина;
	КонецЕсли;
	
	Если ПрошедшаяНагрузка <= 283 И ТестПройден Тогда
		Сообщить("Признак Тест пройден не может быть установлен для нагрузки 283 и менее.");
		Отказ = Истина;
	КонецЕсли;
	
КонецПроцедуры

Процедура ПоместитьВСтопЛист()
	
	//Номенклатура помещается в стоп-лист
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Номенклатура", Номенклатура);
	Запрос.Текст = "ВЫБРАТЬ
	|	НоменклатураИмпорт.Номенклатура
	|ИЗ
	|	РегистрСведений.НоменклатураИмпорт КАК НоменклатураИмпорт
	|ГДЕ
	|	НоменклатураИмпорт.Номенклатура = &Номенклатура";
	Записи = Запрос.Выполнить().Выгрузить();
	Если Записи.Количество() = 0 Тогда
		МенеджерЗаписи = РегистрыСведений.НоменклатураИмпорт.СоздатьМенеджерЗаписи();
		МенеджерЗаписи.Номенклатура = Номенклатура;
		МенеджерЗаписи.Записать();
		Сообщить("Номенклатура помещена в стоп-лист");
	КонецЕсли;
	
КонецПроцедуры


Процедура ПриОткрытии()
	Если контрагент = Справочники.Контрагенты.ПустаяСсылка() Тогда
Контрагент = 	ПараметрыСеанса.ПустойКонтрагент ;
ПараметрыСеанса.ПустойКонтрагент = Справочники.Контрагенты.ПустаяСсылка();
конецЕсли;
КонецПроцедуры

Процедура ПередЗаписью(Отказ)
	Если не ЗначениеЗаполнено(Контрагент) Тогда
		Сообщить("Не заполнен контрагент!");
		отказ=Истина;
	конецЕсли;
	Если не ЗначениеЗаполнено(ВидТовара) Тогда
		Сообщить("Не заполнен вид товара");
		отказ=Истина;
	конецЕсли;
	Если не ЗначениеЗаполнено(Договор) Тогда
		Сообщить("Не заполнен договор");
		отказ=Истина;
	конецЕсли;
	Если не ЗначениеЗаполнено(Подразделение) Тогда
		Сообщить("Не заполнено подразделение");
		отказ=Истина;
	конецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	БумажныеДоговоры.Период,
	|	БумажныеДоговоры.Контрагент,
	|	БумажныеДоговоры.Номер,
	|	БумажныеДоговоры.ДатаОкончанияДействия,
	|	БумажныеДоговоры.Состояние,
	|	БумажныеДоговоры.ЕстьДоговорПоручительства,
	|	БумажныеДоговоры.ЕстьКопииПравоустанавливающихДокументов,
	|	БумажныеДоговоры.ПутьКФайлуДоговора,
	|	БумажныеДоговоры.ДопустимоеЧислоДнейЗадолженности,
	|	БумажныеДоговоры.Пролонгируется,
	|	БумажныеДоговоры.Комментарий
	|ИЗ
	|	РегистрСведений.БумажныеДоговоры КАК БумажныеДоговоры
	|ГДЕ
	|	БумажныеДоговоры.Контрагент = &Контрагент
	|	И (БумажныеДоговоры.ДатаОкончанияДействия > &ТекущаяДата
	|			ИЛИ БумажныеДоговоры.Пролонгируется)";
	
	Запрос.УстановитьПараметр("Контрагент", Контрагент);
	Запрос.УстановитьПараметр("ПустаяДата", Дата(1,1,1));
	Запрос.УстановитьПараметр("ТекущаяДата", ТекущаяДата());
	
	Результат = Запрос.Выполнить();
	//Если (Найти(ЭлементыФормы.Договор.Значение.Ссылка.Наименование,"счетам")=0 и Результат.Пустой()) тогда
	//	Сообщить("Заключенных бумажных договоров нет. Можно использовать только договор по счетам");
	//	Отказ = Истина;
	//ИначеЕсли (Найти(ЭлементыФормы.Договор.Значение.Ссылка.Наименование,"счетам")<>0 и не Результат.Пустой()) Тогда
	//	Сообщить("Есть заключенные бумажные договора. Нельзя использовать договор по счетам");
	//	Отказ = Истина;
	//конецЕсли;

	
КонецПроцедуры

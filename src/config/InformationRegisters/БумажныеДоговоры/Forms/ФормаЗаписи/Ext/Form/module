перем путь00, путь0, назвФ, назвП;
перем ном0;
//06.06.2016 регистрация изменений в договорах
Перем НаборПроверяемыхРеквизитов; 

Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.УстановитьПериод(Период, ?(ДатаОкончанияДействия='0001-01-01', ДатаОкончанияДействия, КонецДня(ДатаОкончанияДействия)));
	Если НастройкаПериода.Редактировать() Тогда
		Период = НастройкаПериода.ПолучитьДатуНачала();
		ДатаОкончанияДействия = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры

Процедура ПутьКФайлуДоговораОткрытие(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = ложь;
	ЗапуститьПриложение(ПутьКФайлуДоговора);
КонецПроцедуры

Процедура ПутьКФайлуДоговораНачалоВыбора(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = ложь;
	если ВидПути= назвП тогда
		диалог = новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.ВыборКаталога);
		если ПутьКФайлуДоговора<>"" тогда
			диалог.Каталог =ПутьКФайлуДоговора;
		иначе
			диалог.Каталог =путь0;
		КонецЕсли;	
	иначе // назвФ	
		диалог = новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
		если ПутьКФайлуДоговора="" тогда
	 		ПолучитьКаталогФайл(диалог.Каталог, диалог.ПолноеИмяФайла);
			файл = новый файл(диалог.ПолноеИмяФайла);
			если не файл.Существует() тогда
				диалог.Каталог =путь0; 
			    диалог.ПолноеИмяФайла = "";
			КонецЕсли;	
		Иначе
			диалог.Каталог =ПутьКФайлуДоговора; 
		    диалог.ПолноеИмяФайла = ПутьКФайлуДоговора;
		КонецЕсли;	
    КонецЕсли;

	Если диалог.Выбрать() тогда
		если ВидПути=назвП тогда
        ПутьКФайлуДоговора = диалог.Каталог;
		иначе
		ПутьКФайлуДоговора = диалог.ПолноеИмяФайла;
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры


Процедура ПриОткрытии()
	
	Если РегистрСведенийМенеджерЗаписи.Контрагент.Пустая() тогда
		если не ПараметрыСеанса.ПустойКонтрагент.Пустая() тогда
			//передаётся при создании записи из карточки Клиента!
			РегистрСведенийМенеджерЗаписи.Контрагент = ПараметрыСеанса.ПустойКонтрагент; 
			ЭлементыФормы.Контрагент.Доступность = ложь;
		КонецЕсли;
		РегистрСведенийМенеджерЗаписи.Период = НачалоДня( ТекущаяДата() );
	КонецЕсли;	
	
	Если Пролонгируется тогда
		ЭлементыФормы.ДатаОкончанияДействия.Доступность = ложь;
	КонецЕсли;
	
	ном0 = Номер; //26.04.2016
	
	//+++ ограничение доступа!
	Если сокрЛП(глТекущийПользователь.Код) = "Красникова" или сокрЛП(глТекущийПользователь.Код) = "Лаврентьева" или сокрЛП(глТекущийПользователь.Код) = "Глухова Т."  Тогда
		ЭлементыФормы.Период.Доступность = Истина;
		ЭлементыФормы.ДатаОкончанияДействия.Доступность = Истина;
		
		ЭлементыФормы.Номер.Доступность = Истина;//05.07.2016 открыт доступ к изменению номера!
		
		ЭлементыФормы.Пролонгируется.Доступность = Истина;
		ЭлементыФормы.ДопустимоеЧислоДнейЗадолженности.Доступность = Истина;
		
		ЭлементыФормы.Состояние.Доступность = Истина;
		ЭлементыФормы.ЕстьКопииПравоустанавливающихДокументов.Доступность = Истина;
		ЭлементыФормы.ЕстьДоговорПоручительства.Доступность = Истина;
		ЭлементыФормы.ПутьКФайлуДоговора.ТолькоПросмотр  = Ложь;	
		ЭлементыФормы.НомерСтарогоДоговора.ТолькоПросмотр = Ложь;
		ЭлементыФормы.ДатаСтарогоДоговора.ТолькоПросмотр = Ложь;
		ЭлементыФормы.Комментарий.ТолькоПросмотр = Ложь;
		//ИначеЕсли СокрЛП(глТекущийПользователь.Код) = "Горохов" Тогда //***2016.05.27 по задаче Красниковой
		//	ЭлементыФормы.Период.Доступность = Истина;
		//	ЭлементыФормы.ДатаОкончанияДействия.Доступность = Истина;			
		//ИначеЕсли СокрЛП(глТекущийПользователь.Код) = "Серков" Тогда //***2016.05.27 по задаче Красниковой
		//	ЭлементыФормы.Период.Доступность = Истина;
		//	ЭлементыФормы.ДатаОкончанияДействия.Доступность = Истина;
		//ИначеЕсли СокрЛП(глТекущийПользователь.Код) = "Лаврентьева" Тогда //***2016.05.27 по задаче Красниковой
		//	ЭлементыФормы.Период.Доступность = Истина;
		//	ЭлементыФормы.ДатаОкончанияДействия.Доступность = Истина;
		//	
		//	ЭлементыФормы.Номер.Доступность = Истина;//05.07.2016 открыт доступ к изменению номера!
		
		//	ЭлементыФормы.Пролонгируется.Доступность = Истина;
		//	ЭлементыФормы.ДопустимоеЧислоДнейЗадолженности.Доступность = Истина;
		//	
		//	//ЭлементыФормы.Состояние.Доступность = Истина;
		//	//ЭлементыФормы.ЕстьДоговорПоручительства.Доступность = Истина;
		//	
		////--под грошко уже другой работает-----------------------------------------------------------------------	
		//ИначеЕсли СокрЛП(глТекущийПользователь.Код) = "Грошко М.А." Тогда //***2016.05.27 по задаче Красниковой
		//	ЭлементыФормы.Период.Доступность = Истина;
		//	ЭлементыФормы.ДатаОкончанияДействия.Доступность = Истина;
		//	
		//	ЭлементыФормы.Пролонгируется.Доступность = Истина;
		//	ЭлементыФормы.ДопустимоеЧислоДнейЗадолженности.Доступность = Истина;
	иначеЕсли сокрЛП(глТекущийПользователь.Код) = "Серков" или сокрЛП(глТекущийПользователь.Код) = "Горохов" или сокрЛП(глТекущийПользователь.Код) = "Малышев Егор" или сокрЛП(глТекущийПользователь.Код) = "Бондаренко Е.Д. (снабжение)" или сокрЛП(глТекущийПользователь.Код) = "Марешева (Новый)" Тогда
		//Если состочние и дата нормальные, не даем редактировать
		Если ДатаОкончанияДействия > ТекущаяДата() и 
			(Состояние = справочники.СостояниеДокументов.НайтиПоКоду("1")
			или Состояние = справочники.СостояниеДокументов.НайтиПоКоду("2")
			или Состояние = справочники.СостояниеДокументов.НайтиПоКоду("12")
			//или Состояние = справочники.СостояниеДокументов.НайтиПоКоду("13")
			//или Состояние = справочники.СостояниеДокументов.НайтиПоКоду("14")
			или Состояние = справочники.СостояниеДокументов.НайтиПоКоду("4") ) Тогда
			ЭлементыФормы.Состояние.Доступность = ложь;	
		иначе		
			ЭлементыФормы.Состояние.Доступность = Истина;
			ЭлементыФормы.ДатаОкончанияДействия.Доступность = Истина;
		конецЕсли;
	КонецЕсли;	
		
	Если сокрЛП(глТекущийПользователь.Код) = "Малышев Егор" ИЛИ сокрЛП(глТекущийПользователь.Код) = "Никитин М.И." Тогда
		//***2018.02.08
		ЭлементыФормы.СуммаДоговора.Доступность = Истина;
	КонецЕсли;
	
	
	ЭлементыФормы.ВидПути.СписокВыбора.Добавить(назвП);
	ЭлементыФормы.ВидПути.СписокВыбора.Добавить(назвФ);
	если ПутьКФайлуДоговора<>"" тогда
		если лев(прав(ПутьКФайлуДоговора,4),1)="." тогда
			ВидПути = назвФ;
		иначе	
			ВидПути = назвП;
		КонецЕсли;
	иначе	
		ВидПути = назвП; //по умолчанию - папка!
	КонецЕсли;
	
	//06.06.2016 регистрация изменений реквизитов	
	НаборПроверяемыхРеквизитов = Новый Структура; 	
	Для каждого элемент из ЭлементыФормы Цикл 
		Если ТипЗнч(элемент) = Тип("ПолеВвода") Тогда 
			НаборПроверяемыхРеквизитов.Вставить(элемент.Имя,Элемент.Значение);
		КонецЕсли;	
	КонецЦикла; 	
	
КонецПроцедуры


Процедура ПриЗаписи(Отказ)
ТипыДоговора = Новый СписокЗначений;
ТипыДоговора.Добавить(Справочники.ТипыДоговоров.НайтиПоКоду("00001"));
ТипыДоговора.Добавить(Справочники.ТипыДоговоров.НайтиПоКоду("00004"));
ТипыДоговора.Добавить(Справочники.ТипыДоговоров.НайтиПоКоду("00027"));
//------------Обратное изменение всех реквизитов всех договоров!-----
Если СокрЛП(ном0)<>"" тогда//+++ 05.05.2016
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ДоговорыКонтрагентов.Ссылка
	               |ИЗ
	               |	Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
	               |ГДЕ
	               |	ДоговорыКонтрагентов.Владелец = &Владелец
	               |	И ДоговорыКонтрагентов.Номер = &Номер
	               |	И ДоговорыКонтрагентов.ТипДоговора В(&ТипыДоговора)";
	
	Запрос.УстановитьПараметр("Владелец", РегистрСведенийМенеджерЗаписи.Контрагент);
	Запрос.УстановитьПараметр("ТипыДоговора", ТипыДоговора);

	Запрос.УстановитьПараметр("Номер", ном0);  //ВОТ ТАК!   26.04.2016 и без даты!
//	Запрос.УстановитьПараметр("Дата", РегистрСведенийМенеджерЗаписи.Период);
	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();
	
	//26.04.2016
	если ном0 <> РегистрСведенийМенеджерЗаписи.Номер и Выборка.Количество()>0 тогда
		Предупреждение("У всех "+строка(Выборка.Количество())+" договоров с номером '"+строка(ном0)+"' 
		|будет изменен номер на '"+строка(РегистрСведенийМенеджерЗаписи.Номер)+"'", 60);
	 КонецЕсли;
	
	Пока Выборка.Следующий() Цикл
	  дог = выборка.Ссылка.ПолучитьОбъект();
	  
	  ЗаполнитьЗначенияСвойств(дог, РегистрСведенийМенеджерЗаписи);
	  дог.СостояниеДоговора 		= РегистрСведенийМенеджерЗаписи.Состояние;
	  дог.ЕстьДогорПоручительства 	= РегистрСведенийМенеджерЗаписи.ЕстьДоговорПоручительства;
	  Дог.ДатаОкончанияДействия     = РегистрСведенийМенеджерЗаписи.ДатаОкончанияДействия;
	  дог.Дата = РегистрСведенийМенеджерЗаписи.Период;// 26.04.2016 и без даты!
	  Дог.ЕстьКопииПравоустанавливающихДокументов  = РегистрСведенийМенеджерЗаписи.ЕстьКопииПравоустанавливающихДокументов;
	  Дог.ДопустимоеЧислоДнейЗадолженности =РегистрСведенийМенеджерЗаписи.ДопустимоеЧислоДнейЗадолженности;
	  //устанавливаем ограничение по отгрузке на большую дату
	  Если дог.ТипДоговора = справочники.ТипыДоговоров.НайтиПоКоду("00004") // отсрочка
		  и дог.ВедениеВзаиморасчетов = Перечисления.ВедениеВзаиморасчетовПоДоговорам.ПоЗаказам
		  и ДопустимоеЧислоДнейЗадолженности>0 тогда
		  дог.КонтролироватьЧислоДнейЗадолженности = Истина;
	  Иначе	 
		  // при "выключении" или ином типе - ничего контролировать НЕ НАДО
		  дог.КонтролироватьЧислоДнейЗадолженности = ложь;
		  дог.ДопустимоеЧислоДнейЗадолженности = 0;
	  КонецЕсли;
	  	  
	  	попытка
	  дог.ОбменДанными.Загрузка = истина;
		  дог.Записать();
	  дог.ОбменДанными.Загрузка = ЛОЖЬ;
		  сообщить("Изменен договор "+строка(дог.Код)+" "+строка(дог.Наименование)
		  + ?(дог.КонтролироватьЧислоДнейЗадолженности," (срок оплаты: "+строка(ДопустимоеЧислоДнейЗадолженности)+")","")
		  +" - "+строка(дог.ОтветственноеЛицо), СтатусСообщения.Информация);
		  
	    исключение
		  сообщить(ОписаниеОшибки(), СтатусСообщения.ОченьВажное);
		КонецПопытки;  
	 КонецЦикла;
	 Сообщить("----- Изменено "+строка(Выборка.Количество())+" договора контрагента "+строка( РегистрСведенийМенеджерЗаписи.Контрагент) +" -----");
 Иначе
 	 Сообщить("----- Ни один из договоров контрагента "+строка( РегистрСведенийМенеджерЗаписи.Контрагент) +" - НЕ Изменен! -----");
 КонецЕсли;
 
///замена реквизитов старых договоров 
Если  СокрЛП(НомерСтарогоДоговора)<> "" Тогда

Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ДоговорыКонтрагентов.Ссылка
		|ИЗ
		|	Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
		|ГДЕ
		|	ДоговорыКонтрагентов.Владелец = &Владелец
		|	И ДоговорыКонтрагентов.Номер = &Номер
		|	И ДоговорыКонтрагентов.Дата = &Дата";

		//Запрос.Текст = Запрос.текст + "И ДоговорыКонтрагентов.ТипДоговора В(&ТипыДоговора)";
		//	Запрос.УстановитьПараметр("ТипыДоговора", ТипыДоговора);
		//конецЕсли; 


	Запрос.УстановитьПараметр("Владелец", Контрагент);
	Запрос.УстановитьПараметр("Дата", ДатаСтарогоДоговора);
	Запрос.УстановитьПараметр("Номер", СокрЛП(НомерСтарогоДоговора));

	Результат = Запрос.Выполнить();

	Если не Результат.Пустой() Тогда
	Выборка = Результат.Выбрать();

	Пока Выборка.Следующий() Цикл
		ДогОб = Выборка.ссылка.получитьОбъект();
		ДогОб.обменДанными = Истина;
		ДогОб.Номер = Номер;
		ДогОб.Дата  = Период;
		ДогОб.ДатаОкончанияДействия = ДатаОкончанияДействия;
		ДогОб.СостояниеДоговора = Состояние; 
		ДогОб.ЕстьДогорПоручительства = ЕстьДоговорПоручительства; 
		ДогОб.ЕстьКопииПравоустанавливающихДокументов  = ЕстьКопииПравоустанавливающихДокументов;
		ДогОб.ДопустимоеЧислоДнейЗадолженности =ДопустимоеЧислоДнейЗадолженности;
		ДогОб.Записать();
	КонецЦикла;
	 Сообщить("Договора обработаны!");
	иначе
	 Сообщить ("Договоров менеджеров с указанным номером не найдено!");
 конецесли;
 конецЕсли;
 КонецПроцедуры


Процедура ПолучитьКаталогФайл(Каталог="", ИмяФайла="")
	путь0   =  путь00+"Договоры поставки поименно\";
	путьСПб =  путь00+"Филиал СПб\Договоры поставки\";
	путьРнД =  путь00+"Филиал Р-н-Д\Договоры поставки\";
	путьЕКТ =  путь00+"Филиал Екатеринбург\Договоры поставки\";
	
	стр1 = РегистрСведенийМенеджерЗаписи;
	
		год = формат(Год(стр1.Период),"ЧГ=0");
		месяц = строка(Месяц(стр1.Период))+"."+формат(стр1.Период,"ДФ=MMММ");
		ном = стрЗаменить(сокрЛП(стр1.Номер), "/",".");
		ном = стрЗаменить(ном,год, прав(год,2));
		
		контр = СокрЛП(строка(стр1.Контрагент));
		если прав(контр,1)="." тогда
			контр = лев(контр, стрДлина(контр)-1);
		КонецЕсли;	
		
		
		если Найти(ном,"ЕКТ")>0 тогда
			путь = путьЕКТ;
		иначеесли Найти(ном,"СП")>0 тогда
			путь = путьСПб;
		иначеесли Найти(ном,"РД")>0 тогда
			путь = путьРнД;
		Иначе
			путь = путь0;
		КонецЕсли;
		
		
		Если путь=путь0 тогда
			стрФ = путь+год+"\"+месяц+"\"+контр+"\";
		Иначе//для филиалов - без месяца
			стрФ = путь+год+"\"+контр+"\";
		КонецЕсли;
		
	 Каталог = стрФ;
	 ИмяФайла = стрФ+ном+".pdf";
КонецПроцедуры	 

Процедура СостояниеНачалоВыбора(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = ЛОЖЬ;
	Если сокрЛП(глТекущийПользователь.Код) = "Серков" или сокрЛП(глТекущийПользователь.Код) = "Горохов" или сокрЛП(глТекущийПользователь.Код) = "Малышев Егор" Тогда
	списокКодов = новый списокЗначений();
	СписокКодов.Добавить(13);
	СписокКодов.Добавить(14);
	форма = справочники.СостояниеДокументов.ПолучитьФормуВыбора();
	форма.СправочникСписок.Отбор.ДляКонтрагента.Использование = Истина;
	форма.СправочникСписок.Отбор.ДляКонтрагента.ВидСравнения = видСравнения.Равно;
	форма.СправочникСписок.Отбор.ДляКонтрагента.Значение = Истина;
	форма.СправочникСписок.Отбор.код.Использование = Истина;
	форма.СправочникСписок.Отбор.Код.ВидСравнения = видСравнения.ВСписке;
	форма.СправочникСписок.Отбор.Код.Значение = списокКодов;
	Состояние = форма.ОткрытьМодально();

	иначе
	форма = справочники.СостояниеДокументов.ПолучитьФормуВыбора();
	форма.СправочникСписок.Отбор.ДляКонтрагента.Использование = Истина;
	форма.СправочникСписок.Отбор.ДляКонтрагента.ВидСравнения = видСравнения.Равно;
	форма.СправочникСписок.Отбор.ДляКонтрагента.Значение = Истина;
	Состояние = форма.ОткрытьМодально();
    конецЕсли;

КонецПроцедуры

//------ в точности как в выборе Состояния в Договоре Контрагента ----------
Процедура СостояниеНачалоВыбораИзСписка(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	Если сокрЛП(глТекущийПользователь.Код) = "Серков" или сокрЛП(глТекущийПользователь.Код) = "Горохов" или сокрЛП(глТекущийПользователь.Код) = "Малышев Егор" Тогда
	списокКодов = новый списокЗначений();
	СписокКодов.Добавить(13);
	СписокКодов.Добавить(14);
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	СостояниеДокументов.Ссылка
		|ИЗ
		|	Справочник.СостояниеДокументов КАК СостояниеДокументов
		|ГДЕ
		|	СостояниеДокументов.ДляКонтрагента
		|	И СостояниеДокументов.Код В(&СписокКодов)";
	
	Запрос.Параметры.Вставить("СписокКодов",СписокКодов);	
	РезультатЗапроса = Запрос.Выполнить().Выгрузить();
	Список= Новый СписокЗначений;
	Массив = РезультатЗапроса.ВыгрузитьКолонку("Ссылка");
	Список.ЗагрузитьЗначения(Массив);
	
	ВыбранныйЭлемент = ВыбратьИзСписка(Список,Элементыформы.Состояние);
	Если ВыбранныйЭлемент <> Неопределено Тогда
		Элемент.Значение = ВыбранныйЭлемент.Значение;
	КонецЕсли;
		
	иначе	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ СостояниеДокументов.Ссылка
		|ИЗ Справочник.СостояниеДокументов КАК СостояниеДокументов
		|ГДЕ СостояниеДокументов.ДляКонтрагента";
	
	РезультатЗапроса = Запрос.Выполнить().Выгрузить();
	Список= Новый СписокЗначений;
	Массив = РезультатЗапроса.ВыгрузитьКолонку("Ссылка");
	Список.ЗагрузитьЗначения(Массив);
	
	ВыбранныйЭлемент = ВыбратьИзСписка(Список,Элементыформы.Состояние);
	Если ВыбранныйЭлемент <> Неопределено Тогда
		Элемент.Значение = ВыбранныйЭлемент.Значение;
	КонецЕсли;
    конецЕсли;
КонецПроцедуры

Процедура ПролонгируетсяПриИзменении(Элемент)
	Если Пролонгируется тогда
		ДатаОкончанияДействия = '00010101';
	КонецЕсли;	
	ЭлементыФормы.ДатаОкончанияДействия.Доступность = НЕ Пролонгируется;
КонецПроцедуры

Процедура ДопустимоеЧислоДнейЗадолженностиПриИзменении(Элемент)
	
	//22.12.2015 - снято ограничение на число дней
	//Если ДопустимоеЧислоДнейЗадолженности > 30 тогда
	//	 Предупреждение("Число дней оплаты в Заказе покупателя 
	//	 				| Для договоров отсрочки не может быть более 30 дней!
	//					| Для договоров предоплаты - не более 14 дней!", 10);
	//					
	//	Если НЕ (РольДоступна("яштФинДиректор") или РольДоступна("ПолныеПрава"))  // ФинОтдел, Бухгалтерия, Горохов
	//	   или ПолучитьЗначениеПоУмолчанию(глТекущийПользователь,"УчетТолькоПоПодразделениюПользователя") тогда
	//	ДопустимоеЧислоДнейЗадолженности = 30; // не более месяца !
	//	КонецЕсли;
	//
	//КонецЕсли;
	
КонецПроцедуры

Процедура ДатаОкончанияДействияПриИзменении(Элемент)
	Если ДатаОкончанияДействия <> '00010101' и Пролонгируется тогда
		Сообщить("Галочка пролонгируется снята!!!");
		Пролонгируется = Ложь;
	КонецЕсли;	
КонецПроцедуры

//06.06.2016 регистрация изменений реквизитов
Процедура ПослеЗаписи()	                                                             	
	Для каждого Элемент Из НаборПроверяемыхРеквизитов Цикл
        ЭУ = ЭлементыФормы.Найти(Элемент.Ключ);
        Если ЭУ  <> Неопределено Тогда 
            Если ЭУ.Значение <>Элемент.Значение Тогда 
            ВнестиЗаписьОбИзменении(Элемент,Эу.Значение,Контрагент,Номер);                
            КонецЕсли; 
        КонецЕсли;
	КонецЦикла;
	
//  проверим есть ли действующие договора по счетам и закроем их 

Если ((Пролонгируется и не ЗначениеЗаполнено(ДатаОкончанияДействия)) или ДатаОкончанияДействия> ТекущаяДата())
	и   
	(Состояние = справочники.СостояниеДокументов.НайтиПоКоду("1")//23.09.2016
	или Состояние = справочники.СостояниеДокументов.НайтиПоКоду("2")
	или Состояние = справочники.СостояниеДокументов.НайтиПоКоду("12")
	или Состояние = справочники.СостояниеДокументов.НайтиПоКоду("13")
	или Состояние = справочники.СостояниеДокументов.НайтиПоКоду("14")
	или Состояние = справочники.СостояниеДокументов.НайтиПоКоду("4")) Тогда
	
	
	договоры =   справочники.ДоговорыКонтрагентов.Выбрать(,Контрагент,,);
	пока Договоры.Следующий() цикл
		если Договоры.ТипДоговора = Справочники.ТипыДоговоров.НайтиПоКоду("00015") и не ЗначениеЗаполнено(ДатаОкончанияДействия) тогда
			догОбъект = Договоры.ПолучитьОбъект();
			ДогОбъект.ДатаОкончанияДействия = ТекущаяДата();
			#Если Клиент Тогда
				Сообщить("Закрыт договор предоплаты по счетам");
			#конецЕсли	
			догОбъект.Записать();
		 конецЕсли;
	конецЦикла;
конецЕсли;
КонецПроцедуры


Процедура ВнестиЗаписьОбИзменении(РеквизитБыло,РеквизитСтало,Контрагент,Номер)		
	ЗаписьОбИзменении = РегистрыСведений.ЖурналИзменений.СоздатьМенеджерЗаписи();
	ЗаписьОбИзменении.Пользователь = ПараметрыСеанса.ТекущийПользователь;
	ЗаписьОбИзменении.Объект = РегистрСведенийМенеджерЗаписи.Контрагент;
	ЗаписьОбИзменении.Компьютер = ИмяКомпьютера();
	ЗаписьОбИзменении.Событие = "Изменение Договора " + Контрагент + "  N " + Номер + ".  Изменен реквизит: " + РеквизитБыло.Ключ;
	ЗаписьОбИзменении.Комментарий = "Было: " + РеквизитБыло.Значение +". Стало: " + РеквизитСтало;
	ЗаписьОбИзменении.Период = ТекущаяДата();
	ЗаписьОбИзменении.Записать();	                                          		
КонецПроцедуры

Процедура НомерСтарогоДоговораПриИзменении(Элемент)
	Комментарий = Комментарий+" Замена договора "+НомерСтарогоДоговора;
КонецПроцедуры
// конец 06.06.2016	

путь00 = "\\omega\Договоры\ТК ЯРШИНТОРГ\";
путь0  = путь00 +"Договоры поставки поименно\";

назвФ = "файлу договора";
назвП = "папке договора";
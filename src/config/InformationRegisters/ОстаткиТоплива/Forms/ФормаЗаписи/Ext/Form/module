 
Процедура ПриОткрытии()
	
	Если НЕ РольДоступна("ПолныеПрава") тогда
		ЭтаФорма.ТолькоПросмотр = истина;
	КонецЕсли;
	
	Если Танкер=0 тогда Танкер=1; КонецЕсли;
	Если ТипТоплива="" тогда ТипТоплива="ДТ"; КонецЕсли;
	
    Если НомерЧека=0 и Количество=0 тогда  //новая запись
		регСв = РегистрыСведений.ОстаткиТоплива.СрезПоследних(Период, новый Структура("Танкер",Танкер) );
		Если регСв.Количество()>0 тогда 
			НомерЧека  = регСв[0].НомерЧека + 1;
			НомерСмены = регСв[0].НомерСмены;
		КонецЕсли;	
	КонецЕсли;

	
	Если Количество<>0 тогда
	 Цена = Стоимость/Количество;
	 ЭлементыФормы.НадписьКомментарий.Заголовок = "Комментарий:      Цена:"+Формат(Цена,"ЧДЦ=2")+" р.";
    КонецЕсли;
	
//---------------------------------------------------------------------

	ЭлементыФормы.Контрагент.СписокВыбора.Добавить( справочники.Контрагенты.НайтиПоКоду("93833"));//Воробьев А. В. ИП+
    ЭлементыФормы.Контрагент.СписокВыбора.Добавить( справочники.Контрагенты.НайтиПоКоду("00216"));//Землянский+
	ЭлементыФормы.Контрагент.СписокВыбора.Добавить( справочники.Контрагенты.НайтиПоКоду("36092"));//Яршинторг ТК



	ЭлементыФормы.ТипТоплива.СписокВыбора.Добавить("ДТ");
	ЭлементыФормы.ТипТоплива.СписокВыбора.Добавить("АИ-92");
	ЭлементыФормы.ТипТоплива.СписокВыбора.Добавить("АИ-95");
	ЭлементыФормы.ТипТоплива.СписокВыбора.Добавить("АИ-98");
	
	// пока только 1 танкер и менять его может только IT-отдел
	Если рольДоступна("ПравоЗавершенияРаботыПользователей") тогда  
		ЭлементыФормы.Танкер.Доступность = истина;
		ЭлементыФормы.ТипТоплива.Доступность = истина;
	КонецЕсли;
	
КонецПроцедуры

Процедура Кнопка1Нажатие(Элемент)
	
	 стр1 = яштРезервыПоТоварам.ПолучитьОстатокТоплива(Период, Танкер);

	 Цена = стр1[0].Стоимость/Стр1[0].Количество;
	 
	 Стоимость = Окр(Количество * Цена, 2);
	 КоличествоПриИзменении(неопределено);
	 
КонецПроцедуры

Процедура ПередЗаписью(Отказ)
	Если НомерЧека>0 и Количество>0 тогда
		Количество = - Количество;
		Стоимость  = - Стоимость ;
		сообщить("Заправка (№ чека "+строка(НомерЧека)+") - уменьшает остаток в Танкере №"+строка(Танкер)+". Количество и цена автоматически изменена на отрицательную", СтатусСообщения.Информация);
	КонецЕсли;	
КонецПроцедуры


Процедура КоличествоПриИзменении(Элемент)
	Если Количество<>0 тогда
	 Цена = Стоимость/Количество;
	 ЭлементыФормы.НадписьКомментарий.Заголовок = "Комментарий:      Цена:"+Формат(Цена,"ЧДЦ=4")+" р.";
 	Иначе
	  ЭлементыФормы.НадписьКомментарий.Заголовок = "Комментарий:";
	КонецЕсли;
КонецПроцедуры


Процедура КоличествоРегулирование(Элемент, Направление, СтандартнаяОбработка)
	СтандартнаяОбработка = ложь;
	Элемент.Значение = Элемент.Значение -  Направление*0.01;
	КоличествоПриИзменении(неопределено);
КонецПроцедуры


Процедура КонтрагентПриИзменении(Элемент)
	ЭлементыФормы.Автомобиль.СписокВыбора.Очистить();
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ОстаткиТоплива.Автомобиль КАК Автомобиль
	|ИЗ
	|	РегистрСведений.ОстаткиТоплива КАК ОстаткиТоплива
	|ГДЕ
	|	ОстаткиТоплива.Контрагент = &Контрагент
	|
	|УПОРЯДОЧИТЬ ПО
	|	Автомобиль
	|АВТОУПОРЯДОЧИВАНИЕ";
	
	Запрос.УстановитьПараметр("Контрагент", Контрагент);
	
	Результат = Запрос.Выполнить();
	если не Результат.Пустой() тогда
	Табл = Результат.Выгрузить();
	ЭлементыФормы.Автомобиль.СписокВыбора.ЗагрузитьЗначения(Табл.ВыгрузитьКолонку("Автомобиль"));
	КонецЕсли;
КонецПроцедуры


Перем НеЗаписан;

Процедура РегистрСведенийСписокПриНачалеРедактирования(Элемент, НоваяСтрока)

	НеЗаписан = Ложь;
	Если НоваяСтрока Тогда
		Элемент.ТекущиеДанные.Код = ПолучитьНовыйКодДляШтрихКода();
		НеЗаписан = Истина;
	КонецЕсли;

КонецПроцедуры

Процедура РегистрСведенийСписокПриОкончанииРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования)
	ТекЗапись = Элемент.ТекущиеДанные;
	НайденныеЗаписи = ПроверитьУникальностьШтрихКода(ТекЗапись.ШтрихКод, ТекЗапись.Код);

	Если НайденныеЗаписи <> Неопределено И НайденныеЗаписи.Количество()<>0 Тогда //Найдены неуникальные записи.
	
		Ответ = Вопрос(""+ТекЗапись.ШтрихКод+". Такой штрихкод уже установлен для других значений!"+Символы.ПС+
		"Показать записи с таким штрихкодом?", РежимДиалогаВопрос.ДаНет);
		Если Ответ = КодВозвратаДиалога.Да Тогда
			РегистрСведенийСписок.Отбор.Штрихкод.Значение = ТекЗапись.ШтрихКод;
			РегистрСведенийСписок.Отбор.Штрихкод.Использование = Истина;
		КонецЕсли;

	КонецЕсли;

КонецПроцедуры

Процедура РегистрСведенийСписокВладелецПриИзменении(Элемент)
	Если НеЗаписан Тогда
		Если НЕ ЗначениеНеЗаполнено(Элемент.Значение) Тогда
			Если ТипЗнч(Элемент.Значение) = Тип ("СправочникСсылка.Номенклатура")Тогда
				ЭлементыФормы.РегистрСведенийСписок.ТекущиеДанные.ЕдиницаИзмерения = Элемент.Значение.ЕдиницаХраненияОстатков;
			КонецЕсли;
			ЭлементыФормы.РегистрСведенийСписок.ТекущиеДанные.Код = ПолучитьНовыйКодДляШтрихКода();;
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры

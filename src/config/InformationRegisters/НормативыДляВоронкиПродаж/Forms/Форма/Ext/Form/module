
Процедура ОсновныеДействияФормыЗаписать(Кнопка)
	Для каждого стр из ТаблицаНормативов Цикл
		сч =1;
		Пока сч<13 Цикл
		Запись = РегистрыСведений.НормативыДляВоронкиПродаж.СоздатьМенеджерЗаписи();
		Запись.СтатусКонтрагента = стр.Статус;
		Запись.Месяц = сч;
		Запись.Прочитать();
		Запись.СтатусКонтрагента = стр.Статус;
		Запись.Месяц = сч;
		Запись[Показатель] = стр[сч];
		Запись.Записать(Истина);
		сч=сч+1;
		конецЦикла;
	конецЦикла;	
КонецПроцедуры

Процедура ПриОткрытии()
	ЭлементыФормы.НадписьПоказатель.Заголовок = Показатель;
	Если показатель = "НормаЗвонков" Тогда
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	НормативыДляВоронкиПродаж.СтатусКонтрагента КАК СтатусКонтрагента,
		|	НормативыДляВоронкиПродаж.Месяц КАК Месяц,
		|	НормативыДляВоронкиПродаж.НормаЗвонков
		|ИЗ
		|	РегистрСведений.НормативыДляВоронкиПродаж КАК НормативыДляВоронкиПродаж
		|
		|УПОРЯДОЧИТЬ ПО
		|	СтатусКонтрагента,
		|	Месяц";
		
		Результат = Запрос.Выполнить();
		
		Выборка = Результат.Выбрать();
		предыдущийСтатус  = "";
		Пока Выборка.Следующий() Цикл
			Если ПредыдущийСтатус <> Выборка.СтатусКонтрагента тогда
				стр = ТаблицаНормативов.Добавить();
				стр.Статус = Выборка.СтатусКонтрагента;
				ПредыдущийСтатус = Выборка.СтатусКонтрагента;
			конецЕсли;
			стр[Выборка.месяц]  = Выборка.НормаЗвонков;
		КонецЦикла;
		Массив = Новый Массив;
		Массив.добавить(Тип("ПеречислениеСсылка.КатегорииКонтрагентов"));
		ЭлементыФормы.ТаблицаНормативов.Колонки.Статус.ЭлементУправления.ОграничениеТипа = Новый ОписаниеТипов(Массив,,);

	ИначеЕсли показатель = "НормаКлиентов" Тогда
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	НормативыДляВоронкиПродаж.СтатусКонтрагента КАК СтатусКонтрагента,
		|	НормативыДляВоронкиПродаж.Месяц КАК Месяц,
		|	НормативыДляВоронкиПродаж.НормаКлиентов
		|ИЗ
		|	РегистрСведений.НормативыДляВоронкиПродаж КАК НормативыДляВоронкиПродаж
		|
		|УПОРЯДОЧИТЬ ПО
		|	СтатусКонтрагента,
		|	Месяц";
		
		Результат = Запрос.Выполнить();
		
		Выборка = Результат.Выбрать();
		предыдущийСтатус  = "";
		Пока Выборка.Следующий() Цикл
			Если ПредыдущийСтатус <> Выборка.СтатусКонтрагента тогда
				стр = ТаблицаНормативов.Добавить();
				стр.Статус = Выборка.СтатусКонтрагента;
				ПредыдущийСтатус = Выборка.СтатусКонтрагента;
			конецЕсли;
			стр[Выборка.месяц]  = Выборка.НормаКлиентов;
		КонецЦикла;
		Массив = Новый Массив;
		Массив.добавить(Тип("ПеречислениеСсылка.КатегорииКонтрагентов"));
		ЭлементыФормы.ТаблицаНормативов.Колонки.Статус.ЭлементУправления.ОграничениеТипа = Новый ОписаниеТипов(Массив,,);

	ИначеЕсли показатель = "НормаПродаж" Тогда
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	НормативыДляВоронкиПродаж.СтатусКонтрагента КАК СтатусКонтрагента,
		|	НормативыДляВоронкиПродаж.Месяц КАК Месяц,
		|	НормативыДляВоронкиПродаж.НормаПродаж
		|ИЗ
		|	РегистрСведений.НормативыДляВоронкиПродаж КАК НормативыДляВоронкиПродаж
		|
		|УПОРЯДОЧИТЬ ПО
		|	СтатусКонтрагента,
		|	Месяц";
		
		Результат = Запрос.Выполнить();
		
		Выборка = Результат.Выбрать();
		предыдущийСтатус  = "";
		Пока Выборка.Следующий() Цикл
			Если ПредыдущийСтатус <> Выборка.СтатусКонтрагента тогда
				стр = ТаблицаНормативов.Добавить();
				стр.Статус = Выборка.СтатусКонтрагента;
				ПредыдущийСтатус = Выборка.СтатусКонтрагента;
			конецЕсли;
			стр[Выборка.месяц]  = Выборка.НормаПродаж;
		КонецЦикла;
		Массив = Новый Массив;
		Массив.добавить(Тип("СправочникСсылка.КатегорииПокупателей"));
		ЭлементыФормы.ТаблицаНормативов.Колонки.Статус.ЭлементУправления.ОграничениеТипа = Новый ОписаниеТипов(Массив,,);
    конецесли;
КонецПроцедуры


Процедура ПриОткрытии()
	// Вставить содержимое обработчика.
КонецПроцедуры

Процедура РегистрСведенийСписокПриПолученииДанных(Элемент, ОформленияСтрок)
	        Для каждого ОформлениеСтроки из ОформленияСтрок Цикл
			ОформлениеСтроки.Ячейки.Код.ОтображатьТекст = Истина;
            ОформлениеСтроки.Ячейки.Код.Текст = ОформлениеСтроки.ДанныеСтроки.Номенклатура.Код;
			конецЦикла;
			
КонецПроцедуры

Процедура ДействияФормыЗагрузить(Кнопка)
	РегистрыСведений.СезонныйАссортимент.получитьформу("ФормаЗагрузки").Открыть();
КонецПроцедуры


Процедура ДействияФормыВыгрузитьВTerminal(Кнопка)
	ИмяФайла=КаталогВременныхФайлов()+"SeasonOffers_terminal.xml"; // на сервере - своя папка...
	
	ОбъектXML = Новый ЗаписьXML;
	ОбъектXML.ОткрытьФайл(ИмяФайла, "UTF-8");
	ОбъектXML.ЗаписатьОбъявлениеXML();  //<?xml version="1.0"?>
	ОбъектXML.ЗаписатьНачалоЭлемента("SeasonOffers");
	

	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	СезонныйАссортимент.Номенклатура,
		|	ЗначенияСвойствОбъектов.Значение как завод
		|ИЗ
		|	РегистрСведений.СезонныйАссортимент КАК СезонныйАссортимент
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияСвойствОбъектов
		|		ПО СезонныйАссортимент.Номенклатура = ЗначенияСвойствОбъектов.Объект
		|ГДЕ
		|	ЗначенияСвойствОбъектов.Свойство = &Свойство";

	Запрос.УстановитьПараметр("Свойство", ПланыВидовХарактеристик.СвойстваОбъектов.НайтиПоКоду("90185"));

	Результат = Запрос.Выполнить();
    наборЗаписей = Результат.Выгрузить();
	
	Для каждого запись из НаборЗаписей Цикл
		ОбъектXML.ЗаписатьНачалоЭлемента("Product");
		ОбъектXML.ЗаписатьАтрибут("ProductId", Запись.Номенклатура.Код); //строка
		ОбъектXML.ЗаписатьАтрибут("Factory", Запись.Завод ); //строка
		ОбъектXML.ЗаписатьКонецЭлемента(); 
	конецЦикла;
	ОбъектXML.ЗаписатьКонецЭлемента(); 
	ОбъектXML.Закрыть();
	
	удачно = ОбменСУТИнтернетМагазин.SIM_ВыгрузитьФайлНаСервер(ИмяФайла,"ImportSeasonOffers", Истина, "terminal.yst.ru" );
	#Если Клиент Тогда
	сообщить("Сформирован файл выгрузки "+Имяфайла);
	Если удачно Тогда
	сообщить("Файл удачно выгружен в Terminal");
	конецЕсли;                                     	
	#конецесли
КонецПроцедуры
                                       
<ПравилаОбмена><ВерсияФормата>2.00</ВерсияФормата><Ид>B455B3BE-484C-4D3A-9834-CE127A33C7E8    </Ид><Наименование>Торговля10_Бухгалтерия4</Наименование><ДатаВремяСоздания>2005-02-20T14:41:35</ДатаВремяСоздания><Источник ВерсияПлатформы="8.0">УправлениеТорговлей</Источник><Приемник ВерсияПлатформы="7.7">Бухгалтерский учет, редакция 4.5</Приемник><Обработки/><ПравилаКонвертацииОбъектов><Группа><Код>Вспомогательные</Код><Наименование>Вспомогательные</Наименование><Порядок>600</Порядок><Правило><Код>ВариантыРасчетаНалогов</Код><Наименование> --&gt; СправочникСсылка.ВариантыРасчетаНалогов</Наименование><Порядок>1600</Порядок><ПередВыгрузкой>Стр = "";

Если Источник.УчитыватьНДС Тогда
	Стр = Стр + "НДС ";
	Если Источник.СуммаВключаетНДС Тогда
		Стр = Стр + "в сумме";
	Иначе
		Стр = Стр + "сверху";
	КонецЕсли;
КонецЕсли;

Если Источник.УчитыватьНП Тогда
	Если Стр &lt;&gt; "" Тогда
		Стр = Стр + "; ";
	КонецЕсли;
	
	Стр = Стр + "НП ";
	Если Источник.СуммаВключаетНП Тогда
		Стр = Стр + "в сумме";
	Иначе
		Стр = Стр + "сверху";
	КонецЕсли;
КонецЕсли;

Если Стр = "" Тогда
	Стр = "Без налогов";
КонецЕсли;

Источник.Вставить("Наименование", Стр);
КлючВыгружаемыхДанных = Стр;</ПередВыгрузкой><НеЗамещать>true</НеЗамещать><Приемник>СправочникСсылка.ВариантыРасчетаНалогов</Приемник><Свойства><Свойство Поиск="true"><Код>2</Код><Наименование> --&gt; Наименование</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/></Свойство><Свойство><Код>3</Код><Наименование> --&gt;</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="СуммаВключаетНДС" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>4</Код><Наименование> --&gt; СуммаВключаетНП</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="СуммаВключаетНП" Вид="Реквизит" Тип="Число"/></Свойство></Свойства><Значения/></Правило><Правило><Код>ВидыНоменклатуры</Код><Наименование> --&gt; СправочникСсылка.ВидыНоменклатуры</Наименование><Порядок>100</Порядок><ПередВыгрузкой>КлючВыгружаемыхДанных = Источник.Наименование;

Если ПустаяСтрока(КлючВыгружаемыхДанных) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой><НеЗамещать>true</НеЗамещать><Приемник>СправочникСсылка.ВидыНоменклатуры</Приемник><Свойства><Свойство Поиск="true"><Код>1</Код><Наименование> --&gt; Наименование</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/></Свойство><Свойство><Код>2</Код><Наименование> --&gt; ТипНоменклатуры</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="ТипНоменклатуры" Вид="Реквизит" Тип="ПеречислениеСсылка.ТипыНоменклатуры"/></Свойство></Свойства><Значения/></Правило><Правило><Код>ДвиженияДенежныхСредств</Код><Наименование> --&gt; СправочникСсылка.ДвиженияДенежныхСредств</Наименование><Порядок>300</Порядок><Приемник>СправочникСсылка.ДвиженияДенежныхСредств</Приемник><Свойства><Свойство Поиск="true"><Код>3</Код><Наименование> --&gt; РазрезДеятельности</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="РазрезДеятельности" Вид="Реквизит" Тип="ПеречислениеСсылка.РазрезыДеятельности"/><ПередВыгрузкой>Значение = "Текущая";</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>2</Код><Наименование> --&gt; ВидДвижения</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="ВидДвижения" Вид="Реквизит" Тип="ПеречислениеСсылка.ВидыДвиженийДенежныхСредств"/></Свойство><Свойство Поиск="true"><Код>1</Код><Наименование> --&gt; Наименование</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/></Свойство></Свойства><Значения/></Правило><Правило><Код>НоменклатураПосредническаяУслуга</Код><Наименование> --&gt; СправочникСсылка.Номенклатура</Наименование><Порядок>1700</Порядок><Приемник>СправочникСсылка.Номенклатура</Приемник><Свойства><Свойство Поиск="true"><Код>11</Код><Наименование> --&gt; ЭтоГруппа</Наименование><Порядок>1100</Порядок><Источник/><Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Число"/><ПередВыгрузкой>Значение = 0;</ПередВыгрузкой></Свойство><Свойство><Код>10</Код><Наименование> --&gt; ТипНоменклатуры</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="ТипНоменклатуры" Вид="Реквизит" Тип="ПеречислениеСсылка.ТипыНоменклатуры"/><ПередВыгрузкой>Значение = "ПосредническаяУслуга"</ПередВыгрузкой></Свойство><Свойство><Код>9</Код><Наименование> --&gt; СтавкаНДС</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="СтавкаНДС" Вид="Реквизит" Тип="СправочникСсылка.СтавкиНДС"/><КодПравилаКонвертации>СтавкиНДС                                         </КодПравилаКонвертации><ПередВыгрузкой>Значение = ВходящиеДанные;</ПередВыгрузкой></Свойство><Свойство><Код>7</Код><Наименование> --&gt; ПорядокХраненияОтпускнойЦены</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="ПорядокХраненияОтпускнойЦены" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 1</ПередВыгрузкой></Свойство><Свойство><Код>5</Код><Наименование> --&gt; ВидНоменклатуры</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="ВидНоменклатуры" Вид="Реквизит" Тип="СправочникСсылка.ВидыНоменклатуры"/><КодПравилаКонвертации>ВидыНоменклатуры                                  </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура;
Значение.Вставить("Наименование", "Посредническая услуга");
Значение.Вставить("ТипНоменклатуры", "ПосредническаяУслуга");</ПередВыгрузкой></Свойство><Свойство><Код>2</Код><Наименование> --&gt; Наименование</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>Значение = "Посредническая услуга в торговле"</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>1</Код><Наименование> --&gt; Код</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Код" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>Значение = ДобавитьКПрефиксу("1", "П", 9, "Справа");</ПередВыгрузкой></Свойство></Свойства><Значения/></Правило><Правило><Код>Подразделения</Код><Наименование>СправочникСсылка.ПодразделенияКомпании --&gt; СправочникСсылка.Подразделения</Наименование><Порядок>700</Порядок><СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору><Источник>СправочникСсылка.Подразделения</Источник><Приемник>СправочникСсылка.Подразделения</Приемник><Свойства><Свойство Поиск="true"><Код>1</Код><Наименование>Код --&gt; Код</Наименование><Порядок>100</Порядок><Источник Имя="Код" Вид="Свойство" Тип="Строка"/><Приемник Имя="Код" Вид="Свойство" Тип="Строка"/></Свойство><Свойство><Код>2</Код><Наименование>Наименование --&gt; Наименование</Наименование><Порядок>200</Порядок><Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/></Свойство></Свойства><Значения/></Правило><Правило><Код>СтатьиЗатратНаПроизводство</Код><Наименование> --&gt; СправочникСсылка.СтатьиИздержекОбращения</Наименование><Порядок>200</Порядок><ПередВыгрузкой>КлючВыгружаемыхДанных = Источник;
	
Если ПустаяСтрока(КлючВыгружаемыхДанных) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой><НеЗамещать>true</НеЗамещать><СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору><Приемник>СправочникСсылка.СтатьиЗатратНаПроизводство</Приемник><Свойства><Свойство Поиск="true"><Код>1</Код><Наименование> --&gt; Наименование</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>Значение = Источник;</ПередВыгрузкой></Свойство></Свойства><Значения/></Правило><Правило><Код>СтатьиИздержекОбращения</Код><Наименование> --&gt; СправочникСсылка.СтатьиИздержекОбращения</Наименование><Порядок>200</Порядок><ПередВыгрузкой>Если ТипЗнч(Источник) = Тип("Структура") Тогда
	КлючВыгружаемыхДанных = Источник.Наименование;
Иначе
	КлючВыгружаемыхДанных = Источник;
КонецЕсли;
	
Если ПустаяСтрока(КлючВыгружаемыхДанных) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой><НеЗамещать>true</НеЗамещать><Приемник>СправочникСсылка.СтатьиИздержекОбращения</Приемник><Свойства><Свойство Поиск="true"><Код>1</Код><Наименование> --&gt; Наименование</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>Если ТипЗнч(Источник) = Тип("Структура") Тогда
	Значение = Источник.Наименование;
Иначе
	Значение = Источник;
КонецЕсли;</ПередВыгрузкой></Свойство></Свойства><Значения/></Правило><Правило><Код>СтатьиКоммерческихРасходов</Код><Наименование> --&gt; СправочникСсылка.СтатьиКоммерческихРасходов</Наименование><Порядок>1800</Порядок><ПередВыгрузкой>КлючВыгружаемыхДанных = Источник;

Если ПустаяСтрока(КлючВыгружаемыхДанных) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой><СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору><Приемник>СправочникСсылка.СтатьиКоммерческихРасходов</Приемник><Свойства><Свойство Поиск="true"><Код>1</Код><Наименование> --&gt; Наименование</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>Значение = Источник;</ПередВыгрузкой></Свойство></Свойства><Значения/></Правило><Правило><Код>СтатьиОбщепроизводственныхЗатрат</Код><Наименование> --&gt; СправочникСсылка.СтатьиКоммерческихРасходов</Наименование><Порядок>1800</Порядок><ПередВыгрузкой>КлючВыгружаемыхДанных = Источник;
	
Если ПустаяСтрока(КлючВыгружаемыхДанных) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой><СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору><Приемник>СправочникСсылка.СтатьиОбщепроизводственныхЗатрат</Приемник><Свойства><Свойство Поиск="true"><Код>1</Код><Наименование> --&gt; Наименование</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>Значение = Источник;</ПередВыгрузкой></Свойство></Свойства><Значения/></Правило><Правило><Код>СтатьиОбщехозяйственныхЗатрат</Код><Наименование> --&gt; СправочникСсылка.СтатьиКоммерческихРасходов</Наименование><Порядок>1800</Порядок><ПередВыгрузкой>КлючВыгружаемыхДанных = Источник;
	
Если ПустаяСтрока(КлючВыгружаемыхДанных) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой><Приемник>СправочникСсылка.СтатьиОбщехозяйственныхЗатрат</Приемник><Свойства><Свойство Поиск="true"><Код>1</Код><Наименование> --&gt; Наименование</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>Значение = Источник;</ПередВыгрузкой></Свойство></Свойства><Значения/></Правило><Правило><Код>СтатьиРасходовНаПродажу</Код><Наименование> --&gt; СправочникСсылка.СтатьиКоммерческихРасходов</Наименование><Порядок>1800</Порядок><ПередВыгрузкой>КлючВыгружаемыхДанных = Источник;
	
Если ПустаяСтрока(КлючВыгружаемыхДанных) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой><СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору><Приемник>СправочникСсылка.СтатьиРасходовНаПродажу</Приемник><Свойства><Свойство Поиск="true"><Код>1</Код><Наименование> --&gt; Наименование</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>Значение = Источник;</ПередВыгрузкой></Свойство></Свойства><Значения/></Правило></Группа><Группа><Код>Документы</Код><Наименование>Документы</Наименование><Порядок>200</Порядок><Правило><Код>АвансовыйОтчет</Код><Наименование>ДокументСсылка.АвансовыйОтчет --&gt; ДокументСсылка.АвансовыйОтчет</Наименование><Порядок>100</Порядок><Источник>ДокументСсылка.АвансовыйОтчет</Источник><Приемник>ДокументСсылка.АвансовыйОтчет</Приемник><Свойства><Свойство><Код>45</Код><Наименование> --&gt;</Наименование><Порядок>1800</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>44</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>1400</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>14</Код><Наименование>ВалютаДокумента --&gt; Валюта</Наименование><Порядок>1300</Порядок><Источник Имя="ВалютаДокумента" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/><Приемник Имя="Валюта" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/><КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации><ПередВыгрузкой>Если Источник.ВалютаДокумента = Константы.ВалютаРегламентированногоУчета.Получить() Тогда
	Пусто = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>13</Код><Наименование> --&gt; Сумма1</Наименование><Порядок>1200</Порядок><Источник/><Приемник Имя="Сумма3" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>ВалютаРеглУчета = Константы.ВалютаРегламентированногоУчета.Получить();
Если Источник.ВыданныеАвансы.Количество() &gt; 2 Тогда
	Значение     = Источник.ВыданныеАвансы[2].РасходныйКассовыйОрдер.СуммаДокумента;
	ВалютаРКО    = Источник.ВыданныеАвансы[2].РасходныйКассовыйОрдер.ВалютаДокумента;
	КурсРКО      = ?(Источник.ВыданныеАвансы[2].РасходныйКассовыйОрдер.ВалютаДокумента = ВалютаРеглУчета,
						1, Источник.ВыданныеАвансы[2].РасходныйКассовыйОрдер.КурсВзаиморасчетов);
	КратностьРКО = ?(Источник.ВыданныеАвансы[2].РасходныйКассовыйОрдер.ВалютаДокумента = ВалютаРеглУчета,
						1, Источник.ВыданныеАвансы[2].РасходныйКассовыйОрдер.КратностьВзаиморасчетов);
	Значение     = ПересчитатьИзВалютыВВалюту(Значение, ВалютаРКО, Источник.ВалютаДокумента, КурсРКО, 
							  Источник.КурсДокумента, КратностьРКО, Источник.КратностьДокумента);
Иначе	
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>12</Код><Наименование> --&gt; Сумма1</Наименование><Порядок>1100</Порядок><Источник/><Приемник Имя="Сумма2" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>ВалютаРеглУчета = Константы.ВалютаРегламентированногоУчета.Получить();
Если Источник.ВыданныеАвансы.Количество() &gt; 1 Тогда
	Значение     = Источник.ВыданныеАвансы[1].РасходныйКассовыйОрдер.СуммаДокумента;
	ВалютаРКО    = Источник.ВыданныеАвансы[1].РасходныйКассовыйОрдер.ВалютаДокумента;
	КурсРКО      = ?(Источник.ВыданныеАвансы[1].РасходныйКассовыйОрдер.ВалютаДокумента = ВалютаРеглУчета,
						1, Источник.ВыданныеАвансы[1].РасходныйКассовыйОрдер.РасшифровкаПлатежа[0].КурсВзаиморасчетов);
	КратностьРКО = ?(Источник.ВыданныеАвансы[1].РасходныйКассовыйОрдер.ВалютаДокумента = ВалютаРеглУчета,
						1, Источник.ВыданныеАвансы[1].РасходныйКассовыйОрдер.РасшифровкаПлатежа[0].КратностьВзаиморасчетов);
	Значение     = ПересчитатьИзВалютыВВалюту(Значение, ВалютаРКО, Источник.ВалютаДокумента, КурсРКО, 
							  Источник.КурсДокумента, КратностьРКО, Источник.КратностьДокумента);

Иначе
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>11</Код><Наименование> --&gt; Дата1</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="Дата3" Вид="Реквизит" Тип="Дата"/><ПередВыгрузкой>Если Источник.ВыданныеАвансы.Количество() &gt; 2 Тогда
	Значение = Источник.ВыданныеАвансы[2].РасходныйКассовыйОрдер.Дата;

Иначе
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>10</Код><Наименование> --&gt; Дата1</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="Дата2" Вид="Реквизит" Тип="Дата"/><ПередВыгрузкой>Если Источник.ВыданныеАвансы.Количество() &gt; 1 Тогда
	Значение = Источник.ВыданныеАвансы[1].РасходныйКассовыйОрдер.Дата;

Иначе
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>9</Код><Наименование> --&gt; Получено1</Наименование><Порядок>600</Порядок><Источник/><Приемник Имя="Получено3" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Если Источник.ВыданныеАвансы.Количество() &gt; 2 Тогда
	Значение = "из кассы";

Иначе
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>8</Код><Наименование> --&gt; Получено1</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="Получено2" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Если Источник.ВыданныеАвансы.Количество() &gt; 1 Тогда
	Значение = "из кассы";

Иначе
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>7</Код><Наименование>ФизЛицо --&gt; Сотрудник</Наименование><Порядок>300</Порядок><Источник Имя="ФизЛицо" Вид="Реквизит" Тип="СправочникСсылка.ФизическиеЛица"/><Приемник Имя="Сотрудник" Вид="Реквизит" Тип="СправочникСсылка.Сотрудники"/><КодПравилаКонвертации>Сотрудники                                        </КодПравилаКонвертации></Свойство><Свойство><Код>6</Код><Наименование> --&gt; Сумма1</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="Сумма1" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>ВалютаРеглУчета = Константы.ВалютаРегламентированногоУчета.Получить();
Если Источник.ВыданныеАвансы.Количество() &gt; 0 Тогда
	Значение     = Источник.ВыданныеАвансы[0].РасходныйКассовыйОрдер.СуммаДокумента;
	ВалютаРКО    = Источник.ВыданныеАвансы[0].РасходныйКассовыйОрдер.ВалютаДокумента;
	КурсРКО      = ?(Источник.ВыданныеАвансы[0].РасходныйКассовыйОрдер.ВалютаДокумента = ВалютаРеглУчета,
						1, Источник.ВыданныеАвансы[0].РасходныйКассовыйОрдер.РасшифровкаПлатежа[0].КурсВзаиморасчетов);
	КратностьРКО = ?(Источник.ВыданныеАвансы[0].РасходныйКассовыйОрдер.ВалютаДокумента = ВалютаРеглУчета,
						1, Источник.ВыданныеАвансы[0].РасходныйКассовыйОрдер.РасшифровкаПлатежа[0].КратностьВзаиморасчетов);
	Значение     = ПересчитатьИзВалютыВВалюту(Значение, ВалютаРКО, Источник.ВалютаДокумента, КурсРКО, 
							  Источник.КурсДокумента, КратностьРКО, Источник.КратностьДокумента);
	
Иначе
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>5</Код><Наименование> --&gt; Дата1</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="Дата1" Вид="Реквизит" Тип="Дата"/><ПередВыгрузкой>Если Источник.ВыданныеАвансы.Количество() &gt; 0 Тогда
	Значение = Источник.ВыданныеАвансы[0].РасходныйКассовыйОрдер.Дата;
	
Иначе
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>4</Код><Наименование> --&gt; Получено1</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="Получено1" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Если Источник.ВыданныеАвансы.Количество() &gt; 0 Тогда
	Значение = "из кассы";
	
Иначе
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>2</Код><Наименование>Номер --&gt; НомерДок</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>Значение = ПолучитьПрефиксЧислоНомера(Источник.Номер,, "Число");
Значение = ДобавитьКПрефиксу(Значение, "", 6, "");</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>1</Код><Наименование>Дата --&gt; ДатаДок</Наименование><Порядок>100</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Группа><Код>15</Код><Наименование>Товары --&gt; ТабличнаяЧасть</Наименование><Порядок>1500</Порядок><Источник/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><ПередОбработкойВыгрузки>Запрос = Новый Запрос;
Запрос.УстановитьПараметр("Источник", Источник);

ПустаяСтруктура = Новый	Структура;
Запрос.УстановитьПараметр("ПустаяСтруктура", ПустаяСтруктура);


Запрос.Текст = "
|ВЫБРАТЬ 
|   ""Товары""                  КАК ВидТабличнойЧасти,
|	Док.ВидДокВходящий          КАК КомуЗаЧто,
|	Док.Номенклатура            КАК Номенклатура,
|	Док.НомерВходящегоДокумента КАК НомерДокумента,
|	Док.ДатаВходящегоДокумента  КАК ДатаС,
|	Док.Номенклатура            КАК НачСубконто1,
|   Док.Склад                   КАК Субконто2,
|   Док.Количество              КАК Количество,
|	Док.Коэффициент				КАК Коэффициент,
|   Док.Сумма					КАК Сумма,
|	Док.СуммаНДС                КАК СуммаНДС,
|	Неопределено				КАК СтатьяЗатрат
|ИЗ
|	Документ.АвансовыйОтчет.Товары КАК Док
|ГДЕ
|	Док.Ссылка = &amp;Источник
|
|ОБЪЕДИНИТЬ ВСЕ
|
|ВЫБРАТЬ 
|   ""ОплатаПоставщикам""       КАК ВидТабличнойЧасти,
|	Док.ВидДокВходящий          КАК КомуЗаЧто,
|	Неопределено                КАК Номенклатура,
|	Док.НомерВходящегоДокумента КАК НомерДокумента,
|	Док.ДатаВходящегоДокумента  КАК ДатаС, 
|	Док.Контрагент              КАК НачСубконто1, 
|   Док.ДоговорКонтрагента      КАК Субконто2,
|   0                           КАК Количество,
|	1            				КАК Коэффициент,
|   Док.Сумма					КАК Сумма,
|	0                           КАК СуммаНДС,
|	Неопределено				КАК СтатьяЗатрат
|ИЗ
|	Документ.АвансовыйОтчет.ОплатаПоставщикам КАК Док
|ГДЕ
|	Док.Ссылка = &amp;Источник
|
|ОБЪЕДИНИТЬ ВСЕ
|
|ВЫБРАТЬ 
|   ""Прочее""                  КАК ВидТабличнойЧасти,
|	Док.ВидДокВходящий          КАК КомуЗаЧто,
|	Неопределено                КАК Номенклатура,
|	Док.НомерВходящегоДокумента КАК НомерДокумента,
|	Док.ДатаВходящегоДокумента  КАК ДатаС,
|	ВЫРАЗИТЬ ("""" КАК Строка (50)) КАК НачСубконто1,
|   ВЫРАЗИТЬ ("""" КАК Строка (50)) КАК Субконто2,
|   0                           КАК Количество,
|	1            				КАК Коэффициент,
|   Док.Сумма					КАК Сумма,
|	0                           КАК СуммаНДС,
|	Док.СтатьяЗатрат		    КАК СтатьяЗатрат
|ИЗ
|	Документ.АвансовыйОтчет.Прочее КАК Док
|ГДЕ
|	Док.Ссылка = &amp;Источник";

КоллекцияОбъектов = Запрос.Выполнить().Выгрузить();
КоллекцияОбъектов.Колонки.Добавить("КоррСчет");
КоллекцияОбъектов.Колонки.Добавить("Субконто1");

Для каждого СтрокаКоллекции из КоллекцияОбъектов Цикл
	СтрокаКоллекции.Субконто1 = СтрокаКоллекции.НачСубконто1;
	Если СтрокаКоллекции.ВидТабличнойЧасти = "Прочее" Тогда
		ВидРасхода = СтрокаКоллекции.СтатьяЗатрат.ХарактерЗатрат;
		Если ВидРасхода = Перечисления.ХарактерЗатрат.ПроизводственныеРасходы Тогда
			СтрокаКоллекции.КоррСчет  = "20";  
			СтруктураСубконто1 = Новый Структура("Наименование, ТипНоменклатуры");
			СтруктураСубконто1.Наименование = "Товар";
			СтруктураСубконто1.ТипНоменклатуры = "Товар";
			СтрокаКоллекции.Субконто1 = СтруктураСубконто1;
			СтрокаКоллекции.Субконто2 = СтрокаКоллекции.СтатьяЗатрат.Наименование;
			//СтрокаКоллекции.Субконто3 = Источник.Подразделение;
		ИначеЕсли ВидРасхода = Перечисления.ХарактерЗатрат.ОбщепроизводственныеРасходы Тогда
			СтрокаКоллекции.КоррСчет = "25";
			СтрокаКоллекции.Субконто1 = СтрокаКоллекции.СтатьяЗатрат.Наименование;
			//СтрокаКоллекции.Субконто2 = Источник.Подразделение;
		ИначеЕсли ВидРасхода = Перечисления.ХарактерЗатрат.ОбщехозяйственныеРасходы Тогда
			СтрокаКоллекции.КоррСчет = "26";
			СтрокаКоллекции.Субконто1 = СтрокаКоллекции.СтатьяЗатрат.Наименование;
			//СтрокаКоллекции.Субконто2 = Источник.Подразделение;
		ИначеЕсли ВидРасхода = Перечисления.ХарактерЗатрат.КоммерческиеРасходы Тогда
			СтрокаКоллекции.КоррСчет = "44.2";
			СтрокаКоллекции.Субконто1 = СтрокаКоллекции.СтатьяЗатрат.Наименование;
		ИначеЕсли ВидРасхода = Перечисления.ХарактерЗатрат.ИздержкиОбращения Тогда
			СтрокаКоллекции.КоррСчет = "44.1.1";
			СтрокаКоллекции.Субконто1 = СтрокаКоллекции.СтатьяЗатрат.Наименование;
		КонецЕсли;
	КонецЕсли;	
КонецЦикла;</ПередОбработкойВыгрузки><Свойство><Код>25</Код><Наименование> --&gt; НДС</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = ОбъектКоллекции.СуммаНДС;</ПередВыгрузкой></Свойство><Свойство><Код>24</Код><Наименование> --&gt; Сумма</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если ОбъектКоллекции.ВидТабличнойЧасти = "Товары" Тогда
	Если Не Источник.СуммаВключаетНДС Тогда
		Значение = ОбъектКоллекции.Сумма + ОбъектКоллекции.СуммаНДС;
	Иначе
		Значение = ОбъектКоллекции.Сумма;
	КонецЕсли;
Иначе
	Значение = ОбъектКоллекции.Сумма;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>23</Код><Наименование> --&gt; Сумма</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="СуммаПоОтчету" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если ОбъектКоллекции.ВидТабличнойЧасти = "Товары" Тогда
	Если Не Источник.СуммаВключаетНДС Тогда
		Значение = ОбъектКоллекции.Сумма + ОбъектКоллекции.СуммаНДС;
	Иначе
		Значение = ОбъектКоллекции.Сумма;
	КонецЕсли;
Иначе
	Значение = ОбъектКоллекции.Сумма;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>22</Код><Наименование> --&gt;</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = ОбъектКоллекции.Количество * ОбъектКоллекции.Коэффициент;</ПередВыгрузкой></Свойство><Свойство><Код>21</Код><Наименование> --&gt; Субконто2</Наименование><Порядок>600</Порядок><Источник/><Приемник Имя="Субконто2" Вид="Реквизит"/><ПередВыгрузкой>Если ОбъектКоллекции.ВидТабличнойЧасти = "Товары" Тогда
	Если Источник.ВидПоступления = Перечисления.ВидыПоступленияТоваров.ПоОрдеру Тогда
		Значение = Источник.СкладОрдер.Склад;
	Иначе
		Значение = Источник.СкладОрдер;
	КонецЕсли;
	ИмяПКО = "МестаХранения";
ИначеЕсли ОбъектКоллекции.ВидТабличнойЧасти = "ОплатаПоставщикам" Тогда
	ИмяПКО = "Договоры";
ИначеЕсли ОбъектКоллекции.ВидТабличнойЧасти = "Прочее" Тогда
	ВидРасхода = ОбъектКоллекции.СтатьяЗатрат.ХарактерЗатрат;
	Если ВидРасхода = Перечисления.ХарактерЗатрат.ПроизводственныеРасходы Тогда
		ИмяПКО = "СтатьиЗатратНаПроизводство";
	ИначеЕсли ВидРасхода = Перечисления.ХарактерЗатрат.ОбщепроизводственныеРасходы Тогда
		ИмяПКО = "СтатьиОбщепроизводственныхЗатрат";
	ИначеЕсли ВидРасхода = Перечисления.ХарактерЗатрат.ОбщехозяйственныеРасходы Тогда
		ИмяПКО = "СтатьиОбщехозяйственныхЗатрат";
	ИначеЕсли ВидРасхода = Перечисления.ХарактерЗатрат.КоммерческиеРасходы Тогда
		ИмяПКО = "СтатьиКоммерческихРасходов";
	ИначеЕсли ВидРасхода = Перечисления.ХарактерЗатрат.ИздержкиОбращения Тогда
		ИмяПКО = "СтатьиИздержекОбращения";
	Иначе
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>20</Код><Наименование>Номенклатура --&gt; Субконто1</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="Субконто1" Вид="Реквизит"/><ПередВыгрузкой>Если ОбъектКоллекции.ВидТабличнойЧасти = "Товары" Тогда
	ИмяПКО = "Номенклатура";
	ИсходящиеДанные = Новый Структура;
	ИсходящиеДанные.Вставить("ТипНоменклатуры", "Товар");
	ИсходящиеДанные.Вставить("ТипТовара", "Собственный");
ИначеЕсли ОбъектКоллекции.ВидТабличнойЧасти = "ОплатаПоставщикам" Тогда
	ИмяПКО = "Контрагенты";
ИначеЕсли  ОбъектКоллекции.ВидТабличнойЧасти = "Прочее" Тогда
	Если ОбъектКоллекции.КоррСчет  = "20" Тогда
		ИмяПКО = "ВидыНоменклатуры";
	ИначеЕсли ОбъектКоллекции.КоррСчет = "25" Тогда
		ИмяПКО = "СтатьиОбщепроизводственныхЗатрат";
	ИначеЕсли ОбъектКоллекции.КоррСчет = "26" Тогда
		ИмяПКО = "СтатьиОбщехозяйственныхЗатрат";
	ИначеЕсли ОбъектКоллекции.КоррСчет = "44.2" Тогда
		ИмяПКО = "СтатьиКоммерческихРасходов";
	ИначеЕсли ОбъектКоллекции.КоррСчет = "44.1.3" Тогда
		ИмяПКО = "СтатьиРасходовНаПродажу";
	КонецЕсли;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>19</Код><Наименование> --&gt;</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="КоррСчет" Вид="Реквизит"/><ПередВыгрузкой>ТипПриемника = "ПланСчетовСсылка.Основной";
Если ОбъектКоллекции.ВидТабличнойЧасти = "Товары" Тогда
	Если Источник.ВидПоступления = Перечисления.ВидыПоступленияТоваров.ПоОрдеру Тогда
		Склад = Источник.СкладОрдер.Склад;
	Иначе
		Склад = Источник.СкладОрдер;
	КонецЕсли;
	Значение = ?(Склад.ВидСклада = Перечисления.ВидыСкладов.Оптовый, "41.1", "41.2");
ИначеЕсли ОбъектКоллекции.ВидТабличнойЧасти = "ОплатаПоставщикам" Тогда
	Если Источник.ВалютаДокумента &lt;&gt; Константы.ВалютаРегламентированногоУчета.Получить() Тогда
		Значение = "60.11";
		
	Иначе
		Значение = "60.1";
	КонецЕсли;
ИначеЕсли ОбъектКоллекции.ВидТабличнойЧасти = "Прочее" Тогда
	Значение = ОбъектКоллекции.КоррСчет;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>18</Код><Наименование>ДатаВходящегоДокумента --&gt; ДатаС</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="ДатаС" Вид="Реквизит" Тип="Дата"/></Свойство><Свойство><Код>17</Код><Наименование> --&gt;</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="НомерДокумента" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>16</Код><Наименование>ВидДокВходящий --&gt; КомуЗаЧто</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="КомуЗаЧто" Вид="Реквизит" Тип="Строка"/></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>ВозвратПоставщику</Код><Наименование>ДокументСсылка.ВозвратТоваровПоставщику --&gt; ДокументСсылка.РасходнаяНакладная</Наименование><Порядок>500</Порядок><ПередВыгрузкой>Если ВходящиеДанные.ТабличнаяЧасть.Количество() = 0 Тогда
	Отказ = Истина;
КонецЕсли;

КлючВыгружаемыхДанных = ЗначениеВСтрокуВнутр(Источник) + ЗначениеВСтрокуВнутр(ВходящиеДанные.ДокументПоступления);</ПередВыгрузкой><Источник>ДокументСсылка.ВозвратТоваровПоставщику</Источник><Приемник>ДокументСсылка.РасходнаяНакладная</Приемник><Свойства><Свойство><Код>19</Код><Наименование> --&gt; РасчетныйСчет</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="РасчетныйСчет" Вид="Реквизит" Тип="СправочникСсылка.БанковскиеСчета"/><КодПравилаКонвертации>БанковскиеСчета                                   </КодПравилаКонвертации><ПередВыгрузкой>Значение = Источник.Организация.ОсновнойБанковскийСчет;</ПередВыгрузкой></Свойство><Свойство><Код>18</Код><Наименование> --&gt; ВариантРасчетаНалогов</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="ВариантРасчетаНалогов" Вид="Реквизит" Тип="СправочникСсылка.ВариантыРасчетаНалогов"/><КодПравилаКонвертации>ВариантыРасчетаНалогов                            </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("СуммаВключаетНДС, СуммаВключаетНП, УчитыватьНДС, УчитыватьНП");
Значение.СуммаВключаетНДС = Источник.СуммаВключаетНДС;
Значение.СуммаВключаетНП  = Ложь;
Значение.УчитыватьНДС = Источник.УчитыватьНДС;
Значение.УчитыватьНП  = Ложь;</ПередВыгрузкой></Свойство><Свойство><Код>17</Код><Наименование> --&gt; Курс</Наименование><Порядок>800</Порядок><Источник Имя="КурсВзаиморасчетов" Вид="Реквизит" Тип="Число"/><Приемник Имя="Курс" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>15</Код><Наименование> --&gt; ВидОтгрузки</Наименование><Порядок>600</Порядок><Источник/><Приемник Имя="ВидОтгрузки" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = ?(Источник.Склад.ВидСклада = Перечисления.ВидыСкладов.Оптовый, 3, 4);
</ПередВыгрузкой></Свойство><Свойство><Код>14</Код><Наименование> --&gt; МестоХранения</Наименование><Порядок>500</Порядок><Источник Имя="Склад" Вид="Реквизит" Тип="СправочникСсылка.Склады"/><Приемник Имя="МестоХранения" Вид="Реквизит" Тип="СправочникСсылка.МестаХранения"/><КодПравилаКонвертации>МестаХранения                                     </КодПравилаКонвертации></Свойство><Свойство><Код>13</Код><Наименование> --&gt; Договор</Наименование><Порядок>400</Порядок><Источник Имя="ДоговорКонтрагента" Вид="Реквизит" Тип="СправочникСсылка.ДоговорыКонтрагентов"/><Приемник Имя="Договор" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство Поиск="true"><Код>1</Код><Наименование>Дата --&gt; ДатаДок</Наименование><Порядок>100</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство Поиск="true"><Код>2</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "В", 6, "Справа");</ПередВыгрузкой></Свойство><Свойство><Код>3</Код><Наименование>Контрагент --&gt; Контрагент</Наименование><Порядок>300</Порядок><Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство><Код>20</Код><Наименование> --&gt; ВерсияОбъекта</Наименование><Порядок>1100</Порядок><Источник/><Приемник Имя="ВерсияОбъекта" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Значение = "7.70.447"</ПередВыгрузкой></Свойство><Свойство><Код>21</Код><Наименование> --&gt; НДСвключатьВСтоимость</Наименование><Порядок>1200</Порядок><Источник/><Приемник Имя="НДСвключатьВСтоимость" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если Источник.Склад.ВидСклада &lt;&gt; Перечисления.ВидыСкладов.Оптовый Тогда
	Выполнить(Алгоритмы.НДСвключатьВСтоимость);
Иначе
	 Значение = 0;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>22</Код><Наименование> --&gt; ДокументПоступления</Наименование><Порядок>1300</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="ДокументПоступления" Вид="Реквизит" Тип="ДокументСсылка.ПоступлениеТоваров"/><КодПравилаКонвертации>ПоступлениеТоваров                                </КодПравилаКонвертации></Свойство><Свойство><Код>23</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>1500</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Группа><Код>4</Код><Наименование> --&gt; ТабличнаяЧасть</Наименование><Порядок>1400</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><Свойство><Код>12</Код><Наименование> --&gt; ГТД</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="ГТД" Вид="Реквизит" Тип="СправочникСсылка.ГТД"/><КодПравилаКонвертации>ГТД                                               </КодПравилаКонвертации><ПередВыгрузкой>Если Не ЗначениеНеЗаполнено(ОбъектКоллекции.НомерГТД) Тогда
	Значение = Новый Структура("Наименование, СтранаПроисхождения, Комментарий", ОбъектКоллекции.НомерГТД.Код, 
			ОбъектКоллекции.СтранаПроисхождения.Наименование, ОбъектКоллекции.НомерГТД.Комментарий);
Иначе
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>5</Код><Наименование> --&gt; Товар</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Товар" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/><КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации><ПередВыгрузкой>ИсходящиеДанные = Новый Структура;
ИсходящиеДанные.Вставить("ТипНоменклатуры", "Товар");

Если Источник.ДоговорКонтрагента.ВидДоговора = Перечисления.ВидыДоговоровКонтрагентов.СПоставщиком Тогда
	ИсходящиеДанные.Вставить("ТипТовара", "Собственный");
	
Иначе
	ИсходящиеДанные.Вставить("ТипТовара", "НаКомиссии");
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>6</Код><Наименование> --&gt; Количество</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Значение = ОбъектКоллекции.Количество * ОбъектКоллекции.Коэффициент;</ПриВыгрузке></Свойство><Свойство><Код>7</Код><Наименование> --&gt; Цена</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Цена" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Значение = ОбъектКоллекции.Цена / ОбъектКоллекции.Коэффициент;
Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>8</Код><Наименование> --&gt; Сумма</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>9</Код><Наименование> --&gt; НДС</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>11</Код><Наименование> --&gt; Всего</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="Всего" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>ВозвратПоставщикуИзНТТ</Код><Наименование>ДокументСсылка.ВозвратТоваровПоставщикуИзНТТ --&gt; ДокументСсылка.РасходнаяНакладная</Наименование><Порядок>500</Порядок><ПередВыгрузкой>Если ВходящиеДанные.ТабличнаяЧасть.Количество() = 0 Тогда
	Отказ = Истина;
КонецЕсли;

КлючВыгружаемыхДанных = ЗначениеВСтрокуВнутр(Источник) + ЗначениеВСтрокуВнутр(ВходящиеДанные.ДокументПоступления);</ПередВыгрузкой><Источник>ДокументСсылка.ВозвратТоваровПоставщикуИзНеавтоматизированнойТорговойТочки</Источник><Приемник>ДокументСсылка.РасходнаяНакладная</Приемник><Свойства><Свойство><Код>1</Код><Наименование> --&gt; ВариантРасчетаНалогов</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="ВариантРасчетаНалогов" Вид="Реквизит" Тип="СправочникСсылка.ВариантыРасчетаНалогов"/><КодПравилаКонвертации>ВариантыРасчетаНалогов                            </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("СуммаВключаетНДС, СуммаВключаетНП, УчитыватьНДС, УчитыватьНП");
Значение.СуммаВключаетНДС = Источник.СуммаВключаетНДС;
Значение.СуммаВключаетНП  = Ложь;
Значение.УчитыватьНДС = Источник.УчитыватьНДС;
Значение.УчитыватьНП  = Ложь;</ПередВыгрузкой></Свойство><Свойство><Код>2</Код><Наименование> --&gt; ВерсияОбъекта</Наименование><Порядок>1100</Порядок><Источник/><Приемник Имя="ВерсияОбъекта" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Значение = "7.70.447"</ПередВыгрузкой></Свойство><Свойство><Код>3</Код><Наименование> --&gt; ВидОтгрузки</Наименование><Порядок>600</Порядок><Источник/><Приемник Имя="ВидОтгрузки" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 4;
</ПередВыгрузкой></Свойство><Свойство><Код>4</Код><Наименование> --&gt; Договор</Наименование><Порядок>400</Порядок><Источник Имя="ДоговорКонтрагента" Вид="Измерение" Тип="СправочникСсылка.ДоговорыКонтрагентов"/><Приемник Имя="Договор" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство><Код>5</Код><Наименование> --&gt; ДокументПоступления</Наименование><Порядок>1300</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="ДокументПоступления" Вид="Реквизит" Тип="ДокументСсылка.ПоступлениеТоваров"/><КодПравилаКонвертации>ПоступлениеТоваровВНТТ                            </КодПравилаКонвертации></Свойство><Свойство><Код>6</Код><Наименование> --&gt; Курс</Наименование><Порядок>800</Порядок><Источник Имя="КурсВзаиморасчетов" Вид="Реквизит" Тип="Число"/><Приемник Имя="Курс" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>7</Код><Наименование> --&gt; МестоХранения</Наименование><Порядок>500</Порядок><Источник Имя="Склад" Вид="Ресурс" Тип="СправочникСсылка.Склады"/><Приемник Имя="МестоХранения" Вид="Реквизит" Тип="СправочникСсылка.МестаХранения"/><КодПравилаКонвертации>МестаХранения                                     </КодПравилаКонвертации></Свойство><Свойство><Код>8</Код><Наименование> --&gt; НДСвключатьВСтоимость</Наименование><Порядок>1200</Порядок><Источник/><Приемник Имя="НДСвключатьВСтоимость" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если Источник.Склад.ВидСклада &lt;&gt; Перечисления.ВидыСкладов.Оптовый Тогда
	Выполнить(Алгоритмы.НДСвключатьВСтоимость);
Иначе
	 Значение = 0;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>9</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "Н", 6, "Справа");</ПередВыгрузкой></Свойство><Свойство><Код>10</Код><Наименование> --&gt; РасчетныйСчет</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="РасчетныйСчет" Вид="Реквизит" Тип="СправочникСсылка.БанковскиеСчета"/><КодПравилаКонвертации>БанковскиеСчета                                   </КодПравилаКонвертации><ПередВыгрузкой>Значение = Источник.Организация.ОсновнойБанковскийСчет;</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>19</Код><Наименование>Дата --&gt; ДатаДок</Наименование><Порядок>100</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство><Код>20</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>1500</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>21</Код><Наименование>Контрагент --&gt; Контрагент</Наименование><Порядок>300</Порядок><Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Группа><Код>11</Код><Наименование> --&gt; ТабличнаяЧасть</Наименование><Порядок>1400</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><Свойство><Код>14</Код><Наименование> --&gt; Количество</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Значение = ОбъектКоллекции.Количество * ОбъектКоллекции.Коэффициент;</ПриВыгрузке></Свойство><Свойство><Код>15</Код><Наименование> --&gt; НДС</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>16</Код><Наименование> --&gt; Сумма</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>17</Код><Наименование> --&gt; Товар</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Товар" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/><КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации><ПередВыгрузкой>ИсходящиеДанные = Новый Структура;
ИсходящиеДанные.Вставить("ТипНоменклатуры", "Товар");

Если Источник.ДоговорКонтрагента.ВидДоговора = Перечисления.ВидыДоговоровКонтрагентов.СПоставщиком Тогда
	ИсходящиеДанные.Вставить("ТипТовара", "Собственный");
	
Иначе
	ИсходящиеДанные.Вставить("ТипТовара", "НаКомиссии");
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>18</Код><Наименование> --&gt; Цена</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Цена" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Значение = ОбъектКоллекции.Цена / ОбъектКоллекции.Коэффициент;
Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>12</Код><Наименование> --&gt; Всего</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="Всего" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>13</Код><Наименование> --&gt; ГТД</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="ГТД" Вид="Реквизит" Тип="СправочникСсылка.ГТД"/><КодПравилаКонвертации>ГТД                                               </КодПравилаКонвертации><ПередВыгрузкой>Если Не ЗначениеНеЗаполнено(ОбъектКоллекции.НомерГТД) Тогда
	Значение = Новый Структура("Наименование, СтранаПроисхождения, Комментарий", ОбъектКоллекции.НомерГТД.Код, 
			ОбъектКоллекции.СтранаПроисхождения.Наименование, ОбъектКоллекции.НомерГТД.Комментарий);
Иначе
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>ВозвратТоваровОтПокупателя</Код><Наименование>ДокументСсылка.ВозвратТоваровОтПокупателя --&gt; ДокументСсылка.ПоступлениеТоваров</Наименование><Порядок>300</Порядок><ПередВыгрузкой>Если ВходящиеДанные.ТабличнаяЧасть.Количество() = 0 Тогда
	Отказ = Истина;
КонецЕсли;

КлючВыгружаемыхДанных = ЗначениеВСтрокуВнутр(Источник) + ЗначениеВСтрокуВнутр(ВходящиеДанные.ДокументОснование);</ПередВыгрузкой><Источник>ДокументСсылка.ВозвратТоваровОтПокупателя</Источник><Приемник>ДокументСсылка.ПоступлениеТоваров</Приемник><Свойства><Свойство><Код>22</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>1200</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>21</Код><Наименование> --&gt; ВерсияОбъекта</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="ВерсияОбъекта" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Значение = "7.70.447"</ПередВыгрузкой></Свойство><Свойство><Код>20</Код><Наименование> --&gt; Курс</Наименование><Порядок>900</Порядок><Источник Имя="КурсВзаиморасчетов" Вид="Реквизит" Тип="Число"/><Приемник Имя="Курс" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>7</Код><Наименование>ДоговорВзаиморасчетов --&gt; Договор</Наименование><Порядок>700</Порядок><Источник Имя="ДоговорКонтрагента" Вид="Реквизит" Тип="СправочникСсылка.ДоговорыКонтрагентов"/><Приемник Имя="Договор" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство><Код>6</Код><Наименование>Контрагент --&gt; Контрагент</Наименование><Порядок>600</Порядок><Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство><Код>5</Код><Наименование> --&gt;</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="ВариантРасчетаНалогов" Вид="Реквизит" Тип="СправочникСсылка.ВариантыРасчетаНалогов"/><КодПравилаКонвертации>ВариантыРасчетаНалогов                            </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("СуммаВключаетНДС, СуммаВключаетНП, УчитыватьНДС, УчитыватьНП");
Значение.СуммаВключаетНДС = Источник.СуммаВключаетНДС;
Значение.СуммаВключаетНП  = Ложь;
Значение.УчитыватьНДС = Источник.УчитыватьНДС;
Значение.УчитыватьНП  = Ложь;</ПередВыгрузкой></Свойство><Свойство><Код>4</Код><Наименование>СкладОрдер --&gt; МестоХранения</Наименование><Порядок>400</Порядок><Источник Имя="СкладОрдер" Вид="Реквизит"/><Приемник Имя="МестоХранения" Вид="Реквизит" Тип="СправочникСсылка.МестаХранения"/><КодПравилаКонвертации>МестаХранения                                     </КодПравилаКонвертации><ПередВыгрузкой>Если Источник.ВидПоступления = Перечисления.ВидыПоступленияТоваров.ПоОрдеру Тогда
	Значение = Источник.СкладОрдер.Склад;
Иначе
	Значение = Источник.СкладОрдер;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>3</Код><Наименование>ВидОперации --&gt; ВидПоступления</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="ВидПоступления" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>ВидДоговораКонтрагента = Источник.ДоговорКонтрагента.ВидДоговора;
ВидСклада = ?(Источник.ВидПоступления = Перечисления.ВидыПоступленияТоваров.ПоОрдеру, Источник.СкладОрдер.Склад.ВидСклада, Источник.СкладОрдер.ВидСклада);

Если ВидДоговораКонтрагента = Перечисления.ВидыДоговоровКонтрагентов.СКомиссионером Тогда
	Значение = 3;
	
ИначеЕсли ВидСклада = Перечисления.ВидыСкладов.Оптовый Тогда
	Значение = 4;
	
Иначе
	Значение = 5;

КонецЕсли;</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>2</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "В", 6, "Справа");</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>1</Код><Наименование>Дата --&gt; ДатаДок</Наименование><Порядок>100</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Группа><Код>9</Код><Наименование>Товары --&gt; ТабличнаяЧасть</Наименование><Порядок>1100</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><ПередОбработкойВыгрузки>Если ВходящиеДанные.ТабличнаяЧасть.Количество() = 0 Тогда
	Отказ = Истина;
КонецЕсли;</ПередОбработкойВыгрузки><Свойство><Код>10</Код><Наименование>Номенклатура --&gt; Товар</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Товар" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/><КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации><ПередВыгрузкой>ИсходящиеДанные = Новый Структура;
ИсходящиеДанные.Вставить("ТипНоменклатуры", "Товар");

Если ОбъектКоллекции.Комитент = Справочники.Контрагенты.ПустаяСсылка() Тогда
	ИсходящиеДанные.Вставить("ТипТовара", "Собственный");
	
Иначе
	ИсходящиеДанные.Вставить("ТипТовара", "НаКомиссии");
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>11</Код><Наименование> --&gt; Количество</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>12</Код><Наименование> --&gt; Цена</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Цена" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>19</Код><Наименование> --&gt; ДоговорКомиссии</Наименование><Порядок>600</Порядок><Источник/><Приемник Имя="ДоговорКомиссии" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство><Код>18</Код><Наименование> --&gt; Комитент</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="Комитент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство><Код>17</Код><Наименование> --&gt; ГТД</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="ГТД" Вид="Реквизит" Тип="СправочникСсылка.ГТД"/><КодПравилаКонвертации>ГТД                                               </КодПравилаКонвертации><ПередВыгрузкой>Если Не ЗначениеНеЗаполнено(ОбъектКоллекции.ГТД) Тогда
	Значение = Новый Структура("Наименование, СтранаПроисхождения, Комментарий", ОбъектКоллекции.ГТД.Код, 
			ОбъектКоллекции.СтранаПроисхождения.Наименование, ОбъектКоллекции.ГТД.Комментарий);
Иначе
	Пусто = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>13</Код><Наименование> --&gt; Цена</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>16</Код><Наименование> --&gt; Цена</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Всего" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Выполнить(Алгоритмы.ПолучитьСуммуВсего);</ПередВыгрузкой><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>14</Код><Наименование> --&gt; Цена</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>Выписка</Код><Наименование> --&gt; ДокументСсылка.Выписка</Наименование><Порядок>2100</Порядок><ПередВыгрузкой>// В случае, если есть отбор по подразделениям, могут появиться
// выписки без строк табличной части. Их выгружать не надо.
Если Источник.ТабличнаяЧасть.Количество() = 0 Тогда
	Отказ = Истина;
КонецЕсли;

КлючВыгружаемыхДанных = ЗначениеВСтрокуВнутр(Источник.БанковскийСчет) + ЗначениеВСтрокуВнутр(Источник.ДатаДок) + ЗначениеВСтрокуВнутр(Источник.Валюта);
//ТолькоПолучитьУзелСсылки = Истина;</ПередВыгрузкой><Приемник>ДокументСсылка.Выписка</Приемник><Свойства><Свойство Поиск="true"><Код>10</Код><Наименование> --&gt; БанковскийСчет</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="БанковскийСчет" Вид="Реквизит" Тип="СправочникСсылка.БанковскиеСчета"/><КодПравилаКонвертации>БанковскиеСчета                                   </КодПравилаКонвертации></Свойство><Свойство Поиск="true"><Код>11</Код><Наименование> --&gt; Валюта</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Валюта" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/><КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации></Свойство><Свойство Поиск="true"><Код>9</Код><Наименование> --&gt; ДатаДок</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Группа><Код>1</Код><Наименование> --&gt; ТабличнаяЧасть</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><Свойство><Код>2</Код><Наименование> --&gt; ВидДвижения</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="ВидДвижения" Вид="Реквизит" Тип="СправочникСсылка.ДвиженияДенежныхСредств"/><КодПравилаКонвертации>ДвиженияДенежныхСредств                           </КодПравилаКонвертации></Свойство><Свойство><Код>3</Код><Наименование> --&gt; КоррСчет</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="КоррСчет" Вид="Реквизит"/><ПередВыгрузкой>Если одПустое(ОбъектКоллекции.КоррСчет) Тогда
	Отказ = Истина;
КонецЕсли;

ТипПриемника = "ПланСчетовСсылка.Основной";</ПередВыгрузкой></Свойство><Свойство><Код>4</Код><Наименование> --&gt; Субконто1</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Субконто1" Вид="Реквизит"/><ПередВыгрузкой>Если ОбъектКоллекции.Субконто1 = Неопределено Тогда
	Отказ = Истина;

Иначе
	ИмяПКО = ОбъектКоллекции.ИмяПКО1;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>5</Код><Наименование> --&gt; Субконто2</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="Субконто2" Вид="Реквизит"/><ПередВыгрузкой>Если ОбъектКоллекции.Субконто2 = Неопределено Тогда
	Отказ = Истина;

Иначе
	ИмяПКО = ОбъектКоллекции.ИмяПКО2;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>6</Код><Наименование> --&gt; Субконто3</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="Субконто3" Вид="Реквизит"/><ПередВыгрузкой>Если ОбъектКоллекции.Субконто3 = Неопределено Тогда
	Отказ = Истина;

Иначе
	ТипПриемника = "ПеречислениеСсылка.ВидыРасчетовСПокупателями";
	Значение = ОбъектКоллекции.Субконто3;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>7</Код><Наименование> --&gt; Приход</Наименование><Порядок>600</Порядок><Источник/><Приемник Имя="Приход" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>8</Код><Наименование> --&gt; Расход</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="Расход" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>12</Код><Наименование> --&gt; НазначениеПлатежа</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="НазначениеПлатежа" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>13</Код><Наименование> --&gt; КурсОплаты</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="КурсОплаты" Вид="Реквизит" Тип="Число"/></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>Доверенность</Код><Наименование>ДокументСсылка.Доверенность --&gt; ДокументСсылка.Доверенность</Наименование><Порядок>1100</Порядок><Источник>ДокументСсылка.Доверенность</Источник><Приемник>ДокументСсылка.Доверенность</Приемник><Свойства><Свойство><Код>3</Код><Наименование>ПоДокументу --&gt; ПоДокументу</Наименование><Порядок>300</Порядок><Источник Имя="ПоДокументу" Вид="Реквизит" Тип="Строка"/><Приемник Имя="ПоДокументу" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>2</Код><Наименование>НаПолучениеОт --&gt; НаПолучениеОт</Наименование><Порядок>200</Порядок><Источник Имя="НаПолучениеОт" Вид="Реквизит" Тип="Строка"/><Приемник Имя="НаПолучениеОт" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>1</Код><Наименование>ДатаДействия --&gt; ДатаДействия</Наименование><Порядок>100</Порядок><Источник Имя="ДатаДействия" Вид="Реквизит" Тип="Дата"/><Приемник Имя="ДатаДействия" Вид="Реквизит" Тип="Дата"/></Свойство><Свойство Поиск="true"><Код>8</Код><Наименование> --&gt; ДатаДок</Наименование><Порядок>400</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство Поиск="true"><Код>9</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "", 6, "");</ПередВыгрузкой></Свойство><Свойство><Код>10</Код><Наименование> --&gt; РасчетныйСчет</Наименование><Порядок>600</Порядок><Источник Имя="СтруктурнаяЕдиница" Вид="Реквизит" Тип="СправочникСсылка.БанковскиеСчета"/><Приемник Имя="РасчетныйСчет" Вид="Реквизит" Тип="СправочникСсылка.БанковскиеСчета"/><КодПравилаКонвертации>БанковскиеСчета                                   </КодПравилаКонвертации></Свойство><Свойство><Код>11</Код><Наименование> --&gt; ВариантОплаты</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="ВариантОплаты" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 1</ПередВыгрузкой></Свойство><Свойство><Код>14</Код><Наименование> --&gt; Сотрудник</Наименование><Порядок>1000</Порядок><Источник Имя="ФизЛицо" Вид="Реквизит" Тип="СправочникСсылка.ФизическиеЛица"/><Приемник Имя="Сотрудник" Вид="Реквизит" Тип="СправочникСсылка.Сотрудники"/><КодПравилаКонвертации>Сотрудники                                        </КодПравилаКонвертации></Свойство><Свойство><Код>15</Код><Наименование> --&gt; Выдана</Наименование><Порядок>1100</Порядок><Источник/><Приемник Имя="Выдана" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>СтруктураФИО	= РегистрыСведений.ФИОФизЛиц.ПолучитьПоследнее(РабочаяДата, Новый Структура("ФизЛицо", Источник.ФизЛицо));
Значение = СокрЛП(СтруктураФИО.Фамилия) + " " + Лев(СокрЛ(СтруктураФИО.Имя), 1) + "." + Лев(СокрЛ(СтруктураФИО.Отчество), 1)</ПередВыгрузкой></Свойство><Свойство><Код>16</Код><Наименование> --&gt; Поставщик</Наименование><Порядок>1200</Порядок><Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><Приемник Имя="Поставщик" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство><Код>17</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>1600</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Группа><Код>4</Код><Наименование> --&gt; ТабличнаяЧасть</Наименование><Порядок>1500</Порядок><Источник Имя="Товары" Вид="ТабличнаяЧасть"/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><Свойство><Код>7</Код><Наименование> --&gt; Количество</Наименование><Порядок>300</Порядок><Источник Имя="Количество" Вид="Реквизит" Тип="Число"/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>6</Код><Наименование> --&gt; ЕдиницаИзмерения</Наименование><Порядок>200</Порядок><Источник Имя="ЕдиницаПоКлассификатору" Вид="Реквизит" Тип="СправочникСсылка.КлассификаторЕдиницИзмерения"/><Приемник Имя="ЕдиницаИзмерения" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Значение = ОбъектКоллекции.ЕдиницаПоКлассификатору.Наименование;</ПередВыгрузкой></Свойство><Свойство><Код>5</Код><Наименование> --&gt; Товар</Наименование><Порядок>100</Порядок><Источник Имя="НаименованиеТовара" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Товар" Вид="Реквизит" Тип="Строка"/></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>ЗаявлениеНаАккредитив</Код><Наименование>ДокументСсылка.Аккредитив --&gt; ДокументСсылка.ЗаявлениеНаАккредитив</Наименование><Порядок>200</Порядок><Источник>ДокументСсылка.АккредитивПереданный</Источник><Приемник>ДокументСсылка.ЗаявлениеНаАккредитив</Приемник><Свойства><Свойство><Код>10</Код><Наименование>СуммаНДС --&gt; НДС</Наименование><Порядок>1000</Порядок><Источник Имя="СуммаНДС" Вид="Реквизит" Тип="Число"/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>9</Код><Наименование>СуммаДокумента --&gt; Сумма</Наименование><Порядок>900</Порядок><Источник Имя="СуммаДокумента" Вид="Реквизит" Тип="Число"/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>8</Код><Наименование>ЮрФизЛицоКонтрагента --&gt; Контрагент</Наименование><Порядок>800</Порядок><Источник Имя="ЮрФизЛицоКонтрагента" Вид="Реквизит"/><Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство><Код>7</Код><Наименование>СчетОрганизации --&gt; РасчетныйСчет</Наименование><Порядок>700</Порядок><Источник Имя="СчетОрганизации" Вид="Реквизит" Тип="СправочникСсылка.БанковскиеСчета"/><Приемник Имя="РасчетныйСчет" Вид="Реквизит" Тип="СправочникСсылка.БанковскиеСчета"/><КодПравилаКонвертации>БанковскиеСчета                                   </КодПравилаКонвертации></Свойство><Свойство Поиск="true"><Код>6</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>600</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "", 6, "");</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>5</Код><Наименование>Дата --&gt; ДатаДок</Наименование><Порядок>500</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство><Код>11</Код><Наименование>СрокДействия --&gt; СрокПлатежа</Наименование><Порядок>1100</Порядок><Источник Имя="СрокДействия" Вид="Реквизит" Тип="Дата"/><Приемник Имя="СрокПлатежа" Вид="Реквизит" Тип="Дата"/></Свойство><Свойство><Код>1</Код><Наименование>СчетКонтрагента --&gt; СчетКонтрагента</Наименование><Порядок>100</Порядок><Источник Имя="СчетКонтрагента" Вид="Реквизит" Тип="СправочникСсылка.БанковскиеСчета"/><Приемник Имя="СчетКонтрагента" Вид="Реквизит" Тип="СправочникСсылка.РасчетныеСчета"/><КодПравилаКонвертации>РасчетныеСчета                                    </КодПравилаКонвертации></Свойство><Свойство><Код>2</Код><Наименование>ВидПлатежа --&gt; ВидПлатежа</Наименование><Порядок>200</Порядок><Источник Имя="ВидПлатежа" Вид="Реквизит" Тип="Строка"/><Приемник Имя="ВидПлатежа" Вид="Реквизит" Тип="ПеречислениеСсылка.ВидыПлатежа"/></Свойство><Свойство><Код>3</Код><Наименование>ВидАккредитива --&gt; ВидАккредитива</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="ВидАккредитива" Вид="Реквизит" Тип="ПеречислениеСсылка.ВидыАккредитива"/><ПередВыгрузкой>ВидАккредитива = Источник.ВидАккредитива;

Если ВидАккредитива = "Отзывный (непокрытый)" Тогда
	Значение = "ОтзывныйНепокрытый";
	
ИначеЕсли ВидАккредитива = "Отзывный (покрытый)" Тогда
	Значение = "ОтзывныйПокрытый";
	
ИначеЕсли ВидАккредитива = "Безотзывный (непокрытый)" Тогда
	Значение = "БезотзывныйНепокрытый";
	
ИначеЕсли ВидАккредитива = "Безотзывный (покрытый)" Тогда
	Значение = "БезотзывныйПокрытый";
	
Иначе
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>17</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>1700</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>16</Код><Наименование>САкцептом --&gt; Акцепт</Наименование><Порядок>1600</Порядок><Источник Имя="САкцептом" Вид="Реквизит" Тип="Булево"/><Приемник Имя="Акцепт" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>15</Код><Наименование>СчетДепонента --&gt; СчетПоставщика</Наименование><Порядок>1500</Порядок><Источник Имя="СчетДепонента" Вид="Реквизит" Тип="Строка"/><Приемник Имя="СчетПоставщика" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>14</Код><Наименование>ДокументыКПредъявлению --&gt; ВидДокумента</Наименование><Порядок>1400</Порядок><Источник Имя="ДокументыКПредъявлению" Вид="Реквизит" Тип="Строка"/><Приемник Имя="ВидДокумента" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>13</Код><Наименование>ДополнительныеУсловия --&gt; ДополнУсловия</Наименование><Порядок>1300</Порядок><Источник Имя="ДополнительныеУсловия" Вид="Реквизит" Тип="Строка"/><Приемник Имя="ДополнУсловия" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>12</Код><Наименование>НазначениеПлатежа --&gt; Содержание</Наименование><Порядок>1200</Порядок><Источник Имя="НазначениеПлатежа" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Содержание" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>4</Код><Наименование>СтавкаНДС --&gt; СтавкаНДС</Наименование><Порядок>400</Порядок><Источник Имя="СтавкаНДС" Вид="Реквизит" Тип="ПеречислениеСсылка.СтавкиНДС"/><Приемник Имя="СтавкаНДС" Вид="Реквизит" Тип="СправочникСсылка.СтавкиНДС"/><КодПравилаКонвертации>СтавкиНДС                                         </КодПравилаКонвертации></Свойство></Свойства><Значения/></Правило><Правило><Код>ОказаниеУслуг</Код><Наименование>ДокументСсылка.РеализацияТоваровУслуг --&gt; ДокументСсылка.ОказаниеУслуг</Наименование><Порядок>2400</Порядок><ПередВыгрузкой>Если Источник.Услуги.Количество() = 0 Или Источник.Товары.Количество() &lt;&gt; 0 Тогда
	Отказ = Истина;
КонецЕсли;

КлючВыгружаемыхДанных = ЗначениеВСтрокуВнутр(Источник) + ИмяПКО;</ПередВыгрузкой><Источник>ДокументСсылка.РеализацияТоваровУслуг</Источник><Приемник>ДокументСсылка.ОказаниеУслуг</Приемник><Свойства><Свойство Поиск="true"><Код>23</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "Р", 6, "Справа");</ПередВыгрузкой></Свойство><Свойство><Код>22</Код><Наименование> --&gt; ТипЗаказчика</Наименование><Порядок>1100</Порядок><Источник/><Приемник Имя="ТипЗаказчика" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 1;</ПередВыгрузкой></Свойство><Свойство><Код>21</Код><Наименование> --&gt; ТипУслуги</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="ТипУслуги" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 1;</ПередВыгрузкой></Свойство><Свойство><Код>20</Код><Наименование> --&gt; ВариантРасчетаНалогов</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="ВариантРасчетаНалогов" Вид="Реквизит" Тип="СправочникСсылка.ВариантыРасчетаНалогов"/><КодПравилаКонвертации>ВариантыРасчетаНалогов                            </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("СуммаВключаетНДС, СуммаВключаетНП, УчитыватьНДС, УчитыватьНП");
Значение.СуммаВключаетНДС = Источник.СуммаВключаетНДС;
Значение.СуммаВключаетНП  = Ложь;
Значение.УчитыватьНДС = Источник.УчитыватьНДС;
Значение.УчитыватьНП  = Ложь;</ПередВыгрузкой></Свойство><Свойство><Код>19</Код><Наименование> --&gt; УчитыватьНП</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="УчитыватьНП" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 0;</ПередВыгрузкой></Свойство><Свойство><Код>7</Код><Наименование>КурсВзаиморасчетов --&gt; Курс</Наименование><Порядок>600</Порядок><Источник Имя="КурсВзаиморасчетов" Вид="Реквизит" Тип="Число"/><Приемник Имя="Курс" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>5</Код><Наименование>Контрагент --&gt; Контрагент</Наименование><Порядок>500</Порядок><Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство><Код>4</Код><Наименование>ДоговорКонтрагента --&gt; Договор</Наименование><Порядок>400</Порядок><Источник Имя="ДоговорКонтрагента" Вид="Реквизит" Тип="СправочникСсылка.ДоговорыКонтрагентов"/><Приемник Имя="Договор" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство><Код>3</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>300</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство Поиск="true"><Код>2</Код><Наименование>Дата --&gt; ДатаДок</Наименование><Порядок>100</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Группа><Код>8</Код><Наименование>Услуги --&gt; ТабличнаяЧасть</Наименование><Порядок>700</Порядок><Источник Имя="Услуги" Вид="ТабличнаяЧасть"/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><Свойство><Код>18</Код><Наименование> --&gt; Всего</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="Всего" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если Не Источник.СуммаВключаетНДС Тогда
	Значение = ОбъектКоллекции.Сумма + ОбъектКоллекции.СуммаНДС;
Иначе
	Значение = ОбъектКоллекции.Сумма;
КонецЕсли;</ПередВыгрузкой><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>15</Код><Наименование>Номенклатура --&gt; Услуга</Наименование><Порядок>700</Порядок><Источник Имя="Номенклатура" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/><Приемник Имя="Услуга" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/><КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации><ПередВыгрузкой>ИсходящиеДанные = Новый Структура;
ИсходящиеДанные.Вставить("ТипНоменклатуры", "Услуга");
ИсходящиеДанные.Вставить("ТипТовара", "Собственный");
</ПередВыгрузкой></Свойство><Свойство><Код>14</Код><Наименование>СуммаНДС --&gt; НДС</Наименование><Порядок>600</Порядок><Источник Имя="СуммаНДС" Вид="Реквизит" Тип="Число"/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>12</Код><Наименование>Сумма --&gt; Сумма</Наименование><Порядок>400</Порядок><Источник Имя="Сумма" Вид="Реквизит" Тип="Число"/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>11</Код><Наименование>Цена --&gt; Цена</Наименование><Порядок>300</Порядок><Источник Имя="Цена" Вид="Реквизит" Тип="Число"/><Приемник Имя="Цена" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если ЗначениеНеЗаполнено(ОбъектКоллекции.ПроцентСкидкиНаценки) Тогда
	Значение = ОбъектКоллекции.Цена;
Иначе
	Значение = ОбъектКоллекции.Сумма / ОбъектКоллекции.Количество;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>10</Код><Наименование>Количество --&gt; Количество</Наименование><Порядок>200</Порядок><Источник Имя="Количество" Вид="Реквизит" Тип="Число"/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>ОказаниеУслугКомиссии</Код><Наименование>ДокументСсылка.ОтчетКомитентуОПродажах --&gt; ДокументСсылка.ОказаниеУслуг</Наименование><Порядок>1500</Порядок><ПередВыгрузкой>Если Источник.СуммаВознаграждения = 0 Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой><Источник>ДокументСсылка.ОтчетКомитентуОПродажах</Источник><Приемник>ДокументСсылка.ОказаниеУслуг</Приемник><Свойства><Свойство Поиск="true"><Код>10</Код><Наименование> --&gt; ДатаДок</Наименование><Порядок>100</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство Поиск="true"><Код>11</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "", 6, "");</ПередВыгрузкой></Свойство><Свойство><Код>12</Код><Наименование> --&gt; Договор</Наименование><Порядок>400</Порядок><Источник Имя="ДоговорКонтрагента" Вид="Реквизит" Тип="СправочникСсылка.ДоговорыКонтрагентов"/><Приемник Имя="Договор" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство><Код>14</Код><Наименование> --&gt; ЗачитыватьАванс</Наименование><Порядок>600</Порядок><Источник/><Приемник Имя="ЗачитыватьАванс" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 2</ПередВыгрузкой></Свойство><Свойство><Код>15</Код><Наименование> --&gt; Курс</Наименование><Порядок>700</Порядок><Источник Имя="КурсВзаиморасчетов" Вид="Реквизит" Тип="Число"/><Приемник Имя="Курс" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>16</Код><Наименование> --&gt; ВариантРасчетаНалогов</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="ВариантРасчетаНалогов" Вид="Реквизит" Тип="СправочникСсылка.ВариантыРасчетаНалогов"/><КодПравилаКонвертации>ВариантыРасчетаНалогов                            </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("СуммаВключаетНДС, СуммаВключаетНП, УчитыватьНДС, УчитыватьНП");
Значение.СуммаВключаетНДС = 1;
Значение.СуммаВключаетНП  = 0;
Значение.УчитыватьНДС = 1;
Значение.УчитыватьНП  = 0;

Если (Источник.СтавкаНДСВознаграждения = Перечисления.СтавкиНДС.ПустаяСсылка()) или (Источник.СтавкаНДСВознаграждения = Перечисления.СтавкиНДС.БезНДС) Тогда
	Значение.СуммаВключаетНДС = 0;
	Значение.СуммаВключаетНП  = 0;
	Значение.УчитыватьНДС = 0;
	Значение.УчитыватьНП  = 0;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>20</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>1300</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>19</Код><Наименование> --&gt; ВерсияОбъекта</Наименование><Порядок>1100</Порядок><Источник/><Приемник Имя="ВерсияОбъекта" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Значение = "7.70.447"</ПередВыгрузкой></Свойство><Свойство><Код>18</Код><Наименование> --&gt; ЗачетТребований</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="ЗачетТребований" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 1</ПередВыгрузкой></Свойство><Свойство><Код>17</Код><Наименование> --&gt; ТипУслуги</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="ТипУслуги" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 2</ПередВыгрузкой></Свойство><Свойство><Код>1</Код><Наименование>Контрагент --&gt; Контрагент</Наименование><Порядок>300</Порядок><Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Группа><Код>2</Код><Наименование> --&gt; ТабличнаяЧасть</Наименование><Порядок>1200</Порядок><Источник/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><ПередОбработкойВыгрузки>КоллекцияОбъектов = Новый ТаблицаЗначений;
КоллекцияОбъектов.Колонки.Добавить("Сумма");
КоллекцияОбъектов.Колонки.Добавить("НДС");

Значение = Источник.Товары.Итог("СуммаВознаграждения");
Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора);

Стр = КоллекцияОбъектов.Добавить();
Стр.Сумма = Значение;
Стр.НДС = РассчитатьСуммуНДС(Стр.Сумма, Истина, Истина, ПолучитьСтавкуНДС(Источник.СтавкаНДСВознаграждения));</ПередОбработкойВыгрузки><Свойство><Код>9</Код><Наименование> --&gt; Всего</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="Всего" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = ОбъектКоллекции.Сумма;</ПередВыгрузкой></Свойство><Свойство><Код>7</Код><Наименование> --&gt; НДС</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>6</Код><Наименование> --&gt; Сумма</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>5</Код><Наименование> --&gt; Цена</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Цена" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = ОбъектКоллекции.Сумма;</ПередВыгрузкой></Свойство><Свойство><Код>4</Код><Наименование> --&gt; Количество</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 1;</ПередВыгрузкой></Свойство><Свойство><Код>3</Код><Наименование> --&gt; Услуга</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Услуга" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/><КодПравилаКонвертации>НоменклатураПосредническаяУслуга                  </КодПравилаКонвертации><ПередВыгрузкой>Значение = "Посредническая услуга в торговле";
ИсходящиеДанные = Источник.СтавкаНДСВознаграждения;</ПередВыгрузкой></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>ПеремещениеТоваров</Код><Наименование>ДокументСсылка.ПеремещениеТоваров --&gt; ДокументСсылка.ПеремещениеТоваров</Наименование><Порядок>1600</Порядок><ПередВыгрузкой>Значение = 0;

Если (Источник.СкладОтправитель.ВидСклада = Перечисления.ВидыСкладов.Оптовый) и (Источник.СкладПолучатель.ВидСклада &lt;&gt; Перечисления.ВидыСкладов.Оптовый) Тогда
	Выполнить(Алгоритмы.НДСвключатьВСтоимость);
	
ИначеЕсли (Источник.СкладОтправитель.ВидСклада &lt;&gt; Перечисления.ВидыСкладов.Оптовый) и (Источник.СкладПолучатель.ВидСклада = Перечисления.ВидыСкладов.Оптовый) Тогда
	Выполнить(Алгоритмы.НДСвключатьВСтоимость);
	Значение = ?(Значение = 0, 1, 0);
КонецЕсли;

ВходящиеДанные = Новый Структура;
ВходящиеДанные.Вставить("НДСвключатьВСтоимость", Значение);</ПередВыгрузкой><Источник>ДокументСсылка.ПеремещениеТоваров</Источник><Приемник>ДокументСсылка.ПеремещениеТоваров</Приемник><Свойства><Свойство><Код>14</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>800</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>13</Код><Наименование> --&gt; НДСвключатьВСтоимость</Наименование><Порядок>600</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="НДСвключатьВСтоимость" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>12</Код><Наименование> --&gt; ВидПеремещения</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="ВидПеремещения" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если (Источник.СкладОтправитель.ВидСклада = Перечисления.ВидыСкладов.Оптовый) и (НЕ Источник.СкладПолучатель.ВидСклада =  Перечисления.ВидыСкладов.Оптовый) Тогда
	Значение = 1;
	
ИначеЕсли (Источник.СкладОтправитель.ВидСклада =  Перечисления.ВидыСкладов.Оптовый) и (Источник.СкладПолучатель.ВидСклада =  Перечисления.ВидыСкладов.Оптовый) Тогда
	Значение = 2;
	
ИначеЕсли (Не Источник.СкладОтправитель.ВидСклада =  Перечисления.ВидыСкладов.Оптовый) и (Источник.СкладПолучатель.ВидСклада =  Перечисления.ВидыСкладов.Оптовый) Тогда
	Значение = 3;

Иначе
	Значение = 0;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>11</Код><Наименование> --&gt; Склад</Наименование><Порядок>400</Порядок><Источник Имя="СкладОтправитель" Вид="Реквизит" Тип="СправочникСсылка.Склады"/><Приемник Имя="Склад" Вид="Реквизит" Тип="СправочникСсылка.МестаХранения"/><КодПравилаКонвертации>МестаХранения                                     </КодПравилаКонвертации></Свойство><Свойство Поиск="true"><Код>10</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "", 6, "");</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>9</Код><Наименование> --&gt; ДатаДок</Наименование><Порядок>100</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство><Код>1</Код><Наименование>СкладПолучатель --&gt; СкладПолучатель</Наименование><Порядок>300</Порядок><Источник Имя="СкладПолучатель" Вид="Реквизит" Тип="СправочникСсылка.Склады"/><Приемник Имя="СкладПолучатель" Вид="Реквизит" Тип="СправочникСсылка.МестаХранения"/><КодПравилаКонвертации>МестаХранения                                     </КодПравилаКонвертации></Свойство><Группа><Код>2</Код><Наименование> --&gt; ТабличнаяЧасть</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><ПередОбработкойВыгрузки>Запросы.ТабличнаяЧастьПеремещения.УстановитьПараметр("ПустойКомитент", Справочники.Контрагенты.ПустаяСсылка());
Запросы.ТабличнаяЧастьПеремещения.УстановитьПараметр("Расход", ВидДвиженияНакопления.Расход);
Запросы.ТабличнаяЧастьПеремещения.УстановитьПараметр("ПустойДоговорКомиссии", Справочники.ДоговорыКонтрагентов.ПустаяСсылка());
Запросы.ТабличнаяЧастьПеремещения.УстановитьПараметр("ТоварПринятыйКомиссия", Перечисления.СтатусыПартийТоваров.НаКомиссию);
Запросы.ТабличнаяЧастьПеремещения.УстановитьПараметр("Источник", Источник);
ТаблицаТоваров   = Источник.Товары.Выгрузить();

ТаблицаПартий    = Запросы.ТабличнаяЧастьПеремещения.Выполнить().Выгрузить();
ТаблицаПартий.Свернуть("Номенклатура, ДокументПоставки, Комитент", "Количество");

КоллекцияОбъектов = Новый ТаблицаЗначений;
КоллекцияОбъектов.Колонки.Добавить("Товар", Новый ОписаниеТипов("СправочникСсылка.Номенклатура"));
КоллекцияОбъектов.Колонки.Добавить("Комитент", Новый ОписаниеТипов("СправочникСсылка.Контрагенты"));
КоллекцияОбъектов.Колонки.Добавить("Количество", Новый ОписаниеТипов("Число"));
КоллекцияОбъектов.Колонки.Добавить("Коэффициент", Новый ОписаниеТипов("Число"));
КоллекцияОбъектов.Колонки.Добавить("ДокументПоставки");

ОстКоличествоПоПартиям = 0;
НоменклатураПред = "";
НомерСтрокиПред = 0;
Для каждого СтрокаТаблицы ИЗ ТаблицаТоваров Цикл
	КоличествоПоСтроке = СтрокаТаблицы.Количество / СтрокаТаблицы.Коэффициент * СтрокаТаблицы.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент;
	ОстКоличествоПоСтроке = КоличествоПоСтроке;
	Если НоменклатураПред &lt;&gt; СтрокаТаблицы.Номенклатура Тогда
		Индекс = 0;
		СтруктураПоиска = Новый Структура;
		СтруктураПоиска.Вставить("Номенклатура", СтрокаТаблицы.Номенклатура);
		МассивСтрок = ТаблицаПартий.НайтиСтроки(СтруктураПоиска);
	КонецЕсли;
	Пока 1 = 1 Цикл
		Если (ОстКоличествоПоПартиям = 0) ИЛИ (НоменклатураПред &lt;&gt; СтрокаТаблицы.Номенклатура) Тогда
			Если Индекс &lt;= МассивСтрок.ВГраница()Тогда
				СтрокаТаблицыПартий = МассивСтрок.Получить(Индекс);
				Индекс = Индекс + 1;
				ОстКоличествоПоПартиям = СтрокаТаблицыПартий.Количество;
			Иначе
				
				// Если не все количество распределилось по партиям все равно выгрузим количестово из документа
				СтрокаКоллекции             = КоллекцияОбъектов.Добавить();
				СтрокаКоллекции.Товар       = СтрокаТаблицы.Номенклатура;
				СтрокаКоллекции.Количество  = ОстКоличествоПоСтроке;
				СтрокаКоллекции.Коэффициент = СтрокаТаблицы.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент;
				ОстКоличествоПоСтроке       = ОстКоличествоПоСтроке - СтрокаКоллекции.Количество;
				Прервать;
				
			КонецЕсли;
		КонецЕсли;
		
		Если ОстКоличествоПоСтроке = 0 Тогда
			Продолжить;
		КонецЕсли;
		
		СтрокаКоллекции = КоллекцияОбъектов.Добавить();
		СтрокаКоллекции.Товар = СтрокаТаблицы.Номенклатура;
		СтрокаКоллекции.ДокументПоставки = СтрокаТаблицыПартий.ДокументПоставки; 
		СтрокаКоллекции.Количество = Мин(ОстКоличествоПоСтроке, ОстКоличествоПоПартиям);
		СтрокаКоллекции.Коэффициент = СтрокаТаблицы.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент;
		СтрокаКоллекции.Комитент   = СтрокаТаблицыПартий.Комитент;
		ОстКоличествоПоПартиям = ОстКоличествоПоПартиям - СтрокаКоллекции.Количество;
		ОстКоличествоПоСтроке  = ОстКоличествоПоСтроке - СтрокаКоллекции.Количество;
		НоменклатураПред = СтрокаТаблицы.Номенклатура;
		НомерСтрокиПред  = СтрокаТаблицы.НомерСтроки;
		Если ОстКоличествоПоСтроке &lt;= 0 Тогда
			Прервать;
		КонецЕсли;
	КонецЦикла;
КонецЦикла;

КоллекцияОбъектов.Свернуть("Товар, Комитент, ДокументПоставки, Коэффициент", "Количество");

КоллекцияОбъектов.Колонки.Добавить("Контрагент");
КоллекцияОбъектов.Колонки.Добавить("СчетФактура");
КоллекцияОбъектов.Колонки.Добавить("НДС");

ДатаДок = Источник.Дата;

ВалютаКон = Константы.ВалютаРегламентированногоУчета.Получить();
ФильтрПоВалютеКон = Новый Структура("Валюта", ВалютаКон);
ПоКурсуКон = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеКон).Курс;
ПоКратностьКон = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеКон).Кратность;

Если ВходящиеДанные.НДСвключатьВСтоимость = 1 Тогда
	Для каждого ОбъектКоллекции из КоллекцияОбъектов Цикл
		Если ТипЗнч(ОбъектКоллекции.ДокументПоставки) = Тип("ДокументСсылка.ОприходованиеТоваров") 
		 ИЛИ ТипЗнч(ОбъектКоллекции.ДокументПоставки) = Тип("ДокументСсылка.АвансовыйОтчет") 
		 ИЛИ ТипЗнч(ОбъектКоллекции.ДокументПоставки) = Тип("ДокументСсылка.КомплектацияНоменклатуры") 
		 ИЛИ ЗначениеНеЗаполнено(ОбъектКоллекции.ДокументПоставки) Тогда
			Продолжить;
		КонецЕсли;
        ОбъектКоллекции.Контрагент = ОбъектКоллекции.ДокументПоставки.Контрагент;

		// Если документ поставки является одновременно регистратором счета-фактуры
		СчетФактура = НайтиПодчиненныйДокумент(ОбъектКоллекции.ДокументПоставки, "СчетФактураПолученный");

		Если СчетФактура = Неопределено Тогда
			Продолжить;
			
		Иначе
		    ДатаСФ = Формат(СчетФактура.Дата, "ДЛФ=Д");
			Если ДатаСФ &lt;&gt; Формат(ОбъектКоллекции.ДокументПоставки.Дата, "ДЛФ=Д") Тогда
				ОбъектКоллекции.СчетФактура = СчетФактура;
				
			Иначе
				ОбъектКоллекции.СчетФактура = ОбъектКоллекции.ДокументПоставки;
			КонецЕсли;
		КонецЕсли;
		
		Таб = ОбъектКоллекции.ДокументПоставки.Товары.Найти(ОбъектКоллекции.Товар);
		Если Таб &lt;&gt; Неопределено Тогда
			Количество = Таб.Количество * Таб.Коэффициент;
			Если Количество &lt;&gt; 0 Тогда
                ДатаДок = ОбъектКоллекции.ДокументПоставки.Дата;

				ВалютаНач = ОбъектКоллекции.ДокументПоставки.ВалютаДокумента;
				ПоКурсуНач = КурсДокумента(ОбъектКоллекции.ДокументПоставки, ВалютаКон);
				ПоКратностьНач = КратностьДокумента(ОбъектКоллекции.ДокументПоставки, ВалютаКон);

				Если ПоКурсуНач = 0 Тогда
					ФильтрПоВалютеНач = Новый Структура("Валюта", ВалютаНач);
					ПоКурсуНач = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеНач).Курс;
					ПоКратностьНач = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеНач).Кратность;
				КонецЕсли;
				
				ПоКратностьНач = ?(ПоКратностьНач = 0, 1, ПоКратностьНач);
				ПоКратностьКон = ?(ПоКратностьКон = 0, 1, ПоКратностьКон);

				НДСзаЕдиницу = ПересчитатьИзВалютыВВалюту(Таб.СуммаНДС/Количество, ВалютаНач, ВалютаКон, ПоКурсуНач, ПоКурсуКон, ПоКратностьНач, ПоКратностьКон);
				ОбъектКоллекции.НДС = НДСзаЕдиницу*Количество;
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
КонецЕсли;</ПередОбработкойВыгрузки><Свойство><Код>7</Код><Наименование> --&gt; НДС</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если ОбъектКоллекции.НДС = Неопределено Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>6</Код><Наименование> --&gt; СчетФактура</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="СчетФактура" Вид="Реквизит"/><ПередВыгрузкой>Если ОбъектКоллекции.СчетФактура = Неопределено Тогда
	Отказ = Истина;

ИначеЕсли ОбъектКоллекции.СчетФактура.Метаданные().Имя = "ПоступлениеТоваровУслуг" Тогда
     ИмяПКО = "ПоступлениеТоваров";
	
ИначеЕсли ОбъектКоллекции.СчетФактура.Метаданные().Имя = "СчетФактураВыданный" Тогда
	 ИмяПКО = "СчетФактура";
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>5</Код><Наименование> --&gt; Контрагент</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><ПередВыгрузкой>Если ОбъектКоллекции.Контрагент = Неопределено Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>4</Код><Наименование> --&gt; Количество</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = ОбъектКоллекции.Количество * ОбъектКоллекции.Коэффициент;</ПередВыгрузкой></Свойство><Свойство><Код>3</Код><Наименование> --&gt; Товар</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Товар" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/><ПередВыгрузкой>ИсходящиеДанные = Новый Структура;
ИсходящиеДанные.Вставить("ТипНоменклатуры", "Товар");

Если ОбъектКоллекции.Комитент = Справочники.Контрагенты.ПустаяСсылка() Тогда
	ИсходящиеДанные.Вставить("ТипТовара", "Собственный");
	
Иначе
	ИсходящиеДанные.Вставить("ТипТовара", "НаКомиссии");
КонецЕсли;</ПередВыгрузкой></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>ПлатежноеПоручение</Код><Наименование>ДокументСсылка.ПлатежноеПоручение --&gt; ДокументСсылка.ПлатежноеПоручение</Наименование><Порядок>1700</Порядок><Источник>ДокументСсылка.ПлатежноеПоручениеИсходящее</Источник><Приемник>ДокументСсылка.ПлатежноеПоручение</Приемник><Свойства><Свойство><Код>11</Код><Наименование>ПоказательТипа --&gt; ПоказательТипа</Наименование><Порядок>1100</Порядок><Источник Имя="ПоказательТипа" Вид="Реквизит" Тип="Строка"/><Приемник Имя="ПоказательТипа" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство Поиск="true"><Код>12</Код><Наименование> --&gt; ДатаДок</Наименование><Порядок>1200</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство Поиск="true"><Код>13</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>1300</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "", 6, "");</ПередВыгрузкой></Свойство><Свойство><Код>14</Код><Наименование> --&gt; РасчетныйСчет</Наименование><Порядок>1400</Порядок><Источник Имя="СчетОрганизации" Вид="Реквизит" Тип="СправочникСсылка.БанковскиеСчета"/><Приемник Имя="РасчетныйСчет" Вид="Реквизит" Тип="СправочникСсылка.БанковскиеСчета"/><КодПравилаКонвертации>БанковскиеСчета                                   </КодПравилаКонвертации></Свойство><Свойство><Код>15</Код><Наименование> --&gt; Контрагент</Наименование><Порядок>1500</Порядок><Источник/><Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство><Код>16</Код><Наименование> --&gt; Сумма</Наименование><Порядок>1600</Порядок><Источник Имя="СуммаДокумента" Вид="Реквизит" Тип="Число"/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>17</Код><Наименование> --&gt; НДС</Наименование><Порядок>1700</Порядок><Источник Имя="СуммаНДС" Вид="Реквизит" Тип="Число"/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>19</Код><Наименование> --&gt; Очередность</Наименование><Порядок>1900</Порядок><Источник Имя="ОчередностьПлатежа" Вид="Реквизит" Тип="Число"/><Приемник Имя="Очередность" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>20</Код><Наименование> --&gt; АвтоПодстСуммыНДС</Наименование><Порядок>2000</Порядок><Источник/><Приемник Имя="АвтоПодстСуммыНДС" Вид="Реквизит" Тип="ПеречислениеСсылка.ПодстановкаСуммыНДС"/><ПередВыгрузкой>Значение = "БезСуммыБезНДС";</ПередВыгрузкой></Свойство><Свойство><Код>24</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>2400</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>23</Код><Наименование> --&gt; СтатусСоставителяПлДок</Наименование><Порядок>2300</Порядок><Источник Имя="СтатусСоставителя" Вид="Реквизит" Тип="Строка"/><Приемник Имя="СтатусСоставителяПлДок" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>22</Код><Наименование> --&gt; Договор</Наименование><Порядок>2200</Порядок><Источник/><Приемник Имя="Договор" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство><Код>21</Код><Наименование> --&gt; Содержание</Наименование><Порядок>2100</Порядок><Источник Имя="НазначениеПлатежа" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Содержание" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>10</Код><Наименование>ПоказательПериода --&gt; ПоказательПериода</Наименование><Порядок>1000</Порядок><Источник Имя="ПоказательПериода" Вид="Реквизит" Тип="Строка"/><Приемник Имя="ПоказательПериода" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>9</Код><Наименование>ПоказательОснования --&gt; ПоказательОснования</Наименование><Порядок>900</Порядок><Источник Имя="ПоказательОснования" Вид="Реквизит" Тип="Строка"/><Приемник Имя="ПоказательОснования" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>8</Код><Наименование>ПоказательНомера --&gt; ПоказательНомера</Наименование><Порядок>800</Порядок><Источник Имя="ПоказательНомера" Вид="Реквизит" Тип="Строка"/><Приемник Имя="ПоказательНомера" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>7</Код><Наименование>ПоказательДаты --&gt; ПоказательДаты</Наименование><Порядок>700</Порядок><Источник Имя="ПоказательДаты" Вид="Реквизит" Тип="Дата"/><Приемник Имя="ПоказательДаты" Вид="Реквизит" Тип="Дата"/></Свойство><Свойство><Код>6</Код><Наименование>КодОКАТО --&gt; КодОКАТО</Наименование><Порядок>600</Порядок><Источник Имя="КодОКАТО" Вид="Реквизит" Тип="Строка"/><Приемник Имя="КодОКАТО" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>5</Код><Наименование>КодБК --&gt; КодБК</Наименование><Порядок>500</Порядок><Источник Имя="КодБК" Вид="Реквизит" Тип="Строка"/><Приемник Имя="КодБК" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>4</Код><Наименование>ПеречислениеНалога --&gt; ПеречислениеНалога</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="ПеречислениеНалога" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>3</Код><Наименование>СтавкаНДС --&gt; СтавкаНДС</Наименование><Порядок>300</Порядок><Источник Имя="СтавкаНДС" Вид="Реквизит" Тип="ПеречислениеСсылка.СтавкиНДС"/><Приемник Имя="СтавкаНДС" Вид="Реквизит" Тип="СправочникСсылка.СтавкиНДС"/><КодПравилаКонвертации>СтавкиНДС                                         </КодПравилаКонвертации></Свойство><Свойство><Код>2</Код><Наименование>ВидПлатежа --&gt; ВидПлатежа</Наименование><Порядок>200</Порядок><Источник Имя="ВидПлатежа" Вид="Реквизит" Тип="Строка"/><Приемник Имя="ВидПлатежа" Вид="Реквизит" Тип="ПеречислениеСсылка.ВидыПлатежа"/></Свойство><Свойство><Код>1</Код><Наименование>СчетКонтрагента --&gt; СчетКонтрагента</Наименование><Порядок>100</Порядок><Источник Имя="СчетКонтрагента" Вид="Реквизит" Тип="СправочникСсылка.БанковскиеСчета"/><Приемник Имя="СчетКонтрагента" Вид="Реквизит" Тип="СправочникСсылка.РасчетныеСчета"/><КодПравилаКонвертации>РасчетныеСчета                                    </КодПравилаКонвертации></Свойство></Свойства><Значения/></Правило><Правило><Код>ПоступлениеТоваров</Код><Наименование>ДокументСсылка.ПоступлениеТоваров --&gt; ДокументСсылка.ПоступлениеТоваров</Наименование><Порядок>600</Порядок><ПередВыгрузкой>Если Источник.Товары.Количество() = 0 Тогда
	Отказ = Истина;
КонецЕсли;

КлючВыгружаемыхДанных = ЗначениеВСтрокуВнутр(Источник) + ИмяПКО;</ПередВыгрузкой><Источник>ДокументСсылка.ПоступлениеТоваровУслуг</Источник><Приемник>ДокументСсылка.ПоступлениеТоваров</Приемник><Свойства><Свойство><Код>26</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>1600</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>25</Код><Наименование>ДатаВходящегоДокумента --&gt; ДатаДокВходящий</Наименование><Порядок>1400</Порядок><Источник Имя="ДатаВходящегоДокумента" Вид="Реквизит" Тип="Дата"/><Приемник Имя="ДатаДокВходящий" Вид="Реквизит" Тип="Дата"/></Свойство><Свойство><Код>24</Код><Наименование>НомерВходящегоДокумента --&gt;</Наименование><Порядок>1300</Порядок><Источник Имя="НомерВходящегоДокумента" Вид="Реквизит" Тип="Строка"/><Приемник Имя="НомерДокВходящий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>23</Код><Наименование> --&gt; ВерсияОбъекта</Наименование><Порядок>1200</Порядок><Источник/><Приемник Имя="ВерсияОбъекта" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Значение = "7.70.447"</ПередВыгрузкой></Свойство><Свойство><Код>22</Код><Наименование> --&gt; Курс</Наименование><Порядок>1100</Порядок><Источник Имя="КурсВзаиморасчетов" Вид="Реквизит" Тип="Число"/><Приемник Имя="Курс" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>21</Код><Наименование> --&gt; НДСвключатьВСтоимость</Наименование><Порядок>1000</Порядок><Источник Имя="НДСВключенВСтоимость" Вид="Реквизит" Тип="Булево"/><Приемник Имя="НДСвключатьВСтоимость" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>20</Код><Наименование> --&gt; ВариантРасчетаНалогов</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="ВариантРасчетаНалогов" Вид="Реквизит" Тип="СправочникСсылка.ВариантыРасчетаНалогов"/><КодПравилаКонвертации>ВариантыРасчетаНалогов                            </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("СуммаВключаетНДС, СуммаВключаетНП, УчитыватьНДС, УчитыватьНП");
Значение.СуммаВключаетНДС = Источник.СуммаВключаетНДС;
Значение.СуммаВключаетНП  = Ложь;
Значение.УчитыватьНДС = Источник.УчитыватьНДС;
Значение.УчитыватьНП  = Ложь;</ПередВыгрузкой></Свойство><Свойство><Код>19</Код><Наименование> --&gt; ЗачитыватьАванс</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="ЗачитыватьАванс" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 2;</ПередВыгрузкой></Свойство><Свойство><Код>18</Код><Наименование> --&gt; ВидПоступления</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="ВидПоступления" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Склад = ?(Источник.ВидПоступления = Перечисления.ВидыПоступленияТоваров.ПоОрдеру, Источник.СкладОрдер.Склад, Источник.СкладОрдер);
Значение = ?(Склад.ВидСклада = Перечисления.ВидыСкладов.Оптовый, 1, 2);</ПередВыгрузкой></Свойство><Свойство><Код>17</Код><Наименование> --&gt; МестоХранения</Наименование><Порядок>600</Порядок><Источник Имя="СкладОрдер" Вид="Реквизит"/><Приемник Имя="МестоХранения" Вид="Реквизит" Тип="СправочникСсылка.МестаХранения"/><КодПравилаКонвертации>МестаХранения                                     </КодПравилаКонвертации><ПередВыгрузкой>Если Источник.ВидПоступления = Перечисления.ВидыПоступленияТоваров.ПоОрдеру Тогда
	Значение = Источник.СкладОрдер.Склад;
Иначе
	Значение = Источник.СкладОрдер;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>1</Код><Наименование>Контрагент --&gt; Контрагент</Наименование><Порядок>300</Порядок><Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство Поиск="true"><Код>13</Код><Наименование> --&gt; ДатаДок</Наименование><Порядок>100</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство Поиск="true"><Код>14</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>Значение = ПолучитьПрефиксЧислоНомера(Источник.Номер,, "Число");
Значение = ДобавитьКПрефиксу(Значение, "П", 6, "Справа");</ПередВыгрузкой></Свойство><Свойство><Код>15</Код><Наименование> --&gt; Договор</Наименование><Порядок>400</Порядок><Источник Имя="ДоговорКонтрагента" Вид="Реквизит" Тип="СправочникСсылка.ДоговорыКонтрагентов"/><Приемник Имя="Договор" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство><Код>16</Код><Наименование> --&gt; ДатаНомерСчетаФактуры</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="ДатаНомерСчетаФактуры" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>СчетФактура = НайтиПодчиненныйДокумент(Источник, "СчетФактураПолученный");

Если СчетФактура = Неопределено Тогда
	Отказ = Истина;
	
Иначе
    ДатаСФ = Формат(СчетФактура.Дата, "ДЛФ=Д");
	Если ДатаСФ &lt;&gt; Формат(Источник.Дата, "ДЛФ=Д") Тогда
		Отказ = Истина;
		
	Иначе
		Значение = ДатаСФ + " " + ?(ЗначениеНеЗаполнено(СчетФактура.НомерВходящегоДокумента), СчетФактура.Номер, СчетФактура.НомерВходящегоДокумента);
	КонецЕсли;
КонецЕсли;</ПередВыгрузкой></Свойство><Группа><Код>2</Код><Наименование> --&gt; ТабличнаяЧасть</Наименование><Порядок>1500</Порядок><Источник Имя="Товары" Вид="ТабличнаяЧасть"/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><Свойство><Код>4</Код><Наименование> --&gt; Количество</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = ОбъектКоллекции.Количество * ОбъектКоллекции.Коэффициент;</ПередВыгрузкой></Свойство><Свойство><Код>3</Код><Наименование> --&gt; Товар</Наименование><Порядок>100</Порядок><Источник Имя="Номенклатура" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/><Приемник Имя="Товар" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/><КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации><ПередВыгрузкой>ИсходящиеДанные = Новый Структура;
ИсходящиеДанные.Вставить("ТипНоменклатуры", "Товар");

Если Источник.ДоговорКонтрагента.ВидДоговора = Перечисления.ВидыДоговоровКонтрагентов.СПоставщиком Тогда
 	ИсходящиеДанные.Вставить("ТипТовара", "Собственный");
Иначе
	ИсходящиеДанные.Вставить("ТипТовара", "НаКомиссии");
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>5</Код><Наименование> --&gt; Цена</Наименование><Порядок>300</Порядок><Источник Имя="Цена" Вид="Реквизит" Тип="Число"/><Приемник Имя="Цена" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = ОбъектКоллекции.Цена / ОбъектКоллекции.Коэффициент;
Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПередВыгрузкой></Свойство><Свойство><Код>6</Код><Наименование> --&gt; Сумма</Наименование><Порядок>400</Порядок><Источник Имя="Сумма" Вид="Реквизит" Тип="Число"/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>7</Код><Наименование> --&gt; НДС</Наименование><Порядок>500</Порядок><Источник Имя="СуммаНДС" Вид="Реквизит" Тип="Число"/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>9</Код><Наименование> --&gt; Всего</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="Всего" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если Не Источник.СуммаВключаетНДС Тогда
	Значение = ОбъектКоллекции.Сумма + ОбъектКоллекции.СуммаНДС;
Иначе
	Значение = ОбъектКоллекции.Сумма;
КонецЕсли;</ПередВыгрузкой><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>10</Код><Наименование> --&gt; ГТД</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="ГТД" Вид="Реквизит" Тип="СправочникСсылка.ГТД"/><КодПравилаКонвертации>ГТД                                               </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("Наименование, СтранаПроисхождения, Комментарий", ОбъектКоллекции.СерияНоменклатуры.НомерГТД.Код, 
		ОбъектКоллекции.СерияНоменклатуры.СтранаПроисхождения.Наименование, ОбъектКоллекции.СерияНоменклатуры.НомерГТД.Комментарий);</ПередВыгрузкой></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>ПоступлениеТоваровВНТТ</Код><Наименование>ДокументСсылка.ПоступлениеТоваровВНТТ --&gt; ДокументСсылка.ПоступлениеТоваров</Наименование><Порядок>600</Порядок><ПередВыгрузкой>Если Источник.ВидОперации = Перечисления.ВидыОперацийПоступлениеТоваровУслугВНеавтоматизированнуюТорговуюТочку.ВнутреннееПеремещение Тогда
	Отказ = Истина;
КонецЕсли;

Если Источник.Товары.Количество() = 0 Тогда
	Отказ = Истина;
КонецЕсли;

КлючВыгружаемыхДанных = ЗначениеВСтрокуВнутр(Источник) + ИмяПКО;</ПередВыгрузкой><Источник>ДокументСсылка.ПоступлениеТоваровУслугВНеавтоматизированнуюТорговуюТочку</Источник><Приемник>ДокументСсылка.ПоступлениеТоваров</Приемник><Свойства><Свойство Поиск="true"><Код>30</Код><Наименование>Дата --&gt; ДатаДок</Наименование><Порядок>300</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство Поиск="true"><Код>29</Код><Наименование>Номер --&gt; НомерДок</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>Значение = ПолучитьПрефиксЧислоНомера(Источник.Номер,, "Число");
Значение = ДобавитьКПрефиксу(Значение, "Н", 6, "Справа");</ПередВыгрузкой></Свойство><Свойство><Код>31</Код><Наименование>ВидПоступления --&gt; ВидПоступления</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="ВидПоступления" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 2;</ПередВыгрузкой></Свойство><Свойство><Код>32</Код><Наименование>ДатаВходящегоДокумента --&gt; ДатаДокВходящий</Наименование><Порядок>500</Порядок><Источник Имя="ДатаВходящегоДокумента" Вид="Реквизит" Тип="Дата"/><Приемник Имя="ДатаДокВходящий" Вид="Реквизит" Тип="Дата"/></Свойство><Свойство><Код>33</Код><Наименование>ДоговорКонтрагента --&gt; Договор</Наименование><Порядок>600</Порядок><Источник Имя="ДоговорКонтрагента" Вид="Измерение" Тип="СправочникСсылка.ДоговорыКонтрагентов"/><Приемник Имя="Договор" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство><Код>34</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>700</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>35</Код><Наименование>Контрагент --&gt; Контрагент</Наименование><Порядок>800</Порядок><Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство><Код>36</Код><Наименование>НДСВключенВСтоимость --&gt; НДСвключатьВСтоимость</Наименование><Порядок>900</Порядок><Источник Имя="НДСВключенВСтоимость" Вид="Реквизит" Тип="Булево"/><Приемник Имя="НДСвключатьВСтоимость" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>37</Код><Наименование>НомерВходящегоДокумента --&gt; НомерДокВходящий</Наименование><Порядок>1000</Порядок><Источник Имя="НомерВходящегоДокумента" Вид="Реквизит" Тип="Строка"/><Приемник Имя="НомерДокВходящий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>38</Код><Наименование> --&gt; МестоХранения</Наименование><Порядок>1100</Порядок><Источник Имя="Склад" Вид="Реквизит" Тип="СправочникСсылка.Склады"/><Приемник Имя="МестоХранения" Вид="Реквизит" Тип="СправочникСсылка.МестаХранения"/><КодПравилаКонвертации>МестаХранения                                     </КодПравилаКонвертации></Свойство><Свойство><Код>39</Код><Наименование> --&gt; ЗачитыватьАванс</Наименование><Порядок>1200</Порядок><Источник/><Приемник Имя="ЗачитыватьАванс" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 2;</ПередВыгрузкой></Свойство><Свойство><Код>40</Код><Наименование> --&gt; ВариантРасчетаНалогов</Наименование><Порядок>1300</Порядок><Источник/><Приемник Имя="ВариантРасчетаНалогов" Вид="Реквизит" Тип="СправочникСсылка.ВариантыРасчетаНалогов"/><КодПравилаКонвертации>ВариантыРасчетаНалогов                            </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("СуммаВключаетНДС, СуммаВключаетНП, УчитыватьНДС, УчитыватьНП");
Значение.СуммаВключаетНДС = Источник.СуммаВключаетНДС;
Значение.СуммаВключаетНП  = Ложь;
Значение.УчитыватьНДС = Источник.УчитыватьНДС;
Значение.УчитыватьНП  = Ложь;</ПередВыгрузкой></Свойство><Свойство><Код>41</Код><Наименование> --&gt; Курс</Наименование><Порядок>1400</Порядок><Источник Имя="КурсВзаиморасчетов" Вид="Реквизит" Тип="Число"/><Приемник Имя="Курс" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>42</Код><Наименование> --&gt; ВерсияОбъекта</Наименование><Порядок>1500</Порядок><Источник/><Приемник Имя="ВерсияОбъекта" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Значение = "7.70.447"</ПередВыгрузкой></Свойство><Свойство><Код>43</Код><Наименование> --&gt; ДатаНомерСчетаФактуры</Наименование><Порядок>1600</Порядок><Источник/><Приемник Имя="ДатаНомерСчетаФактуры" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>СчетФактура = НайтиПодчиненныйДокумент(Источник, "СчетФактураПолученный");

Если СчетФактура = Неопределено Тогда
	Отказ = Истина;
	
Иначе
    ДатаСФ = Формат(СчетФактура.Дата, "ДЛФ=Д");
	Если ДатаСФ &lt;&gt; Формат(Источник.Дата, "ДЛФ=Д") Тогда
		Отказ = Истина;
		
	Иначе
		Значение = ДатаСФ + " " + ?(ЗначениеНеЗаполнено(СчетФактура.НомерВходящегоДокумента), СчетФактура.Номер, СчетФактура.НомерВходящегоДокумента);
	КонецЕсли;
КонецЕсли;</ПередВыгрузкой></Свойство><Группа><Код>1</Код><Наименование>Товары --&gt; ТабличнаяЧасть</Наименование><Порядок>100</Порядок><Источник Имя="Товары" Вид="ТабличнаяЧасть"/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><Свойство><Код>22</Код><Наименование> --&gt; ГТД</Наименование><Порядок>2100</Порядок><Источник/><Приемник Имя="ГТД" Вид="Реквизит" Тип="СправочникСсылка.ГТД"/><КодПравилаКонвертации>ГТД                                               </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("Наименование, СтранаПроисхождения, Комментарий", ОбъектКоллекции.СерияНоменклатуры.НомерГТД.Код, 
		ОбъектКоллекции.СерияНоменклатуры.СтранаПроисхождения.Наименование, ОбъектКоллекции.СерияНоменклатуры.НомерГТД.Комментарий);</ПередВыгрузкой></Свойство><Свойство><Код>21</Код><Наименование> --&gt; Всего</Наименование><Порядок>2000</Порядок><Источник/><Приемник Имя="Всего" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если Не Источник.СуммаВключаетНДС Тогда
	Значение = ОбъектКоллекции.Сумма + ОбъектКоллекции.СуммаНДС;
Иначе
	Значение = ОбъектКоллекции.Сумма;
КонецЕсли;</ПередВыгрузкой><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>2</Код><Наименование>Номенклатура --&gt; </Наименование><Порядок>100</Порядок><Источник Имя="Номенклатура" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/><Приемник Имя="Товар" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/><КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации><ПередВыгрузкой>ИсходящиеДанные = Новый Структура;
ИсходящиеДанные.Вставить("ТипНоменклатуры", "Товар");

Если Источник.ДоговорКонтрагента.ВидДоговора = Перечисления.ВидыДоговоровКонтрагентов.СПоставщиком Тогда
 	ИсходящиеДанные.Вставить("ТипТовара", "Собственный");
Иначе
	ИсходящиеДанные.Вставить("ТипТовара", "НаКомиссии");
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>7</Код><Наименование>Количество --&gt; Количество</Наименование><Порядок>600</Порядок><Источник/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = ОбъектКоллекции.Количество * ОбъектКоллекции.Коэффициент;</ПередВыгрузкой></Свойство><Свойство><Код>8</Код><Наименование>Цена --&gt; Цена</Наименование><Порядок>700</Порядок><Источник Имя="Цена" Вид="Измерение" Тип="Число"/><Приемник Имя="Цена" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = ОбъектКоллекции.Цена / ОбъектКоллекции.Коэффициент;
Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПередВыгрузкой></Свойство><Свойство><Код>9</Код><Наименование>Сумма --&gt; Сумма</Наименование><Порядок>800</Порядок><Источник Имя="Сумма" Вид="Реквизит" Тип="Число"/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>19</Код><Наименование> --&gt; НДС</Наименование><Порядок>1800</Порядок><Источник Имя="СуммаНДС" Вид="Реквизит" Тип="Число"/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>ПриходныйОрдер</Код><Наименование>ДокументСсылка.ПриходныйКассовыйОрдер --&gt; ДокументСсылка.ПриходныйОрдер</Наименование><Порядок>1900</Порядок><Источник>ДокументСсылка.ПриходныйКассовыйОрдер</Источник><Приемник>ДокументСсылка.ПриходныйОрдер</Приемник><Свойства><Свойство><Код>4</Код><Наименование>Основание --&gt; Основание</Наименование><Порядок>400</Порядок><Источник Имя="Основание" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Основание" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>5</Код><Наименование>Приложение --&gt; Приложение</Наименование><Порядок>500</Порядок><Источник Имя="Приложение" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Приложение" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство Поиск="true"><Код>6</Код><Наименование> --&gt; ДатаДок</Наименование><Порядок>600</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство Поиск="true"><Код>7</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>700</Порядок><Источник Имя="Номер" Вид="Свойство" Тип="Строка"/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "", 6, "Справа");;</ПередВыгрузкой></Свойство><Свойство><Код>8</Код><Наименование> --&gt; КоррСчет</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="КоррСчет" Вид="Реквизит"/><ПередВыгрузкой>ТипПриемника = "ПланСчетовСсылка.Основной";

Если Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ОплатаПокупателя Тогда
	СтруктураДляОтбора = Новый Структура;
	СтруктураДляОтбора.Вставить("ДоговорКонтрагента", Источник.РасшифровкаПлатежа[0].ДоговорКонтрагента);
	СтруктураДляОтбора.Вставить("Сделка",             Источник.РасшифровкаПлатежа[0].Сделка);
	
	ТаблицаОстатков = РегистрыНакопления.ВзаиморасчетыСКонтрагентами.Остатки(Источник.МоментВремени(), СтруктураДляОтбора);
	Если ТаблицаОстатков.Количество() &gt; 0 И ТаблицаОстатков[0].СуммаВзаиморасчетов &gt; 0 Тогда
		Аванс = Ложь;
	Иначе
		Аванс = Истина;
	КонецЕсли;
	Если Аванс Тогда
		Если Источник.ВалютаДокумента &lt;&gt; Константы.ВалютаРегламентированногоУчета.Получить() Тогда
    	    Значение = "62.22";
		
		Иначе
			Значение = "62.2";
		КонецЕсли;
	Иначе
		Если Источник.ВалютаДокумента &lt;&gt; Константы.ВалютаРегламентированногоУчета.Получить() Тогда
    	    Значение = "62.11";
		
		Иначе
			Значение = "62.1";
		КонецЕсли;
	КонецЕсли;	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПриходДенежныхСредствРозничнаяВыручка Тогда
	Значение = "90.1.1";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ВозвратДенежныхСредствПодотчетником Тогда
	Если Источник.ВалютаДокумента &lt;&gt; Константы.ВалютаРегламентированногоУчета.Получить() Тогда
        Значение = "71.11";
		
	Иначе
		Значение = "71.1";
	КонецЕсли;
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ВозвратДенежныхСредствПоставщиком Тогда
	Если Источник.ВалютаДокумента &lt;&gt; Константы.ВалютаРегламентированногоУчета.Получить() Тогда
        Значение = "60.22";
		
	Иначе
		Значение = "60.2";
	КонецЕсли;
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПрочиеРасчетыСКонтрагентами Тогда
	Если Источник.ВалютаДокумента &lt;&gt; Константы.ВалютаРегламентированногоУчета.Получить() Тогда
        Значение = "76.6";
		
	Иначе
		Значение = "76.5";
	КонецЕсли;
	              
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПолучениеНаличныхДенежныхСредствВБанке Тогда
	
	Если Источник.ВалютаДокумента &lt;&gt; Константы.ВалютаРегламентированногоУчета.Получить() Тогда
        Значение = "51";
		
	Иначе
		Значение = "52";
	КонецЕсли;
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПриходДенежныхСредствПрочее Тогда
	Пусто = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>9</Код><Наименование> --&gt; Субконто1</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="Субконто1" Вид="Реквизит"/><ПередВыгрузкой>Если Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ОплатаПокупателя 
 ИЛИ Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПрочиеРасчетыСКонтрагентами Тогда
	Значение = Источник.Контрагент;
	ИмяПКО = "Контрагенты";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПриходДенежныхСредствРозничнаяВыручка Тогда
	Значение = Новый Структура;
	Значение.Вставить("Наименование", "Товар");
	Значение.Вставить("ТипНоменклатуры", "Товар");
	ИмяПКО = "ВидыНоменклатуры";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ВозвратДенежныхСредствПодотчетником Тогда
	Значение = Источник.Контрагент;
	ИмяПКО = "Сотрудники";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ВозвратДенежныхСредствПоставщиком Тогда
	Значение = Источник.Контрагент;
	ИмяПКО = "Контрагенты";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПолучениеНаличныхДенежныхСредствВБанке Тогда
	Значение = Источник.СчетОрганизации;
	ИмяПКО   = "БанковскиеСчета";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПриходДенежныхСредствПрочее Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>10</Код><Наименование> --&gt; Субконто2</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="Субконто2" Вид="Реквизит"/><ПередВыгрузкой>Если Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ОплатаПокупателя 
 ИЛИ Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПрочиеРасчетыСКонтрагентами Тогда
	Значение = Источник.РасшифровкаПлатежа[0].ДоговорКонтрагента;
	Для каждого СтрокаРасшифровки из Источник.РасшифровкаПлатежа Цикл
		Если СтрокаРасшифровки.ДоговорКонтрагента &lt;&gt; Значение Тогда
			Пусто = Истина;
			Прервать;
		КонецЕсли;
	КонецЦикла;
	ИмяПКО = "Договоры";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПриходДенежныхСредствРозничнаяВыручка Тогда
	Значение = Источник.СтавкаНДС;
	ИмяПКО = "СтавкиНДС";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ВозвратДенежныхСредствПодотчетником Тогда
	Отказ = Истина;
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ВозвратДенежныхСредствПоставщиком Тогда
	Значение = Источник.РасшифровкаПлатежа[0].ДоговорКонтрагента;
	Для каждого СтрокаРасшифровки из Источник.РасшифровкаПлатежа Цикл
		Если СтрокаРасшифровки.ДоговорКонтрагента &lt;&gt; Значение Тогда
			Пусто = Истина;
			Прервать;
		КонецЕсли;
	КонецЦикла;
	ИмяПКО = "Договоры";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПолучениеНаличныхДенежныхСредствВБанке Тогда
	Значение = Новый Структура("Наименование, ВидДвижения");
	Значение.Наименование = "Получение наличных из банка";
	Значение.ВидДвижения  = "ПолученоИзБанкаНаличными";
	ИмяПКО = "ДвиженияДенежныхСредств";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПриходДенежныхСредствПрочее Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>11</Код><Наименование> --&gt; Субконто3</Наименование><Порядок>1100</Порядок><Источник/><Приемник Имя="Субконто3" Вид="Реквизит"/><ПередВыгрузкой>Если Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ОплатаПокупателя 
 Или Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПрочиеРасчетыСКонтрагентами Тогда
	Отказ = Истина;
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПриходДенежныхСредствРозничнаяВыручка Тогда
	Отказ = Истина;
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ВозвратДенежныхСредствПодотчетником Тогда
	Отказ = Истина;
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ВозвратДенежныхСредствПоставщиком Тогда
	Отказ = Истина;
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПолучениеНаличныхДенежныхСредствВБанке Тогда
	Отказ = Истина;
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПриходДенежныхСредствПрочее Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>12</Код><Наименование> --&gt; ФормироватьПроводки</Наименование><Порядок>1200</Порядок><Источник/><Приемник Имя="ФормироватьПроводки" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПриходДенежныхСредствРозничнаяВыручка Тогда
	Значение = 0;
	
Иначе
	Значение = 1;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>14</Код><Наименование> --&gt; Сумма</Наименование><Порядок>1400</Порядок><Источник Имя="СуммаДокумента" Вид="Реквизит" Тип="Число"/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>15</Код><Наименование> --&gt; НДС</Наименование><Порядок>1500</Порядок><Источник/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если Не одПустое(Источник.СтавкаНДС) Тогда
	НДС = 0;
	НП = 0;
    РассчитатьСуммуНДС(Источник.СуммаДокумента, Истина, Истина, ПолучитьСтавкуНДС(Источник.СтавкаНДС));
	Значение = НДС;
Иначе
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>16</Код><Наименование> --&gt; УказатьНДС</Наименование><Порядок>1600</Порядок><Источник/><Приемник Имя="УказатьНДС" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если Не одПустое(Источник.СтавкаНДС) Тогда
	Значение = 1;

Иначе
	Значение = 0;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>18</Код><Наименование> --&gt; УчитыватьНП</Наименование><Порядок>1800</Порядок><Источник/><Приемник Имя="УчитыватьНП" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 0;
</ПередВыгрузкой></Свойство><Свойство><Код>19</Код><Наименование> --&gt; УказатьНП</Наименование><Порядок>1900</Порядок><Источник/><Приемник Имя="УказатьНП" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 0;
</ПередВыгрузкой></Свойство><Свойство><Код>20</Код><Наименование> --&gt; Валютный</Наименование><Порядок>2000</Порядок><Источник/><Приемник Имя="Валютный" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если Источник.ВалютаДокумента &lt;&gt; Константы.ВалютаРегламентированногоУчета.Получить() Тогда
	Значение = 2;
	
Иначе
	Значение = 1;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>21</Код><Наименование> --&gt; Валюта</Наименование><Порядок>2100</Порядок><Источник Имя="ВалютаДокумента" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/><Приемник Имя="Валюта" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/><КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации></Свойство><Свойство><Код>22</Код><Наименование> --&gt; ДвижениеДенежныхСредств</Наименование><Порядок>2200</Порядок><Источник/><Приемник Имя="ДвижениеДенежныхСредств" Вид="Реквизит" Тип="СправочникСсылка.ДвиженияДенежныхСредств"/><КодПравилаКонвертации>ДвиженияДенежныхСредств                           </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("Наименование, ВидДвижения");

Если Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ОплатаПокупателя Тогда
	Значение.Наименование = "Поступления от покупателей";
	Значение.ВидДвижения  = "ВыручкаПоОбычнымВидамДеятельности";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПриходДенежныхСредствРозничнаяВыручка Тогда
	Значение.Наименование = "Поступления от покупателей";
	Значение.ВидДвижения  = "ВыручкаПоОбычнымВидамДеятельности";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ВозвратДенежныхСредствПодотчетником Тогда
	Значение.Наименование = "Прочие поступления";
	Значение.ВидДвижения  = "ПрочиеПоступления";

ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ВозвратДенежныхСредствПоставщиком Тогда
	Значение.Наименование = "Прочие поступления";
	Значение.ВидДвижения  = "ПрочиеПоступления";

ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПриходДенежныхСредствПрочее Тогда
	Значение.Наименование = "Прочие поступления";
	Значение.ВидДвижения  = "ПрочиеПоступления";
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПолучениеНаличныхДенежныхСредствВБанке Тогда
	Значение.Наименование = "Получение наличных из банка";
	Значение.ВидДвижения  = "ПолученоИзБанкаНаличными";
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>23</Код><Наименование> --&gt; ВерсияОбъекта</Наименование><Порядок>2300</Порядок><Источник/><Приемник Имя="ВерсияОбъекта" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Значение = "7.70.447"</ПередВыгрузкой></Свойство><Свойство><Код>24</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>2400</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>25</Код><Наименование> --&gt; РозничнаяВыручка</Наименование><Порядок>2500</Порядок><Источник/><Приемник Имя="РозничнаяВыручка" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если Источник.ВидОперации = Перечисления.ВидыОперацийПКО.ПриходДенежныхСредствРозничнаяВыручка Тогда
	Значение = 1;
Иначе
	Значение = 0;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>26</Код><Наименование>КурсВзаиморасчетов --&gt; КурсОплаты</Наименование><Порядок>2600</Порядок><Источник Имя="КурсВзаиморасчетов" Вид="Реквизит" Тип="Число"/><Приемник Имя="КурсОплаты" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = Источник.РасшифровкаПлатежа[0].КурсВзаиморасчетов;</ПередВыгрузкой></Свойство><Свойство><Код>27</Код><Наименование>НомерЧекаККМ --&gt; НомерЧекаККМ</Наименование><Порядок>2700</Порядок><Источник Имя="НомерЧекаККМ" Вид="Реквизит" Тип="Число"/><Приемник Имя="НомерЧекаККМ" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>3</Код><Наименование>ПринятоОт --&gt; ПринятоОт</Наименование><Порядок>300</Порядок><Источник Имя="ПринятоОт" Вид="Реквизит" Тип="Строка"/><Приемник Имя="ПринятоОт" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>1</Код><Наименование>СтавкаНДС --&gt; СтавкаНДС</Наименование><Порядок>100</Порядок><Источник Имя="СтавкаНДС" Вид="Реквизит" Тип="ПеречислениеСсылка.СтавкиНДС"/><Приемник Имя="СтавкаНДС" Вид="Реквизит" Тип="СправочникСсылка.СтавкиНДС"/><КодПравилаКонвертации>СтавкиНДС                                         </КодПравилаКонвертации></Свойство></Свойства><Значения/></Правило><Правило><Код>ПродажаВРозницу</Код><Наименование>ДокументСсылка.ОтчетККМОПродажах --&gt; ДокументСсылка.ПродажаВРозницу</Наименование><Порядок>1300</Порядок><ПередВыгрузкой>// Документы с оптового склада не выгружаем
Если Источник.Склад.ВидСклада = Перечисления.ВидыСкладов.Оптовый Тогда
	Отказ = Истина;
КонецЕсли;
ВходящиеДанные = Источник.Товары.Выгрузить();
</ПередВыгрузкой><Источник>ДокументСсылка.ОтчетОРозничныхПродажах</Источник><Приемник>ДокументСсылка.ПродажаВРозницу</Приемник><Свойства><Свойство Поиск="true"><Код>12</Код><Наименование> --&gt; ДатаДок</Наименование><Порядок>100</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство Поиск="true"><Код>13</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "", 6, "");</ПередВыгрузкой></Свойство><Свойство><Код>14</Код><Наименование> --&gt; МестоХранения</Наименование><Порядок>300</Порядок><Источник Имя="Склад" Вид="Реквизит" Тип="СправочникСсылка.Склады"/><Приемник Имя="МестоХранения" Вид="Реквизит" Тип="СправочникСсылка.МестаХранения"/><КодПравилаКонвертации>МестаХранения                                     </КодПравилаКонвертации></Свойство><Свойство><Код>15</Код><Наименование> --&gt; ВариантРасчетаНалогов</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="ВариантРасчетаНалогов" Вид="Реквизит" Тип="СправочникСсылка.ВариантыРасчетаНалогов"/><КодПравилаКонвертации>ВариантыРасчетаНалогов                            </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("СуммаВключаетНДС, СуммаВключаетНП, УчитыватьНДС, УчитыватьНП");
Значение.СуммаВключаетНДС = Источник.СуммаВключаетНДС;
Значение.СуммаВключаетНП  = Ложь;
Значение.УчитыватьНДС = Источник.УчитыватьНДС;
Значение.УчитыватьНП  = Ложь;</ПередВыгрузкой></Свойство><Свойство><Код>16</Код><Наименование> --&gt; ДвижениеДенежныхСредств</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="ДвижениеДенежныхСредств" Вид="Реквизит" Тип="СправочникСсылка.ДвиженияДенежныхСредств"/><КодПравилаКонвертации>ДвиженияДенежныхСредств                           </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("Наименование, ВидДвижения");
Значение.Наименование = "Поступления от покупателей";
Значение.ВидДвижения  = "ВыручкаПоОбычнымВидамДеятельности";</ПередВыгрузкой></Свойство><Свойство><Код>17</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>800</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>18</Код><Наименование>ТипЦен --&gt; ТипЦен</Наименование><Порядок>900</Порядок><Источник Имя="ТипЦен" Вид="Реквизит" Тип="СправочникСсылка.ТипыЦенНоменклатуры"/><Приемник Имя="ТипЦен" Вид="Реквизит" Тип="СправочникСсылка.ТипыЦен"/></Свойство><Свойство><Код>19</Код><Наименование> --&gt; ПродажаОблагаетсяЕНВД</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="ПродажаОблагаетсяЕНВД" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = УчетнаяПолитикаНалоговыйУчет("РозничнаяТорговляОблагаетсяЕНВД", Источник.Организация, Источник.Дата);</ПередВыгрузкой></Свойство><Группа><Код>1</Код><Наименование> --&gt; ТабличнаяЧасть</Наименование><Порядок>700</Порядок><Источник Имя="Товары" Вид="ТабличнаяЧасть"/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><ПередОбработкойВыгрузки>Запросы.ТабличнаяЧастьРеализации.УстановитьПараметр("ПустойКомитент", Справочники.Контрагенты.ПустаяСсылка());
Запросы.ТабличнаяЧастьРеализации.УстановитьПараметр("ПустойДоговорКомиссии", Справочники.ДоговорыКонтрагентов.ПустаяСсылка());
Запросы.ТабличнаяЧастьРеализации.УстановитьПараметр("ТоварПринятыйКомиссия", Перечисления.СтатусыПартийТоваров.НаКомиссию);
Запросы.ТабличнаяЧастьРеализации.УстановитьПараметр("Источник", Источник);
ТаблицаТоваров   = ВходящиеДанные;

ТаблицаПартий    = Запросы.ТабличнаяЧастьРеализации.Выполнить().Выгрузить();
ТаблицаПартий.Свернуть("Номенклатура, Комитент, ДоговорКомиссии", "Количество");

КоллекцияОбъектов = Новый ТаблицаЗначений;
КоллекцияОбъектов.Колонки.Добавить("Товар", Новый ОписаниеТипов("СправочникСсылка.Номенклатура"));
КоллекцияОбъектов.Колонки.Добавить("Цена", Новый ОписаниеТипов("Число"));
КоллекцияОбъектов.Колонки.Добавить("ГТД");
КоллекцияОбъектов.Колонки.Добавить("Количество", Новый ОписаниеТипов("Число"));
КоллекцияОбъектов.Колонки.Добавить("Коэффициент", Новый ОписаниеТипов("Число"));
КоллекцияОбъектов.Колонки.Добавить("Сумма", Новый ОписаниеТипов("Число"));
КоллекцияОбъектов.Колонки.Добавить("НДС", Новый ОписаниеТипов("Число"));
КоллекцияОбъектов.Колонки.Добавить("ДоговорКомиссии", Новый ОписаниеТипов("СправочникСсылка.ДоговорыКонтрагентов"));
КоллекцияОбъектов.Колонки.Добавить("Комитент", Новый ОписаниеТипов("СправочникСсылка.Контрагенты"));

ОстКоличествоПоПартиям = 0;
НоменклатураПред = "";
НомерСтрокиПред = 0;
Для каждого СтрокаТаблицы ИЗ ТаблицаТоваров Цикл
	КоличествоПоСтроке = СтрокаТаблицы.Количество / СтрокаТаблицы.Коэффициент * СтрокаТаблицы.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент;
	ОстКоличествоПоСтроке = КоличествоПоСтроке;
	ОстПогСумма = СтрокаТаблицы.Сумма;
	ОстПогНДС = СтрокаТаблицы.СуммаНДС;
	Если НоменклатураПред &lt;&gt; СтрокаТаблицы.Номенклатура Тогда
		Индекс = 0;
		СтруктураПоиска = Новый Структура;
		СтруктураПоиска.Вставить("Номенклатура", СтрокаТаблицы.Номенклатура);
		МассивСтрок = ТаблицаПартий.НайтиСтроки(СтруктураПоиска);
	КонецЕсли;
	Пока 1 = 1 Цикл
		Если (ОстКоличествоПоПартиям = 0) ИЛИ (НоменклатураПред &lt;&gt; СтрокаТаблицы.Номенклатура) Тогда
			Если Индекс &lt;= МассивСтрок.ВГраница()Тогда
				СтрокаТаблицыПартий = МассивСтрок.Получить(Индекс);
				Индекс = Индекс + 1;
				ОстКоличествоПоПартиям = СтрокаТаблицыПартий.Количество;
			Иначе
				
				// Если не все количество распределилось по партиям все равно выгрузим количестово из документа
				СтрокаКоллекции             = КоллекцияОбъектов.Добавить();
				СтрокаКоллекции.Товар       = СтрокаТаблицы.Номенклатура;
				
				Если ЗначениеНеЗаполнено(СтрокаТаблицы.СерияНоменклатуры) Тогда
					СтрокаКоллекции.ГТД = Неопределено;
				Иначе
					СтрокаКоллекции.ГТД = Новый Структура("Наименование, СтранаПроисхождения, Комментарий", 
															СтрокаТаблицы.СерияНоменклатуры.НомерГТД.Код, 
															СтрокаТаблицы.СерияНоменклатуры.СтранаПроисхождения.Наименование, 
								  							СтрокаТаблицы.СерияНоменклатуры.НомерГТД.Комментарий);
				КонецЕсли;
															
				Если ЗначениеНеЗаполнено(СтрокаТаблицы.ПроцентСкидкиНаценки) И ЗначениеНеЗаполнено(СтрокаТаблицы.ПроцентАвтоматическихСкидок) Тогда
					СтрокаКоллекции.Цена  = СтрокаТаблицы.Цена / СтрокаТаблицы.Коэффициент;
				Иначе
					СтрокаКоллекции.Цена  = СтрокаТаблицы.Сумма / СтрокаТаблицы.Количество / СтрокаТаблицы.Коэффициент;
				КонецЕсли;
				СтрокаКоллекции.Количество  = ОстКоличествоПоСтроке;
				СтрокаКоллекции.Коэффициент = СтрокаТаблицы.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент;
				СтрокаКоллекции.Сумма       = ОстПогСумма;
				СтрокаКоллекции.НДС         = ОстПогНДС;
				ОстКоличествоПоСтроке       = ОстКоличествоПоСтроке - СтрокаКоллекции.Количество;
				Прервать;
				
			КонецЕсли;
		КонецЕсли;
		
		Если ОстКоличествоПоСтроке = 0 Тогда
			Продолжить;
		КонецЕсли;
		
		СтрокаКоллекции = КоллекцияОбъектов.Добавить();
		СтрокаКоллекции.Товар = СтрокаТаблицы.Номенклатура;
		
		Если ЗначениеНеЗаполнено(СтрокаТаблицы.СерияНоменклатуры) Тогда
			СтрокаКоллекции.ГТД = Неопределено;
		Иначе
			СтрокаКоллекции.ГТД = Новый Структура("Наименование, СтранаПроисхождения, Комментарий", 
															СтрокаТаблицы.СерияНоменклатуры.НомерГТД.Код, 
															СтрокаТаблицы.СерияНоменклатуры.СтранаПроисхождения.Наименование, 
								  							СтрокаТаблицы.СерияНоменклатуры.НомерГТД.Комментарий);
		КонецЕсли;
															
		Если ЗначениеНеЗаполнено(СтрокаТаблицы.ПроцентСкидкиНаценки) И ЗначениеНеЗаполнено(СтрокаТаблицы.ПроцентАвтоматическихСкидок) Тогда
			СтрокаКоллекции.Цена  = СтрокаТаблицы.Цена / СтрокаТаблицы.Коэффициент;
		Иначе
			СтрокаКоллекции.Цена  = СтрокаТаблицы.Сумма / СтрокаТаблицы.Количество / СтрокаТаблицы.Коэффициент;
		КонецЕсли;
		СтрокаКоллекции.Количество = Мин(ОстКоличествоПоСтроке, ОстКоличествоПоПартиям);
		СтрокаКоллекции.Коэффициент = СтрокаТаблицы.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент;
		КоэффПогашения = СтрокаКоллекции.Количество / КоличествоПоСтроке;
		Если СтрокаКоллекции.Количество = ОстКоличествоПоСтроке Тогда
			СтрокаКоллекции.Сумма = ОстПогСумма;
			СтрокаКоллекции.НДС   = ОстПогНДС;
		Иначе
			СтрокаКоллекции.Сумма = СтрокаТаблицы.Сумма * КоэффПогашения;
			СтрокаКоллекции.НДС   = СтрокаТаблицы.СуммаНДС * КоэффПогашения;
		КонецЕсли;
		СтрокаКоллекции.Комитент  = СтрокаТаблицыПартий.Комитент;
		СтрокаКоллекции.ДоговорКомиссии = СтрокаТаблицыПартий.ДоговорКомиссии;
		ОстКоличествоПоСтроке  = ОстКоличествоПоСтроке - СтрокаКоллекции.Количество;
		ОстКоличествоПоПартиям = ОстКоличествоПоПартиям - СтрокаКоллекции.Количество;
		ОстПогСумма = ОстПогСумма - СтрокаКоллекции.Сумма;
		ОстПогНДС   = ОстПогНДС   - СтрокаКоллекции.НДС;
		НоменклатураПред = СтрокаТаблицы.Номенклатура;
		НомерСтрокиПред  = СтрокаТаблицы.НомерСтроки;
		Если ОстКоличествоПоСтроке &lt;= 0 Тогда
			Прервать;
		КонецЕсли;
	КонецЦикла;
	
КонецЦикла;

КоллекцияОбъектов.Свернуть("Товар, ГТД, Цена, Комитент, ДоговорКомиссии, Коэффициент", "Количество, Сумма, НДС");</ПередОбработкойВыгрузки><Свойство><Код>2</Код><Наименование> --&gt; Товар</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Товар" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/><КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации><ПередВыгрузкой>ИсходящиеДанные = Новый Структура;
ИсходящиеДанные.Вставить("ТипНоменклатуры", "Товар");

Если ОбъектКоллекции.Товар.Услуга Тогда
	ИсходящиеДанные.Вставить("ТипНоменклатуры", "Услуга");
	ИсходящиеДанные.Вставить("ТипТовара", "");

Иначе
	ИсходящиеДанные.Вставить("ТипНоменклатуры", "Товар");
	Если ОбъектКоллекции.Комитент = Справочники.Контрагенты.ПустаяСсылка() Тогда
		ИсходящиеДанные.Вставить("ТипТовара", "Собственный");
		
	Иначе
		ИсходящиеДанные.Вставить("ТипТовара", "НаКомиссии");
	КонецЕсли;
КонецЕсли;

</ПередВыгрузкой></Свойство><Свойство><Код>3</Код><Наименование> --&gt; Количество</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = ОбъектКоллекции.Количество * ОбъектКоллекции.Коэффициент;</ПередВыгрузкой></Свойство><Свойство><Код>4</Код><Наименование> --&gt; Цена</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Цена" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = ОбъектКоллекции.Цена / ОбъектКоллекции.Коэффициент;
</ПередВыгрузкой></Свойство><Свойство><Код>5</Код><Наименование> --&gt; Сумма</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>6</Код><Наименование> --&gt; НДС</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>8</Код><Наименование> --&gt; Всего</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="Всего" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Выполнить(Алгоритмы.ПолучитьСуммуВсего);</ПередВыгрузкой></Свойство><Свойство><Код>9</Код><Наименование> --&gt; Комитент</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="Комитент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство><Код>10</Код><Наименование> --&gt; ДоговорКомиссии</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="ДоговорКомиссии" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство><Код>11</Код><Наименование> --&gt; ГТД</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="ГТД" Вид="Реквизит" Тип="СправочникСсылка.ГТД"/><КодПравилаКонвертации>ГТД                                               </КодПравилаКонвертации></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>ПрочаяРозничнаяПродажа</Код><Наименование>ДокументСсылка.РеализацияТоваров --&gt; ДокументСсылка.ПродажаВРозницу</Наименование><Порядок>1300</Порядок><Источник>ДокументСсылка.РеализацияТоваровУслуг</Источник><Приемник>ДокументСсылка.ПродажаВРозницу</Приемник><Свойства><Свойство><Код>17</Код><Наименование> --&gt; ДвижениеДенежныхСредств</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="ДвижениеДенежныхСредств" Вид="Реквизит" Тип="СправочникСсылка.ДвиженияДенежныхСредств"/><КодПравилаКонвертации>ДвиженияДенежныхСредств                           </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("Наименование, ВидДвижения");
Значение.Наименование = "Поступления от покупателей";
Значение.ВидДвижения  = "ВыручкаПоОбычнымВидамДеятельности";</ПередВыгрузкой></Свойство><Свойство><Код>16</Код><Наименование> --&gt; ВариантРасчетаНалогов</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="ВариантРасчетаНалогов" Вид="Реквизит" Тип="СправочникСсылка.ВариантыРасчетаНалогов"/><КодПравилаКонвертации>ВариантыРасчетаНалогов                            </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("СуммаВключаетНДС, СуммаВключаетНП, УчитыватьНДС, УчитыватьНП");
Значение.СуммаВключаетНДС = Источник.СуммаВключаетНДС;
Значение.СуммаВключаетНП  = Ложь;
Значение.УчитыватьНДС = Источник.УчитыватьНДС;
Значение.УчитыватьНП  = Ложь;</ПередВыгрузкой></Свойство><Свойство><Код>15</Код><Наименование>СкладКомпании --&gt; МестоХранения</Наименование><Порядок>700</Порядок><Источник Имя="Склад" Вид="Реквизит" Тип="СправочникСсылка.Склады"/><Приемник Имя="МестоХранения" Вид="Реквизит" Тип="СправочникСсылка.МестаХранения"/><КодПравилаКонвертации>МестаХранения                                     </КодПравилаКонвертации></Свойство><Свойство Поиск="true"><Код>14</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>600</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "ПР", 6, "Справа");</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>3</Код><Наименование>Дата --&gt; ДатаДок</Наименование><Порядок>300</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство><Код>4</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>400</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Группа><Код>5</Код><Наименование> --&gt; ТабличнаяЧасть</Наименование><Порядок>500</Порядок><Источник Имя="Товары" Вид="ТабличнаяЧасть"/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><ПередОбработкойВыгрузки>Запросы.ТабличнаяЧастьРеализации.УстановитьПараметр("ПустойКомитент", Справочники.Контрагенты.ПустаяСсылка());
Запросы.ТабличнаяЧастьРеализации.УстановитьПараметр("ПустойДоговорКомиссии", Справочники.ДоговорыКонтрагентов.ПустаяСсылка());
Запросы.ТабличнаяЧастьРеализации.УстановитьПараметр("ТоварПринятыйКомиссия", Перечисления.СтатусыПартийТоваров.НаКомиссию);
Запросы.ТабличнаяЧастьРеализации.УстановитьПараметр("Источник", Источник);
ТаблицаТоваров   = Источник.Товары.Выгрузить();

ТаблицаПартий    = Запросы.ТабличнаяЧастьРеализации.Выполнить().Выгрузить();
ТаблицаПартий.Свернуть("Номенклатура, Комитент, ДоговорКомиссии", "Количество");

КоллекцияОбъектов = Новый ТаблицаЗначений;
КоллекцияОбъектов.Колонки.Добавить("Товар", Новый ОписаниеТипов("СправочникСсылка.Номенклатура"));
КоллекцияОбъектов.Колонки.Добавить("Цена", Новый ОписаниеТипов("Число"));
КоллекцияОбъектов.Колонки.Добавить("ГТД");
КоллекцияОбъектов.Колонки.Добавить("Количество", Новый ОписаниеТипов("Число"));
КоллекцияОбъектов.Колонки.Добавить("Сумма", Новый ОписаниеТипов("Число"));
КоллекцияОбъектов.Колонки.Добавить("НДС", Новый ОписаниеТипов("Число"));
КоллекцияОбъектов.Колонки.Добавить("ДоговорКомиссии", Новый ОписаниеТипов("СправочникСсылка.ДоговорыКонтрагентов"));
КоллекцияОбъектов.Колонки.Добавить("Комитент", Новый ОписаниеТипов("СправочникСсылка.Контрагенты"));

ОстКоличествоПоПартиям = 0;
НоменклатураПред = "";
Для каждого СтрокаТаблицы ИЗ ТаблицаТоваров Цикл
	КоличествоПоСтроке = СтрокаТаблицы.Количество * СтрокаТаблицы.Коэффициент;
	ОстКоличествоПоСтроке = КоличествоПоСтроке;
	ОстПогСумма = СтрокаТаблицы.Сумма;
	ОстПогНДС = СтрокаТаблицы.СуммаНДС;
	Если НоменклатураПред &lt;&gt; СтрокаТаблицы.Номенклатура Тогда
		Индекс = 0;
		СтруктураПоиска = Новый Структура;
		СтруктураПоиска.Вставить("Номенклатура", СтрокаТаблицы.Номенклатура);
		МассивСтрок = ТаблицаПартий.НайтиСтроки(СтруктураПоиска);
	КонецЕсли;
	Если (ОстКоличествоПоПартиям = 0) ИЛИ (НоменклатураПред &lt;&gt; СтрокаТаблицы.Номенклатура) Тогда
		Если Индекс &lt;= МассивСтрок.ВГраница() Тогда
			СтрокаТаблицыПартий = МассивСтрок.Получить(Индекс);
			Индекс = Индекс + 1;
			ОстКоличествоПоПартиям = СтрокаТаблицыПартий.Количество * СтрокаТаблицы.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент;
		Иначе
			
			// Если не все количество распределилось по партиям все равно выгрузим количестово из документа
			СтрокаКоллекции = КоллекцияОбъектов.Добавить();
			СтрокаКоллекции.Товар = СтрокаТаблицы.Номенклатура;
			СтрокаКоллекции.ГТД = Новый Структура("Наименование,СтранаПроисхождения,Комментарий", СтрокаТаблицы.СерияНоменклатуры.НомерГТД.Код, СтрокаТаблицы.СерияНоменклатуры.СтранаПроисхождения.Наименование, СтрокаТаблицы.СерияНоменклатуры.НомерГТД.Комментарий);
			СтрокаКоллекции.Цена  = СтрокаТаблицы.Цена / СтрокаТаблицы.Коэффициент;
			СтрокаКоллекции.Количество = ОстКоличествоПоСтроке;
			СтрокаКоллекции.Сумма = ОстПогСумма;
			СтрокаКоллекции.НДС   = ОстПогНДС;
			Продолжить;
			
		КонецЕсли;
	КонецЕсли;
	СтрокаКоллекции = КоллекцияОбъектов.Добавить();
	СтрокаКоллекции.Товар = СтрокаТаблицы.Номенклатура;
	СтрокаКоллекции.ГТД = Новый Структура("Наименование,СтранаПроисхождения,Комментарий", СтрокаТаблицы.СерияНоменклатуры.НомерГТД.Код, СтрокаТаблицы.СерияНоменклатуры.СтранаПроисхождения.Наименование, СтрокаТаблицы.СерияНоменклатуры.НомерГТД.Комментарий);
	СтрокаКоллекции.Цена  = СтрокаТаблицы.Цена / СтрокаТаблицы.Коэффициент;
	СтрокаКоллекции.Количество = Мин(ОстКоличествоПоСтроке, ОстКоличествоПоПартиям);
	КоэффПогашения = СтрокаКоллекции.Количество / КоличествоПоСтроке;
	Если СтрокаКоллекции.Количество = ОстКоличествоПоСтроке Тогда
		СтрокаКоллекции.Сумма = ОстПогСумма;
		СтрокаКоллекции.НДС   = ОстПогНДС;
	Иначе
		СтрокаКоллекции.Сумма = СтрокаТаблицы.Сумма * КоэффПогашения;
		СтрокаКоллекции.НДС   = СтрокаТаблицы.СуммаНДС * КоэффПогашения;
	КонецЕсли;
	СтрокаКоллекции.Комитент  = СтрокаТаблицыПартий.Комитент;
	СтрокаКоллекции.ДоговорКомиссии = СтрокаТаблицыПартий.ДоговорКомиссии;
	ОстКоличествоПоСтроке  = ОстКоличествоПоСтроке - СтрокаКоллекции.Количество;
	ОстКоличествоПоПартиям = ОстКоличествоПоПартиям - СтрокаКоллекции.Количество;
	ОстПогСумма = ОстПогСумма - СтрокаКоллекции.Сумма;
	ОстПогНДС   = ОстПогНДС   - СтрокаКоллекции.НДС;
	НоменклатураПред = СтрокаТаблицы.Номенклатура;
КонецЦикла;

ТаблицаУслуг = Источник.Услуги.Выгрузить();
Для каждого СтрокаТаблицы Из ТаблицаУслуг Цикл
	СтрокаКоллекции = КоллекцияОбъектов.Добавить();
	СтрокаКоллекции.Товар      = СтрокаТаблицы.Номенклатура;
	СтрокаКоллекции.Цена       = СтрокаТаблицы.Цена;
	СтрокаКоллекции.Количество = СтрокаТаблицы.Количество;
	СтрокаКоллекции.Сумма      = СтрокаТаблицы.Сумма;
	СтрокаКоллекции.НДС        = СтрокаТаблицы.СуммаНДС;
КонецЦикла;

КоллекцияОбъектов.Свернуть("Товар, ГТД, Цена, Комитент, ДоговорКомиссии", "Количество, Сумма, НДС");</ПередОбработкойВыгрузки><Свойство><Код>20</Код><Наименование> --&gt; Товар</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Товар" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/><ПередВыгрузкой>ИсходящиеДанные = Новый Структура;
Если ОбъектКоллекции.Товар.Услуга Тогда
	ИсходящиеДанные.Вставить("ТипНоменклатуры", "Услуга");
	ИсходящиеДанные.Вставить("ТипТовара", "");
Иначе
	ИсходящиеДанные.Вставить("ТипНоменклатуры", "Товар");
	Если ОбъектКоллекции.Комитент = Справочники.Контрагенты.ПустаяСсылка() Тогда
		ИсходящиеДанные.Вставить("ТипТовара", "Собственный");
	
	Иначе
		ИсходящиеДанные.Вставить("ТипТовара", "НаКомиссии");
	КонецЕсли;
КонецЕсли;

</ПередВыгрузкой></Свойство><Свойство><Код>19</Код><Наименование>ГТД --&gt; ГТД</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="ГТД" Вид="Реквизит" Тип="СправочникСсылка.ГТД"/><КодПравилаКонвертации>ГТД                                               </КодПравилаКонвертации></Свойство><Свойство><Код>13</Код><Наименование> --&gt; ДоговорКомиссии</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="ДоговорКомиссии" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/></Свойство><Свойство><Код>12</Код><Наименование> --&gt; Комитент</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="Комитент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/></Свойство><Свойство><Код>6</Код><Наименование> --&gt; Количество</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>7</Код><Наименование> --&gt; Цена</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Цена" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетВРублиСуммыИсточника)</ПриВыгрузке></Свойство><Свойство><Код>8</Код><Наименование> --&gt; Сумма</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетВРублиСуммыИсточника)</ПриВыгрузке></Свойство><Свойство><Код>9</Код><Наименование> --&gt; НДС</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетВРублиСуммыИсточника)</ПриВыгрузке></Свойство><Свойство><Код>11</Код><Наименование> --&gt; Всего</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="Всего" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Выполнить(Алгоритмы.ПолучитьСуммуВсего);</ПередВыгрузкой><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетВРублиСуммыИсточника)</ПриВыгрузке></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>ПрочиеЗатраты</Код><Наименование>ДокументСсылка.ПрочиеЗатраты --&gt; ДокументСсылка.УслугиСтороннихОрганизаций</Наименование><Порядок>1800</Порядок><СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору><Источник>ДокументСсылка.ПрочиеЗатраты</Источник><Приемник>ДокументСсылка.УслугиСтороннихОрганизаций</Приемник><Свойства><Свойство><Код>22</Код><Наименование> --&gt; ДатаНомерСчетаФактуры</Наименование><Порядок>1100</Порядок><Источник/><Приемник Имя="ДатаНомерСчетаФактуры" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>СчетФактура = НайтиПодчиненныйДокумент(Источник, "СчетФактураПолученный");

Если СчетФактура = Неопределено Тогда
	Отказ = Истина;
	
Иначе
    ДатаСФ = Формат(СчетФактура.Дата, "ДЛФ=Д");
	Если ДатаСФ &lt;&gt; Формат(Источник.Дата, "ДЛФ=Д") Тогда
		Отказ = Истина;
		
	Иначе
		Значение = ДатаСФ + " " + ?(ЗначениеНеЗаполнено(СчетФактура.НомерВходящегоДокумента), СчетФактура.Номер, СчетФактура.НомерВходящегоДокумента);
	КонецЕсли;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>23</Код><Наименование> --&gt; ВариантРасчетаНалогов</Наименование><Порядок>1200</Порядок><Источник/><Приемник Имя="ВариантРасчетаНалогов" Вид="Реквизит" Тип="СправочникСсылка.ВариантыРасчетаНалогов"/><КодПравилаКонвертации>ВариантыРасчетаНалогов                            </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("СуммаВключаетНДС, СуммаВключаетНП, УчитыватьНДС, УчитыватьНП");
Значение.СуммаВключаетНДС = Источник.СуммаВключаетНДС;
Значение.СуммаВключаетНП  = Источник.СуммаВключаетНП;
Значение.УчитыватьНДС = Источник.УчитыватьНДС;
Значение.УчитыватьНП  = Источник.УчитыватьНП;</ПередВыгрузкой></Свойство><Свойство><Код>9</Код><Наименование>КурсДокумента --&gt; Курс</Наименование><Порядок>900</Порядок><Источник Имя="КурсДокумента" Вид="Реквизит" Тип="Число"/><Приемник Имя="Курс" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>8</Код><Наименование>КурсВзаиморасчетов --&gt; Курс</Наименование><Порядок>800</Порядок><Источник Имя="КурсВзаиморасчетов" Вид="Реквизит" Тип="Число"/><Приемник Имя="Курс" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>7</Код><Наименование>НомерВходящегоДокумента --&gt; НомерДокВходящий</Наименование><Порядок>700</Порядок><Источник Имя="НомерВходящегоДокумента" Вид="Реквизит" Тип="Строка"/><Приемник Имя="НомерДокВходящий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>6</Код><Наименование>Контрагент --&gt; Контрагент</Наименование><Порядок>600</Порядок><Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации><ПередВыгрузкой>Если Параметры.ВыгружатьЮрФизЛиц Тогда
	Значение = Источник.ЮрФизЛицоКонтрагента;
	ИсходящиеДанные = Новый Структура;
	ИсходящиеДанные.Вставить("ЮрФизЛицоКонтрагента", Источник.ЮрФизЛицоКонтрагента);
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>5</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>500</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>4</Код><Наименование>ДоговорВзаиморасчетов --&gt; Договор</Наименование><Порядок>400</Порядок><Источник Имя="ДоговорВзаиморасчетов" Вид="Реквизит" Тип="СправочникСсылка.ДоговорыВзаиморасчетов"/><Приемник Имя="Договор" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство><Код>3</Код><Наименование>ВалютаДокумента --&gt; Валюта</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Валюта" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/><КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации><ПередВыгрузкой>Значение = Константы.ВалютаУправленческогоУчета.Получить();</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>2</Код><Наименование>Номер --&gt; НомерДок</Наименование><Порядок>200</Порядок><Источник Имя="Номер" Вид="Свойство" Тип="Строка"/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/></Свойство><Свойство Поиск="true"><Код>1</Код><Наименование>Дата --&gt; ДатаДок</Наименование><Порядок>100</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Группа><Код>10</Код><Наименование> --&gt; ТабличнаяЧасть</Наименование><Порядок>1000</Порядок><Источник Имя="Затраты" Вид="ТабличнаяЧасть"/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><ПередОбработкойВыгрузки>КоллекцияОбъектов = Новый ТаблицаЗначений;
КоллекцияОбъектов.Колонки.Добавить("НаименованиеУслуги");
КоллекцияОбъектов.Колонки.Добавить("КоррСчет");
КоллекцияОбъектов.Колонки.Добавить("Субконто1");
КоллекцияОбъектов.Колонки.Добавить("Субконто2");
КоллекцияОбъектов.Колонки.Добавить("Субконто3");
КоллекцияОбъектов.Колонки.Добавить("Количество");
КоллекцияОбъектов.Колонки.Добавить("Всего");
КоллекцияОбъектов.Колонки.Добавить("НДС");
КоллекцияОбъектов.Колонки.Добавить("Сумма");
КоллекцияОбъектов.Колонки.Добавить("ТранспортныеРасходы");

Для каждого СтрокаТЧ из Источник.Затраты Цикл
	СтрокаКоллекции = КоллекцияОбъектов.Добавить();
	СтрокаКоллекции.НаименованиеУслуги = СтрокаТЧ.Содержание;
	ВидРасхода = СтрокаТЧ.СтатьяЗатрат.ВидРасхода;
	Если ВидРасхода = Перечисления.ВидыРасходов.Производственные Тогда
		СтрокаКоллекции.КоррСчет  = "20";  
		СтруктураСубконто1 = Новый Структура("Наименование, ТипНоменклатуры");
		СтруктураСубконто1.Наименование = "Товар";
		СтруктураСубконто1.ТипНоменклатуры = "Товар";
		СтрокаКоллекции.Субконто1 = СтруктураСубконто1;
		СтрокаКоллекции.Субконто2 = СтрокаТЧ.СтатьяЗатрат.Наименование;
		//СтрокаКоллекции.Субконто3 = СтрокаТЧ.ПодразделениеЗатраты;
	ИначеЕсли ВидРасхода = Перечисления.ВидыРасходов.Общепроизводственные Тогда
		СтрокаКоллекции.КоррСчет = "25";
		СтрокаКоллекции.Субконто1 = СтрокаТЧ.СтатьяЗатрат.Наименование;
		//СтрокаКоллекции.Субконто2 = СтрокаТЧ.ПодразделениеЗатраты;
	ИначеЕсли ВидРасхода = Перечисления.ВидыРасходов.Общехозяйственные Тогда
		СтрокаКоллекции.КоррСчет = "26";
		СтрокаКоллекции.Субконто1 = СтрокаТЧ.СтатьяЗатрат.Наименование;
		//СтрокаКоллекции.Субконто2 = СтрокаТЧ.ПодразделениеЗатраты;
	ИначеЕсли ВидРасхода = Перечисления.ВидыРасходов.Коммерческие Тогда
		СтрокаКоллекции.КоррСчет = "44.2";
		СтрокаКоллекции.Субконто1 = СтрокаТЧ.СтатьяЗатрат.Наименование;
	ИначеЕсли ВидРасхода = Перечисления.ВидыРасходов.ИздержкиОбращения Тогда
		СтрокаКоллекции.КоррСчет = "44.1.3";
		СтрокаКоллекции.Субконто1 = СтрокаТЧ.СтатьяЗатрат.Наименование;
	КонецЕсли;
	СтрокаКоллекции.Количество = СтрокаТЧ.Количество;
	СтрокаКоллекции.Сумма      = СтрокаТЧ.Сумма;
	СтрокаКоллекции.НДС        = СтрокаТЧ.СуммаНДС;
	
КонецЦикла;
</ПередОбработкойВыгрузки><Свойство><Код>12</Код><Наименование> --&gt; КоррСчет</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="КоррСчет" Вид="Реквизит"/><ПередВыгрузкой>ТипПриемника = "ПланСчетовСсылка.Основной";</ПередВыгрузкой></Свойство><Свойство><Код>13</Код><Наименование> --&gt; Субконто1</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Субконто1" Вид="Реквизит"/><ПередВыгрузкой>	Если ОбъектКоллекции.КоррСчет  = "20" Тогда
		ИмяПКО = "ВидыНоменклатуры";
	ИначеЕсли ОбъектКоллекции.КоррСчет = "25" Тогда
		ИмяПКО = "СтатьиОбщепроизводственныхЗатрат";
	ИначеЕсли ОбъектКоллекции.КоррСчет = "26" Тогда
		ИмяПКО = "СтатьиОбщехозяйственныхЗатрат";
	ИначеЕсли ОбъектКоллекции.КоррСчет = "44.2" Тогда
		ИмяПКО = "СтатьиКоммерческихРасходов";
	ИначеЕсли ОбъектКоллекции.КоррСчет = "44.1.3" ИЛИ
		      ОбъектКоллекции.КоррСчет = "44.1.1" Тогда
		ИмяПКО = "СтатьиИздержекОбращения";
	КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>14</Код><Наименование> --&gt; Субконто2</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="Субконто2" Вид="Реквизит"/><ПередВыгрузкой>Если ОбъектКоллекции.КоррСчет  = "20" Тогда
	ИмяПКО = "СтатьиЗатратНаПроизводство";
	ИначеЕсли ОбъектКоллекции.КоррСчет = "25" Тогда
		ИмяПКО = "Подразделения";
	ИначеЕсли ОбъектКоллекции.КоррСчет = "26" Тогда
		ИмяПКО = "Подразделения";
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>15</Код><Наименование> --&gt; Субконто3</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="Субконто3" Вид="Реквизит"/><ПередВыгрузкой>Если ОбъектКоллекции.КоррСчет  = "20" Тогда
	ИмяПКО = "Подразделения";
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>16</Код><Наименование> --&gt; Количество</Наименование><Порядок>600</Порядок><Источник/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>17</Код><Наименование> --&gt; Всего</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="Всего" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если Не Источник.СуммаВключаетНДС Тогда
	Значение = ОбъектКоллекции.Сумма + ОбъектКоллекции.НДС;
Иначе
	Значение = ОбъектКоллекции.Сумма;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>18</Код><Наименование> --&gt; НДС</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>20</Код><Наименование> --&gt; Сумма</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>21</Код><Наименование> --&gt; ТранспортныеРасходы</Наименование><Порядок>1100</Порядок><Источник/><Приемник Имя="ТранспортныеРасходы" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>11</Код><Наименование> --&gt; НаименованиеУслуги</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="НаименованиеУслуги" Вид="Реквизит" Тип="Строка"/></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>РасходнаяНакладная</Код><Наименование>ДокументСсылка.РеализацияТоваров --&gt; ДокументСсылка.РасходнаяНакладная</Наименование><Порядок>1350</Порядок><ПередВыгрузкой>КлючВыгружаемыхДанных = ЗначениеВСтрокуВнутр(Источник) + ИмяПКО;</ПередВыгрузкой><Источник>ДокументСсылка.РеализацияТоваровУслуг</Источник><Приемник>ДокументСсылка.РасходнаяНакладная</Приемник><Свойства><Свойство><Код>26</Код><Наименование> --&gt; НДСвключатьВСтоимость</Наименование><Порядок>1600</Порядок><Источник/><Приемник Имя="НДСвключатьВСтоимость" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Выполнить(Алгоритмы.НДСвключатьВСтоимость);</ПередВыгрузкой></Свойство><Свойство><Код>25</Код><Наименование>ТипЦен --&gt; ТипЦен</Наименование><Порядок>1500</Порядок><Источник Имя="ТипЦен" Вид="Реквизит" Тип="СправочникСсылка.ТипыЦенНоменклатуры"/><Приемник Имя="ТипЦен" Вид="Реквизит" Тип="СправочникСсылка.ТипыЦен"/></Свойство><Свойство><Код>24</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>1400</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>23</Код><Наименование> --&gt; ВерсияОбъекта</Наименование><Порядок>1200</Порядок><Источник/><Приемник Имя="ВерсияОбъекта" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Значение = "7.70.447"</ПередВыгрузкой></Свойство><Свойство><Код>22</Код><Наименование> --&gt; РасчетныйСчет</Наименование><Порядок>1100</Порядок><Источник/><Приемник Имя="РасчетныйСчет" Вид="Реквизит" Тип="СправочникСсылка.БанковскиеСчета"/><КодПравилаКонвертации>БанковскиеСчета                                   </КодПравилаКонвертации><ПередВыгрузкой>Значение = Источник.Организация.ОсновнойБанковскийСчет;</ПередВыгрузкой></Свойство><Свойство><Код>21</Код><Наименование> --&gt; ВариантРасчетаНалогов</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="ВариантРасчетаНалогов" Вид="Реквизит" Тип="СправочникСсылка.ВариантыРасчетаНалогов"/><КодПравилаКонвертации>ВариантыРасчетаНалогов                            </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("СуммаВключаетНДС, СуммаВключаетНП, УчитыватьНДС, УчитыватьНП");
Значение.СуммаВключаетНДС = Источник.СуммаВключаетНДС;
Значение.СуммаВключаетНП  = Ложь;
Значение.УчитыватьНДС = Источник.УчитыватьНДС;
Значение.УчитыватьНП  = Ложь;</ПередВыгрузкой></Свойство><Свойство><Код>20</Код><Наименование> --&gt; Курс</Наименование><Порядок>900</Порядок><Источник Имя="КурсВзаиморасчетов" Вид="Реквизит" Тип="Число"/><Приемник Имя="Курс" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>19</Код><Наименование> --&gt; ЗачитыватьАванс</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="ЗачитыватьАванс" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 2;</ПередВыгрузкой></Свойство><Свойство><Код>18</Код><Наименование> --&gt; ВидОтгрузки</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="ВидОтгрузки" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = ?(Источник.ДоговорКонтрагента.ВидДоговора = Перечисления.ВидыДоговоровКонтрагентов.СКомиссионером, 2, 1);</ПередВыгрузкой></Свойство><Свойство><Код>17</Код><Наименование> --&gt; МестоХранения</Наименование><Порядок>600</Порядок><Источник Имя="Склад" Вид="Реквизит" Тип="СправочникСсылка.Склады"/><Приемник Имя="МестоХранения" Вид="Реквизит" Тип="СправочникСсылка.МестаХранения"/><КодПравилаКонвертации>МестаХранения                                     </КодПравилаКонвертации></Свойство><Свойство><Код>16</Код><Наименование> --&gt; Договор</Наименование><Порядок>500</Порядок><Источник Имя="ДоговорКонтрагента" Вид="Реквизит" Тип="СправочникСсылка.ДоговорыКонтрагентов"/><Приемник Имя="Договор" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство><Код>15</Код><Наименование>УчитыватьНП --&gt; УчитыватьНП</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="УчитыватьНП" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = Ложь;</ПередВыгрузкой></Свойство><Свойство><Код>14</Код><Наименование>Контрагент --&gt; Контрагент</Наименование><Порядок>300</Порядок><Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство Поиск="true"><Код>1</Код><Наименование>Дата --&gt;</Наименование><Порядок>100</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство Поиск="true"><Код>2</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "Р", 6, "Справа");</ПередВыгрузкой></Свойство><Группа><Код>3</Код><Наименование>Товары --&gt; ТабличнаяЧасть</Наименование><Порядок>1300</Порядок><Источник Имя="Товары" Вид="ТабличнаяЧасть"/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><ПередОбработкойВыгрузки>Запросы.ТабличнаяЧастьРеализации.УстановитьПараметр("ПустойКомитент", Справочники.Контрагенты.ПустаяСсылка());
Запросы.ТабличнаяЧастьРеализации.УстановитьПараметр("ПустойДоговорКомиссии", Справочники.ДоговорыКонтрагентов.ПустаяСсылка());
Запросы.ТабличнаяЧастьРеализации.УстановитьПараметр("ТоварПринятыйКомиссия", Перечисления.СтатусыПартийТоваров.НаКомиссию);
Запросы.ТабличнаяЧастьРеализации.УстановитьПараметр("Источник", Источник);
ТаблицаТоваров   = Источник.Товары.Выгрузить();

ТаблицаПартий    = Запросы.ТабличнаяЧастьРеализации.Выполнить().Выгрузить();
ТаблицаПартий.Свернуть("Номенклатура, Комитент, ДоговорКомиссии", "Количество");

КоллекцияОбъектов = Новый ТаблицаЗначений;
КоллекцияОбъектов.Колонки.Добавить("Товар", Новый ОписаниеТипов("СправочникСсылка.Номенклатура"));
КоллекцияОбъектов.Колонки.Добавить("Цена", Новый ОписаниеТипов("Число"));
КоллекцияОбъектов.Колонки.Добавить("ГТД");
КоллекцияОбъектов.Колонки.Добавить("Количество", Новый ОписаниеТипов("Число"));
КоллекцияОбъектов.Колонки.Добавить("Сумма", Новый ОписаниеТипов("Число"));
КоллекцияОбъектов.Колонки.Добавить("НДС", Новый ОписаниеТипов("Число"));
КоллекцияОбъектов.Колонки.Добавить("ДоговорКомиссии", Новый ОписаниеТипов("СправочникСсылка.ДоговорыКонтрагентов"));
КоллекцияОбъектов.Колонки.Добавить("Комитент", Новый ОписаниеТипов("СправочникСсылка.Контрагенты"));

ОстКоличествоПоПартиям = 0;
НоменклатураПред = "";
НомерСтрокиПред = 0;
Для каждого СтрокаТаблицы ИЗ ТаблицаТоваров Цикл
	КоличествоПоСтроке = СтрокаТаблицы.Количество * СтрокаТаблицы.Коэффициент;
	ОстКоличествоПоСтроке = КоличествоПоСтроке;
	ОстПогСумма = СтрокаТаблицы.Сумма;
	ОстПогНДС = СтрокаТаблицы.СуммаНДС;
	Если НоменклатураПред &lt;&gt; СтрокаТаблицы.Номенклатура Тогда
		Индекс = 0;
		СтруктураПоиска = Новый Структура;
		СтруктураПоиска.Вставить("Номенклатура", СтрокаТаблицы.Номенклатура);
		МассивСтрок = ТаблицаПартий.НайтиСтроки(СтруктураПоиска);
	КонецЕсли;
	Пока 1 = 1 Цикл
		Если (ОстКоличествоПоПартиям = 0) ИЛИ (НоменклатураПред &lt;&gt; СтрокаТаблицы.Номенклатура) Тогда
			Если Индекс &lt;= МассивСтрок.ВГраница()Тогда
				СтрокаТаблицыПартий = МассивСтрок.Получить(Индекс);
				Индекс = Индекс + 1;
				ОстКоличествоПоПартиям = СтрокаТаблицыПартий.Количество * СтрокаТаблицы.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент;
			Иначе
				
				// Если не все количество распределилось по партиям все равно выгрузим количестово из документа
				СтрокаКоллекции = КоллекцияОбъектов.Добавить();
				СтрокаКоллекции.Товар = СтрокаТаблицы.Номенклатура;
				СтрокаКоллекции.ГТД = Новый Структура("Наименование,СтранаПроисхождения,Комментарий", СтрокаТаблицы.СерияНоменклатуры.НомерГТД.Код, СтрокаТаблицы.СерияНоменклатуры.СтранаПроисхождения.Наименование, СтрокаТаблицы.СерияНоменклатуры.НомерГТД.Комментарий);
				Если ЗначениеНеЗаполнено(СтрокаТаблицы.ПроцентСкидкиНаценки) И ЗначениеНеЗаполнено(СтрокаТаблицы.ПроцентАвтоматическихСкидок) Тогда
					СтрокаКоллекции.Цена  = СтрокаТаблицы.Цена / СтрокаТаблицы.Коэффициент;
				Иначе
					СтрокаКоллекции.Цена  = СтрокаТаблицы.Сумма / СтрокаТаблицы.Количество / СтрокаТаблицы.Коэффициент;
				КонецЕсли;
				СтрокаКоллекции.Количество = ОстКоличествоПоСтроке;
				СтрокаКоллекции.Сумма = ОстПогСумма;
				СтрокаКоллекции.НДС   = ОстПогНДС;
				ОстКоличествоПоСтроке  = ОстКоличествоПоСтроке - СтрокаКоллекции.Количество;
				Прервать;
				
			КонецЕсли;
		КонецЕсли;
		
		Если ОстКоличествоПоСтроке = 0 Тогда
			Продолжить;
		КонецЕсли;
		
		СтрокаКоллекции = КоллекцияОбъектов.Добавить();
		СтрокаКоллекции.Товар = СтрокаТаблицы.Номенклатура;
		СтрокаКоллекции.ГТД = Новый Структура("Наименование,СтранаПроисхождения,Комментарий", СтрокаТаблицы.СерияНоменклатуры.НомерГТД.Код, СтрокаТаблицы.СерияНоменклатуры.СтранаПроисхождения.Наименование, СтрокаТаблицы.СерияНоменклатуры.НомерГТД.Комментарий);
		Если ЗначениеНеЗаполнено(СтрокаТаблицы.ПроцентСкидкиНаценки) И ЗначениеНеЗаполнено(СтрокаТаблицы.ПроцентАвтоматическихСкидок) Тогда
			СтрокаКоллекции.Цена  = СтрокаТаблицы.Цена / СтрокаТаблицы.Коэффициент;
		Иначе
			СтрокаКоллекции.Цена  = СтрокаТаблицы.Сумма / СтрокаТаблицы.Количество / СтрокаТаблицы.Коэффициент;
		КонецЕсли;
		СтрокаКоллекции.Количество = Мин(ОстКоличествоПоСтроке, ОстКоличествоПоПартиям);
		КоэффПогашения = СтрокаКоллекции.Количество / КоличествоПоСтроке;
		Если СтрокаКоллекции.Количество = ОстКоличествоПоСтроке Тогда
			СтрокаКоллекции.Сумма = ОстПогСумма;
			СтрокаКоллекции.НДС   = ОстПогНДС;
		Иначе
			СтрокаКоллекции.Сумма = СтрокаТаблицы.Сумма * КоэффПогашения;
			СтрокаКоллекции.НДС   = СтрокаТаблицы.СуммаНДС * КоэффПогашения;
		КонецЕсли;
		СтрокаКоллекции.Комитент  = СтрокаТаблицыПартий.Комитент;
		СтрокаКоллекции.ДоговорКомиссии = СтрокаТаблицыПартий.ДоговорКомиссии;
		ОстКоличествоПоСтроке  = ОстКоличествоПоСтроке - СтрокаКоллекции.Количество;
		ОстКоличествоПоПартиям = ОстКоличествоПоПартиям - СтрокаКоллекции.Количество;
		ОстПогСумма = ОстПогСумма - СтрокаКоллекции.Сумма;
		ОстПогНДС   = ОстПогНДС   - СтрокаКоллекции.НДС;
		НоменклатураПред = СтрокаТаблицы.Номенклатура;
		НомерСтрокиПред  = СтрокаТаблицы.НомерСтроки;
		Если ОстКоличествоПоСтроке &lt;= 0 Тогда
			Прервать;
		КонецЕсли;
	КонецЦикла;
	
КонецЦикла;

ТаблицаУслуг = Источник.Услуги.Выгрузить();
Для каждого СтрокаТаблицы Из ТаблицаУслуг Цикл
	СтрокаКоллекции = КоллекцияОбъектов.Добавить();
	СтрокаКоллекции.Товар      = СтрокаТаблицы.Номенклатура;
	СтрокаКоллекции.Цена       = СтрокаТаблицы.Цена;
	СтрокаКоллекции.Количество = СтрокаТаблицы.Количество;
	СтрокаКоллекции.Сумма      = СтрокаТаблицы.Сумма;
	СтрокаКоллекции.НДС        = СтрокаТаблицы.СуммаНДС;
КонецЦикла;

КоллекцияОбъектов.Свернуть("Товар, ГТД, Цена, Комитент, ДоговорКомиссии", "Количество, Сумма, НДС");</ПередОбработкойВыгрузки><Свойство><Код>9</Код><Наименование> --&gt; НДС</Наименование><Порядок>600</Порядок><Источник/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>11</Код><Наименование> --&gt; Всего</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="Всего" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Выполнить(Алгоритмы.ПолучитьСуммуВсего);</ПередВыгрузкой><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>13</Код><Наименование> --&gt; ДоговорКомиссии</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="ДоговорКомиссии" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство><Код>12</Код><Наименование> --&gt; Комитент</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="Комитент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство><Код>4</Код><Наименование> --&gt; Товар</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Товар" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/><КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации><ПередВыгрузкой>ИсходящиеДанные = Новый Структура;
Если ОбъектКоллекции.Товар.Услуга Тогда
	ИсходящиеДанные.Вставить("ТипНоменклатуры", "Услуга");
	ИсходящиеДанные.Вставить("ТипТовара", "");
Иначе
	ИсходящиеДанные.Вставить("ТипНоменклатуры", "Товар");
	Если ОбъектКоллекции.Комитент = Справочники.Контрагенты.ПустаяСсылка() Тогда
		ИсходящиеДанные.Вставить("ТипТовара", "Собственный");
		
	Иначе
		ИсходящиеДанные.Вставить("ТипТовара", "НаКомиссии");
	КонецЕсли;
КонецЕсли;

</ПередВыгрузкой></Свойство><Свойство><Код>5</Код><Наименование>Количество --&gt; Количество</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>6</Код><Наименование>Цена --&gt; Цена</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Цена" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>7</Код><Наименование>Сумма --&gt; Сумма</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>8</Код><Наименование>ГТД --&gt; ГТД</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="ГТД" Вид="Реквизит" Тип="СправочникСсылка.ГТД"/><КодПравилаКонвертации>ГТД                                               </КодПравилаКонвертации></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>РасходныйОрдер</Код><Наименование>ДокументСсылка.РасходныйКассовыйОрдер --&gt; ДокументСсылка.РасходныйОрдер</Наименование><Порядок>2000</Порядок><Источник>ДокументСсылка.РасходныйКассовыйОрдер</Источник><Приемник>ДокументСсылка.РасходныйОрдер</Приемник><Свойства><Свойство><Код>1</Код><Наименование>Выдать --&gt; Выдать</Наименование><Порядок>100</Порядок><Источник Имя="Выдать" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Выдать" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>2</Код><Наименование>Основание --&gt; Основание</Наименование><Порядок>200</Порядок><Источник Имя="Основание" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Основание" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>3</Код><Наименование>Приложение --&gt; Приложение</Наименование><Порядок>300</Порядок><Источник Имя="Приложение" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Приложение" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>4</Код><Наименование>ПоДокументу --&gt; ПоДокументу</Наименование><Порядок>400</Порядок><Источник Имя="ПоДокументу" Вид="Реквизит" Тип="Строка"/><Приемник Имя="ПоДокументу" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство Поиск="true"><Код>5</Код><Наименование> --&gt; ДатаДок</Наименование><Порядок>500</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство Поиск="true"><Код>6</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>600</Порядок><Источник Имя="Номер" Вид="Свойство" Тип="Строка"/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "", 6, "Справа");
</ПередВыгрузкой></Свойство><Свойство><Код>7</Код><Наименование> --&gt; КоррСчет</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="КоррСчет" Вид="Реквизит"/><ПередВыгрузкой>ТипПриемника = "ПланСчетовСсылка.Основной";

Если Источник.ВидОперации = Перечисления.ВидыОперацийРКО.ОплатаПоставщику Тогда
	Если Источник.ВалютаДокумента &lt;&gt; Константы.ВалютаРегламентированногоУчета.Получить() Тогда
        Значение = "60.11";
		
	Иначе
		Значение = "60.1";
	КонецЕсли;
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийРКО.ВозвратДенежныхСредствПокупателю Тогда
	Если Источник.ВалютаДокумента &lt;&gt; Константы.ВалютаРегламентированногоУчета.Получить() Тогда
        Значение = "62.22";
		
	Иначе
		Значение = "62.2";
	КонецЕсли;
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийРКО.ВыдачаДенежныхСредствПодотчетнику Тогда
	Если Источник.ВалютаДокумента &lt;&gt; Константы.ВалютаРегламентированногоУчета.Получить() Тогда
        Значение = "71.11";
		
	Иначе
		Значение = "71.1";
	КонецЕсли;
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийРКО.ПрочиеРасчетыСКонтрагентами Тогда
	Если Источник.ВалютаДокумента &lt;&gt; Константы.ВалютаРегламентированногоУчета.Получить() Тогда
        Значение = "76.55";
		
	Иначе
		Значение = "76.5";
	КонецЕсли;
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийРКО.РасходДенежныхСредствПрочее Тогда
	Отказ = Истина;
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийРКО.ВыдачаДенежныхСредствКассеККМ Тогда
	Значение = "50.2";
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>11</Код><Наименование> --&gt; Сумма</Наименование><Порядок>1100</Порядок><Источник/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = Источник.СуммаДокумента;</ПередВыгрузкой></Свойство><Свойство><Код>13</Код><Наименование> --&gt; ФормироватьПроводки</Наименование><Порядок>1300</Порядок><Источник/><Приемник Имя="ФормироватьПроводки" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 1;</ПередВыгрузкой></Свойство><Свойство><Код>14</Код><Наименование> --&gt; Валютный</Наименование><Порядок>1400</Порядок><Источник/><Приемник Имя="Валютный" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если Источник.ВалютаДокумента &lt;&gt; Константы.ВалютаРегламентированногоУчета.Получить() Тогда
	Значение = 2;
	
Иначе
	Значение = 1;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>15</Код><Наименование> --&gt; Валюта</Наименование><Порядок>1500</Порядок><Источник Имя="ВалютаДокумента" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/><Приемник Имя="Валюта" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/><КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации></Свойство><Свойство><Код>16</Код><Наименование> --&gt; ДвижениеДенежныхСредств</Наименование><Порядок>1600</Порядок><Источник/><Приемник Имя="ДвижениеДенежныхСредств" Вид="Реквизит" Тип="СправочникСсылка.ДвиженияДенежныхСредств"/><КодПравилаКонвертации>ДвиженияДенежныхСредств                           </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("Наименование, ВидДвижения");

Если Источник.ВидОперации = Перечисления.ВидыОперацийРКО.ОплатаПоставщику Тогда
	Значение.Наименование = "Оплата поставщику";
	Значение.ВидДвижения  = "ПриобретениеТоваровПродукцииРаботИУслуг";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийРКО.ВозвратДенежныхСредствПокупателю Тогда
	Значение.Наименование = "Прочие выплаты";
	Значение.ВидДвижения  = "ПрочиеВыплатыИПеречисления";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийРКО.ВыдачаДенежныхСредствПодотчетнику Тогда
	Значение.Наименование = "Выдача под авансовый отчет";
	Значение.ВидДвижения  = "ВыданныеПодотчетныеСуммы";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийРКО.РасходДенежныхСредствПрочее Тогда
	Значение.Наименование = "Прочие выплаты";
	Значение.ВидДвижения  = "ПрочиеВыплатыИПеречисления";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийРКО.ВыдачаДенежныхСредствКассеККМ Тогда
	Значение.Наименование = "Прочие выплаты";
	Значение.ВидДвижения  = "ПрочиеВыплатыИПеречисления";
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>17</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>1700</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>8</Код><Наименование> --&gt; Субконто1</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="Субконто1" Вид="Реквизит"/><ПередВыгрузкой>Если Источник.ВидОперации = Перечисления.ВидыОперацийРКО.ОплатаПоставщику  
 ИЛИ Источник.ВидОперации = Перечисления.ВидыОперацийРКО.ПрочиеРасчетыСКонтрагентами Тогда
	Значение = Источник.Контрагент;
	ИмяПКО = "Контрагенты";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийРКО.ВозвратДенежныхСредствПокупателю Тогда
	Значение = Источник.Контрагент;
	ИмяПКО = "Контрагенты";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийРКО.ВыдачаДенежныхСредствПодотчетнику Тогда
	Значение = Источник.Контрагент;
	ИмяПКО = "Сотрудники";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийРКО.РасходДенежныхСредствПрочее Тогда
	Отказ = Истина;
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийРКО.ВыдачаДенежныхСредствКассеККМ Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>9</Код><Наименование> --&gt; Субконто2</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="Субконто2" Вид="Реквизит"/><ПередВыгрузкой>Если Источник.ВидОперации = Перечисления.ВидыОперацийРКО.ОплатаПоставщику 
 ИЛИ Источник.ВидОперации = Перечисления.ВидыОперацийРКО.ПрочиеРасчетыСКонтрагентами Тогда
	Значение = Источник.РасшифровкаПлатежа[0].ДоговорКонтрагента;
	Для каждого СтрокаРасшифровки из Источник.РасшифровкаПлатежа Цикл
		Если СтрокаРасшифровки.ДоговорКонтрагента &lt;&gt; Значение Тогда
			Пусто = Истина;
			Прервать;
		КонецЕсли;
	КонецЦикла;
	ИмяПКО = "Договоры";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийРКО.ВозвратДенежныхСредствПокупателю Тогда
	Значение = Источник.РасшифровкаПлатежа[0].ДоговорКонтрагента;
	Для каждого СтрокаРасшифровки из Источник.РасшифровкаПлатежа Цикл
		Если СтрокаРасшифровки.ДоговорКонтрагента &lt;&gt; Значение Тогда
			Пусто = Истина;
			Прервать;
		КонецЕсли;
	КонецЦикла;
	ИмяПКО = "Договоры";
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийРКО.ВыдачаДенежныхСредствПодотчетнику Тогда
	Отказ = Истина;
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийРКО.РасходДенежныхСредствПрочее Тогда
	Отказ = Истина;
	
ИначеЕсли Источник.ВидОперации = Перечисления.ВидыОперацийРКО.ВыдачаДенежныхСредствКассеККМ Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>18</Код><Наименование>КурсВзаиморасчетов --&gt; КурсОплаты</Наименование><Порядок>1800</Порядок><Источник Имя="КурсВзаиморасчетов" Вид="Реквизит" Тип="Число"/><Приемник Имя="КурсОплаты" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = Источник.РасшифровкаПлатежа[0].КурсВзаиморасчетов;</ПередВыгрузкой></Свойство></Свойства><Значения/></Правило><Правило><Код>РеализацияОтгруженнойПродукции</Код><Наименование>ДокументСсылка.ОтчетКомиссионераОПродажах --&gt; ДокументСсылка.РеализацияОтгруженнойПродукции</Наименование><Порядок>1400</Порядок><Источник>ДокументСсылка.ОтчетКомиссионераОПродажах</Источник><Приемник>ДокументСсылка.РеализацияОтгруженнойПродукции</Приемник><Свойства><Свойство><Код>14</Код><Наименование> --&gt; Договор</Наименование><Порядок>400</Порядок><Источник Имя="ДоговорКонтрагента" Вид="Реквизит" Тип="СправочникСсылка.ДоговорыКонтрагентов"/><Приемник Имя="Договор" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство Поиск="true"><Код>13</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "", 6, "");</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>12</Код><Наименование> --&gt; ДатаДок</Наименование><Порядок>100</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство><Код>1</Код><Наименование>Контрагент --&gt; Контрагент</Наименование><Порядок>300</Порядок><Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство><Код>16</Код><Наименование> --&gt; ЗачитыватьАванс</Наименование><Порядок>600</Порядок><Источник/><Приемник Имя="ЗачитыватьАванс" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 2;</ПередВыгрузкой></Свойство><Свойство><Код>17</Код><Наименование> --&gt; ВариантРасчетаНалогов</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="ВариантРасчетаНалогов" Вид="Реквизит" Тип="СправочникСсылка.ВариантыРасчетаНалогов"/><КодПравилаКонвертации>ВариантыРасчетаНалогов                            </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("СуммаВключаетНДС, СуммаВключаетНП, УчитыватьНДС, УчитыватьНП");
Значение.СуммаВключаетНДС = Источник.СуммаВключаетНДС;
Значение.СуммаВключаетНП  = 0;
Значение.УчитыватьНДС = Источник.УчитыватьНДС;
Значение.УчитыватьНП  = 0;</ПередВыгрузкой></Свойство><Свойство><Код>18</Код><Наименование> --&gt; Курс</Наименование><Порядок>800</Порядок><Источник Имя="КурсВзаиморасчетов" Вид="Реквизит" Тип="Число"/><Приемник Имя="Курс" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>19</Код><Наименование> --&gt; ВерсияОбъекта</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="ВерсияОбъекта" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Значение = "7.70.447"</ПередВыгрузкой></Свойство><Свойство><Код>20</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>1100</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Группа><Код>2</Код><Наименование> --&gt; ТабличнаяЧасть</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><ПередОбработкойВыгрузки>Запросы.ТабличнаяЧастьРеализацииОтгруженнойПродукции.УстановитьПараметр("ПустойКомитент", Справочники.Контрагенты.ПустаяСсылка());
Запросы.ТабличнаяЧастьРеализацииОтгруженнойПродукции.УстановитьПараметр("ПустойДоговорКомиссии", Справочники.ДоговорыКонтрагентов.ПустаяСсылка());
Запросы.ТабличнаяЧастьРеализацииОтгруженнойПродукции.УстановитьПараметр("ТоварПринятыйКомиссия", Перечисления.СтатусыПартийТоваров.НаКомиссию);
Запросы.ТабличнаяЧастьРеализацииОтгруженнойПродукции.УстановитьПараметр("Источник", Источник);
КоллекцияОбъектов = Запросы.ТабличнаяЧастьРеализацииОтгруженнойПродукции.Выполнить().Выгрузить();
</ПередОбработкойВыгрузки><Свойство><Код>11</Код><Наименование> --&gt; ДоговорКомиссии</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="ДоговорКомиссии" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство><Код>10</Код><Наименование> --&gt; Комитент</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="Комитент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство><Код>9</Код><Наименование> --&gt; Всего</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="Всего" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если Не Источник.СуммаВключаетНДС Тогда
	Значение = ОбъектКоллекции.Сумма + ОбъектКоллекции.НДС;
	
Иначе
	Значение = ОбъектКоллекции.Сумма;
КонецЕсли;</ПередВыгрузкой><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>7</Код><Наименование> --&gt; НДС</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>6</Код><Наименование> --&gt; Сумма</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>5</Код><Наименование> --&gt; Цена</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Цена" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>4</Код><Наименование> --&gt; Количество</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>3</Код><Наименование> --&gt; Товар</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Товар" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/><КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации><ПередВыгрузкой>ИсходящиеДанные = Новый Структура;
ИсходящиеДанные.Вставить("ТипНоменклатуры", "Товар");

Если ОбъектКоллекции.Комитент = Справочники.Контрагенты.ПустаяСсылка() Тогда
	ИсходящиеДанные.Вставить("ТипТовара", "Собственный");
	
Иначе
	ИсходящиеДанные.Вставить("ТипТовара", "НаКомиссии");
КонецЕсли;</ПередВыгрузкой></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>РеестрСчетов</Код><Наименование>ДокументСсылка.РеестрСчетов --&gt; ДокументСсылка.РеестрСчетов</Наименование><Порядок>700</Порядок><СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору><Источник>ДокументСсылка.РеестрСчетов</Источник><Приемник>ДокументСсылка.РеестрСчетов</Приемник><Свойства/><Значения/></Правило><Правило><Код>СписаниеДебиторскойЗадолженности</Код><Наименование>ДокументСсылка.КорректировкаДолга --&gt; ДокументСсылка.Взаимозачет</Наименование><Порядок>900</Порядок><ПередВыгрузкой>ВходящиеДанные = Новый Структура;
ВходящиеДанные.Вставить("ТабличнаяЧасть", Новый ТаблицаЗначений);
ТабличнаяЧасть = ВходящиеДанные.ТабличнаяЧасть;

ТабличнаяЧасть.Колонки.Добавить("Счет");
ТабличнаяЧасть.Колонки.Добавить("Договор");
ТабличнаяЧасть.Колонки.Добавить("СуммаДеб");

ДатаДок = Источник.Дата;
ВалютаКон = Константы.ВалютаРегламентированногоУчета.Получить();
ФильтрПоВалютеКон = Новый Структура("Валюта", ВалютаКон);
ПоКурсуКон = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеКон).Курс;
ПоКратностьКон = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеКон).Кратность;
		
Для каждого СтрокаДокумента из Источник.СуммыДолга Цикл
	Сумма = СтрокаДокумента.УменьшениеДолгаКонтрагента;
	Если Сумма &lt;&gt; 0 Тогда
		СтрокаТабличнойЧасти = ТабличнаяЧасть.Добавить();
		СтрокаТабличнойЧасти.Счет = "62.1";
		СтрокаТабличнойЧасти.Договор = СтрокаДокумента.ДоговорКонтрагента;

		ВалютаНач = СтрокаДокумента.ДоговорКонтрагента.ВалютаВзаиморасчетов;
		ПоКурсуНач = СтрокаДокумента.КурсВзаиморасчетов;
		ПоКратностьНач = СтрокаДокумента.КратностьВзаиморасчетов;

        ПоКратностьНач = ?(ПоКратностьНач = 0, 1, ПоКратностьНач);
		ПоКратностьКон = ?(ПоКратностьКон = 0, 1, ПоКратностьКон);
		СтрокаТабличнойЧасти.СуммаДеб = ПересчитатьИзВалютыВВалюту(Сумма, ВалютаНач, ВалютаКон, ПоКурсуНач, ПоКурсуКон, ПоКратностьНач, ПоКратностьКон);
	КонецЕсли;
КонецЦикла;

Если ВходящиеДанные.ТабличнаяЧасть.Количество() = 0 Тогда
	Отказ = Истина;
КонецЕсли;

КлючВыгружаемыхДанных = ЗначениеВСтрокуВнутр(Источник) + ИмяПКО;</ПередВыгрузкой><Источник>ДокументСсылка.КорректировкаДолга</Источник><Приемник>ДокументСсылка.Взаимозачет</Приемник><Свойства><Свойство Поиск="true"><Код>6</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "Д", 6, "Справа");</ПередВыгрузкой></Свойство><Свойство><Код>7</Код><Наименование> --&gt; Дебитор</Наименование><Порядок>300</Порядок><Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><Приемник Имя="Дебитор" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство><Код>8</Код><Наименование> --&gt; СчетСписания</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="СчетСписания" Вид="Реквизит"/><ПередВыгрузкой>ТипПриемника = "ПланСчетовСсылка.Основной";
Значение = "91.2";</ПередВыгрузкой></Свойство><Свойство><Код>9</Код><Наименование> --&gt; ВидКорректировки</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="ВидКорректировки" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 3;</ПередВыгрузкой></Свойство><Свойство><Код>10</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>700</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство Поиск="true"><Код>5</Код><Наименование> --&gt; ДатаДок</Наименование><Порядок>100</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Группа><Код>1</Код><Наименование> --&gt; ТабличнаяЧасть</Наименование><Порядок>600</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><Свойство><Код>4</Код><Наименование> --&gt; СуммаДеб</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="СуммаДеб" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>3</Код><Наименование> --&gt; Договор</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="Договор" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство><Код>2</Код><Наименование> --&gt; Счет</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Счет" Вид="Реквизит"/><ПередВыгрузкой>ТипПриемника = "ПланСчетовСсылка.Основной";</ПередВыгрузкой></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>СписаниеКредиторскойЗадолженности</Код><Наименование>ДокументСсылка.КорректировкаДолга --&gt; ДокументСсылка.Взаимозачет</Наименование><Порядок>800</Порядок><ПередВыгрузкой>ВходящиеДанные = Новый Структура;
ВходящиеДанные.Вставить("ТабличнаяЧасть", Новый ТаблицаЗначений);
ТабличнаяЧасть = ВходящиеДанные.ТабличнаяЧасть;

ТабличнаяЧасть.Колонки.Добавить("Счет");
ТабличнаяЧасть.Колонки.Добавить("Договор");
ТабличнаяЧасть.Колонки.Добавить("СуммаКред");

ДатаДок = Источник.Дата;
ВалютаКон = Константы.ВалютаРегламентированногоУчета.Получить();
ФильтрПоВалютеКон = Новый Структура("Валюта", ВалютаКон);
ПоКурсуКон = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеКон).Курс;
ПоКратностьКон = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеКон).Кратность;
		
Для каждого СтрокаДокумента из Источник.СуммыДолга Цикл
	Сумма = СтрокаДокумента.УвеличениеДолгаКонтрагента;
	Если Сумма &lt;&gt; 0 Тогда
		СтрокаТабличнойЧасти = ТабличнаяЧасть.Добавить();
		СтрокаТабличнойЧасти.Счет = "60.1";
		СтрокаТабличнойЧасти.Договор = СтрокаДокумента.ДоговорКонтрагента;

		ВалютаНач = СтрокаДокумента.ДоговорКонтрагента.ВалютаВзаиморасчетов;
		ПоКурсуНач = СтрокаДокумента.КурсВзаиморасчетов;
		ПоКратностьНач = СтрокаДокумента.КратностьВзаиморасчетов;

		ПоКратностьНач = ?(ПоКратностьНач = 0, 1, ПоКратностьНач);
		ПоКратностьКон = ?(ПоКратностьКон = 0, 1, ПоКратностьКон);

		СтрокаТабличнойЧасти.СуммаКред = ПересчитатьИзВалютыВВалюту(Сумма, ВалютаНач, ВалютаКон, ПоКурсуНач, ПоКурсуКон, ПоКратностьНач, ПоКратностьКон);
	КонецЕсли;
КонецЦикла;

Если ВходящиеДанные.ТабличнаяЧасть.Количество() = 0 Тогда
	Отказ = Истина;
КонецЕсли;

КлючВыгружаемыхДанных = ЗначениеВСтрокуВнутр(Источник) + ИмяПКО;</ПередВыгрузкой><Источник>ДокументСсылка.КорректировкаДолга</Источник><Приемник>ДокументСсылка.Взаимозачет</Приемник><Свойства><Свойство Поиск="true"><Код>5</Код><Наименование> --&gt; ДатаДок</Наименование><Порядок>100</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство><Код>9</Код><Наименование> --&gt; ВидКорректировки</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="ВидКорректировки" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 4;</ПередВыгрузкой></Свойство><Свойство><Код>10</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>700</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>8</Код><Наименование> --&gt; СчетСписания</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="СчетСписания" Вид="Реквизит"/><ПередВыгрузкой>ТипПриемника = "ПланСчетовСсылка.Основной";
Значение = "91.1";</ПередВыгрузкой></Свойство><Свойство><Код>7</Код><Наименование> --&gt; Кредитор</Наименование><Порядок>300</Порядок><Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><Приемник Имя="Кредитор" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство Поиск="true"><Код>6</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "К", 6, "Справа");</ПередВыгрузкой></Свойство><Группа><Код>1</Код><Наименование> --&gt; ТабличнаяЧасть</Наименование><Порядок>600</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><Свойство><Код>2</Код><Наименование> --&gt; Счет</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Счет" Вид="Реквизит"/><ПередВыгрузкой>ТипПриемника = "ПланСчетовСсылка.Основной";</ПередВыгрузкой></Свойство><Свойство><Код>3</Код><Наименование> --&gt; Договор</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="Договор" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство><Код>4</Код><Наименование> --&gt; СуммаКред</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="СуммаКред" Вид="Реквизит" Тип="Число"/></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>Счет</Код><Наименование>ДокументСсылка.ЗаказПокупателя --&gt; ДокументСсылка.Счет</Наименование><Порядок>1200</Порядок><ПередВыгрузкой>Если Источник.СтруктурнаяЕдиница = Неопределено Тогда
	Отказ = Истина;
	
ИначеЕсли Источник.СтруктурнаяЕдиница.Метаданные().Имя = "Кассы" Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой><Источник>ДокументСсылка.ЗаказПокупателя</Источник><Приемник>ДокументСсылка.Счет</Приемник><Свойства><Свойство><Код>14</Код><Наименование> --&gt; РасчетныйСчет</Наименование><Порядок>600</Порядок><Источник Имя="СтруктурнаяЕдиница" Вид="Реквизит"/><Приемник Имя="РасчетныйСчет" Вид="Реквизит" Тип="СправочникСсылка.БанковскиеСчета"/><КодПравилаКонвертации>БанковскиеСчета                                   </КодПравилаКонвертации></Свойство><Свойство><Код>12</Код><Наименование> --&gt; Договор</Наименование><Порядок>400</Порядок><Источник Имя="ДоговорКонтрагента" Вид="Реквизит" Тип="СправочникСсылка.ДоговорыКонтрагентов"/><Приемник Имя="Договор" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство Поиск="true"><Код>11</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "", 6, "");</ПередВыгрузкой></Свойство><Свойство><Код>17</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>1000</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>16</Код><Наименование> --&gt; ВариантОтправки</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="ВариантОтправки" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 1</ПередВыгрузкой></Свойство><Свойство><Код>15</Код><Наименование> --&gt; ВариантРасчетаНалогов</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="ВариантРасчетаНалогов" Вид="Реквизит" Тип="СправочникСсылка.ВариантыРасчетаНалогов"/><КодПравилаКонвертации>ВариантыРасчетаНалогов                            </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("СуммаВключаетНДС, СуммаВключаетНП, УчитыватьНДС, УчитыватьНП");
Значение.СуммаВключаетНДС = Источник.СуммаВключаетНДС;
Значение.СуммаВключаетНП  = Ложь;
Значение.УчитыватьНДС = Источник.УчитыватьНДС;
Значение.УчитыватьНП  = Ложь;</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>10</Код><Наименование> --&gt; ДатаДок</Наименование><Порядок>100</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство><Код>1</Код><Наименование>Контрагент --&gt; Контрагент</Наименование><Порядок>300</Порядок><Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Группа><Код>2</Код><Наименование> --&gt; ТабличнаяЧасть</Наименование><Порядок>900</Порядок><Источник Имя="Товары" Вид="ТабличнаяЧасть"/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><Свойство><Код>9</Код><Наименование> --&gt; Всего</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="Всего" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если Не Источник.СуммаВключаетНДС Тогда
	Значение = ОбъектКоллекции.Сумма + ОбъектКоллекции.СуммаНДС;
Иначе
	Значение = ОбъектКоллекции.Сумма;
КонецЕсли;</ПередВыгрузкой><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>7</Код><Наименование> --&gt; НДС</Наименование><Порядок>500</Порядок><Источник Имя="СуммаНДС" Вид="Реквизит" Тип="Число"/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>3</Код><Наименование> --&gt; Товар</Наименование><Порядок>100</Порядок><Источник Имя="Номенклатура" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/><Приемник Имя="Товар" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/><ПередВыгрузкой>ИсходящиеДанные = Новый Структура;
Если ОбъектКоллекции.Номенклатура.Услуга Тогда
	ИсходящиеДанные.Вставить("ТипНоменклатуры", "Услуга");

Иначе
	ИсходящиеДанные.Вставить("ТипНоменклатуры", "Товар");
КонецЕсли;
ИсходящиеДанные.Вставить("ТипТовара", "Собственный");</ПередВыгрузкой></Свойство><Свойство><Код>4</Код><Наименование> --&gt; Количество</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = ОбъектКоллекции.Количество * ОбъектКоллекции.Коэффициент;</ПередВыгрузкой></Свойство><Свойство><Код>5</Код><Наименование> --&gt; Цена</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Цена" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если ЗначениеНеЗаполнено(ОбъектКоллекции.ПроцентСкидкиНаценки) И ЗначениеНеЗаполнено(ОбъектКоллекции.ПроцентАвтоматическихСкидок) Тогда
	Значение = ОбъектКоллекции.Цена / ОбъектКоллекции.Коэффициент;
Иначе
	Значение = ОбъектКоллекции.Сумма / ОбъектКоллекции.Количество / ОбъектКоллекции.Коэффициент;
КонецЕсли;</ПередВыгрузкой><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>6</Код><Наименование> --&gt; Сумма</Наименование><Порядок>400</Порядок><Источник Имя="Сумма" Вид="Реквизит" Тип="Число"/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>СчетФактура</Код><Наименование>ДокументСсылка.СчетФактураВыданный --&gt; ДокументСсылка.СчетФактура</Наименование><Порядок>2200</Порядок><Источник>ДокументСсылка.СчетФактураВыданный</Источник><Приемник>ДокументСсылка.СчетФактура</Приемник><Свойства><Группа><Код>2</Код><Наименование> --&gt; ТабличнаяЧасть</Наименование><Порядок>1500</Порядок><Источник/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><ПередОбработкойВыгрузки>КоллекцияОбъектов = Новый ТаблицаЗначений;
КоллекцияОбъектов.Колонки.Добавить("Товар");
МассивТипов = Новый Массив;
КоллекцияОбъектов.Колонки.Добавить("ГТД");
КоллекцияОбъектов.Колонки.Добавить("СтранаПроисхождения");
КоллекцияОбъектов.Колонки.Добавить("СтавкаНДС");
КоллекцияОбъектов.Колонки.Добавить("Количество");
КоллекцияОбъектов.Колонки.Добавить("Сумма");
КоллекцияОбъектов.Колонки.Добавить("НДС");
КоллекцияОбъектов.Колонки.Добавить("Цена");
КоллекцияОбъектов.Колонки.Добавить("Всего");
КоллекцияОбъектов.Колонки.Добавить("Субконто1");
КоллекцияОбъектов.Колонки.Добавить("ТипПриемникаДляТовара");
КоллекцияОбъектов.Колонки.Добавить("ИмяПКОДляТовара");
КоллекцияОбъектов.Колонки.Добавить("ТипТовара");
КоллекцияОбъектов.Колонки.Добавить("Комитент");
КоллекцияОбъектов.Колонки.Добавить("ДоговорКомиссии");

ИДОснования = Источник.Метаданные().Имя;

Если (ИДОснования = "ПлатежноеПоручениеВходящее") или (ИДОснования = "ПриходныйКассовыйОрдер") Тогда
	Стр = КоллекцияОбъектов.Добавить();
	Стр.Товар     = "Аванс (предв. оплата)";
	Стр.Сумма     = Источник.СуммаДокумента;
	Если Источник.Дата &lt; '20040101' Тогда
		Стр.СтавкаНДС = Перечисления.СтавкиНДС.НДС20_120;
	Иначе
		Стр.СтавкаНДС = Перечисления.СтавкиНДС.НДС18_118;
	КонецЕсли;
	
	НДС = 0;
	Если ИДОснования = "ПриходныйКассовыйОрдер" Тогда
		Стр.СтавкаНДС = Источник.СтавкаНДС;
	КонецЕсли;                              
	РассчитатьСуммуНДС(Источник.СуммаДокумента, 1, 1, ПолучитьСтавкуНДС(Стр.СтавкаНДС));

	Стр.НДС = НДС;
	Стр.Количество = 0;
	
	Стр.Цена = Источник.СуммаДокумента;
	Стр.Всего = Источник.СуммаДокумента;
	Стр.ТипПриемникаДляТовара = "Строка";
	
ИначеЕсли ИДОснования = "ОтчетКомитентуОПродажах" Тогда
	Стр = КоллекцияОбъектов.Добавить();
    Стр.Товар = "Посредническая услуга в торговле";
	Стр.СтавкаНДС = Источник.СтавкаНДСВознаграждения;
	Стр.Сумма = Источник.Товары.Итог("СуммаВознаграждения");
	Стр.Количество = 1;
	Стр.НДС = РассчитатьСуммуНДС(Стр.Сумма, 1, 1, ПолучитьСтавкуНДС(Источник.СтавкаНДСВознаграждения));
	Стр.Цена = Стр.Сумма;
	Стр.Всего = Стр.Сумма;

	Стр.Субконто1 = Новый Структура;
	Стр.Субконто1.Вставить("Наименование", "Товар");
	Стр.Субконто1.Вставить("ТипНоменклатуры", "Товар");

	Стр.ТипПриемникаДляТовара = "СправочникСсылка.Номенклатура";
	Стр.ИмяПКОДляТовара = "НоменклатураПосредническаяУслуга";
	
Иначе
	Запросы.ТабличнаяЧастьРеализации.УстановитьПараметр("ПустойКомитент", Справочники.Контрагенты.ПустаяСсылка());
	Запросы.ТабличнаяЧастьРеализации.УстановитьПараметр("ПустойДоговорКомиссии", Справочники.ДоговорыКонтрагентов.ПустаяСсылка());
	Запросы.ТабличнаяЧастьРеализации.УстановитьПараметр("ТоварПринятыйКомиссия", Перечисления.СтатусыПартийТоваров.НаКомиссию);
	Запросы.ТабличнаяЧастьРеализации.УстановитьПараметр("Источник", Источник);
	ТаблицаТоваров   = Источник.Товары.Выгрузить();

	ТаблицаПартий    = Запросы.ТабличнаяЧастьРеализации.Выполнить().Выгрузить();
	ТаблицаПартий.Свернуть("Номенклатура, Комитент, ТипТовара, ДоговорКомиссии", "Количество");

	ОстКоличествоПоПартиям = 0;
	НоменклатураПред = "";
	Для каждого СтрокаТаблицы ИЗ ТаблицаТоваров Цикл
		КоличествоПоСтроке = СтрокаТаблицы.Количество / СтрокаТаблицы.Коэффициент * СтрокаТаблицы.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент;
		ОстКоличествоПоСтроке = КоличествоПоСтроке;
		ОстПогСумма = СтрокаТаблицы.Сумма;
		ОстПогНДС = СтрокаТаблицы.СуммаНДС;
		Если НоменклатураПред &lt;&gt; СтрокаТаблицы.Номенклатура Тогда
			Индекс = 0;
			СтруктураПоиска = Новый Структура;
			СтруктураПоиска.Вставить("Номенклатура", СтрокаТаблицы.Номенклатура);
			МассивСтрок = ТаблицаПартий.НайтиСтроки(СтруктураПоиска);
		КонецЕсли;
		Если (ОстКоличествоПоПартиям = 0) ИЛИ (НоменклатураПред &lt;&gt; СтрокаТаблицы.Номенклатура) Тогда
			Если Индекс &lt;= МассивСтрок.ВГраница()Тогда
				СтрокаТаблицыПартий = МассивСтрок.Получить(Индекс);
				Индекс = Индекс + 1;
				ОстКоличествоПоПартиям = СтрокаТаблицыПартий.Количество;
			Иначе
				
				// Если не все количество распределилось по партиям все равно выгрузим количестово из документа
				СтрокаКоллекции                     = КоллекцияОбъектов.Добавить();
				СтрокаКоллекции.ТипТовара           = "Собственный"; // по умолчанию
				СтрокаКоллекции.Товар               = СтрокаТаблицы.Номенклатура;
				СтрокаКоллекции.ГТД                 = Новый Структура("Наименование, СтранаПроисхождения, Комментарий",
											СтрокаТаблицы.СерияНоменклатуры.НомерГТД.Код, СтрокаТаблицы.СерияНоменклатуры.СтранаПроисхождения.Наименование, СтрокаТаблицы.СерияНоменклатуры.НомерГТД.Комментарий);
				СтрокаКоллекции.СтранаПроисхождения = СтрокаТаблицы.СерияНоменклатуры.СтранаПроисхождения;
				СтрокаКоллекции.Цена                = СтрокаТаблицы.Цена;
				СтрокаКоллекции.Количество          = ОстКоличествоПоСтроке;
				СтрокаКоллекции.Сумма               = ОстПогСумма;
				СтрокаКоллекции.СтавкаНДС           = СтрокаТаблицы.СтавкаНДС;
				СтрокаКоллекции.НДС                 = ОстПогНДС;
				Продолжить;
				
			КонецЕсли;
		КонецЕсли;
		СтрокаКоллекции                     = КоллекцияОбъектов.Добавить();
		СтрокаКоллекции.Товар               = СтрокаТаблицы.Номенклатура;
		СтрокаКоллекции.ГТД                 = Новый Структура("Наименование, СтранаПроисхождения, Комментарий",
							СтрокаТаблицы.СерияНоменклатуры.НомерГТД.Код, СтрокаТаблицы.СерияНоменклатуры.СтранаПроисхождения.Наименование, СтрокаТаблицы.СерияНоменклатуры.НомерГТД.Комментарий);
		СтрокаКоллекции.СтранаПроисхождения = СтрокаТаблицы.СерияНоменклатуры.СтранаПроисхождения;
		СтрокаКоллекции.Цена                = СтрокаТаблицы.Цена;
		СтрокаКоллекции.Количество          = Мин(ОстКоличествоПоСтроке, ОстКоличествоПоПартиям);
		КоэффПогашения                      = СтрокаКоллекции.Количество / КоличествоПоСтроке;
		СтрокаКоллекции.СтавкаНДС           = СтрокаТаблицы.СтавкаНДС;
		Если СтрокаКоллекции.Количество = ОстКоличествоПоСтроке Тогда
			СтрокаКоллекции.Сумма = ОстПогСумма;
			СтрокаКоллекции.НДС   = ОстПогНДС;
		Иначе
			СтрокаКоллекции.Сумма = СтрокаТаблицы.Сумма * КоэффПогашения;
			СтрокаКоллекции.НДС   = СтрокаТаблицы.СуммаНДС * КоэффПогашения;
		КонецЕсли;
		СтрокаКоллекции.ТипТовара       = СтрокаТаблицыПартий.ТипТовара;
		СтрокаКоллекции.Комитент        = СтрокаТаблицыПартий.Комитент;
		СтрокаКоллекции.ДоговорКомиссии = СтрокаТаблицыПартий.ДоговорКомиссии;
		ОстКоличествоПоСтроке           = ОстКоличествоПоСтроке - СтрокаКоллекции.Количество;
		ОстКоличествоПоПартиям          = ОстКоличествоПоПартиям - СтрокаКоллекции.Количество;
		ОстПогСумма                     = ОстПогСумма - СтрокаКоллекции.Сумма;
		ОстПогНДС                       = ОстПогНДС   - СтрокаКоллекции.НДС;
		НоменклатураПред                = СтрокаТаблицы.Номенклатура;
	КонецЦикла;
	
	Если ЕстьТабЧастьДокумента("Услуги", Источник.Метаданные()) Тогда
		ТаблицаУслуг = Источник.Услуги.Выгрузить();
		Для каждого СтрокаТаблицы Из ТаблицаУслуг Цикл
			СтрокаКоллекции = КоллекцияОбъектов.Добавить();
			СтрокаКоллекции.Товар      = СтрокаТаблицы.Номенклатура;
			СтрокаКоллекции.Цена       = СтрокаТаблицы.Цена;
			СтрокаКоллекции.Количество = СтрокаТаблицы.Количество;
			СтрокаКоллекции.Сумма      = СтрокаТаблицы.Сумма;
			СтрокаКоллекции.СтавкаНДС  = СтрокаТаблицы.СтавкаНДС;
			СтрокаКоллекции.НДС        = СтрокаТаблицы.СуммаНДС;
		КонецЦикла;
	КонецЕсли;

	Для каждого ОбъектКоллекции из КоллекцияОбъектов Цикл
		
		Если Источник.СуммаВключаетНДС Тогда
			ОбъектКоллекции.Сумма = ОбъектКоллекции.Сумма - ОбъектКоллекции.НДС;
		КонецЕсли;

		ОбъектКоллекции.Всего = ОбъектКоллекции.Сумма + ОбъектКоллекции.НДС;

		Если ОбъектКоллекции.Количество &lt;&gt; 0 Тогда
			ОбъектКоллекции.Цена = ОбъектКоллекции.Сумма / ОбъектКоллекции.Количество;
		КонецЕсли;

		ОбъектКоллекции.Субконто1 = Новый Структура;
		ТипНоменклатуры = ?(ОбъектКоллекции.Товар.Услуга, "Услуга", "Товар");
		ОбъектКоллекции.Субконто1.Вставить("Наименование", ТипНоменклатуры);
		ОбъектКоллекции.Субконто1.Вставить("ТипНоменклатуры", ТипНоменклатуры);

		ОбъектКоллекции.ТипПриемникаДляТовара = "СправочникСсылка.Номенклатура";
		ОбъектКоллекции.ИмяПКОДляТовара = "Номенклатура";
	
	КонецЦикла;
КонецЕсли;</ПередОбработкойВыгрузки><Свойство><Код>3</Код><Наименование> --&gt; Товар</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Товар" Вид="Реквизит"/><ПередВыгрузкой>ТипПриемника = ОбъектКоллекции.ТипПриемникаДляТовара;

Если ТипПриемника = "СправочникСсылка.Номенклатура" Тогда
	ИмяПКО = ОбъектКоллекции.ИмяПКОДляТовара;
	
	Если ИмяПКО = "НоменклатураПосредническаяУслуга" Тогда
		ИсходящиеДанные = ОбъектКоллекции.СтавкаНДС;

	Иначе
		ИсходящиеДанные = Новый Структура;
		Если ОбъектКоллекции.Товар.Услуга Тогда
			ИсходящиеДанные.Вставить("ТипНоменклатуры", "Услуга");

		Иначе
			ИсходящиеДанные.Вставить("ТипНоменклатуры", "Товар");
		КонецЕсли;
		
		ИсходящиеДанные.Вставить("ТипТовара", ОбъектКоллекции.ТипТовара);
	КонецЕсли;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>4</Код><Наименование> --&gt; Количество</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>5</Код><Наименование> --&gt; Цена</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Цена" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>ИДОснования = Источник.Метаданные().Имя;

Если ИДОснования = "ПлатежноеПоручениеВходящее" Тогда
	Выполнить(Алгоритмы.ПересчетВРублиСуммыИсточника)	
ИначеЕсли ИДОснования = "ПриходныйКассовыйОрдер" Тогда
	Выполнить(Алгоритмы.ПересчетВРублиСуммыИсточника)	
Иначе
	Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)
КонецЕсли;</ПриВыгрузке></Свойство><Свойство><Код>7</Код><Наименование> --&gt; Сумма</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>ИДОснования = Источник.Метаданные().Имя;

Если ИДОснования = "ПлатежноеПоручениеВходящее" Тогда
	Выполнить(Алгоритмы.ПересчетВРублиСуммыИсточника)	
ИначеЕсли ИДОснования = "ПриходныйКассовыйОрдер" Тогда
	Выполнить(Алгоритмы.ПересчетВРублиСуммыИсточника)	
Иначе
	Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)
КонецЕсли;</ПриВыгрузке></Свойство><Свойство><Код>9</Код><Наименование> --&gt; СтавкаНДС</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="СтавкаНДС" Вид="Реквизит" Тип="СправочникСсылка.СтавкиНДС"/><КодПравилаКонвертации>СтавкиНДС                                         </КодПравилаКонвертации><ПередВыгрузкой>ИДОснования = Источник.Метаданные().Имя;

Если ИДОснования = "ПлатежноеПоручениеВходящее" Тогда
	Если Источник.Дата &lt; '20040101' Тогда
		Значение = Перечисления.СтавкиНДС.НДС20_120;
	Иначе
		Значение = Перечисления.СтавкиНДС.НДС18_118;
	КонецЕсли;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>10</Код><Наименование> --&gt; НДС</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>ИДОснования = Источник.Метаданные().Имя;

Если ИДОснования = "ПлатежноеПоручениеВходящее" Тогда
	Выполнить(Алгоритмы.ПересчетВРублиСуммыИсточника)	
ИначеЕсли ИДОснования = "ПриходныйКассовыйОрдер" Тогда
	Выполнить(Алгоритмы.ПересчетВРублиСуммыИсточника)	
Иначе
	Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)
КонецЕсли;</ПриВыгрузке></Свойство><Свойство><Код>13</Код><Наименование> --&gt; Всего</Наименование><Порядок>1100</Порядок><Источник/><Приемник Имя="Всего" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>ИДОснования = Источник.Метаданные().Имя;

Если ИДОснования = "ПлатежноеПоручениеВходящее" Тогда
	Выполнить(Алгоритмы.ПересчетВРублиСуммыИсточника)	
ИначеЕсли ИДОснования = "ПриходныйКассовыйОрдер" Тогда
	Выполнить(Алгоритмы.ПересчетВРублиСуммыИсточника)	
Иначе
	Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)
КонецЕсли;</ПриВыгрузке></Свойство><Свойство><Код>14</Код><Наименование> --&gt; СтранаПроисхождения</Наименование><Порядок>1200</Порядок><Источник/><Приемник Имя="СтранаПроисхождения" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Если ОбъектКоллекции.СтранаПроисхождения = Неопределено Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>15</Код><Наименование> --&gt; ГТД</Наименование><Порядок>1300</Порядок><Источник/><Приемник Имя="ГТД" Вид="Реквизит" Тип="СправочникСсылка.ГТД"/><КодПравилаКонвертации>ГТД                                               </КодПравилаКонвертации><ПередВыгрузкой>Если ОбъектКоллекции.ГТД = Неопределено Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>16</Код><Наименование> --&gt; Счет</Наименование><Порядок>1400</Порядок><Источник/><Приемник Имя="Счет" Вид="Реквизит"/><ПередВыгрузкой>ТипПриемника = "ПланСчетовСсылка.Основной";
Значение = "90.3";</ПередВыгрузкой></Свойство><Свойство><Код>17</Код><Наименование> --&gt; Субконто1</Наименование><Порядок>1500</Порядок><Источник/><Приемник Имя="Субконто1" Вид="Реквизит"/><КодПравилаКонвертации>ВидыНоменклатуры                                  </КодПравилаКонвертации><ПередВыгрузкой>Если ОбъектКоллекции.Субконто1 = Неопределено Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>18</Код><Наименование> --&gt; Субконто2</Наименование><Порядок>1600</Порядок><Источник/><Приемник Имя="Субконто2" Вид="Реквизит"/><КодПравилаКонвертации>СтавкиНДС                                         </КодПравилаКонвертации><ПередВыгрузкой>Если ОбъектКоллекции.СтавкаНДС = Неопределено Тогда
	 Отказ = Истина;

Иначе
	 Значение = ОбъектКоллекции.СтавкаНДС;
КонецЕсли;</ПередВыгрузкой></Свойство></Группа><Свойство Поиск="true"><Код>23</Код><Наименование> --&gt; ДатаДок</Наименование><Порядок>200</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство Поиск="true"><Код>24</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>400</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(ВходящиеДанные.НомерДок, ЧисловаяЧасть);
Добавка  = ?(ВходящиеДанные.НаАванс, "А", "");
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, Добавка, 6, "Справа");;</ПередВыгрузкой></Свойство><Свойство><Код>25</Код><Наименование> --&gt; Аванс</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Аванс" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = ВходящиеДанные.НаАванс;</ПередВыгрузкой></Свойство><Свойство><Код>28</Код><Наименование> --&gt; Контрагент</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации><ПередВыгрузкой>Значение = Источник.Контрагент;
</ПередВыгрузкой></Свойство><Свойство><Код>29</Код><Наименование> --&gt; Грузополучатель</Наименование><Порядок>600</Порядок><Источник/><Приемник Имя="Грузополучатель" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации><ПередВыгрузкой>Значение = Источник.Контрагент;
</ПередВыгрузкой></Свойство><Свойство><Код>30</Код><Наименование> --&gt; ВариантОтправки</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="ВариантОтправки" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 1;</ПередВыгрузкой></Свойство><Свойство><Код>34</Код><Наименование> --&gt; СчетНДС</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="СчетНДС" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>ИДОснования = Источник.Метаданные().Имя;
УчетнаяПолитика = УчетнаяПолитикаНалоговыйУчет("МоментОпределенияНалоговойБазыНДС", Параметры.Организация, Источник.Дата);

Если ИДОснования = "ПлатежноеПоручениеВходящее" Тогда
    Значение = 1;
	
ИначеЕсли ИДОснования = "ПриходныйКассовыйОрдер" Тогда
	Значение = 1;
	
ИначеЕсли УчетнаяПолитика = Перечисления.МоментыОпределенияНалоговойБазыНДС.ПоОтгрузке Тогда // по отгрузке
	Значение = 1;

Иначе  // по оплате
	Значение = 2;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>38</Код><Наименование> --&gt; СчетАкциза</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="СчетАкциза" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 2;</ПередВыгрузкой></Свойство><Свойство><Код>39</Код><Наименование> --&gt; Договор</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="Договор" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации><ПередВыгрузкой>Значение = Источник.ДоговорКонтрагента;</ПередВыгрузкой></Свойство><Свойство><Код>40</Код><Наименование> --&gt; Курс</Наименование><Порядок>1100</Порядок><Источник/><Приемник Имя="Курс" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>МетаданныеИсточника = Источник.Метаданные();
Если ЕстьРеквизитДокумента("КурсВзаиморасчетов", МетаданныеИсточника) Тогда
	Значение = Источник.КурсВзаиморасчетов;
Иначе
	СтруктураКурса = ПолучитьКурсВалюты(Источник.ДоговорКонтрагента.ВалютаВзаиморасчетов, Источник.Дата);
	Значение = СтруктураКурса.Курс;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>42</Код><Наименование> --&gt; Валюта</Наименование><Порядок>1200</Порядок><Источник/><Приемник Имя="Валюта" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/><ПередВыгрузкой>Значение = Источник.ДоговорКонтрагента.ВалютаВзаиморасчетов;</ПередВыгрузкой></Свойство><Свойство><Код>1</Код><Наименование>ДокументОснование --&gt; ДокументОснование</Наименование><Порядок>100</Порядок><Источник Имя="ДокументОснование" Вид="Реквизит"/><Приемник Имя="ДокументОснование" Вид="Реквизит"/><ПередВыгрузкой>Значение = Источник;
ИДОснования = Источник.Метаданные().Имя;

Если ИДОснования = "ПлатежноеПоручениеВходящее" Тогда
	
	Значение = Новый Структура;
	
	МассивДокументовСТЧ = Новый СписокЗначений;
	МассивДокументовСТЧ.Добавить("ПлатежноеПоручениеИсходящее");
	МассивДокументовСТЧ.Добавить("ПлатежноеПоручениеВходящее");
	МассивДокументовСТЧ.Добавить("ПлатежноеТребованиеВыставленное");
	МассивДокументовСТЧ.Добавить("ПлатежноеТребованиеПолученное");
	МассивДокументовСТЧ.Добавить("ИнкассовоеПоручениеПереданное");
	МассивДокументовСТЧ.Добавить("ИнкассовоеПоручениеПолученное");
	МассивДокументовСТЧ.Добавить("АккредитивПереданный");
	МассивДокументовСТЧ.Добавить("АккредитивПолученный");
	МассивДокументовСТЧ.Добавить("ПлатежныйОрдерПоступлениеДенежныхСредств");
	МассивДокументовСТЧ.Добавить("ПлатежныйОрдерСписаниеДенежныхСредств");

	МассивДокументовБезТЧ = Новый СписокЗначений;
	МассивДокументовБезТЧ.Добавить("ДенежныйЧек");
	МассивДокументовБезТЧ.Добавить("ОбъявлениеНаВзносНаличными");

	ТЗ = "";
	ПервыйРаз = Истина;
	Для каждого ИмяДокумента из МассивДокументовСТЧ Цикл
		
		Если ПервыйРаз Тогда
			ПервыйРаз = Ложь;
		Иначе
			ТЗ = ТЗ + "
			|
			|ОБЪЕДИНИТЬ ВСЕ
			|";
		КонецЕсли;
		
		ТЗ = ТЗ + "ВЫБРАТЬ
		|НачалоПериода(Док.Ссылка.Дата, День) КАК Дата,
		|Док.Ссылка 		                  КАК Ссылка,
		|Док.Ссылка.ВалютаДокумента           КАК Валюта,
		|Док.Ссылка.ВидОперации               КАК ВидОперации,
		|Док.Ссылка.Контрагент                КАК Контрагент,
		|Док.Ссылка.СчетОрганизации           КАК БанковскийСчет,";
		
		МетаданныеДокумента = Метаданные.Документы["" + ИмяДокумента];
		Если ЕстьРеквизитДокумента("НазначениеПлатежа", МетаданныеДокумента) Тогда
			ТЗ = ТЗ + "
			|Док.Ссылка.НазначениеПлатежа         КАК НазначениеПлатежа,";
		Иначе
			ТЗ = ТЗ + "
			|""""                                 КАК НазначениеПлатежа,";
		КонецЕсли;
		
		ТЗ = ТЗ + "
		|Док.ДоговорКонтрагента               КАК ДоговорКонтрагента,
		|Док.Сделка                           КАК Сделка,
		|Док.КурсВзаиморасчетов               КАК КурсВзаиморасчетов,
		|Док.КратностьВзаиморасчетов          КАК КратностьВзаиморасчетов,
		|Док.СуммаПлатежа                     КАК СуммаПлатежа 
		|	
		|ИЗ
		|	Документ." + ИмяДокумента + ".РасшифровкаПлатежа КАК Док
		|
		|ГДЕ
		|	(Док.Ссылка.ОтражатьВБухгалтерскомУчете &lt;&gt; ЛОЖЬ)
		|	И (Док.Ссылка.Проведен = ИСТИНА)
		|	И (Док.Ссылка.Оплачено = ИСТИНА)
		|	И (Док.Ссылка.Организация = &amp;Организация)
		|	И (Док.Ссылка.Дата МЕЖДУ &amp;ДатаНачала И &amp;ДатаОкончания)
		|	И (Док.Ссылка.СчетОрганизации = &amp;БанковскийСчет)";

	КонецЦикла;

	//Для ИмяДокумента каждого из МассивДокументовБезТЧ Цикл
	//	
	//	ТЗ = ТЗ + "
	//	|
	//	|ОБЪЕДИНИТЬ ВСЕ
	//	|";
	//	
	//	ТЗ = ТЗ + "ВЫБРАТЬ
	//	|НачалоПериода(Док.Дата, День) КАК Дата,
	//	|Док.Ссылка 		           КАК Ссылка,
	//	|Док.ВидОперации               КАК ВидОперации,
	//	|""                            КАК НазначениеПлатежа,
	//	|Неопределено                  КАК ДоговорКонтрагента,
	//	|Неопределено                  КАК Сделка,
	//	|Док.СуммаПлатежа              КАК СуммаПлатежа 
	//	|	
	//	|ИЗ
	//	|	Документ." + ИмяДокумента + " КАК Док
	//	|
	//	|ГДЕ
	//	|	(Док.Ссылка.Проведен = ИСТИНА)
	//	|	И (Док.Ссылка.Оплачено = ИСТИНА)
	//	|	И (Док.Организация = &amp;Организация)";

	//	Если Не одПустое(ДатаНачала) и Не одПустое(ДатаОкончания) Тогда
	//		ТЗ = ТЗ + "
	//		| И (БанковскиеВыписки.Дата МЕЖДУ &amp;ДатаНачала И &amp;ДатаОкончания)";

	//	ИначеЕсли Не одПустое(ДатаНачала) и одПустое(ДатаОкончания) Тогда
	//		ТЗ = ТЗ + "
	//		| И (БанковскиеВыписки.Дата &gt;= &amp;ДатаНачала)";

	//	ИначеЕсли одПустое(ДатаНачала) и Не одПустое(ДатаОкончания) Тогда
	//		ТЗ = ТЗ + "
	//		| И (БанковскиеВыписки.Дата &lt;= &amp;ДатаОкончания)";
	//	КонецЕсли;	
	//	
	//КонецЦикла;
	            
	ТЗ = ТЗ + "
		|
		|УПОРЯДОЧИТЬ ПО
		|	Дата,
		|	БанковскийСчет,
		|	Валюта
		|
		|ИТОГИ ПО
		|	Дата,
		|	БанковскийСчет,
		|	Валюта";

	ВалютаРегламентированногоУчета = Константы.ВалютаРегламентированногоУчета.Получить();

	ДатаНач = НачалоДня(Источник.Дата);
	ДатаКон = КонецДня(Источник.Дата);
	
	Запрос = Новый Запрос(ТЗ);

	Запрос.УстановитьПараметр("ДатаНачала",     ДатаНач);
	Запрос.УстановитьПараметр("ДатаОкончания",  ДатаКон);
	Запрос.УстановитьПараметр("Организация",    Параметры.Организация);
	Запрос.УстановитьПараметр("БанковскийСчет", Источник.СчетОрганизации);
	РезультатЗапроса = Запрос.Выполнить();

	ВыборкаДанных = Новый ТаблицаЗначений;
	ВыборкаДанных.Колонки.Добавить("ТабличнаяЧасть");
	ВыборкаДанных.Колонки.Добавить("ДатаДок");
	ВыборкаДанных.Колонки.Добавить("БанковскийСчет");
	ВыборкаДанных.Колонки.Добавить("Валюта");

	Выборка1 = РезультатЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	Пока Выборка1.Следующий() Цикл
		Выборка2 = Выборка1.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		Пока Выборка2.Следующий() Цикл
			Выборка3 = Выборка2.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
			Пока Выборка3.Следующий() Цикл

				
				Значение.Вставить("ДатаДок", Выборка3.Дата);
				Значение.Вставить("БанковскийСчет", Выборка3.БанковскийСчет);
				Если Выборка3.Валюта = ВалютаРегламентированногоУчета Тогда
					Значение.Вставить("Валюта", Неопределено);
				Иначе
					Значение.Вставить("Валюта", Выборка3.Валюта);
				КонецЕсли;
				Значение.Вставить("ТабличнаяЧасть", Новый ТаблицаЗначений);
				
				Значение.ТабличнаяЧасть.Колонки.Добавить("Док");
				Значение.ТабличнаяЧасть.Колонки.Добавить("ВидДвижения");
				Значение.ТабличнаяЧасть.Колонки.Добавить("НазначениеПлатежа");
				Значение.ТабличнаяЧасть.Колонки.Добавить("КоррСчет");
				Значение.ТабличнаяЧасть.Колонки.Добавить("Субконто1");
				Значение.ТабличнаяЧасть.Колонки.Добавить("ИмяПКО1");
				Значение.ТабличнаяЧасть.Колонки.Добавить("Субконто2");
				Значение.ТабличнаяЧасть.Колонки.Добавить("ИмяПКО2");
				Значение.ТабличнаяЧасть.Колонки.Добавить("Субконто3");
				Значение.ТабличнаяЧасть.Колонки.Добавить("ИмяПКО3");
				Значение.ТабличнаяЧасть.Колонки.Добавить("Приход");
				Значение.ТабличнаяЧасть.Колонки.Добавить("Расход");
				Значение.ТабличнаяЧасть.Колонки.Добавить("СчетФактура");
				Значение.ТабличнаяЧасть.Колонки.Добавить("КурсОплаты");

				Выборка4 = Выборка3.Выбрать();
				Пока Выборка4.Следующий() Цикл
				
					СтрокаВыписки = Значение.ТабличнаяЧасть.Добавить();

					СтрокаВыписки.Док = Выборка4.Ссылка;

					СтрокаВыписки.ВидДвижения       = Новый Структура("Наименование, ВидДвижения");
					СтрокаВыписки.НазначениеПлатежа = Выборка4.НазначениеПлатежа;
					
					Если Выборка4.ВидОперации = Перечисления.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ОплатаПокупателя Тогда
						СтрокаВыписки.ВидДвижения.Наименование = "Поступления от покупателей";
						СтрокаВыписки.ВидДвижения.ВидДвижения  = "ВыручкаПоОбычнымВидамДеятельности";
						
						СтруктураДляОтбора = Новый Структура;
						СтруктураДляОтбора.Вставить("ДоговорКонтрагента", Выборка4.ДоговорКонтрагента);
						Если Выборка4.ДоговорКонтрагента &lt;&gt; Перечисления.ВедениеВзаиморасчетовПоДоговорам.ПоДоговоруВЦелом Тогда
							СтруктураДляОтбора.Вставить("Сделка",                Выборка4.Сделка);
						Иначе
							СтруктураДляОтбора.Вставить("Сделка",                Неопределено);
						КонецЕсли;
						ТаблицаОстатков = РегистрыНакопления.ВзаиморасчетыСКонтрагентами.Остатки(СтрокаВыписки.Док.МоментВремени(), СтруктураДляОтбора);
						Если ТаблицаОстатков.Количество() &gt; 0 И ТаблицаОстатков[0].СуммаВзаиморасчетов &gt; 0 Тогда
							Аванс = Ложь;
						Иначе
							Аванс = Истина;
						КонецЕсли;
						Если Выборка4.Валюта &lt;&gt; ВалютаРегламентированногоУчета Тогда
							Если Аванс Тогда
						        СтрокаВыписки.КоррСчет = "62.22";
							Иначе
						        СтрокаВыписки.КоррСчет = "62.11";
							КонецЕсли;
						Иначе
							Если Аванс Тогда
						        СтрокаВыписки.КоррСчет = "62.2";
							Иначе							
								СтрокаВыписки.КоррСчет = "62.1";
							КонецЕсли;
						КонецЕсли;

						СтрокаВыписки.Субконто1 = Выборка4.Контрагент;
						СтрокаВыписки.ИмяПКО1 = "Контрагенты";
						СтрокаВыписки.Субконто2   = Выборка4.ДоговорКонтрагента;
						СтрокаВыписки.ИмяПКО2     = "Договоры";
						СтрокаВыписки.СчетФактура = НайтиПодчиненныйДокумент(СтрокаВыписки.Док);
						СтрокаВыписки.Приход = Выборка4.СуммаПлатежа;
						СтрокаВыписки.Расход = 0;
						СтрокаВыписки.КурсОплаты = Выборка4.КурсВзаиморасчетов / Выборка4.КратностьВзаиморасчетов;
						
					ИначеЕсли Выборка4.ВидОперации = Перечисления.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ВозвратДенежныхСредствПоставщиком Тогда
						
						Выборка4.ВидДвижения.Наименование = "Прочие поступления";
						Выборка4.ВидДвижения.ВидДвижения  = "ПрочиеПоступления";
						Если Выборка4.Валюта &lt;&gt; ВалютаРегламентированногоУчета Тогда
					        СтрокаВыписки.КоррСчет = "60.22";
						Иначе
							СтрокаВыписки.КоррСчет = "60.2";
						КонецЕсли;
						
						СтрокаВыписки.Субконто1 = Выборка4.Контрагент;
						СтрокаВыписки.ИмяПКО1 = "Контрагенты";
						СтрокаВыписки.Субконто2 = Выборка4.ДоговорКонтрагента;
						СтрокаВыписки.ИмяПКО2 = "Договоры";
						СтрокаВыписки.Приход = Выборка4.СуммаПлатежа;
						СтрокаВыписки.КурсОплаты = Выборка4.КурсВзаиморасчетов / Выборка4.КратностьВзаиморасчетов;
						СтрокаВыписки.Расход = 0;

					ИначеЕсли Выборка4.ВидОперации = Перечисления.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ПрочиеРасчетыСКонтрагентами Тогда
						
						СтрокаВыписки.ВидДвижения.Наименование = "Прочие поступления";
						СтрокаВыписки.ВидДвижения.ВидДвижения  = "ПрочиеПоступления";
						Если Выборка4.Валюта &lt;&gt; ВалютаРегламентированногоУчета Тогда
					        СтрокаВыписки.КоррСчет = "76.6";
						Иначе
							СтрокаВыписки.КоррСчет = "76.5";
						КонецЕсли;
						
						СтрокаВыписки.Субконто1  = Выборка4.Контрагент;
						СтрокаВыписки.ИмяПКО1    = "Контрагенты";
						СтрокаВыписки.Субконто2  = Выборка4.ДоговорКонтрагента;
						СтрокаВыписки.ИмяПКО2    = "Договоры";
						СтрокаВыписки.Приход     = Выборка4.СуммаДокумента;
						СтрокаВыписки.КурсОплаты = Выборка4.КурсВзаиморасчетов / Выборка4.КратностьВзаиморасчетов;
						СтрокаВыписки.Расход     = 0;

					ИначеЕсли Выборка4.ВидОперации = Перечисления.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ПрочееПоступлениеБезналичныхДенежныхСредств Тогда
						
						СтрокаВыписки.ВидДвижения.Наименование = "Прочие поступления";
						СтрокаВыписки.ВидДвижения.ВидДвижения  = "ПрочиеПоступления";
						СтрокаВыписки.КоррСчет                 = "";
						СтрокаВыписки.Приход                   = Выборка4.СуммаПлатежа;
						СтрокаВыписки.Расход                   = 0;

					ИначеЕсли Выборка4.ВидОперации = Перечисления.ВидыОперацийСписаниеБезналичныхДенежныхСредств.ОплатаПоставщику Тогда
						СтрокаВыписки.ВидДвижения.Наименование = "Оплата поставщику";
						СтрокаВыписки.ВидДвижения.ВидДвижения  = "ПриобретениеТоваровПродукцииРаботИУслуг";
	                    Если Выборка4.Валюта &lt;&gt; Константы.ВалютаРегламентированногоУчета.Получить() Тогда
					        СтрокаВыписки.КоррСчет = "60.11";
						Иначе
							СтрокаВыписки.КоррСчет = "60.1";
						КонецЕсли;

						СтрокаВыписки.Субконто1 = Выборка4.Контрагент;
						СтрокаВыписки.ИмяПКО1 = "Контрагенты";
						СтрокаВыписки.Субконто2 = Выборка4.ДоговорКонтрагента;
						СтрокаВыписки.ИмяПКО2 = "Договоры";
						СтрокаВыписки.Приход = 0;
						СтрокаВыписки.Расход = Выборка4.СуммаПлатежа;
						СтрокаВыписки.КурсОплаты = Выборка4.КурсВзаиморасчетов / Выборка4.КратностьВзаиморасчетов;
						
					ИначеЕсли Выборка4.ВидОперации = Перечисления.ВидыОперацийСписаниеБезналичныхДенежныхСредств.ВозвратДенежныхСредствПокупателю Тогда
						СтрокаВыписки.ВидДвижения.Наименование = "Прочие выплаты";
						СтрокаВыписки.ВидДвижения.ВидДвижения  = "ПрочиеВыплатыИПеречисления";
						Если Выборка4.Валюта &lt;&gt; ВалютаРегламентированногоУчета Тогда
					        СтрокаВыписки.КоррСчет = "62.22";
						Иначе
							СтрокаВыписки.КоррСчет = "62.2";
						КонецЕсли;
						
						СтрокаВыписки.Субконто1 = Выборка4.Контрагент;
						СтрокаВыписки.ИмяПКО1 = "Контрагенты";
						СтрокаВыписки.Субконто2 = Выборка4.ДоговорКонтрагента;
						СтрокаВыписки.ИмяПКО2 = "Договоры";
						СтрокаВыписки.Приход = 0;
						СтрокаВыписки.Расход = Выборка4.СуммаДокумента;
						СтрокаВыписки.КурсОплаты = Выборка4.КурсВзаиморасчетов / Выборка4.КратностьВзаиморасчетов;
						
					ИначеЕсли Выборка4.ВидОперации = Перечисления.ВидыОперацийСписаниеБезналичныхДенежныхСредств.ПрочееСписаниеБезналичныхДенежныхСредств Тогда
						
						СтрокаВыписки.ВидДвижения.Наименование = "Прочие выплаты";
						СтрокаВыписки.ВидДвижения.ВидДвижения  = "ПрочиеВыплатыИПеречисления";
						СтрокаВыписки.КоррСчет = "";
						СтрокаВыписки.Приход = 0;
						СтрокаВыписки.Расход = Выборка4.СуммаПлатежа;
						
					КонецЕсли;
				КонецЦикла;
			КонецЦикла;
		КонецЦикла;
	КонецЦикла;	
	ИмяПКО = "Выписка";

ИначеЕсли ИДОснования = "ПриходныйКассовыйОрдер" Тогда
	ИмяПКО = "ПриходныйОрдер";
	
ИначеЕсли ИДОснования = "ОтчетКомитентуОПродажах" Тогда
	ИмяПКО = "ОказаниеУслугКомиссии";
	
ИначеЕсли ИДОснования = "ОтчетКомиссионераОПродажах" Тогда
	ИмяПКО = "РеализацияОтгруженнойПродукции";
	
ИначеЕсли ИДОснования = "РеализацияТоваровУслуг" Тогда
	
	Если Источник.Склад.ВидСклада &lt;&gt; Перечисления.ВидыСкладов.Оптовый Тогда
		Пусто = Истина;
	КонецЕсли;
	
	ИмяПКО = "РасходнаяНакладная";
	
ИначеЕсли ИдОснования = "ВозвратТоваровОтПокупателя" Тогда
	
	Пусто = Истина;	
	
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>44</Код><Наименование> --&gt; ВерсияОбъекта</Наименование><Порядок>1300</Порядок><Источник/><Приемник Имя="ВерсияОбъекта" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Значение = "7.70.447"</ПередВыгрузкой></Свойство><Свойство><Код>45</Код><Наименование> --&gt; СуммаНДСопределяетсяРасчетнымМетодом</Наименование><Порядок>1400</Порядок><Источник/><Приемник Имя="СуммаНДСопределяетсяРасчетнымМетодом" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>ИДОснования = Источник.Метаданные().Имя;

Если ИДОснования = "ПлатежноеПоручениеВходящее" Тогда
    Значение = 1;
	
ИначеЕсли ИДОснования = "ПриходныйКассовыйОрдер" Тогда
	Значение = 1;
	
Иначе
	Значение = 0;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>46</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>1600</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>47</Код><Наименование> --&gt; НомерПлатРасчДок</Наименование><Порядок>1700</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="НомерПлатРасчДок" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>48</Код><Наименование> --&gt; ДатаПлатРасчДок</Наименование><Порядок>1800</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="ДатаПлатРасчДок" Вид="Реквизит" Тип="Дата"/></Свойство></Свойства><Значения/></Правило><Правило><Код>СчетФактураПолученный</Код><Наименование>ДокументСсылка.СчетФактураПолученный --&gt; ДокументСсылка.СчетФактураПолученный</Наименование><Порядок>2300</Порядок><ПередВыгрузкой>ДатаСФ = Формат(Источник.Дата, "ДЛФ=Д");
ДатаОсн = Формат(Источник.ДокументОснование.Дата, "ДЛФ=Д");
Если ДатаСФ = ДатаОсн Тогда
	Отказ = Истина;
КонецЕсли;

Всего = 0;
СуммаБезНДС20 = 0;
НДС20 = 0;
СуммаБезНДС10 = 0;
НДС10 = 0;
СуммаСовсемБезНДС = 0;

ИдОснования = Источник.ДокументОснование.Метаданные().Имя;
Если ИдОснования = "ПоступлениеТоваров" Тогда
    УчитыватьНДС = Источник.ДокументОснование.УчитыватьНДС;
	СуммаВключаетНДС = Источник.ДокументОснование.СуммаВключаетНДС;
	
	Для НомерТабличнойЧасти = 1 по 2 Цикл
		Если НомерТабличнойЧасти = 1 Тогда
			Товары = Источник.ДокументОснование.Товары;

		Иначе // Если НомерТабличнойЧасти = 2 Тогда
			Товары = Источник.ДокументОснование.Услуги;
        КонецЕсли;

		Для каждого Товар из Товары Цикл
			Сумма = Товар.Сумма;

			Всего = Всего + Сумма;

			Если СуммаВключаетНДС Тогда
				Сумма = Сумма - Товар.СуммаНДС;
			КонецЕсли;

			СтНДС = ПолучитьСтавкуНДС(Товар.СтавкаНДС);
			Если СтНДС &gt; 10 Тогда
				НДС20 = НДС20 + Товар.СуммаНДС;
				СуммаБезНДС20 = СуммаБезНДС20 + Сумма;

			ИначеЕсли СтНДС &gt; 0 Тогда
				НДС10 = НДС10 + Товар.СуммаНДС;
				СуммаБезНДС10 = СуммаБезНДС10 + Сумма;

			Иначе
				СуммаСовсемБезНДС = СуммаСовсемБезНДС + Сумма;
			КонецЕсли;
    	КонецЦикла;
	КонецЦикла;

ИначеЕсли ИдОснования = "ПоступлениеДопРасходов" Тогда
	Док = Источник.ДокументОснование;

	Сумма = Док.СуммаДокумента + Док.Сумма;
	Всего = Всего + Сумма;

	Если Док.СуммаВключаетНДС Тогда
		Сумма = Сумма - Док.СуммаНДС;
	КонецЕсли;

	СтНДС = ПолучитьСтавкуНДС(Док.СтавкаНДС);
	Если СтНДС &gt; 10 Тогда
		НДС20 = НДС20 + Док.СуммаНДС;
		СуммаБезНДС20 = СуммаБезНДС20 + Сумма;

	ИначеЕсли СтНДС &gt; 0 Тогда
		НДС10 = НДС10 + Док.СуммаНДС;
		СуммаБезНДС10 = СуммаБезНДС10 + Сумма;

	Иначе
		СуммаСовсемБезНДС = СуммаСовсемБезНДС + Сумма;
	КонецЕсли;

ИначеЕсли ИдОснования = "ОтчетКомиссионераОПродажах" Тогда
	Товары = Источник.ДокументОснование.Товары;
	УчитыватьНДС = Источник.ДокументОснование.УчитыватьНДС;
	СуммаВключаетНДС = Источник.ДокументОснование.СуммаВключаетНДС;

	Для каждого Товар из Товары Цикл
		Сумма = Товар.Сумма;
		Всего = Всего + Сумма;

		Если СуммаВключаетНДС Тогда
			Сумма = Сумма - Товар.СуммаНДС;
		КонецЕсли;

		СтНДС = ПолучитьСтавкуНДС(Товар.СтавкаНДС);
		Если СтНДС &gt; 10 Тогда
			НДС20 = НДС20 + Товар.СуммаНДС;
			СуммаБезНДС20 = СуммаБезНДС20 + Сумма;

		ИначеЕсли СтНДС &gt; 0 Тогда
			НДС10 = НДС10 + Товар.СуммаНДС;
			СуммаБезНДС10 = СуммаБезНДС10 + Сумма;

		Иначе
			СуммаСовсемБезНДС = СуммаСовсемБезНДС + Сумма;
		КонецЕсли;
	КонецЦикла;
ИначеЕсли ИДОснования = "АвансовыйОтчет" Тогда
	Отказ = Истина;
КонецЕсли;

Если Не Отказ Тогда
	
	ВалютаРегл = Константы.ВалютаРегламентированногоУчета.Получить();
	ДатаДок = Источник.ДокументОснование.Дата;

	ВалютаНач      = Источник.ДокументОснование.ВалютаДокумента;
	ПоКурсуНач     = КурсДокумента(Источник.ДокументОснование, ВалютаРегл);
	ПоКратностьНач = КратностьДокумента(Источник.ДокументОснование, ВалютаРегл);

	Если ПоКурсуНач = 0 Тогда
		ФильтрПоВалютеНач = Новый Структура("Валюта", ВалютаНач);
		ПоКурсуНач = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеНач).Курс;
		ПоКратностьНач = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеНач).Кратность;
	КонецЕсли;

	ВалютаКон      = Источник.ДокументОснование.ДоговорКонтрагента.ВалютаВзаиморасчетов;
	ПоКурсуКон     = Источник.ДокументОснование.КурсВзаиморасчетов;
	ПоКратностьКон = Источник.ДокументОснование.КратностьВзаиморасчетов;

	Если ПоКурсуКон = 0 Тогда
		ФильтрПоВалютеКон = Новый Структура("Валюта", ВалютаКон);
		ПоКурсуКон = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеКон).Курс;
		ПоКратностьКон = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеКон).Кратность;
	КонецЕсли;

	ПоКратностьНач = ?(ПоКратностьНач = 0, 1, ПоКратностьНач);
	ПоКратностьКон = ?(ПоКратностьКон = 0, 1, ПоКратностьКон);

	ВходящиеДанные = Новый Структура("Всего, СуммаБезНДС20, НДС20, СуммаБезНДС10, НДС10, СуммаСовсемБезНДС");
	ВходящиеДанные.Всего = ПересчитатьИзВалютыВВалюту(Всего, ВалютаНач, ВалютаКон, ПоКурсуНач, ПоКурсуКон, ПоКратностьНач, ПоКратностьКон);
	ВходящиеДанные.СуммаБезНДС20 = ПересчитатьИзВалютыВВалюту(СуммаБезНДС20, ВалютаНач, ВалютаКон, ПоКурсуНач, ПоКурсуКон, ПоКратностьНач, ПоКратностьКон);
	ВходящиеДанные.НДС20 = ПересчитатьИзВалютыВВалюту(НДС20, ВалютаНач, ВалютаКон, ПоКурсуНач, ПоКурсуКон, ПоКратностьНач, ПоКратностьКон);
	ВходящиеДанные.СуммаБезНДС10 = ПересчитатьИзВалютыВВалюту(СуммаБезНДС10, ВалютаНач, ВалютаКон, ПоКурсуНач, ПоКурсуКон, ПоКратностьНач, ПоКратностьКон);
	ВходящиеДанные.НДС10 = ПересчитатьИзВалютыВВалюту(НДС10, ВалютаНач, ВалютаКон, ПоКурсуНач, ПоКурсуКон, ПоКратностьНач, ПоКратностьКон);
	ВходящиеДанные.СуммаСовсемБезНДС = ПересчитатьИзВалютыВВалюту(СуммаСовсемБезНДС, ВалютаНач, ВалютаКон, ПоКурсуНач, ПоКурсуКон, ПоКратностьНач, ПоКратностьКон);
	
КонецЕсли;</ПередВыгрузкой><Источник>ДокументСсылка.СчетФактураПолученный</Источник><Приемник>ДокументСсылка.СчетФактураПолученный</Приемник><Свойства><Группа><Код>1</Код><Наименование> --&gt; ТабличнаяЧасть</Наименование><Порядок>2100</Порядок><Источник/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><ПередОбработкойВыгрузки>Если Источник.ДокументОснование.Метаданные().Имя = "ПоступлениеТоваров" Тогда
	Товары = Источник.ДокументОснование.Товары;

	КоллекцияОбъектов = Новый ТаблицаЗначений;
	КоллекцияОбъектов.Колонки.Добавить("Товар");
	КоллекцияОбъектов.Колонки.Добавить("ГТД");
	КоллекцияОбъектов.Колонки.Добавить("Количество");
	КоллекцияОбъектов.Колонки.Добавить("ТипТовара");

	Для каждого Товар из Товары Цикл
		Если Не одПустое(Товар.ГТД) Тогда
			Стр = КоллекцияОбъектов.Добавить();
			Стр.Товар = Товар.Номенклатура;
			Стр.ГТД = Новый Структура ("Наименование, СтранаПроисхождения, Комментарий", 
											Товар.СерияНоменклатуры.НомерГТД.Код, Товар.СтранаПроисхождения, Товар.СерияНоменклатуры.НомерГТД.Комментарий);
			Стр.Количество = Товар.Количество * Товар.Коэффициент;
			Если Источник.ДокументОснование.ДоговорКонтрагента.ВидДоговора = Перечисления.ВидыДоговоровКонтрагентов.СПоставщиком Тогда
			 	Стр.ТипТовара = "Собственный";
			 Иначе
				Стр.ТипТовара = "НаКомиссии";
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;

Иначе
    Отказ = Истина;
КонецЕсли;</ПередОбработкойВыгрузки><Свойство><Код>4</Код><Наименование> --&gt; Количество</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>3</Код><Наименование> --&gt; ГТД</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="ГТД" Вид="Реквизит" Тип="СправочникСсылка.ГТД"/><КодПравилаКонвертации>ГТД                                               </КодПравилаКонвертации></Свойство><Свойство><Код>2</Код><Наименование> --&gt; Товар</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Товар" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/><КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации><ПередВыгрузкой>ИсходящиеДанные = Новый Структура;
ИсходящиеДанные.Вставить("ТипТовара", ОбъектКоллекции.ТипТовара);
ИсходящиеДанные.Вставить("ТипНоменклатуры", ?(ОбъектКоллекции.Товар.Услуга, "Услуга", "Товар"));</ПередВыгрузкой></Свойство></Группа><Свойство><Код>21</Код><Наименование> --&gt; СуммаСовсемБезНДС</Наименование><Порядок>1600</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="СуммаСовсемБезНДС" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>20</Код><Наименование> --&gt; НДС10</Наименование><Порядок>1500</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="НДС10" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>19</Код><Наименование> --&gt; СуммаБезНДС10</Наименование><Порядок>1400</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="СуммаБезНДС10" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>18</Код><Наименование> --&gt; НДС20</Наименование><Порядок>1300</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="НДС20" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>23</Код><Наименование> --&gt; Договор</Наименование><Порядок>1700</Порядок><Источник/><Приемник Имя="Договор" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации><ПередВыгрузкой>Значение = Источник.ДокументОснование.ДоговорКонтрагента;</ПередВыгрузкой></Свойство><Свойство><Код>24</Код><Наименование> --&gt; Курс</Наименование><Порядок>1800</Порядок><Источник/><Приемник Имя="Курс" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = Источник.ДокументОснование.КурсВзаиморасчетов;</ПередВыгрузкой></Свойство><Свойство><Код>25</Код><Наименование> --&gt; ФормироватьПроводки</Наименование><Порядок>1900</Порядок><Источник/><Приемник Имя="ФормироватьПроводки" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если Источник.ДокументОснование.Метаданные().Имя = "ОтчетКомиссионераОПродажах" Тогда
	Значение = 0;

Иначе
	Значение = 1;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>26</Код><Наименование> --&gt; ВерсияОбъекта</Наименование><Порядок>2000</Порядок><Источник/><Приемник Имя="ВерсияОбъекта" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Значение = "7.70.447"</ПередВыгрузкой></Свойство><Свойство><Код>27</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>2200</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>17</Код><Наименование> --&gt; СуммаБезНДС20</Наименование><Порядок>1200</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="СуммаБезНДС20" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>16</Код><Наименование> --&gt; Всего</Наименование><Порядок>1100</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="Всего" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>14</Код><Наименование> --&gt; Субконто2</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="Субконто2" Вид="Реквизит"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации><ПередВыгрузкой>ИмяПКО = "Договоры";
Значение = Источник.ДокументОснование.ДоговорКонтрагента;</ПередВыгрузкой></Свойство><Свойство><Код>13</Код><Наименование> --&gt; Субконто1</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="Субконто1" Вид="Реквизит"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации><ПередВыгрузкой>ИмяПКО = "Контрагенты";
Значение = Источник.ДокументОснование.Контрагент;</ПередВыгрузкой></Свойство><Свойство><Код>12</Код><Наименование> --&gt; Счет</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="Счет" Вид="Реквизит"/><ПередВыгрузкой>ТипПриемника = "ПланСчетовСсылка.Основной";
Значение = "60.1";</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>11</Код><Наименование> --&gt; Контрагент</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации><ПередВыгрузкой>Значение = Источник.ДокументОснование.Контрагент;
</ПередВыгрузкой></Свойство><Свойство><Код>10</Код><Наименование> --&gt; Субсчет19</Наименование><Порядок>600</Порядок><Источник/><Приемник Имя="Субсчет19" Вид="Реквизит"/><ПередВыгрузкой>ТипПриемника = "ПланСчетовСсылка.Основной";
Значение = "19.3";</ПередВыгрузкой></Свойство><Свойство><Код>9</Код><Наименование> --&gt; ДатаОприходования</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="ДатаОприходования" Вид="Реквизит" Тип="Дата"/><ПередВыгрузкой>Значение = Источник.ДокументОснование.Дата;</ПередВыгрузкой></Свойство><Свойство><Код>8</Код><Наименование> --&gt; ДокументОприходования</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="ДокументОприходования" Вид="Реквизит"/><ПередВыгрузкой>Значение = Источник.ДокументОснование;

ИдОснования = Значение.Метаданные().Имя;
Если ИдОснования = "ПоступлениеТоваров" Тогда
	Товары = Источник.ДокументОснование.Товары;
	Услуги = Источник.ДокументОснование.Услуги;
	Если (Товары.Количество() &lt;&gt; 0) и (Услуги.Количество() &lt;&gt; 0) Тогда
        Отказ = Истина;
		
	ИначеЕсли (Товары.Количество() &lt;&gt; 0) и (Услуги.Количество() = 0) Тогда
        ИмяПКО = "ПоступлениеТоваров";
		
	ИначеЕсли (Товары.Количество() = 0) и (Услуги.Количество() &lt;&gt; 0) Тогда
		ИмяПКО = "УслугиСтороннихОрганизаций";

	Иначе
		Отказ = Истина;
	КонецЕсли;

ИначеЕсли ИдОснования = "ПоступлениеДопРасходов" Тогда
	ИмяПКО = "УслугиСтороннихОрганизацийДопРасходы";

ИначеЕсли ИдОснования = "ОтчетКомиссионераОПродажах" Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>7</Код><Наименование> --&gt; ДатаНомерСчетаФактуры</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="ДатаНомерСчетаФактуры" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Значение = Формат(Источник.ДатаВходящегоДокумента, "ДЛФ=Д") + " " + Источник.НомерВходящегоДокумента;</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>6</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>Если ЗначениеНеЗаполнено(Источник.НомерВходящегоДокумента) Тогда
	ЧисловаяЧасть = "";
	ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
	Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "", 10, "");
Иначе
	Значение = Источник.НомерВходящегоДокумента;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>5</Код><Наименование> --&gt; ДатаДок</Наименование><Порядок>200</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство></Свойства><Значения/></Правило><Правило><Код>УслугиСтороннихОрганизаций</Код><Наименование>ДокументСсылка.ПоступлениеТоваров --&gt; ДокументСсылка.УслугиСтороннихОрганизаций</Наименование><Порядок>700</Порядок><ПередВыгрузкой>Если Источник.Услуги.Количество() = 0 Тогда
	Отказ = Истина;
КонецЕсли;

КлючВыгружаемыхДанных = ЗначениеВСтрокуВнутр(Источник) + ИмяПКО;</ПередВыгрузкой><Источник>ДокументСсылка.ПоступлениеТоваровУслуг</Источник><Приемник>ДокументСсылка.УслугиСтороннихОрганизаций</Приемник><Свойства><Свойство Поиск="true"><Код>11</Код><Наименование> --&gt; ДатаДок</Наименование><Порядок>100</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство><Код>1</Код><Наименование>Контрагент --&gt; Контрагент</Наименование><Порядок>300</Порядок><Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство><Код>24</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>1600</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>23</Код><Наименование> --&gt; ДатаДокВходящий</Наименование><Порядок>1400</Порядок><Источник Имя="ДатаВходящегоДокумента" Вид="Реквизит" Тип="Дата"/><Приемник Имя="ДатаДокВходящий" Вид="Реквизит" Тип="Дата"/></Свойство><Свойство><Код>22</Код><Наименование> --&gt; НомерДокВходящий</Наименование><Порядок>1300</Порядок><Источник Имя="НомерВходящегоДокумента" Вид="Реквизит" Тип="Строка"/><Приемник Имя="НомерДокВходящий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>21</Код><Наименование> --&gt; ВерсияОбъекта</Наименование><Порядок>1200</Порядок><Источник/><Приемник Имя="ВерсияОбъекта" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Значение = "7.70.447"</ПередВыгрузкой></Свойство><Свойство><Код>20</Код><Наименование> --&gt; Курс</Наименование><Порядок>1100</Порядок><Источник Имя="КурсВзаиморасчетов" Вид="Реквизит" Тип="Число"/><Приемник Имя="Курс" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>19</Код><Наименование> --&gt; НДСвключатьВСтоимость</Наименование><Порядок>1000</Порядок><Источник Имя="НДСВключенВСтоимость" Вид="Реквизит" Тип="Булево"/><Приемник Имя="НДСвключатьВСтоимость" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>18</Код><Наименование> --&gt; ТипИсполнителя</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="ТипИсполнителя" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 1;</ПередВыгрузкой></Свойство><Свойство><Код>17</Код><Наименование> --&gt; ВариантРасчетаНалогов</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="ВариантРасчетаНалогов" Вид="Реквизит" Тип="СправочникСсылка.ВариантыРасчетаНалогов"/><КодПравилаКонвертации>ВариантыРасчетаНалогов                            </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("СуммаВключаетНДС, СуммаВключаетНП, УчитыватьНДС, УчитыватьНП");
Значение.СуммаВключаетНДС = Источник.СуммаВключаетНДС;
Значение.СуммаВключаетНП  = Ложь;
Значение.УчитыватьНДС = Источник.УчитыватьНДС;
Значение.УчитыватьНП  = Ложь;</ПередВыгрузкой></Свойство><Свойство><Код>16</Код><Наименование> --&gt; ДатаНомерСчетаФактуры</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="ДатаНомерСчетаФактуры" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>СчетФактура = НайтиПодчиненныйДокумент(Источник, "СчетФактураПолученный");

Если СчетФактура = Неопределено Тогда
	Отказ = Истина;
	
Иначе
    ДатаСФ = Формат(СчетФактура.Дата, "ДЛФ=Д");
	Если ДатаСФ &lt;&gt; Формат(Источник.Дата, "ДЛФ=Д") Тогда
		Отказ = Истина;
		
	Иначе
		Значение = ДатаСФ + " " + СчетФактура.Номер;
	КонецЕсли;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>15</Код><Наименование> --&gt; ЗачитыватьАванс</Наименование><Порядок>600</Порядок><Источник/><Приемник Имя="ЗачитыватьАванс" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 2;</ПередВыгрузкой></Свойство><Свойство><Код>14</Код><Наименование> --&gt; Валюта</Наименование><Порядок>500</Порядок><Источник Имя="ВалютаДокумента" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/><Приемник Имя="Валюта" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/><КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации><ПередВыгрузкой>Значение = Источник.ДоговорКонтрагента.ВалютаВзаиморасчетов;</ПередВыгрузкой></Свойство><Свойство><Код>13</Код><Наименование> --&gt; Договор</Наименование><Порядок>400</Порядок><Источник Имя="ДоговорКонтрагента" Вид="Реквизит" Тип="СправочникСсылка.ДоговорыКонтрагентов"/><Приемник Имя="Договор" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство Поиск="true"><Код>12</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "П", 6, "Справа");</ПередВыгрузкой></Свойство><Группа><Код>2</Код><Наименование> --&gt; ТабличнаяЧасть</Наименование><Порядок>1500</Порядок><Источник Имя="Услуги" Вид="ТабличнаяЧасть"/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><ПередОбработкойВыгрузки>КоллекцияОбъектов = Новый ТаблицаЗначений;
КоллекцияОбъектов.Колонки.Добавить("КоррСчет");
КоллекцияОбъектов.Колонки.Добавить("Субконто1");
КоллекцияОбъектов.Колонки.Добавить("Субконто2");
КоллекцияОбъектов.Колонки.Добавить("Субконто3");
КоллекцияОбъектов.Колонки.Добавить("Количество");
КоллекцияОбъектов.Колонки.Добавить("Содержание");
КоллекцияОбъектов.Колонки.Добавить("СуммаНДС");
КоллекцияОбъектов.Колонки.Добавить("Сумма");
КоллекцияОбъектов.Колонки.Добавить("СтатьяЗатрат");

Для каждого СтрокаТЧ из Источник.Услуги Цикл
	СтрокаКоллекции = КоллекцияОбъектов.Добавить();
	ВидРасхода = СтрокаТЧ.СтатьяЗатрат.ХарактерЗатрат;
	Если ВидРасхода = Перечисления.ХарактерЗатрат.ПроизводственныеРасходы Тогда
		СтрокаКоллекции.КоррСчет  = "20";  
		СтруктураСубконто1 = Новый Структура("Наименование, ТипНоменклатуры");
		СтруктураСубконто1.Наименование = "Товар";
		СтруктураСубконто1.ТипНоменклатуры = "Товар";
		СтрокаКоллекции.Субконто1 = СтруктураСубконто1;
		СтрокаКоллекции.Субконто2 = СтрокаТЧ.СтатьяЗатрат.Наименование;
		//СтрокаКоллекции.Субконто3 = СтрокаТЧ.ПодразделениеЗатраты;
	ИначеЕсли ВидРасхода = Перечисления.ХарактерЗатрат.ОбщепроизводственныеРасходы Тогда
		СтрокаКоллекции.КоррСчет = "25";
		СтрокаКоллекции.Субконто1 = СтрокаТЧ.СтатьяЗатрат.Наименование;
		//СтрокаКоллекции.Субконто2 = СтрокаТЧ.ПодразделениеЗатраты;
	ИначеЕсли ВидРасхода = Перечисления.ХарактерЗатрат.ОбщехозяйственныеРасходы Тогда
		СтрокаКоллекции.КоррСчет = "26";
		СтрокаКоллекции.Субконто1 = СтрокаТЧ.СтатьяЗатрат.Наименование;
		//СтрокаКоллекции.Субконто2 = СтрокаТЧ.ПодразделениеЗатраты;
	ИначеЕсли ВидРасхода = Перечисления.ХарактерЗатрат.КоммерческиеРасходы Тогда
		СтрокаКоллекции.КоррСчет = "44.2";
		СтрокаКоллекции.Субконто1 = СтрокаТЧ.СтатьяЗатрат.Наименование;
	ИначеЕсли ВидРасхода = Перечисления.ХарактерЗатрат.ИздержкиОбращения Тогда
		СтрокаКоллекции.КоррСчет = "44.1.3";
		СтрокаКоллекции.Субконто1 = СтрокаТЧ.СтатьяЗатрат.Наименование;
	КонецЕсли;
	СтрокаКоллекции.Содержание   = СтрокаТЧ.Содержание;
	СтрокаКоллекции.Количество   = СтрокаТЧ.Количество;
	СтрокаКоллекции.СуммаНДС     = СтрокаТЧ.СуммаНДС;
	СтрокаКоллекции.Сумма        = СтрокаТЧ.Сумма;
	СтрокаКоллекции.СтатьяЗатрат = СтрокаТЧ.СтатьяЗатрат;
КонецЦикла;</ПередОбработкойВыгрузки><Свойство><Код>10</Код><Наименование> --&gt; Сумма</Наименование><Порядок>800</Порядок><Источник Имя="Сумма" Вид="Реквизит" Тип="Число"/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>8</Код><Наименование> --&gt; НДС</Наименование><Порядок>600</Порядок><Источник Имя="СуммаНДС" Вид="Реквизит" Тип="Число"/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>7</Код><Наименование> --&gt; Всего</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="Всего" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если Не Источник.СуммаВключаетНДС Тогда
	Значение = ОбъектКоллекции.Сумма + ОбъектКоллекции.СуммаНДС;
Иначе
	Значение = ОбъектКоллекции.Сумма;
КонецЕсли;</ПередВыгрузкой><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>6</Код><Наименование> --&gt; Количество</Наименование><Порядок>400</Порядок><Источник Имя="Количество" Вид="Реквизит" Тип="Число"/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>5</Код><Наименование> --&gt; Субконто1</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Субконто1" Вид="Реквизит"/><ПередВыгрузкой>Если ОбъектКоллекции.КоррСчет  = "20" Тогда
	ИмяПКО = "ВидыНоменклатуры";
ИначеЕсли ОбъектКоллекции.КоррСчет = "25" Тогда
	ИмяПКО = "СтатьиОбщепроизводственныхЗатрат";
ИначеЕсли ОбъектКоллекции.КоррСчет = "26" Тогда
	ИмяПКО = "СтатьиОбщехозяйственныхЗатрат";
ИначеЕсли ОбъектКоллекции.КоррСчет = "44.2" Тогда
	ИмяПКО = "СтатьиКоммерческихРасходов";
ИначеЕсли ОбъектКоллекции.КоррСчет = "44.1.3" Тогда
	ИмяПКО = "СтатьиРасходовНаПродажу";
ИначеЕсли ОбъектКоллекции.КоррСчет = "44.1.1" Тогда
	ИмяПКО = "СтатьиИздержекОбращения";
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>4</Код><Наименование> --&gt; КоррСчет</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="КоррСчет" Вид="Реквизит"/><ПередВыгрузкой>ТипПриемника = "ПланСчетовСсылка.Основной";</ПередВыгрузкой></Свойство><Свойство><Код>3</Код><Наименование> --&gt; НаименованиеУслуги</Наименование><Порядок>100</Порядок><Источник Имя="Содержание" Вид="Реквизит" Тип="Строка"/><Приемник Имя="НаименованиеУслуги" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>26</Код><Наименование> --&gt; Субконто3</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="Субконто3" Вид="Реквизит"/><ПередВыгрузкой>ВидРасхода = ОбъектКоллекции.СтатьяЗатрат.ХарактерЗатрат;
Если ВидРасхода = Перечисления.ХарактерЗатрат.ПроизводственныеРасходы Тогда
	ИмяПКО = "Подразделения";
Иначе
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>25</Код><Наименование> --&gt; Субконто2</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="Субконто2" Вид="Реквизит"/><ПередВыгрузкой>ВидРасхода = ОбъектКоллекции.СтатьяЗатрат.ХарактерЗатрат;
Если ВидРасхода = Перечисления.ХарактерЗатрат.ПроизводственныеРасходы Тогда
	ИмяПКО = "СтатьиЗатратНаПроизводство";
ИначеЕсли ВидРасхода = Перечисления.ХарактерЗатрат.ОбщепроизводственныеРасходы Тогда
	ИмяПКО = "Подразделения";
ИначеЕсли ВидРасхода = Перечисления.ХарактерЗатрат.ОбщехозяйственныеРасходы Тогда
	ИмяПКО = "Подразделения";
Иначе
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>УслугиСтороннихОрганизацийДопРасходы</Код><Наименование>ДокументСсылка.ПоступлениеДопРасходов --&gt; ДокументСсылка.УслугиСтороннихОрганизаций</Наименование><Порядок>1800</Порядок><Источник>ДокументСсылка.ПоступлениеДопРасходов</Источник><Приемник>ДокументСсылка.УслугиСтороннихОрганизаций</Приемник><Свойства><Свойство><Код>16</Код><Наименование> --&gt; Валюта</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="Валюта" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/><КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации><ПередВыгрузкой>Значение = Источник.ДоговорКонтрагента.ВалютаВзаиморасчетов;</ПередВыгрузкой></Свойство><Свойство><Код>15</Код><Наименование> --&gt; Договор</Наименование><Порядок>400</Порядок><Источник Имя="ДоговорКонтрагента" Вид="Реквизит" Тип="СправочникСсылка.ДоговорыКонтрагентов"/><Приемник Имя="Договор" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство Поиск="true"><Код>14</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "Д", 6, "Справа");</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>13</Код><Наименование> --&gt; ДатаДок</Наименование><Порядок>100</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство><Код>1</Код><Наименование>Контрагент --&gt; Контрагент</Наименование><Порядок>300</Порядок><Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство><Код>28</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>1700</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>24</Код><Наименование> --&gt; ВерсияОбъекта</Наименование><Порядок>1300</Порядок><Источник/><Приемник Имя="ВерсияОбъекта" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Значение = "7.70.447"</ПередВыгрузкой></Свойство><Свойство><Код>23</Код><Наименование> --&gt; Курс</Наименование><Порядок>1200</Порядок><Источник Имя="КурсВзаиморасчетов" Вид="Реквизит" Тип="Число"/><Приемник Имя="Курс" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>22</Код><Наименование> --&gt; НДСвключатьВСтоимость</Наименование><Порядок>1100</Порядок><Источник Имя="НДСВключенВСтоимость" Вид="Реквизит" Тип="Булево"/><Приемник Имя="НДСвключатьВСтоимость" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>21</Код><Наименование> --&gt; ТипИсполнителя</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="ТипИсполнителя" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 1;</ПередВыгрузкой></Свойство><Свойство><Код>20</Код><Наименование> --&gt; ВариантРасчетаНалогов</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="ВариантРасчетаНалогов" Вид="Реквизит" Тип="СправочникСсылка.ВариантыРасчетаНалогов"/><КодПравилаКонвертации>ВариантыРасчетаНалогов                            </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("СуммаВключаетНДС, СуммаВключаетНП, УчитыватьНДС, УчитыватьНП");
Значение.СуммаВключаетНДС = Источник.СуммаВключаетНДС;
Значение.СуммаВключаетНП  = Ложь;
Значение.УчитыватьНДС = Источник.УчитыватьНДС;
Значение.УчитыватьНП  = Ложь;</ПередВыгрузкой></Свойство><Свойство><Код>18</Код><Наименование> --&gt; ДатаНомерСчетаФактуры</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="ДатаНомерСчетаФактуры" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>СчетФактура = НайтиПодчиненныйДокумент(Источник.Ссылка, "СчетФактураПолученный");

Если СчетФактура = Неопределено Тогда
	Отказ = Истина;
	
Иначе
    ДатаСФ = Формат(СчетФактура.Дата, "ДЛФ=Д");
	Если ДатаСФ &lt;&gt; Формат(Источник.Дата, "ДЛФ=Д") Тогда
		Отказ = Истина;
		
	Иначе
		Значение = ДатаСФ + " " + СчетФактура.Номер;
	КонецЕсли;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>17</Код><Наименование> --&gt; ЗачитыватьАванс</Наименование><Порядок>600</Порядок><Источник/><Приемник Имя="ЗачитыватьАванс" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 2;</ПередВыгрузкой></Свойство><Группа><Код>2</Код><Наименование> --&gt; ТабличнаяЧасть</Наименование><Порядок>1600</Порядок><Источник Имя="ПартииТоваровНаСкладах" Вид="НаборДвиженийРегистраНакопления"/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><ПередОбработкойВыгрузки>ДатаДок = Источник.Дата;

ВалютаКон = Источник.ДоговорКонтрагента.ВалютаВзаиморасчетов;
ПоКурсуКон = Источник.КурсВзаиморасчетов;
ПоКратностьКон = Источник.КратностьВзаиморасчетов;

Если ПоКурсуКон = 0 Тогда
	ФильтрПоВалютеКон = Новый Структура("Валюта", ВалютаКон);
	ПоКурсуКон = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеКон).Курс;
	ПоКратностьКон = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеКон).Кратность;
КонецЕсли;

ВалютаНач = Константы.ВалютаУправленческогоУчета.Получить();
ФильтрПоВалютеНач = Новый Структура("Валюта", ВалютаНач);
ПоКурсуНач = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеНач).Курс;
ПоКратностьНач = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеНач).Кратность;

ПоКратностьНач = ?(ПоКратностьНач = 0, 1, ПоКратностьНач);
ПоКратностьКон = ?(ПоКратностьКон = 0, 1, ПоКратностьКон);

ВходящиеДанные = Новый Структура;
ВходящиеДанные.Вставить("ВалютаНач", ВалютаНач);
ВходящиеДанные.Вставить("ПоКурсуНач", ПоКурсуНач);
ВходящиеДанные.Вставить("ПоКратностьНач", ПоКратностьНач);
ВходящиеДанные.Вставить("ВалютаКон", ВалютаКон);
ВходящиеДанные.Вставить("ПоКурсуКон", ПоКурсуКон);
ВходящиеДанные.Вставить("ПоКратностьКон", ПоКратностьКон);
ВходящиеДанные.Вставить("Сумма", 0);
ВходящиеДанные.Вставить("НДС", 0);
ВходящиеДанные.Вставить("Всего", 0);
</ПередОбработкойВыгрузки><ПередВыгрузкой>Отбор = Новый Структура;                                                                                                                                   
СуммаВключаетНДС = Не РегистрыСведений.УчетнаяПолитика.ПолучитьПоследнее(Источник.Дата, Отбор).НеВключатьНДСВСтоимостьПартий;
ВходящиеДанные.Сумма = ПересчитатьИзВалютыВВалюту(ОбъектКоллекции.Стоимость, ВходящиеДанные.ВалютаНач, ВходящиеДанные.ВалютаКон, ВходящиеДанные.ПоКурсуНач, ВходящиеДанные.ПоКурсуКон, ВходящиеДанные.ПоКратностьНач, ВходящиеДанные.ПоКратностьКон);
ВходящиеДанные.НДС = РассчитатьСуммуНДС(ВходящиеДанные.Сумма, Источник.УчитыватьНДС, СуммаВключаетНДС, ПолучитьСтавкуНДС(Источник.СтавкаНДС));
Если Источник.СуммаВключаетНДС = СуммаВключаетНДС Тогда
ИначеЕсли Источник.СуммаВключаетНДС Тогда
	ВходящиеДанные.Сумма = ВходящиеДанные.Сумма + ВходящиеДанные.НДС;
Иначе
	ВходящиеДанные.Сумма = ВходящиеДанные.Сумма - ВходящиеДанные.НДС;
КонецЕсли;	
Если Источник.СуммаВключаетНДС Тогда
	ВходящиеДанные.Всего = ВходящиеДанные.Сумма;
Иначе
	ВходящиеДанные.Всего = ВходящиеДанные.Сумма + ВходящиеДанные.НДС;
КонецЕсли;
	

</ПередВыгрузкой><Свойство><Код>12</Код><Наименование> --&gt; Сумма</Наименование><Порядок>1000</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>10</Код><Наименование> --&gt; НДС</Наименование><Порядок>800</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>9</Код><Наименование> --&gt; Всего</Наименование><Порядок>700</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="Всего" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>3</Код><Наименование> --&gt; НаименованиеУслуги</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="НаименованиеУслуги" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Значение = Источник.Содержание;</ПередВыгрузкой></Свойство><Свойство><Код>27</Код><Наименование> --&gt; Субконто2</Наименование><Порядок>1300</Порядок><Источник/><Приемник Имя="Субконто2" Вид="Реквизит"/><КодПравилаКонвертации>МестаХранения                                     </КодПравилаКонвертации><ПередВыгрузкой>Если НЕ ЗначениеНеЗаполнено(ОбъектКоллекции.ДокументОприходования) И ЕстьРеквизитДокумента("Склад", ОбъектКоллекции.ДокументОприходования.Метаданные()) Тогда
	Значение = ОбъектКоллекции.ДокументОприходования.Склад;
Иначе
	Значение = Справочники.Склады.ПустаяСсылка()
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>26</Код><Наименование> --&gt; Субконто1</Наименование><Порядок>1200</Порядок><Источник/><Приемник Имя="Субконто1" Вид="Реквизит"/><КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации><ПередВыгрузкой>Значение = ОбъектКоллекции.Номенклатура;

ИсходящиеДанные = Новый Структура;
ИсходящиеДанные.Вставить("ТипНоменклатуры", "Товар");
ИсходящиеДанные.Вставить("ТипТовара", "Собственный");</ПередВыгрузкой></Свойство><Свойство><Код>25</Код><Наименование> --&gt; КоррСчет</Наименование><Порядок>1100</Порядок><Источник/><Приемник Имя="КоррСчет" Вид="Реквизит"/><ПередВыгрузкой>ТипПриемника = "ПланСчетовСсылка.Основной";
Если НЕ ЗначениеНеЗаполнено(ОбъектКоллекции.ДокументОприходования) И ЕстьРеквизитДокумента("Склад", ОбъектКоллекции.ДокументОприходования.Метаданные()) Тогда
	Если (ОбъектКоллекции.ДокументОприходования.Склад.ВидСклада &lt;&gt; Перечисления.ВидыСкладов.Оптовый) Тогда
		Значение = "41.2";
	Иначе
		Значение = "41.1";
	КонецЕсли;
		
Иначе
	Значение = "41.1";
КонецЕсли;</ПередВыгрузкой></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>УслугиСтороннихОрганизацийНТТ</Код><Наименование>ДокументСсылка.ПоступлениеТоваров --&gt; ДокументСсылка.УслугиСтороннихОрганизаций</Наименование><Порядок>700</Порядок><ПередВыгрузкой>Если Источник.Услуги.Количество() = 0 Тогда
	Отказ = Истина;
КонецЕсли;

КлючВыгружаемыхДанных = ЗначениеВСтрокуВнутр(Источник) + ИмяПКО;</ПередВыгрузкой><Источник>ДокументСсылка.ПоступлениеТоваровУслугВНеавтоматизированнуюТорговуюТочку</Источник><Приемник>ДокументСсылка.УслугиСтороннихОрганизаций</Приемник><Свойства><Свойство><Код>23</Код><Наименование> --&gt; ТипИсполнителя</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="ТипИсполнителя" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 1;</ПередВыгрузкой></Свойство><Свойство><Код>24</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>1600</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>25</Код><Наименование>Контрагент --&gt; Контрагент</Наименование><Порядок>300</Порядок><Источник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство><Код>12</Код><Наименование> --&gt; НомерДокВходящий</Наименование><Порядок>1300</Порядок><Источник Имя="НомерВходящегоДокумента" Вид="Реквизит" Тип="Строка"/><Приемник Имя="НомерДокВходящий" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство Поиск="true"><Код>11</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "Н", 6, "Справа");</ПередВыгрузкой></Свойство><Свойство><Код>10</Код><Наименование> --&gt; НДСвключатьВСтоимость</Наименование><Порядок>1000</Порядок><Источник Имя="НДСВключенВСтоимость" Вид="Реквизит" Тип="Булево"/><Приемник Имя="НДСвключатьВСтоимость" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>9</Код><Наименование> --&gt; Курс</Наименование><Порядок>1100</Порядок><Источник Имя="КурсВзаиморасчетов" Вид="Реквизит" Тип="Число"/><Приемник Имя="Курс" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>8</Код><Наименование> --&gt; ЗачитыватьАванс</Наименование><Порядок>600</Порядок><Источник/><Приемник Имя="ЗачитыватьАванс" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 2;</ПередВыгрузкой></Свойство><Свойство><Код>7</Код><Наименование> --&gt; Договор</Наименование><Порядок>400</Порядок><Источник Имя="ДоговорКонтрагента" Вид="Измерение" Тип="СправочникСсылка.ДоговорыКонтрагентов"/><Приемник Имя="Договор" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство><Код>6</Код><Наименование> --&gt; ДатаНомерСчетаФактуры</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="ДатаНомерСчетаФактуры" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>СчетФактура = НайтиПодчиненныйДокумент(Источник, "СчетФактураПолученный");

Если СчетФактура = Неопределено Тогда
	Отказ = Истина;
	
Иначе
    ДатаСФ = Формат(СчетФактура.Дата, "ДЛФ=Д");
	Если ДатаСФ &lt;&gt; Формат(Источник.Дата, "ДЛФ=Д") Тогда
		Отказ = Истина;
		
	Иначе
		Значение = ДатаСФ + " " + СчетФактура.Номер;
	КонецЕсли;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>5</Код><Наименование> --&gt; ДатаДокВходящий</Наименование><Порядок>1400</Порядок><Источник Имя="ДатаВходящегоДокумента" Вид="Реквизит" Тип="Дата"/><Приемник Имя="ДатаДокВходящий" Вид="Реквизит" Тип="Дата"/></Свойство><Свойство Поиск="true"><Код>4</Код><Наименование> --&gt; ДатаДок</Наименование><Порядок>100</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство><Код>3</Код><Наименование> --&gt; ВерсияОбъекта</Наименование><Порядок>1200</Порядок><Источник/><Приемник Имя="ВерсияОбъекта" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Значение = "7.70.447"</ПередВыгрузкой></Свойство><Свойство><Код>2</Код><Наименование> --&gt; ВариантРасчетаНалогов</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="ВариантРасчетаНалогов" Вид="Реквизит" Тип="СправочникСсылка.ВариантыРасчетаНалогов"/><КодПравилаКонвертации>ВариантыРасчетаНалогов                            </КодПравилаКонвертации><ПередВыгрузкой>Значение = Новый Структура("СуммаВключаетНДС, СуммаВключаетНП, УчитыватьНДС, УчитыватьНП");
Значение.СуммаВключаетНДС = Источник.СуммаВключаетНДС;
Значение.СуммаВключаетНП  = Ложь;
Значение.УчитыватьНДС = Источник.УчитыватьНДС;
Значение.УчитыватьНП  = Ложь;</ПередВыгрузкой></Свойство><Свойство><Код>1</Код><Наименование> --&gt; Валюта</Наименование><Порядок>500</Порядок><Источник Имя="ВалютаДокумента" Вид="Ресурс" Тип="СправочникСсылка.Валюты"/><Приемник Имя="Валюта" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/><КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации><ПередВыгрузкой>Значение = Источник.ДоговорКонтрагента.ВалютаВзаиморасчетов;</ПередВыгрузкой></Свойство><Группа><Код>13</Код><Наименование> --&gt; ТабличнаяЧасть</Наименование><Порядок>1500</Порядок><Источник Имя="Услуги" Вид="ТабличнаяЧасть"/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><ПередОбработкойВыгрузки>КоллекцияОбъектов = Новый ТаблицаЗначений;
КоллекцияОбъектов.Колонки.Добавить("КоррСчет");
КоллекцияОбъектов.Колонки.Добавить("Субконто1");
КоллекцияОбъектов.Колонки.Добавить("Субконто2");
КоллекцияОбъектов.Колонки.Добавить("Субконто3");
КоллекцияОбъектов.Колонки.Добавить("Количество");
КоллекцияОбъектов.Колонки.Добавить("Содержание");
КоллекцияОбъектов.Колонки.Добавить("СуммаНДС");
КоллекцияОбъектов.Колонки.Добавить("Сумма");
КоллекцияОбъектов.Колонки.Добавить("СтатьяЗатрат");

Для каждого СтрокаТЧ из Источник.Услуги Цикл
	СтрокаКоллекции = КоллекцияОбъектов.Добавить();
	ВидРасхода = СтрокаТЧ.СтатьяЗатрат.ХарактерЗатрат;
	Если ВидРасхода = Перечисления.ХарактерЗатрат.ПроизводственныеРасходы Тогда
		СтрокаКоллекции.КоррСчет  = "20";  
		СтруктураСубконто1 = Новый Структура("Наименование, ТипНоменклатуры");
		СтруктураСубконто1.Наименование = "Товар";
		СтруктураСубконто1.ТипНоменклатуры = "Товар";
		СтрокаКоллекции.Субконто1 = СтруктураСубконто1;
		СтрокаКоллекции.Субконто2 = СтрокаТЧ.СтатьяЗатрат.Наименование;
		//СтрокаКоллекции.Субконто3 = СтрокаТЧ.ПодразделениеЗатраты;
	ИначеЕсли ВидРасхода = Перечисления.ХарактерЗатрат.ОбщепроизводственныеРасходы Тогда
		СтрокаКоллекции.КоррСчет = "25";
		СтрокаКоллекции.Субконто1 = СтрокаТЧ.СтатьяЗатрат.Наименование;
		//СтрокаКоллекции.Субконто2 = СтрокаТЧ.ПодразделениеЗатраты;
	ИначеЕсли ВидРасхода = Перечисления.ХарактерЗатрат.ОбщехозяйственныеРасходы Тогда
		СтрокаКоллекции.КоррСчет = "26";
		СтрокаКоллекции.Субконто1 = СтрокаТЧ.СтатьяЗатрат.Наименование;
		//СтрокаКоллекции.Субконто2 = СтрокаТЧ.ПодразделениеЗатраты;
	ИначеЕсли ВидРасхода = Перечисления.ХарактерЗатрат.КоммерческиеРасходы Тогда
		СтрокаКоллекции.КоррСчет = "44.2";
		СтрокаКоллекции.Субконто1 = СтрокаТЧ.СтатьяЗатрат.Наименование;
	ИначеЕсли ВидРасхода = Перечисления.ХарактерЗатрат.ИздержкиОбращения Тогда
		СтрокаКоллекции.КоррСчет = "44.1.3";
		СтрокаКоллекции.Субконто1 = СтрокаТЧ.СтатьяЗатрат.Наименование;
	КонецЕсли;
	СтрокаКоллекции.Содержание   = СтрокаТЧ.Содержание;
	СтрокаКоллекции.Количество   = СтрокаТЧ.Количество;
	СтрокаКоллекции.СуммаНДС     = СтрокаТЧ.СуммаНДС;
	СтрокаКоллекции.Сумма        = СтрокаТЧ.Сумма;
	СтрокаКоллекции.СтатьяЗатрат = СтрокаТЧ.СтатьяЗатрат;
КонецЦикла;</ПередОбработкойВыгрузки><Свойство><Код>14</Код><Наименование> --&gt; Всего</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="Всего" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если Не Источник.СуммаВключаетНДС Тогда
	Значение = ОбъектКоллекции.Сумма + ОбъектКоллекции.СуммаНДС;
Иначе
	Значение = ОбъектКоллекции.Сумма;
КонецЕсли;</ПередВыгрузкой><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>15</Код><Наименование> --&gt; Количество</Наименование><Порядок>400</Порядок><Источник Имя="Количество" Вид="Ресурс" Тип="Число"/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/></Свойство><Свойство><Код>16</Код><Наименование> --&gt; КоррСчет</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="КоррСчет" Вид="Реквизит"/><ПередВыгрузкой>ТипПриемника = "ПланСчетовСсылка.Основной";</ПередВыгрузкой></Свойство><Свойство><Код>17</Код><Наименование> --&gt; НаименованиеУслуги</Наименование><Порядок>100</Порядок><Источник Имя="Содержание" Вид="Реквизит" Тип="Строка"/><Приемник Имя="НаименованиеУслуги" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>18</Код><Наименование> --&gt; НДС</Наименование><Порядок>600</Порядок><Источник Имя="СуммаНДС" Вид="Реквизит" Тип="Число"/><Приемник Имя="НДС" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство><Свойство><Код>19</Код><Наименование> --&gt; Субконто1</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Субконто1" Вид="Реквизит"/><ПередВыгрузкой>Если ОбъектКоллекции.КоррСчет  = "20" Тогда
	ИмяПКО = "ВидыНоменклатуры";
ИначеЕсли ОбъектКоллекции.КоррСчет = "25" Тогда
	ИмяПКО = "СтатьиОбщепроизводственныхЗатрат";
ИначеЕсли ОбъектКоллекции.КоррСчет = "26" Тогда
	ИмяПКО = "СтатьиОбщехозяйственныхЗатрат";
ИначеЕсли ОбъектКоллекции.КоррСчет = "44.2" Тогда
	ИмяПКО = "СтатьиКоммерческихРасходов";
ИначеЕсли ОбъектКоллекции.КоррСчет = "44.1.3" Тогда
	ИмяПКО = "СтатьиРасходовНаПродажу";
ИначеЕсли ОбъектКоллекции.КоррСчет = "44.1.1" Тогда
	ИмяПКО = "СтатьиИздержекОбращения";
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>20</Код><Наименование> --&gt; Субконто2</Наименование><Порядок>900</Порядок><Источник/><Приемник Имя="Субконто2" Вид="Реквизит"/><ПередВыгрузкой>ВидРасхода = ОбъектКоллекции.СтатьяЗатрат.ХарактерЗатрат;
Если ВидРасхода = Перечисления.ХарактерЗатрат.ПроизводственныеРасходы Тогда
	ИмяПКО = "СтатьиЗатратНаПроизводство";
ИначеЕсли ВидРасхода = Перечисления.ХарактерЗатрат.ОбщепроизводственныеРасходы Тогда
	ИмяПКО = "Подразделения";
ИначеЕсли ВидРасхода = Перечисления.ХарактерЗатрат.ОбщехозяйственныеРасходы Тогда
	ИмяПКО = "Подразделения";
Иначе
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>21</Код><Наименование> --&gt; Субконто3</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="Субконто3" Вид="Реквизит"/><ПередВыгрузкой>ВидРасхода = ОбъектКоллекции.СтатьяЗатрат.ХарактерЗатрат;
Если ВидРасхода = Перечисления.ХарактерЗатрат.ПроизводственныеРасходы Тогда
	ИмяПКО = "Подразделения";
Иначе
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>22</Код><Наименование> --&gt; Сумма</Наименование><Порядок>800</Порядок><Источник Имя="Сумма" Вид="Реквизит" Тип="Число"/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетСуммыИсточникаВВалютуДоговора)</ПриВыгрузке></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>ИнвентаризацияТМЦ</Код><Наименование>ДокументСсылка.ИнвентаризацияТоваровНаСкладе --&gt; ДокументСсылка.ИнвентаризацияТМЦ</Наименование><Порядок>1000</Порядок><Источник>ДокументСсылка.ИнвентаризацияТоваровНаСкладе</Источник><Приемник>ДокументСсылка.ИнвентаризацияТМЦ</Приемник><Свойства><Свойство Поиск="true"><Код>10</Код><Наименование> --&gt; ДатаДок</Наименование><Порядок>100</Порядок><Источник Имя="Дата" Вид="Свойство" Тип="Дата"/><Приемник Имя="ДатаДок" Вид="Свойство" Тип="Дата"/></Свойство><Свойство Поиск="true"><Код>11</Код><Наименование> --&gt; НомерДок</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="НомерДок" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ЧисловаяЧасть = "";
ПолучитьПрефиксЧислоНомера(Источник.Номер, ЧисловаяЧасть);
Значение = ДобавитьКПрефиксу(ЧисловаяЧасть, "", 6, "");</ПередВыгрузкой></Свойство><Свойство><Код>12</Код><Наименование> --&gt; МестоХранения</Наименование><Порядок>300</Порядок><Источник Имя="Склад" Вид="Реквизит" Тип="СправочникСсылка.Склады"/><Приемник Имя="МестоХранения" Вид="Реквизит" Тип="СправочникСсылка.МестаХранения"/><КодПравилаКонвертации>МестаХранения                                     </КодПравилаКонвертации></Свойство><Свойство><Код>13</Код><Наименование> --&gt; ВидТМЦ</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="ВидТМЦ" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 1</ПередВыгрузкой></Свойство><Свойство><Код>14</Код><Наименование> --&gt; ТМЦ_41_1</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="ТМЦ_41_1" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = ?(Источник.Склад.ВидСклада = Перечисления.ВидыСкладов.Оптовый, 1, 0);</ПередВыгрузкой></Свойство><Свойство><Код>15</Код><Наименование> --&gt; ТМЦ_41_2</Наименование><Порядок>600</Порядок><Источник/><Приемник Имя="ТМЦ_41_2" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = ?(Источник.Склад.ВидСклада = Перечисления.ВидыСкладов.Оптовый, 0, 1);</ПередВыгрузкой></Свойство><Свойство><Код>16</Код><Наименование>Комментарий --&gt; Комментарий</Наименование><Порядок>800</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство><Группа><Код>1</Код><Наименование> --&gt; ТабличнаяЧасть</Наименование><Порядок>700</Порядок><Источник Имя="Товары" Вид="ТабличнаяЧасть"/><Приемник Имя="ТабличнаяЧасть" Вид="ТабличнаяЧасть"/><ПередОбработкойВыгрузки>ВходящиеДанные = Новый Структура;

Запрос = Новый Запрос;
Запрос.УстановитьПараметр("Источник", Источник);

Запрос.Текст = "
|ВЫБРАТЬ ПЕРВЫЕ 1
|	Док.Ссылка
|ИЗ Документ.ОтчетОРозничныхПродажах КАК Док
|ГДЕ Док.ИнвентаризацияТоваровНаСкладе = &amp;Источник";

Если Запрос.Выполнить().Пустой() Тогда
	ВходящиеДанные.Вставить("ФормироватьПроводки", "Да");
Иначе
	ВходящиеДанные.Вставить("ФормироватьПроводки", "Нет");
КонецЕсли;
	</ПередОбработкойВыгрузки><Свойство><Код>2</Код><Наименование> --&gt; ВидМПЗ</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="ВидМПЗ" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Значение = "Товар"</ПередВыгрузкой></Свойство><Свойство><Код>3</Код><Наименование> --&gt; МПЗ</Наименование><Порядок>200</Порядок><Источник Имя="Номенклатура" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/><Приемник Имя="МПЗ" Вид="Реквизит"/><КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации><ПередВыгрузкой>ИсходящиеДанные = Новый Структура;
ИсходящиеДанные.Вставить("ТипНоменклатуры", "Товар");
ИсходящиеДанные.Вставить("ТипТовара", "Собственный");</ПередВыгрузкой></Свойство><Свойство><Код>4</Код><Наименование> --&gt; Счет</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="Счет" Вид="Реквизит"/><ПередВыгрузкой>ТипПриемника = "ПланСчетовСсылка.Основной";
Значение = ?(Источник.Склад.ВидСклада = Перечисления.ВидыСкладов.Оптовый, "41.1", "41.2");</ПередВыгрузкой></Свойство><Свойство><Код>5</Код><Наименование> --&gt; КоличествоУчет</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="КоличествоУчет" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = ОбъектКоллекции.КоличествоУчет * ОбъектКоллекции.Коэффициент;</ПередВыгрузкой></Свойство><Свойство><Код>6</Код><Наименование> --&gt; Количество</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = ОбъектКоллекции.Количество * ОбъектКоллекции.Коэффициент;</ПередВыгрузкой></Свойство><Свойство><Код>7</Код><Наименование> --&gt; СуммаУчет</Наименование><Порядок>600</Порядок><Источник Имя="СуммаУчет" Вид="Реквизит" Тип="Число"/><Приемник Имя="СуммаУчет" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетВРублиСуммыИсточникаИзВалютыУпрУчета);</ПриВыгрузке></Свойство><Свойство><Код>8</Код><Наименование> --&gt; Сумма</Наименование><Порядок>700</Порядок><Источник Имя="Сумма" Вид="Реквизит" Тип="Число"/><Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/><ПриВыгрузке>Выполнить(Алгоритмы.ПересчетВРублиСуммыИсточникаИзВалютыУпрУчета);</ПриВыгрузке></Свойство><Свойство><Код>9</Код><Наименование> --&gt; ФормироватьПроводку</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="ФормироватьПроводку" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Значение = ВходящиеДанные.ФормироватьПроводки;</ПередВыгрузкой></Свойство></Группа></Свойства><Значения/></Правило></Группа><Группа><Код>Справочники</Код><Наименование>Справочники</Наименование><Порядок>500</Порядок><Правило><Код>Банки</Код><Наименование>СправочникСсылка.Банки --&gt; СправочникСсылка.Банки</Наименование><Порядок>1500</Порядок><НеЗамещать>true</НеЗамещать><Источник>СправочникСсылка.Банки</Источник><Приемник>СправочникСсылка.Банки</Приемник><Свойства><Свойство Поиск="true"><Код>2</Код><Наименование>Код --&gt; Код</Наименование><Порядок>200</Порядок><Источник Имя="Код" Вид="Свойство" Тип="Строка"/><Приемник Имя="Код" Вид="Свойство" Тип="Строка"/></Свойство><Свойство Поиск="true"><Код>1</Код><Наименование>ЭтоГруппа --&gt; ЭтоГруппа</Наименование><Порядок>100</Порядок><Источник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/><Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Число"/></Свойство><Свойство><Код>3</Код><Наименование>Наименование --&gt; Наименование</Наименование><Порядок>300</Порядок><Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/></Свойство><Свойство><Код>4</Код><Наименование>Родитель --&gt; Родитель</Наименование><Порядок>400</Порядок><Источник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.Банки"/><Приемник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.Банки"/><КодПравилаКонвертации>Банки                                             </КодПравилаКонвертации></Свойство><Группа><Код>9</Код><Наименование> --&gt;</Наименование><Порядок>900</Порядок><Источник/><Приемник/><ПередОбработкойВыгрузки>Если Источник.ЭтоГруппа Тогда
	Отказ = Истина;
КонецЕсли;</ПередОбработкойВыгрузки><Свойство><Код>8</Код><Наименование>Телефоны --&gt; Телефоны</Наименование><Порядок>800</Порядок><Источник Имя="Телефоны" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Телефоны" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>7</Код><Наименование>Адрес --&gt; Адрес</Наименование><Порядок>700</Порядок><Источник Имя="Адрес" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Адрес" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>6</Код><Наименование>КоррСчет --&gt; КоррСчет</Наименование><Порядок>600</Порядок><Источник Имя="КоррСчет" Вид="Реквизит" Тип="Строка"/><Приемник Имя="КоррСчет" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>5</Код><Наименование>Город --&gt; Местонахождение</Наименование><Порядок>500</Порядок><Источник Имя="Город" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Местонахождение" Вид="Реквизит" Тип="Строка"/></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>БанковскиеСчета</Код><Наименование>СправочникСсылка.БанковскиеСчета --&gt; СправочникСсылка.БанковскиеСчета</Наименование><Порядок>900</Порядок><НеЗамещать>true</НеЗамещать><Источник>СправочникСсылка.БанковскиеСчета</Источник><Приемник>СправочникСсылка.БанковскиеСчета</Приемник><Свойства><Свойство><Код>1</Код><Наименование>Наименование --&gt; Наименование</Наименование><Порядок>100</Порядок><Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/></Свойство><Свойство Поиск="true"><Код>2</Код><Наименование>НомерСчета --&gt; Номер</Наименование><Порядок>200</Порядок><Источник Имя="НомерСчета" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Номер" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>3</Код><Наименование>Банк --&gt; БанкОрганизации</Наименование><Порядок>300</Порядок><Источник Имя="Банк" Вид="Реквизит" Тип="СправочникСсылка.Банки"/><Приемник Имя="БанкОрганизации" Вид="Реквизит" Тип="СправочникСсылка.Банки"/><КодПравилаКонвертации>Банки                                             </КодПравилаКонвертации></Свойство><Свойство><Код>4</Код><Наименование>БанкДляРасчетов --&gt; БанкДляРасчетов</Наименование><Порядок>400</Порядок><Источник Имя="БанкДляРасчетов" Вид="Реквизит" Тип="СправочникСсылка.Банки"/><Приемник Имя="БанкДляРасчетов" Вид="Реквизит" Тип="СправочникСсылка.Банки"/><КодПравилаКонвертации>Банки                                             </КодПравилаКонвертации></Свойство><Свойство><Код>5</Код><Наименование>ТекстКорреспондента --&gt; Корреспондент</Наименование><Порядок>500</Порядок><Источник Имя="ТекстКорреспондента" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Корреспондент" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>10</Код><Наименование> --&gt; ТипСчета</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="ТипСчета" Вид="Реквизит" Тип="ПеречислениеСсылка.ТипыБанковскихСчетов"/><ПередВыгрузкой>Если Источник.ВалютаДенежныхСредств = Константы.ВалютаРегламентированногоУчета.Получить() Тогда
	Значение = "Рублевый";
	
Иначе
	Значение = "Валютный";
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>9</Код><Наименование>ДатаЗакрытия --&gt; ДатаЗакрытияСчета</Наименование><Порядок>900</Порядок><Источник Имя="ДатаЗакрытия" Вид="Реквизит" Тип="Дата"/><Приемник Имя="ДатаЗакрытияСчета" Вид="Реквизит" Тип="Дата"/></Свойство><Свойство><Код>8</Код><Наименование>ДатаОткрытия --&gt; ДатаОткрытияСчета</Наименование><Порядок>800</Порядок><Источник Имя="ДатаОткрытия" Вид="Реквизит" Тип="Дата"/><Приемник Имя="ДатаОткрытияСчета" Вид="Реквизит" Тип="Дата"/></Свойство><Свойство><Код>7</Код><Наименование>НомерИДатаРазрешения --&gt; НомерИДатаРазрешения</Наименование><Порядок>700</Порядок><Источник Имя="НомерИДатаРазрешения" Вид="Реквизит" Тип="Строка"/><Приемник Имя="НомерИДатаРазрешения" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>6</Код><Наименование>ВидСчета --&gt; ВидСчета</Наименование><Порядок>600</Порядок><Источник Имя="ВидСчета" Вид="Реквизит" Тип="Строка"/><Приемник Имя="ВидСчета" Вид="Реквизит" Тип="Строка"/></Свойство></Свойства><Значения/></Правило><Правило><Код>Валюты</Код><Наименование>СправочникСсылка.Валюты --&gt; СправочникСсылка.Валюты</Наименование><Порядок>400</Порядок><НеЗамещать>true</НеЗамещать><Источник>СправочникСсылка.Валюты</Источник><Приемник>СправочникСсылка.Валюты</Приемник><Свойства><Свойство><Код>5</Код><Наименование> --&gt; Кратность</Наименование><Порядок>500</Порядок><Источник/><Приемник Имя="Кратность" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(РабочаяДата, Новый Структура("Валюта", Источник)).Кратность;</ПередВыгрузкой></Свойство><Свойство><Код>4</Код><Наименование> --&gt; Курс</Наименование><Порядок>400</Порядок><Источник/><Приемник Имя="Курс" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(РабочаяДата, Новый Структура("Валюта", Источник)).Курс;</ПередВыгрузкой></Свойство><Свойство><Код>3</Код><Наименование> --&gt; ПолнНаименование</Наименование><Порядок>300</Порядок><Источник Имя="НаименованиеПолное" Вид="Реквизит" Тип="Строка"/><Приемник Имя="ПолнНаименование" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>2</Код><Наименование> --&gt; Наименование</Наименование><Порядок>200</Порядок><Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/></Свойство><Свойство Поиск="true"><Код>1</Код><Наименование> --&gt; Код</Наименование><Порядок>100</Порядок><Источник Имя="Код" Вид="Свойство" Тип="Строка"/><Приемник Имя="Код" Вид="Свойство" Тип="Строка"/></Свойство></Свойства><Значения/></Правило><Правило><Код>ВидыДоговоров</Код><Наименование>СправочникСсылка.ВидыВзаиморасчетов --&gt; СправочникСсылка.ВидыДоговоров</Наименование><Порядок>800</Порядок><Источник>СправочникСсылка.ВидыВзаиморасчетов</Источник><Приемник>СправочникСсылка.ВидыДоговоров</Приемник><Свойства><Свойство Поиск="true"><Код>1</Код><Наименование>Код --&gt; Код</Наименование><Порядок>100</Порядок><Источник Имя="Код" Вид="Свойство" Тип="Строка"/><Приемник Имя="Код" Вид="Свойство" Тип="Строка"/></Свойство><Свойство><Код>2</Код><Наименование>Наименование --&gt; Наименование</Наименование><Порядок>200</Порядок><Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/></Свойство></Свойства><Значения/></Правило><Правило><Код>ГТД</Код><Наименование>СправочникСсылка.ГТД --&gt; СправочникСсылка.ГТД</Наименование><Порядок>1700</Порядок><ПередВыгрузкой>Если ЗначениеНеЗаполнено(Источник) ИЛИ ЗначениеНеЗаполнено(Источник.Наименование) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой><НеЗамещать>true</НеЗамещать><Источник>СправочникСсылка.НомераГТД</Источник><Приемник>СправочникСсылка.ГТД</Приемник><Свойства><Свойство Поиск="true"><Код>3</Код><Наименование> --&gt; СтранаПроисхождения</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="СтранаПроисхождения" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>//Значение = ВходящиеДанные.СтранаПроисхождения;</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>1</Код><Наименование>Код --&gt; Наименование</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>//Значение = ВходящиеДанные.ГТД;</ПередВыгрузкой></Свойство><Свойство><Код>2</Код><Наименование> --&gt;</Наименование><Порядок>200</Порядок><Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/></Свойство></Свойства><Значения/></Правило><Правило><Код>Договоры</Код><Наименование>СправочникСсылка.ДоговорыВзаиморасчетов --&gt; СправочникСсылка.Договоры</Наименование><Порядок>1300</Порядок><ПередВыгрузкой>Если Источник.ЭтоГруппа И Источник.Уровень() &gt;= 1 Тогда
	Отказ = Истина;
КонецЕсли;
ВыгрузитьПоПравилу(Источник.Владелец,,,, "Контрагенты");</ПередВыгрузкой><НеЗамещать>true</НеЗамещать><Источник>СправочникСсылка.ДоговорыКонтрагентов</Источник><Приемник>СправочникСсылка.Договоры</Приемник><Свойства><Свойство><Код>3</Код><Наименование>Наименование --&gt;</Наименование><Порядок>300</Порядок><Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/></Свойство><Свойство Поиск="true"><Код>4</Код><Наименование>Родитель --&gt; Родитель</Наименование><Порядок>400</Порядок><Источник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.ДоговорыВзаиморасчетов"/><Приемник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации><ПередВыгрузкой>Значение = Источник.Родитель;
Если НЕ ЗначениеНеЗаполнено(Значение) = 1 Тогда 
	Пока Значение.Уровень() &gt;= 1 Цикл
		Значение = Значение.Родитель;
	КонецЦикла;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>5</Код><Наименование>Владелец --&gt; Владелец</Наименование><Порядок>500</Порядок><Источник Имя="Владелец" Вид="Свойство" Тип="СправочникСсылка.Контрагенты"/><Приемник Имя="Владелец" Вид="Свойство" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство><Код>9</Код><Наименование>ВидВзаиморасчетов --&gt; ВидДоговора</Наименование><Порядок>900</Порядок><Источник Имя="ВидВзаиморасчетов" Вид="Реквизит" Тип="СправочникСсылка.ВидыВзаиморасчетов"/><Приемник Имя="ВидДоговора" Вид="Реквизит" Тип="СправочникСсылка.ВидыДоговоров"/><КодПравилаКонвертации>ВидыДоговоров                                     </КодПравилаКонвертации></Свойство><Свойство Поиск="true"><Код>2</Код><Наименование>ЭтоГруппа --&gt; ЭтоГруппа</Наименование><Порядок>200</Порядок><Источник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/><Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Число"/></Свойство><Свойство Поиск="true"><Код>1</Код><Наименование> --&gt; Код</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Код" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>Значение = ДобавитьКПрефиксу(Источник.Код, "", 6, "");</ПередВыгрузкой></Свойство><Группа><Код>8</Код><Наименование> --&gt;</Наименование><Порядок>800</Порядок><Источник/><Приемник/><ПередОбработкойВыгрузки>Если Источник.ЭтоГруппа Тогда
	Отказ = Истина;
КонецЕсли;</ПередОбработкойВыгрузки><Свойство><Код>7</Код><Наименование> --&gt;</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="ОплатаДоговора" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 1;</ПередВыгрузкой></Свойство><Свойство><Код>6</Код><Наименование>ВалютаВзаиморасчетов --&gt; ВалютаДоговора</Наименование><Порядок>600</Порядок><Источник Имя="ВалютаВзаиморасчетов" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/><Приемник Имя="ВалютаДоговора" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/><КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации><ПередВыгрузкой>Если Источник.ВалютаВзаиморасчетов = Константы.ВалютаРегламентированногоУчета.Получить() Тогда
	Значение = "";
КонецЕсли;</ПередВыгрузкой></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>ДокументыУдостоверяющиеЛичность</Код><Наименование>СправочникСсылка.ДокументыУдостоверяющиеЛичность --&gt; СправочникСсылка.ДокументыУдостоверяющиеЛичност</Наименование><Порядок>1800</Порядок><НеЗамещать>true</НеЗамещать><Источник>СправочникСсылка.ДокументыУдостоверяющиеЛичность</Источник><Приемник>СправочникСсылка.ДокументыУдостоверяющиеЛичность</Приемник><Свойства><Свойство><Код>3</Код><Наименование>КодПФР --&gt; КодСЗВ</Наименование><Порядок>300</Порядок><Источник Имя="КодПФР" Вид="Реквизит" Тип="Строка"/><Приемник Имя="КодСЗВ" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>2</Код><Наименование>КодИМНС --&gt; КодНДФЛ</Наименование><Порядок>200</Порядок><Источник Имя="КодИМНС" Вид="Реквизит" Тип="Строка"/><Приемник Имя="КодНДФЛ" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство Поиск="true"><Код>1</Код><Наименование>Наименование --&gt; Наименование</Наименование><Порядок>100</Порядок><Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/></Свойство></Свойства><Значения/></Правило><Правило><Код>ЕдиницыИзмерений</Код><Наименование>СправочникСсылка.ЕдиницыИзмерения --&gt; СправочникСсылка.ЕдиницыИзмерений</Наименование><Порядок>800</Порядок><ПередВыгрузкой>Если Источник.ЕдиницаПоКлассификатору.Пустая() Тогда
	Отказ = Истина;

Иначе
	Единица = Источник.ЕдиницаПоКлассификатору;
КонецЕсли;

ВходящиеДанные = Новый Структура;
ВходящиеДанные.Вставить("Код", Единица.Код);
ВходящиеДанные.Вставить("Наименование", Единица.Наименование);
ВходящиеДанные.Вставить("ПолнНаименование", Единица.НаименованиеПолное);</ПередВыгрузкой><НеЗамещать>true</НеЗамещать><Источник>СправочникСсылка.ЕдиницыИзмерения</Источник><Приемник>СправочникСсылка.ЕдиницыИзмерений</Приемник><Свойства><Свойство Поиск="true"><Код>1</Код><Наименование>ЕдиницаПоКлассификатору --&gt;</Наименование><Порядок>100</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="Код" Вид="Свойство" Тип="Строка"/></Свойство><Свойство><Код>2</Код><Наименование> --&gt;</Наименование><Порядок>200</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/></Свойство><Свойство><Код>3</Код><Наименование> --&gt; ПолнНаименование</Наименование><Порядок>300</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="ПолнНаименование" Вид="Реквизит" Тип="Строка"/></Свойство></Свойства><Значения/></Правило><Правило><Код>КлассификаторЕдиницИзмерения</Код><Наименование>СправочникСсылка.КлассификаторЕдиницИзмерения --&gt; СправочникСсылка.ЕдиницыИзмерений</Наименование><Порядок>900</Порядок><НеЗамещать>true</НеЗамещать><Источник>СправочникСсылка.КлассификаторЕдиницИзмерения</Источник><Приемник>СправочникСсылка.ЕдиницыИзмерений</Приемник><Свойства><Свойство Поиск="true"><Код>1</Код><Наименование>Код --&gt; Код</Наименование><Порядок>100</Порядок><Источник Имя="Код" Вид="Свойство" Тип="Строка"/><Приемник Имя="Код" Вид="Свойство" Тип="Строка"/></Свойство><Свойство><Код>2</Код><Наименование> --&gt;</Наименование><Порядок>200</Порядок><Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/></Свойство><Свойство><Код>3</Код><Наименование>НаименованиеПолное --&gt; ПолнНаименование</Наименование><Порядок>300</Порядок><Источник Имя="НаименованиеПолное" Вид="Реквизит" Тип="Строка"/><Приемник Имя="ПолнНаименование" Вид="Реквизит" Тип="Строка"/></Свойство></Свойства><Значения/></Правило><Правило><Код>Контрагенты</Код><Наименование>СправочникСсылка.Контрагенты --&gt; СправочникСсылка.Контрагенты</Наименование><Порядок>1200</Порядок><Источник>СправочникСсылка.Контрагенты</Источник><Приемник>СправочникСсылка.Контрагенты</Приемник><Свойства><Свойство Поиск="true"><Код>18</Код><Наименование> --&gt; Код</Наименование><Порядок>1800</Порядок><Источник Имя="Код" Вид="Свойство" Тип="Строка"/><Приемник Имя="Код" Вид="Свойство" Тип="Строка"/></Свойство><Свойство><Код>3</Код><Наименование>Родитель --&gt; Родитель</Наименование><Порядок>400</Порядок><Источник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.Контрагенты"/><Приемник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации><ПередВыгрузкой>Значение = Источник.Родитель;
Если НЕ ЗначениеНеЗаполнено(Значение) = 1 Тогда 
	Пока Значение.Уровень() &gt;= 2 Цикл
		Значение = Значение.Родитель;
	КонецЦикла;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>2</Код><Наименование>Наименование --&gt; Наименование</Наименование><Порядок>300</Порядок><Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/></Свойство><Свойство Поиск="true"><Код>1</Код><Наименование>ЭтоГруппа --&gt; ЭтоГруппа</Наименование><Порядок>200</Порядок><Источник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/><Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Число"/></Свойство><Группа><Код>19</Код><Наименование> --&gt;</Наименование><Порядок>1900</Порядок><Источник/><Приемник/><ПередОбработкойВыгрузки>Если Источник.ЭтоГруппа Тогда
	Отказ = Истина;
КонецЕсли;</ПередОбработкойВыгрузки><Свойство><Код>20</Код><Наименование> --&gt; ВидКонтрагента</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="ВидКонтрагента" Вид="Реквизит" Тип="ПеречислениеСсылка.ВидыКонтрагентов"/><ПередВыгрузкой>Если Источник.ЮрФизЛицо = Перечисления.ЮрФизЛицо.ЮрЛицо Тогда
	Значение = "Организация";
Иначе
	Значение = "ЧастноеЛицо";
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>21</Код><Наименование>НаименованиеПолное --&gt; ПолнНаименование</Наименование><Порядок>200</Порядок><Источник Имя="НаименованиеПолное" Вид="Реквизит" Тип="Строка"/><Приемник Имя="ПолнНаименование" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>22</Код><Наименование>ОсновнойДоговорКонтрагента --&gt; ОсновнойДоговор</Наименование><Порядок>300</Порядок><Источник Имя="ОсновнойДоговорКонтрагента" Вид="Реквизит" Тип="СправочникСсылка.ДоговорыКонтрагентов"/><Приемник Имя="ОсновнойДоговор" Вид="Реквизит" Тип="СправочникСсылка.Договоры"/><КодПравилаКонвертации>Договоры                                          </КодПравилаКонвертации></Свойство><Свойство><Код>23</Код><Наименование>ОсновнойБанковскийСчет --&gt; ОсновнойСчет</Наименование><Порядок>400</Порядок><Источник Имя="ОсновнойБанковскийСчет" Вид="Реквизит" Тип="СправочникСсылка.БанковскиеСчета"/><Приемник Имя="ОсновнойСчет" Вид="Реквизит" Тип="СправочникСсылка.РасчетныеСчета"/><КодПравилаКонвертации>РасчетныеСчета                                    </КодПравилаКонвертации></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>МестаХранения</Код><Наименование>СправочникСсылка.СкладыКомпании --&gt; СправочникСсылка.МестаХранения</Наименование><Порядок>600</Порядок><ПередВыгрузкой>Если ТипЗнч(Источник) &lt;&gt; Тип("СправочникСсылка.Склады") ИЛИ Источник.ЭтоГруппа Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой><Источник>СправочникСсылка.Склады</Источник><Приемник>СправочникСсылка.МестаХранения</Приемник><Свойства><Свойство><Код>3</Код><Наименование> --&gt; ТипСклада</Наименование><Порядок>300</Порядок><Источник/><Приемник Имя="ТипСклада" Вид="Реквизит" Тип="ПеречислениеСсылка.ТипыСкладов"/><ПередВыгрузкой>Если Не Параметры.ВыгружатьАналитикуПоСкладам ИЛИ Источник.ВидСклада = Перечисления.ВидыСкладов.Оптовый Тогда
	Значение = "Оптовый";
Иначе
	Значение = "Розничный";
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>2</Код><Наименование>Наименование --&gt; Наименование</Наименование><Порядок>200</Порядок><Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>Если Не Параметры.ВыгружатьАналитикуПоСкладам Тогда
	Значение = "Управление торговлей";
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>1</Код><Наименование>Код --&gt; Код</Наименование><Порядок>100</Порядок><Источник Имя="Код" Вид="Свойство" Тип="Строка"/><Приемник Имя="Код" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>Если Не Параметры.ВыгружатьАналитикуПоСкладам Тогда
	Значение = "00000";
КонецЕсли;</ПередВыгрузкой></Свойство></Свойства><Значения/></Правило><Правило><Код>Номенклатура</Код><Наименование>СправочникСсылка.Номенклатура --&gt; СправочникСсылка.Номенклатура</Наименование><Порядок>700</Порядок><ПередВыгрузкой>Если НЕ Источник.ЭтоГруппа Тогда
	КлючВыгружаемыхДанных = ЗначениеВСтрокуВнутр(Источник) + ВходящиеДанные.ТипТовара;
КонецЕсли;

Если Источник.ЭтоГруппа И Источник.Уровень() &gt;= 3 Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой><Источник>СправочникСсылка.Номенклатура</Источник><Приемник>СправочникСсылка.Номенклатура</Приемник><Свойства><Свойство><Код>4</Код><Наименование>Родитель --&gt; Родитель</Наименование><Порядок>400</Порядок><Источник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.Номенклатура"/><Приемник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.Номенклатура"/><КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации><ПередВыгрузкой>ИсходящиеДанные = Новый Структура;
ИсходящиеДанные.Вставить("ТипНоменклатуры", "");
ИсходящиеДанные.Вставить("ТипТовара", "");
Значение = Источник.Родитель;
Если НЕ ЗначениеНеЗаполнено(Значение) = 1 Тогда 
	Пока Значение.Уровень() &gt;= 3 Цикл
		Значение = Значение.Родитель;
	КонецЦикла;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>3</Код><Наименование>Наименование --&gt; Наименование</Наименование><Порядок>300</Порядок><Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/></Свойство><Свойство Поиск="true"><Код>1</Код><Наименование>ЭтоГруппа --&gt; ЭтоГруппа</Наименование><Порядок>100</Порядок><Источник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/><Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Число"/></Свойство><Свойство Поиск="true"><Код>13</Код><Наименование>Код --&gt; Код</Наименование><Порядок>1300</Порядок><Источник/><Приемник Имя="Код" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>ТипТовара = ВходящиеДанные.ТипТовара;

Если ТипТовара = "Собственный" Тогда
	КодТипаТовара = "С";

ИначеЕсли ТипТовара = "НаКомиссии" Тогда
	КодТипаТовара = "К";

ИначеЕсли ТипТовара = "Тара" Тогда
	КодТипаТовара = "Т";
Иначе
	КодТипаТовара = "";
КонецЕсли;

Значение = ДобавитьКПрефиксу(Источник.Код, КодТипаТовара, 9, "Справа");</ПередВыгрузкой></Свойство><Группа><Код>15</Код><Наименование> --&gt;</Наименование><Порядок>1500</Порядок><Источник/><Приемник/><ПередОбработкойВыгрузки>Если Источник.ЭтоГруппа Тогда
	Отказ = Истина;
КонецЕсли;</ПередОбработкойВыгрузки><Свойство><Код>5</Код><Наименование>НаименованиеПолное --&gt; ПолнНаименование</Наименование><Порядок>500</Порядок><Источник Имя="НаименованиеПолное" Вид="Реквизит" Тип="Строка"/><Приемник Имя="ПолнНаименование" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>6</Код><Наименование>БазоваяЕдиницаИзмерения --&gt; ЕдиницаИзмерения</Наименование><Порядок>600</Порядок><Источник Имя="БазоваяЕдиницаИзмерения" Вид="Реквизит" Тип="СправочникСсылка.КлассификаторЕдиницИзмерения"/><Приемник Имя="ЕдиницаИзмерения" Вид="Реквизит" Тип="СправочникСсылка.ЕдиницыИзмерений"/><КодПравилаКонвертации>КлассификаторЕдиницИзмерения                      </КодПравилаКонвертации></Свойство><Свойство><Код>7</Код><Наименование> --&gt;</Наименование><Порядок>700</Порядок><Источник/><Приемник Имя="СтранаПроисхождения" Вид="Реквизит" Тип="Строка"/><ПередВыгрузкой>Страна = Источник.СтранаПроисхождения;

Если Источник.ЭтоГруппа Тогда
    Отказ = Истина;
	
ИначеЕсли Страна = Справочники.КлассификаторСтранМира.ПустаяСсылка() Тогда
	Отказ = Истина;

ИначеЕсли Страна.Код = "643" Тогда
	Отказ = Истина;

Иначе
	Значение = Страна.Наименование;
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>8</Код><Наименование>Услуга --&gt; ТипНоменклатуры</Наименование><Порядок>800</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="ТипНоменклатуры" Вид="Реквизит" Тип="ПеречислениеСсылка.ТипыНоменклатуры"/></Свойство><Свойство><Код>9</Код><Наименование> --&gt; ТипТовара</Наименование><Порядок>900</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="ТипТовара" Вид="Реквизит" Тип="ПеречислениеСсылка.ТипыТоваров"/></Свойство><Свойство><Код>10</Код><Наименование> --&gt; ВидНоменклатуры</Наименование><Порядок>1000</Порядок><Источник/><Приемник Имя="ВидНоменклатуры" Вид="Реквизит" Тип="СправочникСсылка.ВидыНоменклатуры"/><КодПравилаКонвертации>ВидыНоменклатуры                                  </КодПравилаКонвертации><ПередВыгрузкой>Если Источник.ЭтоГруппа Тогда
    Отказ = Истина;

Иначе
	Значение = Новый Структура;
	Значение.Вставить("Наименование", ВходящиеДанные.ТипНоменклатуры);
	Значение.Вставить("ТипНоменклатуры", ВходящиеДанные.ТипНоменклатуры);
КонецЕсли;</ПередВыгрузкой></Свойство><Свойство><Код>11</Код><Наименование>СтавкаНДС --&gt; СтавкаНДС</Наименование><Порядок>1100</Порядок><Источник Имя="СтавкаНДС" Вид="Реквизит" Тип="ПеречислениеСсылка.СтавкиНДС"/><Приемник Имя="СтавкаНДС" Вид="Реквизит" Тип="СправочникСсылка.СтавкиНДС"/><КодПравилаКонвертации>СтавкиНДС                                         </КодПравилаКонвертации></Свойство><Свойство><Код>14</Код><Наименование> --&gt; ПорядокХраненияОтпускнойЦены</Наименование><Порядок>1400</Порядок><Источник/><Приемник Имя="ПорядокХраненияОтпускнойЦены" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Значение = 1;</ПередВыгрузкой></Свойство><Свойство><Код>16</Код><Наименование> --&gt; СтранаПроисхожд</Наименование><Порядок>1500</Порядок><Источник/><Приемник Имя="СтранаПроисхожд" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если ВРег(СокрЛП(Источник.СтранаПроисхождения)) = "РОССИЯ" ИЛИ ЗначениеНеЗаполнено(Источник.СтранаПроисхождения) Тогда
	Значение = 1;
Иначе
	Значение = 0;
КонецЕсли;</ПередВыгрузкой></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>РасчетныеСчета</Код><Наименование>СправочникСсылка.БанковскиеСчета --&gt; СправочникСсылка.РасчетныеСчета</Наименование><Порядок>1400</Порядок><ПередВыгрузкой>ВыгрузитьПоПравилу(Источник.Владелец,,,, "Контрагенты");</ПередВыгрузкой><НеЗамещать>true</НеЗамещать><Источник>СправочникСсылка.БанковскиеСчета</Источник><Приемник>СправочникСсылка.РасчетныеСчета</Приемник><Свойства><Свойство><Код>1</Код><Наименование> --&gt;</Наименование><Порядок>100</Порядок><Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/></Свойство><Свойство Поиск="true"><Код>2</Код><Наименование>Владелец --&gt;</Наименование><Порядок>200</Порядок><Источник Имя="Владелец" Вид="Свойство"/><Приемник Имя="Владелец" Вид="Свойство" Тип="СправочникСсылка.Контрагенты"/><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации></Свойство><Свойство><Код>7</Код><Наименование>ТекстНазначения --&gt; Назначение</Наименование><Порядок>700</Порядок><Источник Имя="ТекстНазначения" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Назначение" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>6</Код><Наименование>ТекстКорреспондента --&gt; Корреспондент</Наименование><Порядок>600</Порядок><Источник Имя="ТекстКорреспондента" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Корреспондент" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>5</Код><Наименование>БанкДляРасчетов --&gt; БанкДляРасчетов</Наименование><Порядок>500</Порядок><Источник Имя="БанкДляРасчетов" Вид="Реквизит" Тип="СправочникСсылка.Банки"/><Приемник Имя="БанкДляРасчетов" Вид="Реквизит" Тип="СправочникСсылка.Банки"/><КодПравилаКонвертации>Банки                                             </КодПравилаКонвертации></Свойство><Свойство Поиск="true"><Код>3</Код><Наименование>НомерСчета --&gt; Номер</Наименование><Порядок>300</Порядок><Источник Имя="НомерСчета" Вид="Реквизит" Тип="Строка"/><Приемник Имя="Номер" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>4</Код><Наименование>Банк --&gt; БанкОрганизации</Наименование><Порядок>400</Порядок><Источник Имя="Банк" Вид="Реквизит" Тип="СправочникСсылка.Банки"/><Приемник Имя="БанкОрганизации" Вид="Реквизит" Тип="СправочникСсылка.Банки"/><КодПравилаКонвертации>Банки                                             </КодПравилаКонвертации></Свойство></Свойства><Значения/></Правило><Правило><Код>Сотрудники</Код><Наименование>СправочникСсылка.ФизическиеЛица --&gt; СправочникСсылка.Сотрудники</Наименование><Порядок>500</Порядок><ПередВыгрузкой>Если Источник.ЭтоГруппа И Источник.Уровень() &gt;= 2 Тогда
	Отказ = Истина;
КонецЕсли;

СтруктураПаспортныхДанных	= РегистрыСведений.ПаспортныеДанныеФизЛиц.ПолучитьПоследнее(РабочаяДата, Новый Структура("ФизЛицо", Источник));
ВходящиеДанные				= Новый Структура;

ВходящиеДанные.Вставить("ВидДокумента", СтруктураПаспортныхДанных.ДокументВид);
ВходящиеДанные.Вставить("ДокументСерия", СтруктураПаспортныхДанных.ДокументСерия);
ВходящиеДанные.Вставить("ДокументНомер", СтруктураПаспортныхДанных.ДокументНомер);
ВходящиеДанные.Вставить("ДокументДатаВыдачи", СтруктураПаспортныхДанных.ДокументДатаВыдачи);
ВходящиеДанные.Вставить("ДокументКемВыдан", СтруктураПаспортныхДанных.ДокументКемВыдан);</ПередВыгрузкой><НеЗамещать>true</НеЗамещать><Источник>СправочникСсылка.ФизическиеЛица</Источник><Приемник>СправочникСсылка.Сотрудники</Приемник><Свойства><Свойство Поиск="true"><Код>7</Код><Наименование>ЭтоГруппа --&gt; ЭтоГруппа</Наименование><Порядок>700</Порядок><Источник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/><Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Число"/></Свойство><Свойство Поиск="true"><Код>8</Код><Наименование>Код --&gt; Код</Наименование><Порядок>800</Порядок><Источник/><Приемник Имя="Код" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>Значение = ДобавитьКПрефиксу(Источник.Код, "", 10, "");</ПередВыгрузкой></Свойство><Свойство><Код>6</Код><Наименование> --&gt; Наименование</Наименование><Порядок>600</Порядок><Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/></Свойство><Свойство><Код>2</Код><Наименование>Родитель --&gt; Родитель</Наименование><Порядок>200</Порядок><Источник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.ФизическиеЛица"/><Приемник Имя="Родитель" Вид="Свойство" Тип="СправочникСсылка.Сотрудники"/><КодПравилаКонвертации>Сотрудники                                        </КодПравилаКонвертации><ПередВыгрузкой>Значение = Источник.Родитель;
Если НЕ ЗначениеНеЗаполнено(Значение) = 1 Тогда 
	Пока Значение.Уровень() &gt;= 2 Цикл
		Значение = Значение.Родитель;
	КонецЦикла;
КонецЕсли;</ПередВыгрузкой></Свойство><Группа><Код>14</Код><Наименование> --&gt;</Наименование><Порядок>1400</Порядок><Источник/><Приемник/><ПередОбработкойВыгрузки>Если Источник.ЭтоГруппа Тогда
	Отказ = Истина;
КонецЕсли;</ПередОбработкойВыгрузки><Свойство><Код>9</Код><Наименование> --&gt; ВидДокумента</Наименование><Порядок>900</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="ВидДокумента" Вид="Реквизит" Тип="СправочникСсылка.ДокументыУдостоверяющиеЛичность"/><КодПравилаКонвертации>ДокументыУдостоверяющиеЛичность                   </КодПравилаКонвертации></Свойство><Свойство><Код>10</Код><Наименование> --&gt; ДокументДатаВыдачи</Наименование><Порядок>1000</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="ДокументДатаВыдачи" Вид="Реквизит" Тип="Дата"/></Свойство><Свойство><Код>11</Код><Наименование> --&gt; ДокументКемВыдан</Наименование><Порядок>1100</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="ДокументКемВыдан" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>12</Код><Наименование> --&gt; ДокументНомер</Наименование><Порядок>1200</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="ДокументНомер" Вид="Реквизит" Тип="Строка"/></Свойство><Свойство><Код>13</Код><Наименование> --&gt; ДокументСерия</Наименование><Порядок>1300</Порядок><ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных><Источник/><Приемник Имя="ДокументСерия" Вид="Реквизит" Тип="Строка"/></Свойство></Группа></Свойства><Значения/></Правило><Правило><Код>СтавкиНДС</Код><Наименование>ПеречислениеСсылка.СтавкиНДС --&gt; СправочникСсылка.СтавкиНДС</Наименование><Порядок>1000</Порядок><НеЗамещать>true</НеЗамещать><Источник>ПеречислениеСсылка.СтавкиНДС</Источник><Приемник>СправочникСсылка.СтавкиНДС</Приемник><Свойства><Свойство><Код>2</Код><Наименование> --&gt; Наименование</Наименование><Порядок>200</Порядок><Источник/><Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/><ПередВыгрузкой>Значение = Строка(Источник);</ПередВыгрузкой></Свойство><Свойство Поиск="true"><Код>1</Код><Наименование> --&gt; Ставка</Наименование><Порядок>100</Порядок><Источник/><Приемник Имя="Ставка" Вид="Реквизит" Тип="Число"/><ПередВыгрузкой>Если Источник = Перечисления.СтавкиНДС.БезНДС Тогда
	Значение = 0;
	
ИначеЕсли Источник = Перечисления.СтавкиНДС.НДС20 Тогда
	Значение = 20;
	
ИначеЕсли Источник = Перечисления.СтавкиНДС.НДС20_120 Тогда
	Значение = 20;
	
ИначеЕсли Источник = Перечисления.СтавкиНДС.НДС18 Тогда
	Значение = 18;
	
ИначеЕсли Источник = Перечисления.СтавкиНДС.НДС18_118 Тогда
	Значение = 18;
	
ИначеЕсли Источник = Перечисления.СтавкиНДС.НДС10 Тогда
	Значение = 10;
	
ИначеЕсли Источник = Перечисления.СтавкиНДС.НДС10_110 Тогда
	Значение = 10;
	
Иначе
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкой></Свойство></Свойства><Значения/></Правило></Группа><Правило><Код>ТребованиеНакладная</Код><Наименование>ДокументСсылка.ТребованиеНакладная --&gt; ДокументСсылка.ТребованиеНакладная</Наименование><Порядок>800</Порядок><СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору><Источник>ДокументСсылка.ТребованиеНакладная</Источник><Приемник>ДокументСсылка.ТребованиеНакладная</Приемник><Свойства/><Значения/></Правило></ПравилаКонвертацииОбъектов><ПравилаВыгрузкиДанных><Группа><Код>Документы</Код><Наименование>Хозяйственные операции</Наименование><Порядок>1200</Порядок><Правило><Код>АвансовыйОтчет</Код><Наименование>Авансовый отчет</Наименование><Порядок>200</Порядок><КодПравилаКонвертации>АвансовыйОтчет                                    </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.АвансовыйОтчет</ОбъектВыборки><ПередВыгрузкойОбъекта>Если НЕ Объект.Проведен или Не Объект.ОтражатьВБухгалтерскомУчете Тогда
	Отказ = Истина;

ИначеЕсли Объект.Организация &lt;&gt; Параметры.Организация Тогда
	Отказ = Истина;
	
ИначеЕсли (Параметры.СписокСкладов.НайтиПоЗначению(Объект.СкладОрдер) = Неопределено) 
		и (Объект.ВидПоступления &lt;&gt; Перечисления.ВидыПоступленияТоваров.ПоОрдеру 
		   или Параметры.СписокСкладов.НайтиПоЗначению(Объект.СкладОрдер.Склад) = Неопределено) 
		и (Параметры.СписокСкладов.Количество() &gt; 0) Тогда
	Отказ = Истина;
	
ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило><Код>ВозвратТоваровОтПокупателя</Код><Наименование>Возврат товаров от покупателя</Наименование><Порядок>600</Порядок><КодПравилаКонвертации>ВозвратТоваровОтПокупателя                        </КодПравилаКонвертации><СпособОтбораДанных>ПроизвольныйАлгоритм</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.ВозвратТоваровОтПокупателя</ОбъектВыборки><ПередОбработкойПравила>ТЗ = "ВЫБРАТЬ
|	ВозвратТоваровОтПокупателяТовары.Ссылка КАК Источник,
|	ВозвратТоваровОтПокупателяТовары.Номенклатура КАК Товар,
|	ВозвратТоваровОтПокупателяТовары.СерияНоменклатуры.НомерГТД КАК ГТД,
|	ВозвратТоваровОтПокупателяТовары.СерияНоменклатуры.СтранаПроисхождения КАК СтранаПроисхождения,
|	ВЫБОР КОГДА ВозвратТоваровОтПокупателяТовары.ДокументПартии ССЫЛКА Документ.РеализацияТоваровУслуг ТОГДА 
|		ВозвратТоваровОтПокупателяТовары.ДокументПартии 
|	ИНАЧЕ 
|		&amp;ПустойДокументПартии 
|	КОНЕЦ КАК ДокументОтгрузки,
|	ВЫБОР КОГДА ПартииТоваров.Количество &lt;&gt; 0 ТОГДА 
|		ВЫБОР КОГДА ВозвратТоваровОтПокупателяТовары.Количество &lt;&gt; 0 
|				  И ВозвратТоваровОтПокупателяТовары.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент &lt;&gt; 0 ТОГДА 
|						ПартииТоваров.Количество * ВозвратТоваровОтПокупателяТовары.Коэффициент 
|						* ВозвратТоваровОтПокупателяТовары.Сумма * ВозвратТоваровОтПокупателяТовары.Количество 
|						/ ВозвратТоваровОтПокупателяТовары.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент 
|		ИНАЧЕ 
|			0 
|		КОНЕЦ 
|	ИНАЧЕ 
|		ВозвратТоваровОтПокупателяТовары.Сумма 
|	КОНЕЦ КАК Сумма,
|	ВЫБОР КОГДА ПартииТоваров.Количество &lt;&gt; 0 ТОГДА 
|		ВЫБОР КОГДА ВозвратТоваровОтПокупателяТовары.Количество &lt;&gt; 0 
|			      И ВозвратТоваровОтПокупателяТовары.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент &lt;&gt; 0 ТОГДА 
|				ПартииТоваров.Количество * ВозвратТоваровОтПокупателяТовары.Коэффициент 
|				* ВозвратТоваровОтПокупателяТовары.СуммаНДС * ВозвратТоваровОтПокупателяТовары.Количество 
|				/ ВозвратТоваровОтПокупателяТовары.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент 
|		ИНАЧЕ 
|			0 
|		КОНЕЦ 
|	ИНАЧЕ 
|		ВозвратТоваровОтПокупателяТовары.СуммаНДС 
|	КОНЕЦ КАК НДС,
|	ВЫБОР КОГДА ПартииТоваров.Количество &lt;&gt; 0 ТОГДА 
|		ВЫБОР КОГДА ВозвратТоваровОтПокупателяТовары.Количество &lt;&gt; 0 
|			И ВозвратТоваровОтПокупателяТовары.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент &lt;&gt; 0 ТОГДА 
|				ПартииТоваров.Количество * ВозвратТоваровОтПокупателяТовары.Коэффициент * ВозвратТоваровОтПокупателяТовары.Цена 
|				* ВозвратТоваровОтПокупателяТовары.Количество 
|				/ ВозвратТоваровОтПокупателяТовары.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент 
|		ИНАЧЕ 
|			0 
|		КОНЕЦ 
|	ИНАЧЕ 
|		ВозвратТоваровОтПокупателяТовары.Цена 
|	КОНЕЦ КАК Цена,
|	ВЫБОР КОГДА ПартииТоваров.Количество &lt;&gt; 0 ТОГДА 
|		ПартииТоваров.Количество ИНАЧЕ ВозвратТоваровОтПокупателяТовары.Количество 
|	КОНЕЦ КАК Количество,
|	ВЫБОР КОГДА ПартииТоваров.СтатусПартии = &amp;ТоварПринятыйКомиссия ТОГДА 
|		ПартииТоваров.ДокументОприходования.Контрагент 
|	ИНАЧЕ 
|		&amp;ПустойКомитент 
|	КОНЕЦ КАК Комитент,
|	ВЫБОР КОГДА ПартииТоваров.СтатусПартии = &amp;ТоварПринятыйКомиссия ТОГДА 
|		ПартииТоваров.ДокументОприходования.ДоговорКонтрагента
|	ИНАЧЕ 
|		&amp;ПустойДоговорКомиссии 
|	КОНЕЦ КАК ДоговорКомиссии
|ИЗ
|	Документ.ВозвратТоваровОтПокупателя.Товары КАК ВозвратТоваровОтПокупателяТовары
|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ПартииТоваровНаСкладах КАК ПартииТоваров
|		ПО ВозвратТоваровОтПокупателяТовары.Номенклатура = ПартииТоваров.Номенклатура И 
|		   ВозвратТоваровОтПокупателяТовары.Ссылка = ПартииТоваров.Регистратор И
|		   ВозвратТоваровОтПокупателяТовары.СерияНоменклатуры = ПартииТоваров.СерияНоменклатуры И
|		   ВозвратТоваровОтПокупателяТовары.ХарактеристикаНоменклатуры = ПартииТоваров.ХарактеристикаНоменклатуры И 
|		   (ВозвратТоваровОтПокупателяТовары.ДокументПартии = ПартииТоваров.ДокументОприходования
|			И НЕ(ВозвратТоваровОтПокупателяТовары.ДокументПартии ССЫЛКА Документ.РеализацияТоваровУслуг) 
|			ИЛИ ВозвратТоваровОтПокупателяТовары.ДокументПартии = &amp;ПустойДокументПартии)
|
|ГДЕ
|	ВозвратТоваровОтПокупателяТовары.Ссылка.Проведен = ИСТИНА
|	И ВозвратТоваровОтПокупателяТовары.Ссылка.ОтражатьВБухгалтерскомУчете = ИСТИНА
|	И ВозвратТоваровОтПокупателяТовары.Ссылка.Организация = &amp;Организация";

Если Не одПустое(ДатаНачала) и Не одПустое(ДатаОкончания) Тогда
	ТЗ = ТЗ + "
	| И (ВозвратТоваровОтПокупателяТовары.Ссылка.Дата МЕЖДУ &amp;ДатаНачала И &amp;ДатаОкончания)";

ИначеЕсли Не одПустое(ДатаНачала) и одПустое(ДатаОкончания) Тогда
	ТЗ = ТЗ + "
	| И (ВозвратТоваровОтПокупателяТовары.Ссылка.Дата &gt;= &amp;ДатаНачала)";

ИначеЕсли одПустое(ДатаНачала) и Не одПустое(ДатаОкончания) Тогда
	ТЗ = ТЗ + "
	| И (ВозвратТоваровОтПокупателяТовары.Ссылка.Дата &lt;= &amp;ДатаОкончания)";
КонецЕсли;	

ТЗ = ТЗ + "
|ИТОГИ ПО
|	Источник,
|	ДокументОтгрузки";


Запрос = Новый Запрос(ТЗ);
Запрос.УстановитьПараметр("ПустойДокументПартии", Документы.РеализацияТоваровУслуг.ПустаяСсылка());
Запрос.УстановитьПараметр("ПустойКомитент", Справочники.Контрагенты.ПустаяСсылка());
Запрос.УстановитьПараметр("ПустойДоговорКомиссии", Справочники.ДоговорыКонтрагентов.ПустаяСсылка());
Запрос.УстановитьПараметр("ДатаНачала", ДатаНачала);
Запрос.УстановитьПараметр("ДатаОкончания", ДатаОкончания);
Запрос.УстановитьПараметр("Организация", Параметры.Организация);
Запрос.УстановитьПараметр("ТоварПринятыйКомиссия", Перечисления.СтатусыПартийТоваров.НаКомиссию);

РезультатЗапроса = Запрос.Выполнить();

ВыборкаДанных = Новый ТаблицаЗначений;
ВыборкаДанных.Колонки.Добавить("Источник");
ВыборкаДанных.Колонки.Добавить("ДокументОснование");
ВыборкаДанных.Колонки.Добавить("ТабличнаяЧасть");

ВыборкаДокументовВозврата = РезультатЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
Пока ВыборкаДокументовВозврата.Следующий() Цикл
	ВыборкаДокументовОтгрузки = ВыборкаДокументовВозврата.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	Пока ВыборкаДокументовОтгрузки.Следующий() Цикл
		СтрокаВыборкиДанных = ВыборкаДанных.Добавить();
		СтрокаВыборкиДанных.Источник = ВыборкаДокументовВозврата.Источник;
		СтрокаВыборкиДанных.ДокументОснование = ВыборкаДокументовОтгрузки.ДокументОтгрузки;
		
		СтрокаВыборкиДанных.ТабличнаяЧасть = Новый ТаблицаЗначений;
		Для Индекс = 0 по РезультатЗапроса.Колонки.Количество() - 1 Цикл
			СтрокаВыборкиДанных.ТабличнаяЧасть.Колонки.Добавить(РезультатЗапроса.Колонки.Получить(Индекс).Имя);
		КонецЦикла;

		ТабличнаяЧасть = ВыборкаДокументовОтгрузки.Выбрать();
		Пока ТабличнаяЧасть.Следующий() Цикл
			СтрокаТабличнойЧасти = СтрокаВыборкиДанных.ТабличнаяЧасть.Добавить();
			Для Индекс = 0 по РезультатЗапроса.Колонки.Количество() - 1 Цикл
				СтрокаТабличнойЧасти.Установить(Индекс, ТабличнаяЧасть.Получить(Индекс));
			КонецЦикла;
		КонецЦикла;
	КонецЦикла;
КонецЦикла;</ПередОбработкойПравила><ПередВыгрузкойОбъекта>ИсходящиеДанные = Новый Структура;
ИсходящиеДанные.Вставить("ДокументОснование", Объект.ДокументОснование );
ИсходящиеДанные.Вставить("ТабличнаяЧасть", Объект.ТабличнаяЧасть);

Объект = Объект.Источник;

Если НЕ Объект.Проведен или Не Объект.ОтражатьВБухгалтерскомУчете Тогда
	Отказ = Истина;

ИначеЕсли (Параметры.СписокСкладов.НайтиПоЗначению(Объект.СкладОрдер) = Неопределено) 
		и (Объект.ВидПоступления &lt;&gt; Перечисления.ВидыПоступленияТоваров.ПоОрдеру 
		   или Параметры.СписокСкладов.НайтиПоЗначению(Объект.СкладОрдер.Склад) = Неопределено) 
		и (Параметры.СписокСкладов.Количество() &gt; 0) Тогда
	Отказ = Истина;
	
ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило><Код>ВозвратТоваровПоставщику</Код><Наименование>Возврат товаров поставщику</Наименование><Порядок>1200</Порядок><КодПравилаКонвертации>ВозвратПоставщику                                 </КодПравилаКонвертации><СпособОтбораДанных>ПроизвольныйАлгоритм</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.ВозвратТоваровПоставщику</ОбъектВыборки><ПередОбработкойПравила>ТЗ = "ВЫБРАТЬ
|	ВозвратТоваровПоставщикуТовары.Ссылка                                КАК Источник,
|	ВозвратТоваровПоставщикуТовары.Номенклатура                          КАК Товар,
|	ВозвратТоваровПоставщикуТовары.СерияНоменклатуры.НомерГТД            КАК НомерГТД,
|	ВозвратТоваровПоставщикуТовары.СерияНоменклатуры.СтранаПроисхождения КАК СтранаПроисхождения,
|	ВЫБОР КОГДА ВозвратТоваровПоставщикуТовары.ДокументПоступления &lt;&gt; &amp;ПустойДокументПартии ТОГДА 
|		ВозвратТоваровПоставщикуТовары.ДокументПоступления 
|	КОНЕЦ                                                                КАК ДокументПоступления,
|	ВЫБОР КОГДА ВозвратТоваровПоставщикуТовары.Ссылка.СуммаВключаетНДС ТОГДА 
|		ВозвратТоваровПоставщикуТовары.Сумма 
|	ИНАЧЕ 
|		ВЫБОР КОГДА ВозвратТоваровПоставщикуТовары.Ссылка.СуммаВключаетНДС ТОГДА 
|			ВозвратТоваровПоставщикуТовары.Сумма 
|		ИНАЧЕ 
|			ВЫБОР КОГДА НЕ(ВозвратТоваровПоставщикуТовары.Ссылка.СуммаВключаетНДС) ТОГДА 
|				ВозвратТоваровПоставщикуТовары.Сумма + ВозвратТоваровПоставщикуТовары.СуммаНДС 
|			ИНАЧЕ 
|				ВозвратТоваровПоставщикуТовары.Сумма + ВозвратТоваровПоставщикуТовары.СуммаНДС 
|			КОНЕЦ 
|		КОНЕЦ 
|	КОНЕЦ                                                                КАК Всего,
|	ВозвратТоваровПоставщикуТовары.Сумма                                 КАК Сумма,
|	ВозвратТоваровПоставщикуТовары.СуммаНДС                              КАК НДС,
|	ВозвратТоваровПоставщикуТовары.Цена                                  КАК Цена,
|	ВозвратТоваровПоставщикуТовары.Коэффициент                           КАК Коэффициент,
|	ВозвратТоваровПоставщикуТовары.Количество                            КАК Количество
|ИЗ
|	Документ.ВозвратТоваровПоставщику.Товары КАК ВозвратТоваровПоставщикуТовары
|
|ГДЕ
|	ВозвратТоваровПоставщикуТовары.Ссылка.Проведен = ИСТИНА
|	И ВозвратТоваровПоставщикуТовары.Ссылка.ОтражатьВБухгалтерскомУчете = ИСТИНА
|	И ВозвратТоваровПоставщикуТовары.Ссылка.Организация = &amp;Организация";

Если Не одПустое(ДатаНачала) и Не одПустое(ДатаОкончания) Тогда
	ТЗ = ТЗ + "
	| И (ВозвратТоваровПоставщикуТовары.Ссылка.Дата МЕЖДУ &amp;ДатаНачала И &amp;ДатаОкончания)";

ИначеЕсли Не одПустое(ДатаНачала) и одПустое(ДатаОкончания) Тогда
	ТЗ = ТЗ + "
	| И (ВозвратТоваровПоставщикуТовары.Ссылка.Дата &gt;= &amp;ДатаНачала)";

ИначеЕсли одПустое(ДатаНачала) и Не одПустое(ДатаОкончания) Тогда
	ТЗ = ТЗ + "
	| И (ВозвратТоваровПоставщикуТовары.Ссылка.Дата &lt;= &amp;ДатаОкончания)";
КонецЕсли;	

ТЗ = ТЗ + "
|ИТОГИ ПО
|	Источник,
|	ДокументПоступления";


Запрос = Новый Запрос(ТЗ);
Запрос.УстановитьПараметр("ПустойДокументПартии", Документы.ПоступлениеТоваровУслуг.ПустаяСсылка());
Запрос.УстановитьПараметр("ДатаНачала", ДатаНачала);
Запрос.УстановитьПараметр("ДатаОкончания", ДатаОкончания);
Запрос.УстановитьПараметр("Организация", Параметры.Организация);
РезультатЗапроса = Запрос.Выполнить();

ВыборкаДанных = Новый ТаблицаЗначений;
ВыборкаДанных.Колонки.Добавить("Источник");
ВыборкаДанных.Колонки.Добавить("ДокументПоступления");
ВыборкаДанных.Колонки.Добавить("ТабличнаяЧасть");

ВыборкаДокументовВозврата = РезультатЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
Пока ВыборкаДокументовВозврата.Следующий() Цикл
	ВыборкаДокументовПоступления = ВыборкаДокументовВозврата.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	Пока ВыборкаДокументовПоступления.Следующий() Цикл
		СтрокаВыборкиДанных = ВыборкаДанных.Добавить();
		СтрокаВыборкиДанных.Источник = ВыборкаДокументовВозврата.Источник;
		СтрокаВыборкиДанных.ДокументПоступления = ВыборкаДокументовПоступления.ДокументПоступления;
		
		СтрокаВыборкиДанных.ТабличнаяЧасть = Новый ТаблицаЗначений;
		Для Индекс = 0 по РезультатЗапроса.Колонки.Количество() - 1 Цикл
			СтрокаВыборкиДанных.ТабличнаяЧасть.Колонки.Добавить(РезультатЗапроса.Колонки.Получить(Индекс).Имя);
		КонецЦикла;

		ТабличнаяЧасть = ВыборкаДокументовПоступления.Выбрать();
		Пока ТабличнаяЧасть.Следующий() Цикл
			СтрокаТабличнойЧасти = СтрокаВыборкиДанных.ТабличнаяЧасть.Добавить();
			Для Индекс = 0 по РезультатЗапроса.Колонки.Количество() - 1 Цикл
				СтрокаТабличнойЧасти.Установить(Индекс, ТабличнаяЧасть.Получить(Индекс));
			КонецЦикла;
		КонецЦикла;
	КонецЦикла;
КонецЦикла;
</ПередОбработкойПравила><ПередВыгрузкойОбъекта>ИсходящиеДанные = Новый Структура;
ИсходящиеДанные.Вставить("ДокументПоступления", Объект.ДокументПоступления );
ИсходящиеДанные.Вставить("ТабличнаяЧасть", Объект.ТабличнаяЧасть);

Объект = Объект.Источник;

Если НЕ Объект.Проведен или Не Объект.ОтражатьВБухгалтерскомУчете Тогда
	Отказ = Истина;

ИначеЕсли (Параметры.СписокСкладов.НайтиПоЗначению(Объект.Склад) = Неопределено) и (Параметры.СписокСкладов.Количество() &gt; 0) Тогда
	Отказ = Истина;
	
ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило><Код>ВозвратТоваровПоставщикуИзНТТ</Код><Наименование>Возврат товаров поставщику из НТТ</Наименование><Порядок>1200</Порядок><КодПравилаКонвертации>ВозвратПоставщикуИзНТТ                            </КодПравилаКонвертации><СпособОтбораДанных>ПроизвольныйАлгоритм</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.ВозвратТоваровПоставщикуИзНеавтоматизированнойТорговойТочки</ОбъектВыборки><ПередОбработкойПравила>ТЗ = "ВЫБРАТЬ
|	ВозвратТоваровПоставщикуТовары.Ссылка                                КАК Источник,
|	ВозвратТоваровПоставщикуТовары.Номенклатура                          КАК Товар,
|	ВозвратТоваровПоставщикуТовары.СерияНоменклатуры.НомерГТД            КАК НомерГТД,
|	ВозвратТоваровПоставщикуТовары.СерияНоменклатуры.СтранаПроисхождения КАК СтранаПроисхождения,
|	ВЫБОР КОГДА ВозвратТоваровПоставщикуТовары.ДокументПоступления &lt;&gt; &amp;ПустойДокументПартии ТОГДА 
|		ВозвратТоваровПоставщикуТовары.ДокументПоступления 
|	КОНЕЦ                                                                КАК ДокументПоступления,
|	ВЫБОР КОГДА ВозвратТоваровПоставщикуТовары.Ссылка.СуммаВключаетНДС ТОГДА 
|		ВозвратТоваровПоставщикуТовары.Сумма 
|	ИНАЧЕ 
|		ВЫБОР КОГДА ВозвратТоваровПоставщикуТовары.Ссылка.СуммаВключаетНДС ТОГДА 
|			ВозвратТоваровПоставщикуТовары.Сумма 
|		ИНАЧЕ 
|			ВЫБОР КОГДА НЕ(ВозвратТоваровПоставщикуТовары.Ссылка.СуммаВключаетНДС) ТОГДА 
|				ВозвратТоваровПоставщикуТовары.Сумма + ВозвратТоваровПоставщикуТовары.СуммаНДС 
|			ИНАЧЕ 
|				ВозвратТоваровПоставщикуТовары.Сумма + ВозвратТоваровПоставщикуТовары.СуммаНДС 
|			КОНЕЦ 
|		КОНЕЦ 
|	КОНЕЦ                                                                КАК Всего,
|	ВозвратТоваровПоставщикуТовары.Сумма                                 КАК Сумма,
|	ВозвратТоваровПоставщикуТовары.СуммаНДС                              КАК НДС,
|	ВозвратТоваровПоставщикуТовары.Цена                                  КАК Цена,
|	ВозвратТоваровПоставщикуТовары.Коэффициент                           КАК Коэффициент,
|	ВозвратТоваровПоставщикуТовары.Количество                            КАК Количество
|ИЗ
|	Документ.ВозвратТоваровПоставщикуИзНеавтоматизированнойТорговойТочки.Товары КАК ВозвратТоваровПоставщикуТовары
|
|ГДЕ
|	ВозвратТоваровПоставщикуТовары.Ссылка.Проведен = ИСТИНА
|	И ВозвратТоваровПоставщикуТовары.Ссылка.ОтражатьВБухгалтерскомУчете = ИСТИНА
|	И ВозвратТоваровПоставщикуТовары.Ссылка.Организация = &amp;Организация";

Если Не одПустое(ДатаНачала) и Не одПустое(ДатаОкончания) Тогда
	ТЗ = ТЗ + "
	| И (ВозвратТоваровПоставщикуТовары.Ссылка.Дата МЕЖДУ &amp;ДатаНачала И &amp;ДатаОкончания)";

ИначеЕсли Не одПустое(ДатаНачала) и одПустое(ДатаОкончания) Тогда
	ТЗ = ТЗ + "
	| И (ВозвратТоваровПоставщикуТовары.Ссылка.Дата &gt;= &amp;ДатаНачала)";

ИначеЕсли одПустое(ДатаНачала) и Не одПустое(ДатаОкончания) Тогда
	ТЗ = ТЗ + "
	| И (ВозвратТоваровПоставщикуТовары.Ссылка.Дата &lt;= &amp;ДатаОкончания)";
КонецЕсли;	

ТЗ = ТЗ + "
|ИТОГИ ПО
|	Источник,
|	ДокументПоступления";

Запрос = Новый Запрос(ТЗ);
Запрос.УстановитьПараметр("ПустойДокументПартии", Документы.ПоступлениеТоваровУслугВНеавтоматизированнуюТорговуюТочку.ПустаяСсылка());
Запрос.УстановитьПараметр("ДатаНачала", ДатаНачала);
Запрос.УстановитьПараметр("ДатаОкончания", ДатаОкончания);
Запрос.УстановитьПараметр("Организация", Параметры.Организация);
РезультатЗапроса = Запрос.Выполнить();

ВыборкаДанных = Новый ТаблицаЗначений;
ВыборкаДанных.Колонки.Добавить("Источник");
ВыборкаДанных.Колонки.Добавить("ДокументПоступления");
ВыборкаДанных.Колонки.Добавить("ТабличнаяЧасть");

ВыборкаДокументовВозврата = РезультатЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
Пока ВыборкаДокументовВозврата.Следующий() Цикл
	ВыборкаДокументовПоступления = ВыборкаДокументовВозврата.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	Пока ВыборкаДокументовПоступления.Следующий() Цикл
		СтрокаВыборкиДанных = ВыборкаДанных.Добавить();
		СтрокаВыборкиДанных.Источник = ВыборкаДокументовВозврата.Источник;
		СтрокаВыборкиДанных.ДокументПоступления = ВыборкаДокументовПоступления.ДокументПоступления;
		
		СтрокаВыборкиДанных.ТабличнаяЧасть = Новый ТаблицаЗначений;
		Для Индекс = 0 по РезультатЗапроса.Колонки.Количество() - 1 Цикл
			СтрокаВыборкиДанных.ТабличнаяЧасть.Колонки.Добавить(РезультатЗапроса.Колонки.Получить(Индекс).Имя);
		КонецЦикла;

		ТабличнаяЧасть = ВыборкаДокументовПоступления.Выбрать();
		Пока ТабличнаяЧасть.Следующий() Цикл
			СтрокаТабличнойЧасти = СтрокаВыборкиДанных.ТабличнаяЧасть.Добавить();
			Для Индекс = 0 по РезультатЗапроса.Колонки.Количество() - 1 Цикл
				СтрокаТабличнойЧасти.Установить(Индекс, ТабличнаяЧасть.Получить(Индекс));
			КонецЦикла;
		КонецЦикла;
	КонецЦикла;
КонецЦикла;</ПередОбработкойПравила><ПередВыгрузкойОбъекта>ИсходящиеДанные = Новый Структура;
ИсходящиеДанные.Вставить("ДокументПоступления", Объект.ДокументПоступления );
ИсходящиеДанные.Вставить("ТабличнаяЧасть", Объект.ТабличнаяЧасть);

Объект = Объект.Источник;

Если НЕ Объект.Проведен или Не Объект.ОтражатьВБухгалтерскомУчете Тогда
	Отказ = Истина;

ИначеЕсли (Параметры.СписокСкладов.НайтиПоЗначению(Объект.Склад) = Неопределено) и (Параметры.СписокСкладов.Количество() &gt; 0) Тогда
	Отказ = Истина;
	
ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило><Код>Выписка</Код><Наименование>Выписка</Наименование><Порядок>2100</Порядок><КодПравилаКонвертации>Выписка                                           </КодПравилаКонвертации><СпособОтбораДанных>ПроизвольныйАлгоритм</СпособОтбораДанных><ПередОбработкойПравила>МассивДокументовСТЧ = Новый СписокЗначений;
МассивДокументовСТЧ.Добавить("ПлатежноеПоручениеИсходящее");
МассивДокументовСТЧ.Добавить("ПлатежноеПоручениеВходящее");
МассивДокументовСТЧ.Добавить("ПлатежноеТребованиеВыставленное");
МассивДокументовСТЧ.Добавить("ПлатежноеТребованиеПолученное");
МассивДокументовСТЧ.Добавить("ИнкассовоеПоручениеПереданное");
МассивДокументовСТЧ.Добавить("ИнкассовоеПоручениеПолученное");
МассивДокументовСТЧ.Добавить("АккредитивПереданный");
МассивДокументовСТЧ.Добавить("АккредитивПолученный");
МассивДокументовСТЧ.Добавить("ПлатежныйОрдерПоступлениеДенежныхСредств");
МассивДокументовСТЧ.Добавить("ПлатежныйОрдерСписаниеДенежныхСредств");

МассивДокументовБезТЧ = Новый СписокЗначений;
МассивДокументовБезТЧ.Добавить("ДенежныйЧек");
МассивДокументовБезТЧ.Добавить("ОбъявлениеНаВзносНаличными");

ТЗ = "";
ПервыйРаз = Истина;
Для каждого ИмяДокумента из МассивДокументовСТЧ Цикл
	
	Если ПервыйРаз Тогда
		ПервыйРаз = Ложь;
	Иначе
		ТЗ = ТЗ + "
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|";
	КонецЕсли;
	
	ТЗ = ТЗ + "ВЫБРАТЬ
	|НачалоПериода(Док.Ссылка.Дата, День) КАК Дата,
	|Док.Ссылка 		                  КАК Ссылка,
	|Док.Ссылка.ВалютаДокумента           КАК Валюта,
	|Док.Ссылка.ВидОперации               КАК ВидОперации,
	|Док.Ссылка.Контрагент                КАК Контрагент,
	|Док.Ссылка.СчетОрганизации           КАК БанковскийСчет,";
	
	МетаданныеДокумента = Метаданные.Документы["" + ИмяДокумента];
	Если ЕстьРеквизитДокумента("НазначениеПлатежа", МетаданныеДокумента) Тогда
		ТЗ = ТЗ + "
		|Док.Ссылка.НазначениеПлатежа         КАК НазначениеПлатежа,";
	Иначе
		ТЗ = ТЗ + "
		|""""                                 КАК НазначениеПлатежа,";
	КонецЕсли;
	
	ТЗ = ТЗ + "
	|Док.ДоговорКонтрагента               КАК ДоговорКонтрагента,
	|Док.Сделка                           КАК Сделка,
	|Док.КурсВзаиморасчетов               КАК КурсВзаиморасчетов,
	|Док.КратностьВзаиморасчетов          КАК КратностьВзаиморасчетов,
	|Док.СуммаПлатежа                     КАК СуммаПлатежа 
	|	
	|ИЗ
	|	Документ." + ИмяДокумента + ".РасшифровкаПлатежа КАК Док
	|
	|ГДЕ
	|	(Док.Ссылка.ОтражатьВБухгалтерскомУчете &lt;&gt; ЛОЖЬ)
	|	И (Док.Ссылка.Проведен = ИСТИНА)
	|	И (Док.Ссылка.Оплачено = ИСТИНА)
	|	И (Док.Ссылка.Организация = &amp;Организация)";

	Если Не одПустое(ДатаНачала) и Не одПустое(ДатаОкончания) Тогда
		ТЗ = ТЗ + "
		| И (Док.Ссылка.Дата МЕЖДУ &amp;ДатаНачала И &amp;ДатаОкончания)";

	ИначеЕсли Не одПустое(ДатаНачала) и одПустое(ДатаОкончания) Тогда
		ТЗ = ТЗ + "
		| И (Док.Ссылка.Дата &gt;= &amp;ДатаНачала)";

	ИначеЕсли одПустое(ДатаНачала) и Не одПустое(ДатаОкончания) Тогда
		ТЗ = ТЗ + "
		| И (Док.Ссылка.Дата &lt;= &amp;ДатаОкончания)";
	КонецЕсли;	
	
КонецЦикла;

//Для ИмяДокумента каждого из МассивДокументовБезТЧ Цикл
//	
//	ТЗ = ТЗ + "
//	|
//	|ОБЪЕДИНИТЬ ВСЕ
//	|";
//	
//	ТЗ = ТЗ + "ВЫБРАТЬ
//	|НачалоПериода(Док.Дата, День) КАК Дата,
//	|Док.Ссылка 		           КАК Ссылка,
//	|Док.ВидОперации               КАК ВидОперации,
//	|""                            КАК НазначениеПлатежа,
//	|Неопределено                  КАК ДоговорКонтрагента,
//	|Неопределено                  КАК Сделка,
//	|Док.СуммаПлатежа              КАК СуммаПлатежа 
//	|	
//	|ИЗ
//	|	Документ." + ИмяДокумента + " КАК Док
//	|
//	|ГДЕ
//	|	(Док.Ссылка.Проведен = ИСТИНА)
//	|	И (Док.Ссылка.Оплачено = ИСТИНА)
//	|	И (Док.Организация = &amp;Организация)";

//	Если Не одПустое(ДатаНачала) и Не одПустое(ДатаОкончания) Тогда
//		ТЗ = ТЗ + "
//		| И (БанковскиеВыписки.Дата МЕЖДУ &amp;ДатаНачала И &amp;ДатаОкончания)";

//	ИначеЕсли Не одПустое(ДатаНачала) и одПустое(ДатаОкончания) Тогда
//		ТЗ = ТЗ + "
//		| И (БанковскиеВыписки.Дата &gt;= &amp;ДатаНачала)";

//	ИначеЕсли одПустое(ДатаНачала) и Не одПустое(ДатаОкончания) Тогда
//		ТЗ = ТЗ + "
//		| И (БанковскиеВыписки.Дата &lt;= &amp;ДатаОкончания)";
//	КонецЕсли;	
//	
//КонецЦикла;
            
ТЗ = ТЗ + "
	|
	|УПОРЯДОЧИТЬ ПО
	|	Дата,
	|	БанковскийСчет,
	|	Валюта
	|
	|ИТОГИ ПО
	|	Дата,
	|	БанковскийСчет,
	|	Валюта";

ВалютаРегламентированногоУчета = Константы.ВалютаРегламентированногоУчета.Получить();

Запрос = Новый Запрос(ТЗ);

Запрос.УстановитьПараметр("ДатаНачала", ДатаНачала);
Запрос.УстановитьПараметр("ДатаОкончания", ДатаОкончания);
Запрос.УстановитьПараметр("Организация", Параметры.Организация);
РезультатЗапроса = Запрос.Выполнить();

ВыборкаДанных = Новый ТаблицаЗначений;
ВыборкаДанных.Колонки.Добавить("ТабличнаяЧасть");
ВыборкаДанных.Колонки.Добавить("ДатаДок");
ВыборкаДанных.Колонки.Добавить("БанковскийСчет");
ВыборкаДанных.Колонки.Добавить("Валюта");

Выборка1 = РезультатЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
Пока Выборка1.Следующий() Цикл
	Выборка2 = Выборка1.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
	Пока Выборка2.Следующий() Цикл
		Выборка3 = Выборка2.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		Пока Выборка3.Следующий() Цикл

			СтрокаВыборкиДанных                = ВыборкаДанных.Добавить();
			СтрокаВыборкиДанных.ДатаДок        = Выборка3.Дата;
			СтрокаВыборкиДанных.БанковскийСчет = Выборка3.БанковскийСчет;
			
			Если Выборка3.Валюта = ВалютаРегламентированногоУчета Тогда
				СтрокаВыборкиДанных.Валюта = Неопределено;
			Иначе
				СтрокаВыборкиДанных.Валюта = Выборка3.Валюта;
			КонецЕсли;

			СтрокаВыборкиДанных.ТабличнаяЧасть = Новый ТаблицаЗначений;
			СтрокаВыборкиДанных.ТабличнаяЧасть.Колонки.Добавить("Док");
			СтрокаВыборкиДанных.ТабличнаяЧасть.Колонки.Добавить("ВидДвижения");
			СтрокаВыборкиДанных.ТабличнаяЧасть.Колонки.Добавить("НазначениеПлатежа");
			СтрокаВыборкиДанных.ТабличнаяЧасть.Колонки.Добавить("КоррСчет");
			СтрокаВыборкиДанных.ТабличнаяЧасть.Колонки.Добавить("Субконто1");
			СтрокаВыборкиДанных.ТабличнаяЧасть.Колонки.Добавить("ИмяПКО1");
			СтрокаВыборкиДанных.ТабличнаяЧасть.Колонки.Добавить("Субконто2");
			СтрокаВыборкиДанных.ТабличнаяЧасть.Колонки.Добавить("ИмяПКО2");
			СтрокаВыборкиДанных.ТабличнаяЧасть.Колонки.Добавить("Субконто3");
			СтрокаВыборкиДанных.ТабличнаяЧасть.Колонки.Добавить("ИмяПКО3");
			СтрокаВыборкиДанных.ТабличнаяЧасть.Колонки.Добавить("Приход");
			СтрокаВыборкиДанных.ТабличнаяЧасть.Колонки.Добавить("Расход");
			СтрокаВыборкиДанных.ТабличнаяЧасть.Колонки.Добавить("СчетФактура");
			СтрокаВыборкиДанных.ТабличнаяЧасть.Колонки.Добавить("КурсОплаты");

			Выборка4 = Выборка3.Выбрать();
			Пока Выборка4.Следующий() Цикл
			
				СтрокаВыписки = СтрокаВыборкиДанных.ТабличнаяЧасть.Добавить();

				СтрокаВыписки.Док = Выборка4.Ссылка;

				СтрокаВыписки.ВидДвижения       = Новый Структура("Наименование, ВидДвижения");
				СтрокаВыписки.НазначениеПлатежа = Выборка4.НазначениеПлатежа;
				
				Если Выборка4.ВидОперации = Перечисления.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ОплатаПокупателя 
				 ИЛИ Выборка4.ВидОперации = Перечисления.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ПрочиеРасчетыСКонтрагентами Тогда
					СтрокаВыписки.ВидДвижения.Наименование = "Поступления от покупателей";
					СтрокаВыписки.ВидДвижения.ВидДвижения  = "ВыручкаПоОбычнымВидамДеятельности";
					
					СтруктураДляОтбора = Новый Структура;
					СтруктураДляОтбора.Вставить("ДоговорКонтрагента", Выборка4.ДоговорКонтрагента);
					Если Выборка4.ДоговорКонтрагента &lt;&gt; Перечисления.ВедениеВзаиморасчетовПоДоговорам.ПоДоговоруВЦелом Тогда
						СтруктураДляОтбора.Вставить("Сделка",                Выборка4.Сделка);
					Иначе
						СтруктураДляОтбора.Вставить("Сделка",                Неопределено);
					КонецЕсли;
					ТаблицаОстатков = РегистрыНакопления.ВзаиморасчетыСКонтрагентами.Остатки(СтрокаВыписки.Док.МоментВремени(), СтруктураДляОтбора);
					Если ТаблицаОстатков.Количество() &gt; 0 И ТаблицаОстатков[0].СуммаВзаиморасчетов &gt; 0 Тогда
						Аванс = Ложь;
					Иначе
						Аванс = Истина;
					КонецЕсли;
					Если Выборка4.Валюта &lt;&gt; ВалютаРегламентированногоУчета Тогда
						Если Аванс Тогда
					        СтрокаВыписки.КоррСчет = "62.22";
						Иначе
					        СтрокаВыписки.КоррСчет = "62.11";
						КонецЕсли;
					Иначе
						Если Аванс Тогда
					        СтрокаВыписки.КоррСчет = "62.2";
						Иначе							
							СтрокаВыписки.КоррСчет = "62.1";
						КонецЕсли;
					КонецЕсли;

					СтрокаВыписки.Субконто1 = Выборка4.Контрагент;
					СтрокаВыписки.ИмяПКО1 = "Контрагенты";
					СтрокаВыписки.Субконто2   = Выборка4.ДоговорКонтрагента;
					СтрокаВыписки.ИмяПКО2     = "Договоры";
					СтрокаВыписки.СчетФактура = НайтиПодчиненныйДокумент(СтрокаВыписки.Док);
					СтрокаВыписки.Приход = Выборка4.СуммаПлатежа;
					СтрокаВыписки.Расход = 0;
					СтрокаВыписки.КурсОплаты = Выборка4.КурсВзаиморасчетов / Выборка4.КратностьВзаиморасчетов;
					
				ИначеЕсли Выборка4.ВидОперации = Перечисления.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ВозвратДенежныхСредствПоставщиком Тогда
					
					Выборка4.ВидДвижения.Наименование = "Прочие поступления";
					Выборка4.ВидДвижения.ВидДвижения  = "ПрочиеПоступления";
					Если Выборка4.Валюта &lt;&gt; ВалютаРегламентированногоУчета Тогда
				        СтрокаВыписки.КоррСчет = "60.22";
					Иначе
						СтрокаВыписки.КоррСчет = "60.2";
					КонецЕсли;
					
					СтрокаВыписки.Субконто1 = Выборка4.Контрагент;
					СтрокаВыписки.ИмяПКО1 = "Контрагенты";
					СтрокаВыписки.Субконто2 = Выборка4.ДоговорКонтрагента;
					СтрокаВыписки.ИмяПКО2 = "Договоры";
					СтрокаВыписки.Приход = Выборка4.СуммаПлатежа;
					СтрокаВыписки.КурсОплаты = Выборка4.КурсВзаиморасчетов / Выборка4.КратностьВзаиморасчетов;
					СтрокаВыписки.Расход = 0;

				ИначеЕсли Выборка4.ВидОперации = Перечисления.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ПрочиеРасчетыСКонтрагентами Тогда
					
					СтрокаВыписки.ВидДвижения.Наименование = "Прочие поступления";
					СтрокаВыписки.ВидДвижения.ВидДвижения  = "ПрочиеПоступления";
					Если Выборка4.Валюта &lt;&gt; ВалютаРегламентированногоУчета Тогда
				        СтрокаВыписки.КоррСчет = "76.6";
					Иначе
						СтрокаВыписки.КоррСчет = "76.5";
					КонецЕсли;
					
					СтрокаВыписки.Субконто1  = Выборка4.Контрагент;
					СтрокаВыписки.ИмяПКО1    = "Контрагенты";
					СтрокаВыписки.Субконто2  = Выборка4.ДоговорКонтрагента;
					СтрокаВыписки.ИмяПКО2    = "Договоры";
					СтрокаВыписки.Приход     = Выборка4.СуммаПлатежа;
					СтрокаВыписки.КурсОплаты = Выборка4.КурсВзаиморасчетов / Выборка4.КратностьВзаиморасчетов;
					СтрокаВыписки.Расход     = 0;

				ИначеЕсли Выборка4.ВидОперации = Перечисления.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ПрочееПоступлениеБезналичныхДенежныхСредств Тогда
					
					СтрокаВыписки.ВидДвижения.Наименование = "Прочие поступления";
					СтрокаВыписки.ВидДвижения.ВидДвижения  = "ПрочиеПоступления";
					СтрокаВыписки.КоррСчет                 = "";
					СтрокаВыписки.Приход                   = Выборка4.СуммаПлатежа;
					СтрокаВыписки.Расход                   = 0;

				ИначеЕсли Выборка4.ВидОперации = Перечисления.ВидыОперацийСписаниеБезналичныхДенежныхСредств.ОплатаПоставщику 
				      ИЛИ Выборка4.ВидОперации = Перечисления.ВидыОперацийППИсходящее.ОплатаПоставщику Тогда
					СтрокаВыписки.ВидДвижения.Наименование = "Оплата поставщику";
					СтрокаВыписки.ВидДвижения.ВидДвижения  = "ПриобретениеТоваровПродукцииРаботИУслуг";
                    Если Выборка4.Валюта &lt;&gt; Константы.ВалютаРегламентированногоУчета.Получить() Тогда
				        СтрокаВыписки.КоррСчет = "60.11";
					Иначе
						СтрокаВыписки.КоррСчет = "60.1";
					КонецЕсли;

					СтрокаВыписки.Субконто1 = Выборка4.Контрагент;
					СтрокаВыписки.ИмяПКО1 = "Контрагенты";
					СтрокаВыписки.Субконто2 = Выборка4.ДоговорКонтрагента;
					СтрокаВыписки.ИмяПКО2 = "Договоры";
					СтрокаВыписки.Приход = 0;
					СтрокаВыписки.Расход = Выборка4.СуммаПлатежа;
					СтрокаВыписки.КурсОплаты = Выборка4.КурсВзаиморасчетов / Выборка4.КратностьВзаиморасчетов;
					
				ИначеЕсли Выборка4.ВидОперации = Перечисления.ВидыОперацийСписаниеБезналичныхДенежныхСредств.ВозвратДенежныхСредствПокупателю 
				      ИЛИ Выборка4.ВидОперации = Перечисления.ВидыОперацийППИсходящее.ВозвратДенежныхСредствПокупателю Тогда
					СтрокаВыписки.ВидДвижения.Наименование = "Прочие выплаты";
					СтрокаВыписки.ВидДвижения.ВидДвижения  = "ПрочиеВыплатыИПеречисления";
					Если Выборка4.Валюта &lt;&gt; ВалютаРегламентированногоУчета Тогда
				        СтрокаВыписки.КоррСчет = "62.22";
					Иначе
						СтрокаВыписки.КоррСчет = "62.2";
					КонецЕсли;
					
					СтрокаВыписки.Субконто1 = Выборка4.Контрагент;
					СтрокаВыписки.ИмяПКО1 = "Контрагенты";
					СтрокаВыписки.Субконто2 = Выборка4.ДоговорКонтрагента;
					СтрокаВыписки.ИмяПКО2 = "Договоры";
					СтрокаВыписки.Приход = 0;
					СтрокаВыписки.Расход = Выборка4.СуммаДокумента;
					СтрокаВыписки.КурсОплаты = Выборка4.КурсВзаиморасчетов / Выборка4.КратностьВзаиморасчетов;
					
				ИначеЕсли Выборка4.ВидОперации = Перечисления.ВидыОперацийСписаниеБезналичныхДенежныхСредств.ПрочееСписаниеБезналичныхДенежныхСредств  
				      ИЛИ Выборка4.ВидОперации = Перечисления.ВидыОперацийППИсходящее.ПрочееСписаниеБезналичныхДенежныхСредств Тогда
					
					СтрокаВыписки.ВидДвижения.Наименование = "Прочие выплаты";
					СтрокаВыписки.ВидДвижения.ВидДвижения  = "ПрочиеВыплатыИПеречисления";
					СтрокаВыписки.КоррСчет = "";
					СтрокаВыписки.Приход = 0;
					СтрокаВыписки.Расход = Выборка4.СуммаПлатежа;
					
				ИначеЕсли Выборка4.ВидОперации = Перечисления.ВидыОперацийСписаниеБезналичныхДенежныхСредств.ПрочиеРасчетыСКонтрагентами 
				      ИЛИ Выборка4.ВидОперации = Перечисления.ВидыОперацийППИсходящее.ПрочиеРасчетыСКонтрагентами Тогда
					СтрокаВыписки.ВидДвижения.Наименование = "Прочие выплаты";
					СтрокаВыписки.ВидДвижения.ВидДвижения  = "ПрочиеВыплатыИПеречисления";
					Если Выборка4.Валюта &lt;&gt; ВалютаРегламентированногоУчета Тогда
				        СтрокаВыписки.КоррСчет = "76.6";
					Иначе
						СтрокаВыписки.КоррСчет = "76.5";
					КонецЕсли;
					
					СтрокаВыписки.Субконто1 = Выборка4.Контрагент;
					СтрокаВыписки.ИмяПКО1 = "Контрагенты";
					СтрокаВыписки.Субконто2 = Выборка4.ДоговорКонтрагента;
					СтрокаВыписки.ИмяПКО2 = "Договоры";
					СтрокаВыписки.Приход = 0;
					СтрокаВыписки.Расход = Выборка4.СуммаПлатежа;
					СтрокаВыписки.КурсОплаты = Выборка4.КурсВзаиморасчетов / Выборка4.КратностьВзаиморасчетов;
					
				КонецЕсли;
			КонецЦикла;
		КонецЦикла;
	КонецЦикла;
КонецЦикла;
</ПередОбработкойПравила></Правило><Правило><Код>Доверенность</Код><Наименование>Доверенность</Наименование><Порядок>300</Порядок><КодПравилаКонвертации>Доверенность                                      </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.Доверенность</ОбъектВыборки><ПередВыгрузкойОбъекта>Если Объект.ПометкаУдаления Тогда
	Отказ = Истина;

ИначеЕсли Объект.Организация &lt;&gt; Параметры.Организация Тогда
	Отказ = Истина;
	
ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило><Код>ДопРасходы</Код><Наименование>Поступление доп. расходов</Наименование><Порядок>1900</Порядок><КодПравилаКонвертации>УслугиСтороннихОрганизацийДопРасходы              </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.ПоступлениеДопРасходов</ОбъектВыборки><ПередВыгрузкойОбъекта>Если НЕ Объект.Проведен или Не Объект.ОтражатьВБухгалтерскомУчете Тогда
	Отказ = Истина;

ИначеЕсли Объект.Организация &lt;&gt; Параметры.Организация Тогда
	Отказ = Истина;

ИначеЕсли Объект.ВидОперации = Перечисления.ВидыОперацийПоступлениеДопРасходов.ВнутреннийРасход Тогда
	Отказ = Истина;

ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило><Код>ИнвентаризацияТМЦ</Код><Наименование>Инвентаризация товаров на складе</Наименование><Порядок>100</Порядок><КодПравилаКонвертации>ИнвентаризацияТМЦ                                 </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.ИнвентаризацияТоваровНаСкладе</ОбъектВыборки><ПередВыгрузкойОбъекта>Если Объект.ПометкаУдаления Тогда
	Отказ = Истина;

ИначеЕсли Объект.Организация &lt;&gt; Параметры.Организация Тогда
	Отказ = Истина;

ИначеЕсли (Параметры.СписокСкладов.НайтиПоЗначению(Объект.Склад) = Неопределено) и (Параметры.СписокСкладов.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило><Код>ПеремещениеТоваров</Код><Наименование>Перемещение товаров</Наименование><Порядок>1100</Порядок><КодПравилаКонвертации>ПеремещениеТоваров                                </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.ПеремещениеТоваров</ОбъектВыборки><ПередВыгрузкойОбъекта>Если НЕ Объект.Проведен или Не Объект.ОтражатьВБухгалтерскомУчете Тогда
	Отказ = Истина;

ИначеЕсли Объект.Организация &lt;&gt; Параметры.Организация Тогда
	Отказ = Истина;

ИначеЕсли (Параметры.СписокСкладов.НайтиПоЗначению(Объект.СкладПолучатель) = Неопределено) и (Параметры.СписокСкладов.НайтиПоЗначению(Объект.СкладОтправитель) = Неопределено) и (Параметры.СписокСкладов.Количество() &gt; 0) Тогда
	Отказ = Истина;
	
ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило><Код>ПосредническиеУслугиВТорговле</Код><Наименование>Отчет комитенту о продажах товаров</Наименование><Порядок>1000</Порядок><КодПравилаКонвертации>ОказаниеУслугКомиссии                             </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.ОтчетКомитентуОПродажах</ОбъектВыборки><ПередВыгрузкойОбъекта>Если НЕ Объект.Проведен или Не Объект.ОтражатьВБухгалтерскомУчете Тогда
	Отказ = Истина;

ИначеЕсли Объект.Организация &lt;&gt; Параметры.Организация Тогда
	Отказ = Истина;

ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило><Код>ПоступлениеТоваров</Код><Наименование>Поступление товаров</Наименование><Порядок>1300</Порядок><КодПравилаКонвертации>ПоступлениеТоваров                                </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.ПоступлениеТоваровУслуг</ОбъектВыборки><ПередВыгрузкойОбъекта>Если НЕ Объект.Проведен или Не Объект.ОтражатьВБухгалтерскомУчете Тогда
	Отказ = Истина;

ИначеЕсли Объект.Организация &lt;&gt; Параметры.Организация Тогда
	Отказ = Истина;

ИначеЕсли (Параметры.СписокСкладов.НайтиПоЗначению(Объект.СкладОрдер) = Неопределено) 
		и (Объект.ВидПоступления &lt;&gt; Перечисления.ВидыПоступленияТоваров.ПоОрдеру 
		   или Параметры.СписокСкладов.НайтиПоЗначению(Объект.СкладОрдер.Склад) = Неопределено) 
		и (Параметры.СписокСкладов.Количество() &gt; 0) Тогда
	Отказ = Истина;
	
ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило><Код>ПоступлениеТоваровВНТТ</Код><Наименование>Поступление товаров в НТТ</Наименование><Порядок>1300</Порядок><КодПравилаКонвертации>ПоступлениеТоваровВНТТ                            </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.ПоступлениеТоваровУслугВНеавтоматизированнуюТорговуюТочку</ОбъектВыборки></Правило><Правило><Код>ПриходныйОрдер</Код><Наименование>Приходный кассовый ордер</Наименование><Порядок>1800</Порядок><КодПравилаКонвертации>ПриходныйОрдер                                    </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.ПриходныйКассовыйОрдер</ОбъектВыборки><ПередВыгрузкойОбъекта>Если НЕ Объект.Проведен или Не Объект.ОтражатьВБухгалтерскомУчете Тогда
	Отказ = Истина;

ИначеЕсли Объект.Организация &lt;&gt; Параметры.Организация Тогда
	Отказ = Истина;

ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило><Код>ПродажаВРозницу</Код><Наименование>Отчет ККМ о продажах</Наименование><Порядок>500</Порядок><КодПравилаКонвертации>ПродажаВРозницу                                   </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.ОтчетОРозничныхПродажах</ОбъектВыборки><ПередВыгрузкойОбъекта>Если НЕ Объект.Проведен или Не Объект.ОтражатьВБухгалтерскомУчете Тогда
	Отказ = Истина;

ИначеЕсли Объект.Организация &lt;&gt; Параметры.Организация Тогда
	Отказ = Истина;

ИначеЕсли (Параметры.СписокСкладов.НайтиПоЗначению(Объект.Склад) = Неопределено) и (Параметры.СписокСкладов.Количество() &gt; 0) Тогда
	Отказ = Истина;
	
ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило><Код>РасходныйОрдер</Код><Наименование>Расходный кассовый ордер</Наименование><Порядок>2000</Порядок><КодПравилаКонвертации>РасходныйОрдер                                    </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.РасходныйКассовыйОрдер</ОбъектВыборки><ПередВыгрузкойОбъекта>Если НЕ Объект.Проведен или Не Объект.ОтражатьВБухгалтерскомУчете Тогда
	Отказ = Истина;

ИначеЕсли Объект.Организация &lt;&gt; Параметры.Организация Тогда
	Отказ = Истина;

ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило><Код>РеализацияОтгруженнойПродукции</Код><Наименование>Отчет комиссионера о продажах</Наименование><Порядок>800</Порядок><КодПравилаКонвертации>РеализацияОтгруженнойПродукции                    </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.ОтчетКомиссионераОПродажах</ОбъектВыборки><ПередВыгрузкойОбъекта>Если НЕ Объект.Проведен или Не Объект.ОтражатьВБухгалтерскомУчете Тогда
	Отказ = Истина;

ИначеЕсли Объект.Организация &lt;&gt; Параметры.Организация Тогда
	Отказ = Истина;

ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило><Код>РеализацияТоваров</Код><Наименование>Реализация товаров</Наименование><Порядок>900</Порядок><КодПравилаКонвертации>РасходнаяНакладная                                </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.РеализацияТоваровУслуг</ОбъектВыборки><ПередВыгрузкойОбъекта>Если НЕ Объект.Проведен или Не Объект.ОтражатьВБухгалтерскомУчете Тогда
	Отказ = Истина;

ИначеЕсли Объект.Организация &lt;&gt; Параметры.Организация Тогда
	Отказ = Истина;

ИначеЕсли (Параметры.СписокСкладов.НайтиПоЗначению(Объект.Склад) = Неопределено) и (Параметры.СписокСкладов.Количество() &gt; 0) Тогда
	Отказ = Истина;
	
ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;

Если Объект.Склад.ВидСклада &lt;&gt; Перечисления.ВидыСкладов.Оптовый Тогда
	ИмяПКО = "ПрочаяРозничнаяПродажа";
Иначе
	ИмяПКО = "РасходнаяНакладная";
КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило><Код>СписаниеДебиторскойЗадолженности</Код><Наименование>Корректировка дебиторской задолженности</Наименование><Порядок>1600</Порядок><КодПравилаКонвертации>СписаниеДебиторскойЗадолженности                  </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.КорректировкаДолга</ОбъектВыборки><ПередВыгрузкойОбъекта>Если НЕ Объект.Проведен или Не Объект.ОтражатьВБухгалтерскомУчете Тогда
	Отказ = Истина;

ИначеЕсли Объект.Организация &lt;&gt; Параметры.Организация Тогда
	Отказ = Истина;

ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило><Код>СписаниеКредиторскойЗадолженности</Код><Наименование>Корректировка кредиторской задолженности</Наименование><Порядок>1700</Порядок><КодПравилаКонвертации>СписаниеКредиторскойЗадолженности                 </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.КорректировкаДолга</ОбъектВыборки><ПередВыгрузкойОбъекта>Если НЕ Объект.Проведен или Не Объект.ОтражатьВБухгалтерскомУчете Тогда
	Отказ = Истина;

ИначеЕсли Объект.Организация &lt;&gt; Параметры.Организация Тогда
	Отказ = Истина;

ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило><Код>Счет</Код><Наименование>Заказ покупателя</Наименование><Порядок>400</Порядок><КодПравилаКонвертации>Счет                                              </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.ЗаказПокупателя</ОбъектВыборки><ПередВыгрузкойОбъекта>Если НЕ Объект.Проведен Тогда
	Отказ = Истина;

ИначеЕсли Объект.Организация &lt;&gt; Параметры.Организация Тогда
	Отказ = Истина;

ИначеЕсли (Параметры.СписокСкладов.НайтиПоЗначению(Объект.Склад) = Неопределено) и (Параметры.СписокСкладов.Количество() &gt; 0) Тогда
	Отказ = Истина;
	
ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило><Код>СчетФактура</Код><Наименование>Счет фактура выданный</Наименование><Порядок>2200</Порядок><КодПравилаКонвертации>СчетФактура                                       </КодПравилаКонвертации><ПередОбработкойПравила>Док = Документы.СчетФактураВыданный.Выбрать(ДатаНачала, ДатаОкончания);
Пока Док.Следующий() Цикл
	Объект = Док.ДокументОснование;
	
	ИДОснования = Объект.Метаданные().Имя;
	Если (ИДОснования = "ПлатежноеПоручениеВходящее") или (ИДОснования = "ПриходныйКассовыйОрдер") или (ИДОснования = "ОтчетКомитентуОПродажах")  или (ИДОснования = "ОтчетКомиссионераОПродажах") Тогда
		Если НЕ Объект.Проведен или Не Объект.ОтражатьВБухгалтерскомУчете Тогда
			
			Продолжить;

		ИначеЕсли Объект.Организация &lt;&gt; Параметры.Организация Тогда
			
			Продолжить;
			
		КонецЕсли;
		
	ИначеЕсли ИДОснования = "РеализацияТоваровУслуг" И Объект.Склад.ВидСклада &lt;&gt; Перечисления.ВидыСкладов.Оптовый Тогда
		Продолжить;
	Иначе
		Если Объект.ПометкаУдаления или Не Объект.ОтражатьВБухгалтерскомУчете Тогда
			Продолжить;

		ИначеЕсли Объект.Организация &lt;&gt; Параметры.Организация Тогда
			Продолжить;
		
		ИначеЕсли ЕстьРеквизитДокумента("Склад", Объект.Метаданные()) И (Параметры.СписокСкладов.НайтиПоЗначению(Объект.Склад) = Неопределено) и (Параметры.СписокСкладов.Количество() &gt; 0) Тогда
			Продолжить;
			
		ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
			Продолжить;
		КонецЕсли;
	КонецЕсли;

	ВходящиеДанные = Новый Структура;
	ВходящиеДанные.Вставить("ДатаДок", Док.Дата);
	ВходящиеДанные.Вставить("НомерДок", ДобавитьКПрефиксу(Док.Номер, "", 8, ""));
	ВходящиеДанные.Вставить("НаАванс", Док.НаАванс);
	ВходящиеДанные.Вставить("НомерПлатРасчДок", Док.НомерПлатежноРасчетногоДокумента);
	ВходящиеДанные.Вставить("ДатаПлатРасчДок", Док.ДатаПлатежноРасчетногоДокумента);

	ВыгрузитьПоПравилу(Объект,, ВходящиеДанные,, "СчетФактура");
КонецЦикла;

Отказ = Истина;</ПередОбработкойПравила></Правило><Правило><Код>СчетФактураПолученный</Код><Наименование>Счет фактура полученный</Наименование><Порядок>2300</Порядок><КодПравилаКонвертации>СчетФактураПолученный                             </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.СчетФактураПолученный</ОбъектВыборки><ПередВыгрузкойОбъекта>ИДОснования = Объект.ДокументОснование.Метаданные().Имя;
Если (ИДОснования = "ОтчетКомиссионераОПродажах") 
 ИЛИ (ИДОснования = "ПоступлениеДопРасходов") Тогда
	Если Объект.ПометкаУдаления или Не Объект.ДокументОснование.ОтражатьВБухгалтерскомУчете 
     ИЛИ НЕ Объект.ДокументОснование.Проведен Тогда
		Отказ = Истина;

	ИначеЕсли Объект.ДокументОснование.Организация &lt;&gt; Параметры.Организация Тогда
		Отказ = Истина;

	ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.ДокументОснование.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
		Отказ = Истина;
	КонецЕсли;
	
Иначе
	Если Объект.ПометкаУдаления или Не Объект.ДокументОснование.ОтражатьВБухгалтерскомУчете
 	 ИЛИ НЕ Объект.ДокументОснование.Проведен Тогда
		Отказ = Истина;

	ИначеЕсли Объект.ДокументОснование.Организация &lt;&gt; Параметры.Организация Тогда
		Отказ = Истина;

	ИначеЕсли ЕстьРеквизитДокумента("Склад", Объект.ДокументОснование.Метаданные()) и (Параметры.СписокСкладов.НайтиПоЗначению(Объект.ДокументОснование.Склад) = Неопределено) и (Параметры.СписокСкладов.Количество() &gt; 0) Тогда
		Отказ = Истина;
		
	ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.ДокументОснование.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
		Отказ = Истина;
	КонецЕсли;
КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило><Код>УслугиСтороннихОрганизаций</Код><Наименование>Услуги сторонних организаций</Наименование><Порядок>1500</Порядок><КодПравилаКонвертации>УслугиСтороннихОрганизаций                        </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.ПоступлениеТоваровУслуг</ОбъектВыборки><ПередВыгрузкойОбъекта>Если НЕ Объект.Проведен или Не Объект.ОтражатьВБухгалтерскомУчете Тогда
	Отказ = Истина;

ИначеЕсли Объект.Организация &lt;&gt; Параметры.Организация Тогда
	Отказ = Истина;

ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило><Код>УслугиСтороннихОрганизацийНТТ</Код><Наименование>Услуги сторонних организаций НТТ</Наименование><Порядок>1500</Порядок><КодПравилаКонвертации>УслугиСтороннихОрганизацийНТТ                     </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>ДокументСсылка.ПоступлениеТоваровУслугВНеавтоматизированнуюТорговуюТочку</ОбъектВыборки><ПередВыгрузкойОбъекта>Если НЕ Объект.Проведен или Не Объект.ОтражатьВБухгалтерскомУчете Тогда
	Отказ = Истина;

ИначеЕсли Объект.Организация &lt;&gt; Параметры.Организация Тогда
	Отказ = Истина;

ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;</ПередВыгрузкойОбъекта></Правило></Группа><Группа Отключить="true"><Код>Справочники</Код><Наименование>Справочники</Наименование><Порядок>1300</Порядок><Правило Отключить="true"><Код>Банки</Код><Наименование>Банки</Наименование><Порядок>100</Порядок><КодПравилаКонвертации>Банки                                             </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>СправочникСсылка.Банки</ОбъектВыборки></Правило><Правило Отключить="true"><Код>Валюты</Код><Наименование>Валюты</Наименование><Порядок>200</Порядок><КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>СправочникСсылка.Валюты</ОбъектВыборки></Правило><Правило Отключить="true"><Код>Контрагенты</Код><Наименование>Контрагенты</Наименование><Порядок>700</Порядок><КодПравилаКонвертации>Контрагенты                                       </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>СправочникСсылка.Контрагенты</ОбъектВыборки></Правило><Правило Отключить="true"><Код>Номенклатура</Код><Наименование>Номенклатура</Наименование><Порядок>500</Порядок><КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>СправочникСсылка.Номенклатура</ОбъектВыборки><ПередВыгрузкойОбъекта>ИсходящиеДанные = Новый Структура;
ИсходящиеДанные.Вставить("ТипТовара", "Собственный");
ИсходящиеДанные.Вставить("ТипНоменклатуры", "Товар");

Если Не Объект.ЭтоГруппа Тогда
	Если Объект.Услуга Тогда
		ИсходящиеДанные.Вставить("ТипНоменклатуры", "Услуга");
	КонецЕсли;
КонецЕсли;</ПередВыгрузкойОбъекта></Правило><Правило Отключить="true"><Код>СкладыКомпании</Код><Наименование>Склады (места хранения) компании</Наименование><Порядок>400</Порядок><КодПравилаКонвертации>МестаХранения                                     </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>СправочникСсылка.Склады</ОбъектВыборки></Правило><Правило Отключить="true"><Код>ФизическиеЛица</Код><Наименование>Физические лица - сотрудники</Наименование><Порядок>300</Порядок><КодПравилаКонвертации>Сотрудники                                        </КодПравилаКонвертации><СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных><ОбъектВыборки>СправочникСсылка.ФизическиеЛица</ОбъектВыборки><ПередВыгрузкойОбъекта>Если Не Отказ И ЗначениеНеЗаполнено(Объект) Или ТипЗнч(Объект) &lt;&gt; Тип("СправочникСсылка.ФизическиеЛица") Тогда
	Отказ = Истина;
КонецЕсли;
</ПередВыгрузкойОбъекта></Правило></Группа></ПравилаВыгрузкиДанных><ПравилаОчисткиДанных/><Алгоритмы><Алгоритм Имя="НДСвключатьВСтоимость"><Текст>Значение = УчетнаяПолитикаНалоговыйУчет("РозничнаяТорговляОблагаетсяЕНВД", Источник.Организация, Источник.Дата);</Текст></Алгоритм><Алгоритм Имя="ПересчетВРублиСуммыИсточника"><Текст>ДатаДок        = Источник.Дата;

ВалютаНач      = Источник.ВалютаДокумента;
ВалютаКон      = Константы.ВалютаРегламентированногоУчета.Получить();
ПоКурсуНач     = КурсДокумента(Источник, ВалютаКон);
ПоКратностьНач = КратностьДокумента(Источник, ВалютаКон);

Если ПоКурсуНач = 0 Тогда
	ФильтрПоВалютеНач = Новый Структура("Валюта", ВалютаНач);
	ПоКурсуНач        = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеНач).Курс;
	ПоКратностьНач    = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеНач).Кратность;
КонецЕсли;

ФильтрПоВалютеКон = Новый Структура("Валюта", ВалютаКон);
ПоКурсуКон = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеКон).Курс;
ПоКратностьКон = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеКон).Кратность;

ПоКратностьНач = ?(ПоКратностьНач = 0, 1, ПоКратностьНач);
ПоКратностьКон = ?(ПоКратностьКон = 0, 1, ПоКратностьКон);
Значение = ПересчитатьИзВалютыВВалюту(Значение, ВалютаНач, ВалютаКон, ПоКурсуНач, ПоКурсуКон, ПоКратностьНач, ПоКратностьКон);</Текст></Алгоритм><Алгоритм Имя="ПересчетВРублиСуммыИсточникаИзВалютыУпрУчета"><Текст>ДатаДок = Источник.Дата;

ВалютаНач = Константы.ВалютаУправленческогоУчета.Получить();

ФильтрПоВалютеНач = Новый Структура("Валюта", ВалютаНач);
ПоКурсуНач = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеНач).Курс;
ПоКратностьНач = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеНач).Кратность;

ВалютаКон = Константы.ВалютаРегламентированногоУчета.Получить();
ФильтрПоВалютеКон = Новый Структура("Валюта", ВалютаКон);
ПоКурсуКон = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеКон).Курс;
ПоКратностьКон = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеКон).Кратность;

ПоКратностьНач = ?(ПоКратностьНач = 0, 1, ПоКратностьНач);
ПоКратностьКон = ?(ПоКратностьКон = 0, 1, ПоКратностьКон);
Значение = ПересчитатьИзВалютыВВалюту(Значение, ВалютаНач, ВалютаКон, ПоКурсуНач, ПоКурсуКон, ПоКратностьНач, ПоКратностьКон);</Текст></Алгоритм><Алгоритм Имя="ПересчетСуммыИсточникаВВалютуДоговора"><Текст>ДатаДок = Источник.Дата;

ВалютаНач      = Источник.ВалютаДокумента;
ПоКурсуНач     = КурсДокумента(Источник, Константы.ВалютаРегламентированногоУчета.Получить());
ПоКратностьНач = КратностьДокумента(Источник, Константы.ВалютаРегламентированногоУчета.Получить());

Если ПоКурсуНач = 0 Тогда
	ФильтрПоВалютеНач = Новый Структура("Валюта", ВалютаНач);
	ПоКурсуНач        = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеНач).Курс;
	ПоКратностьНач    = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеНач).Кратность;
КонецЕсли;

ВалютаКон = Источник.ДоговорКонтрагента.ВалютаВзаиморасчетов;
ПоКурсуКон = Источник.КурсВзаиморасчетов;
ПоКратностьКон = Источник.КратностьВзаиморасчетов;

Если ПоКурсуКон = 0 Тогда
	ФильтрПоВалютеКон = Новый Структура("Валюта", ВалютаКон);
	ПоКурсуКон        = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеКон).Курс;
	ПоКратностьКон    = РегистрыСведений.КурсыВалют.ПолучитьПоследнее(ДатаДок, ФильтрПоВалютеКон).Кратность;
КонецЕсли;

ПоКратностьНач = ?(ПоКратностьНач = 0, 1, ПоКратностьНач);
ПоКратностьКон = ?(ПоКратностьКон = 0, 1, ПоКратностьКон);
Значение = ПересчитатьИзВалютыВВалюту(Значение, ВалютаНач, ВалютаКон, ПоКурсуНач, ПоКурсуКон, ПоКратностьНач, ПоКратностьКон);</Текст></Алгоритм><Алгоритм Имя="ПолучитьСуммуВсего"><Текст>Если Не Источник.СуммаВключаетНДС Тогда
	Значение = ОбъектКоллекции.Сумма + ОбъектКоллекции.НДС;
Иначе
	Значение = ОбъектКоллекции.Сумма;
КонецЕсли;</Текст></Алгоритм><Алгоритм Имя="ПроверитьСоответствиеДокументаПараметрамОтбора"><Текст>Если Объект.Организация &lt;&gt; Организация Тогда
	Отказ = Истина;

ИначеЕсли (Параметры.СписокСкладов.НайтиПоЗначению(Объект.Склад) = Неопределено) и (Параметры.СписокСкладов.Количество() &gt; 0) Тогда
	Отказ = Истина;
	
ИначеЕсли (Параметры.СписокПодразделений.НайтиПоЗначению(Объект.Подразделение) = Неопределено)  и (Параметры.СписокПодразделений.Количество() &gt; 0) Тогда
	Отказ = Истина;
КонецЕсли;</Текст></Алгоритм></Алгоритмы><Запросы><Запрос Имя="ТабличнаяЧастьПеремещения"><Текст>ВЫБРАТЬ
	ПартииТоваров.Номенклатура,
	ПартииТоваров.Количество,
	ВЫБОР КОГДА ПартииТоваров.СтатусПартии = &amp;ТоварПринятыйКомиссия ТОГДА 
		"НаКомиссии" 
	ИНАЧЕ 
		"Собственный" 
	КОНЕЦ КАК ТипТовара,
	ВЫБОР КОГДА ПартииТоваров.СтатусПартии = &amp;ТоварПринятыйКомиссия ТОГДА 
		ПартииТоваров.ДокументОприходования.Контрагент 
	ИНАЧЕ 
		&amp;ПустойКомитент 
	КОНЕЦ КАК Комитент,
	ВЫБОР КОГДА ПартииТоваров.СтатусПартии = &amp;ТоварПринятыйКомиссия ТОГДА 
		ПартииТоваров.ДокументОприходования.ДоговорКонтрагента
	ИНАЧЕ 
		&amp;ПустойДоговорКомиссии 
	КОНЕЦ КАК ДоговорКомиссии,
	ПартииТоваров.ДокументОприходования КАК ДокументПоставки
ИЗ
	 РегистрНакопления.ПартииТоваровНаСкладах КАК ПартииТоваров
ГДЕ	 
	ПартииТоваров.Регистратор = &amp;Источник
	И ПартииТоваров.ВидДвижения = &amp;Расход</Текст></Запрос><Запрос Имя="ТабличнаяЧастьПродажиВРозницу"><Текст>ВЫБРАТЬ
	РеализацияТоваров.Номенклатура КАК Товар,
	РеализацияТоваров.ГТД,
	РеализацияТоваров.СтранаПроисхождения,
	ВЫБОР КОГДА ПартииТоваров.Количество &lt;&gt; 0 ТОГДА 
		ВЫБОР КОГДА РеализацияТоваров.Количество &lt;&gt; 0 И РеализацияТоваров.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент &lt;&gt; 0 ТОГДА 
			ПартииТоваров.Количество * РеализацияТоваров.Коэффициент * РеализацияТоваров.Сумма / РеализацияТоваров.Количество 
			/ РеализацияТоваров.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент 
		ИНАЧЕ 
				0 
		КОНЕЦ 
	ИНАЧЕ
		РеализацияТоваров.Сумма 
	КОНЕЦ КАК Сумма,
	ВЫБОР КОГДА ПартииТоваров.Количество &lt;&gt; 0 ТОГДА 
		ВЫБОР КОГДА РеализацияТоваров.Количество &lt;&gt; 0 И РеализацияТоваров.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент &lt;&gt; 0 ТОГДА 
			ПартииТоваров.Количество * РеализацияТоваров.Коэффициент * РеализацияТоваров.СуммаНДС / РеализацияТоваров.Количество 
			/ РеализацияТоваров.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент 
		ИНАЧЕ 
			0 
		КОНЕЦ 
	ИНАЧЕ 
		РеализацияТоваров.СуммаНДС 
	КОНЕЦ КАК НДС,
	ВЫБОР КОГДА ПартииТоваров.Количество &lt;&gt; 0 ТОГДА 
		ВЫБОР КОГДА РеализацияТоваров.Количество &lt;&gt; 0 И РеализацияТоваров.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент &lt;&gt; 0 ТОГДА 
			ПартииТоваров.Количество * РеализацияТоваров.Коэффициент * РеализацияТоваров.СуммаНП / РеализацияТоваров.Количество 
			/ РеализацияТоваров.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент 
		ИНАЧЕ 
			0 
		КОНЕЦ 
	ИНАЧЕ 
		РеализацияТоваров.СуммаНП 
	КОНЕЦ КАК НП,
	ВЫБОР 
		КОГДА РеализацияТоваров.Коэффициент &lt;&gt; 0 ТОГДА 
			 РеализацияТоваров.Цена / РеализацияТоваров.Коэффициент 
		ИНАЧЕ 0 
	КОНЕЦ КАК Цена,
	ВЫБОР 
		КОГДА ПартииТоваров.Количество &lt;&gt; 0 ТОГДА 
			ПартииТоваров.Количество * РеализацияТоваров.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент
		ИНАЧЕ 
			РеализацияТоваров.Количество * РеализацияТоваров.Коэффициент
	КОНЕЦ КАК Количество,
	ВЫБОР КОГДА ПартииТоваров.СтатусПартии = &amp;ТоварПринятыйКомиссия ТОГДА \
		ПартииТоваров.ДокументПоставки.Контрагент 
	ИНАЧЕ 
		&amp;ПустойКомитент 
	КОНЕЦ КАК Комитент,
	ВЫБОР КОГДА ПартииТоваров.СтатусПартии = &amp;ТоварПринятыйКомиссия ТОГДА 
		ПартииТоваров.ДокументПоставки.ДоговорКонтрагента 
	ИНАЧЕ 
		&amp;ПустойДоговорКомиссии 
	КОНЕЦ КАК ДоговорКомиссии
ИЗ
	Документ.ОтчетОРозничныхПродажах.Товары КАК РеализацияТоваров
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ПартииТоваровНаСкладах КАК ПартииТоваров
		ПО РеализацияТоваров.Номенклатура = ПартииТоваров.Номенклатура 
		И РеализацияТоваров.Ссылка = ПартииТоваров.Регистратор 
		И РеализацияТоваров.СерияНоменклатуры = ПартииТоваров.СерияНоменклатуры 
		И РеализацияТоваров.ХарактеристикаНоменклатуры = ПартииТоваров.ХарактеристикаНоменклатуры

ГДЕ
	РеализацияТоваров.Ссылка = &amp;Источник</Текст></Запрос><Запрос Имя="ТабличнаяЧастьРеализации"><Текст>ВЫБРАТЬ
	ПартииТоваров.Номенклатура,
	ПартииТоваров.Количество,
	ВЫБОР КОГДА ПартииТоваров.СтатусПартии = &amp;ТоварПринятыйКомиссия ТОГДА 
		"НаКомиссии" 
	ИНАЧЕ 
		"Собственный" 
	КОНЕЦ КАК ТипТовара,
	ВЫБОР КОГДА ПартииТоваров.СтатусПартии = &amp;ТоварПринятыйКомиссия ТОГДА 
		ПартииТоваров.ДокументОприходования.Контрагент 
	ИНАЧЕ 
		&amp;ПустойКомитент 
	КОНЕЦ КАК Комитент,
	ВЫБОР КОГДА ПартииТоваров.СтатусПартии = &amp;ТоварПринятыйКомиссия ТОГДА 
		ПартииТоваров.ДокументОприходования.ДоговорКонтрагента 
	ИНАЧЕ 
		&amp;ПустойДоговорКомиссии 
	КОНЕЦ КАК ДоговорКомиссии
ИЗ
	 РегистрНакопления.ПартииТоваровНаСкладах КАК ПартииТоваров
ГДЕ	 
	ПартииТоваров.Регистратор = &amp;Источник
</Текст></Запрос><Запрос Имя="ТабличнаяЧастьРеализацииОтгруженнойПродукции"><Текст>ВЫБРАТЬ
	РеализацияТоваров.Номенклатура КАК Товар,
	РеализацияТоваров.СерияНоменклатуры.НомерГТД,
	ВЫБОР КОГДА ПартииТоваров.Количество &lt;&gt; 0 ТОГДА 
		ВЫБОР КОГДА РеализацияТоваров.Количество &lt;&gt; 0 И РеализацияТоваров.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент &lt;&gt; 0 ТОГДА 
			ПартииТоваров.Количество * РеализацияТоваров.Коэффициент * РеализацияТоваров.Сумма / РеализацияТоваров.Количество 
			/ РеализацияТоваров.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент 
		ИНАЧЕ 
			0 
		КОНЕЦ 
	ИНАЧЕ 
		РеализацияТоваров.Сумма 
	КОНЕЦ КАК Сумма,
	ВЫБОР КОГДА ПартииТоваров.Количество &lt;&gt; 0 ТОГДА 
		ВЫБОР КОГДА РеализацияТоваров.Количество &lt;&gt; 0 И РеализацияТоваров.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент &lt;&gt; 0 ТОГДА 
			ПартииТоваров.Количество * РеализацияТоваров.Коэффициент * РеализацияТоваров.СуммаНДС / РеализацияТоваров.Количество 
			/ РеализацияТоваров.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент 
		ИНАЧЕ 
			0 
		КОНЕЦ 
	ИНАЧЕ 
		РеализацияТоваров.СуммаНДС КОНЕЦ КАК НДС,
	ВЫБОР 
		КОГДА РеализацияТоваров.Коэффициент &lt;&gt; 0 ТОГДА
			РеализацияТоваров.Цена / РеализацияТоваров.Коэффициент
		ИНАЧЕ 
			0               
		КОНЕЦ КАК Цена, 
	ВЫБОР 
		КОГДА ПартииТоваров.Количество &lt;&gt; 0 ТОГДА 
			ПартииТоваров.Количество * ПартииТоваров.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент
		ИНАЧЕ РеализацияТоваров.Количество * РеализацияТоваров.Коэффициент
	КОНЕЦ КАК Количество,
	ВЫБОР КОГДА ПартииТоваров.СтатусПартии = &amp;ТоварПринятыйКомиссия ТОГДА 
		ПартииТоваров.ДокументОприходования.Контрагент 
	ИНАЧЕ 
		&amp;ПустойКомитент 
	КОНЕЦ КАК Комитент,
	ВЫБОР КОГДА ПартииТоваров.СтатусПартии = &amp;ТоварПринятыйКомиссия ТОГДА 
		ПартииТоваров.ДокументОприходования.ДоговорКонтрагента 
	ИНАЧЕ 
		&amp;ПустойДоговорКомиссии 
	КОНЕЦ КАК ДоговорКомиссии
ИЗ
	Документ.ОтчетКомиссионераОПродажах.Товары КАК РеализацияТоваров
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ПартииТоваровПереданные КАК ПартииТоваров
		ПО РеализацияТоваров.Номенклатура = ПартииТоваров.Номенклатура 
		И РеализацияТоваров.Ссылка = ПартииТоваров.Регистратор 
		И РеализацияТоваров.ХарактеристикаНоменклатуры = ПартииТоваров.ХарактеристикаНоменклатуры

ГДЕ
	РеализацияТоваров.Ссылка = &amp;Источник</Текст></Запрос></Запросы></ПравилаОбмена>

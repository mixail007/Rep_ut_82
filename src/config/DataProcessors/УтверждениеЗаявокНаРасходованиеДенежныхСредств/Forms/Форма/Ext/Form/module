
Процедура КнопкаВыполнитьНажатие(Кнопка)
	// Вставить содержимое обработчика.
КонецПроцедуры

Процедура КнопкаНастройкаПериодаНажатие(Элемент)
	
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.УстановитьПериод(ДатаНач, ?(ДатаКон='0001-01-01', ДатаКон, КонецДня(ДатаКон)));
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	Если НастройкаПериода.Редактировать() Тогда
		ДатаНач = НастройкаПериода.ПолучитьДатуНачала();
		ДатаКон = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
	
КонецПроцедуры

Процедура ПолучитьЗаявкиНажатие(Элемент)
	
	ЗаполнитьТЧБезналичнойОплаты();
	
	ЗаполнитьТЧНаличнойОплаты();
	
КонецПроцедуры

Процедура ЗаполнитьТЧБезналичнойОплаты()
	
	Безналичные.Очистить();
	
	Если Согласование Тогда //рук-ль обособл подр
		
		//В головном подр Пока не реализовано. В перспективе - ответственный за статью затрат.
		
		Запрос = Новый Запрос;
		Запрос.УстановитьПараметр("ДатаНач", НачалоДня(ДатаНач));				   
		Запрос.УстановитьПараметр("ДатаКон", КонецДня(ДатаКон));
		Запрос.УстановитьПараметр("Подразделение", глТекущийПользователь.ОсновноеПодразделение);
		Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ
		               |	ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование КАК Ссылка,
		               |	ВЫБОР
		               |		КОГДА ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийЗаявкиНаРасходование.ВыдачаДенежныхСредствПодотчетнику)
		               |			ТОГДА ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Получатель
		               |		ИНАЧЕ ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Контрагент
		               |	КОНЕЦ КАК Контрагент
		               |ИЗ
		               |	РегистрНакопления.ЗаявкиНаРасходованиеСредств КАК ЗаявкиНаРасходованиеСредств
		               |ГДЕ
		               |	ЗаявкиНаРасходованиеСредств.ДатаРасхода МЕЖДУ &ДатаНач И &ДатаКон
		               |	И (ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Подготовлен)
		               |			ИЛИ ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Согласован)
		               |			ИЛИ ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Утвержден))
		               |	И ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.ФормаОплаты = ЗНАЧЕНИЕ(Перечисление.ВидыДенежныхСредств.Безналичные)
		               |	И ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Подразделение = &Подразделение
		               |
		               |УПОРЯДОЧИТЬ ПО
		               |	ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Состояние УБЫВ,
		               |	Контрагент
		               |АВТОУПОРЯДОЧИВАНИЕ";
					   
		ЭлементыФормы.Панель1.Страницы.Безналичные.Доступность = Ложь;
		
	КонецЕсли;

	Если Утверждение Тогда
		
		Если РольДоступна("яштФинДиректор") И НЕ СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Серков" И НЕ СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Бондаренко Е.Д. (снабжение)" Тогда 
			
			Запрос = Новый Запрос;
			Запрос.УстановитьПараметр("ДатаНач", НачалоДня(ДатаНач));				   
			Запрос.УстановитьПараметр("ДатаКон", КонецДня(ДатаКон));
			Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ
			               |	ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование КАК Ссылка,
			               |	ВЫБОР
			               |		КОГДА ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийЗаявкиНаРасходование.ВыдачаДенежныхСредствПодотчетнику)
			               |			ТОГДА ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Получатель
			               |		ИНАЧЕ ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Контрагент
			               |	КОНЕЦ КАК Контрагент
			               |ИЗ
			               |	РегистрНакопления.ЗаявкиНаРасходованиеСредств КАК ЗаявкиНаРасходованиеСредств
			               |ГДЕ
			               |	ЗаявкиНаРасходованиеСредств.ДатаРасхода МЕЖДУ &ДатаНач И &ДатаКон
			               |	И (ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Подготовлен)
			               |			ИЛИ ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Согласован)
			               |			ИЛИ ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Утвержден))
			               |	И ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.ФормаОплаты = ЗНАЧЕНИЕ(Перечисление.ВидыДенежныхСредств.Безналичные)
			               |
			               |УПОРЯДОЧИТЬ ПО
			               |	ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Состояние УБЫВ,
			               |	Контрагент
			               |АВТОУПОРЯДОЧИВАНИЕ";
			
		Иначеесли СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Серков" или СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Бондаренко Е.Д. (снабжение)" Тогда  //Серков для обособл. подр
			
			Запрос = Новый Запрос;
			Запрос.УстановитьПараметр("ДатаНач", НачалоДня(ДатаНач));				   
			Запрос.УстановитьПараметр("ДатаКон", КонецДня(ДатаКон));
			Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ
			               |	ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование КАК Ссылка,
			               |	ВЫБОР
			               |		КОГДА ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийЗаявкиНаРасходование.ВыдачаДенежныхСредствПодотчетнику)
			               |			ТОГДА ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Получатель
			               |		ИНАЧЕ ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Контрагент
			               |	КОНЕЦ КАК Контрагент
			               |ИЗ
			               |	РегистрНакопления.ЗаявкиНаРасходованиеСредств КАК ЗаявкиНаРасходованиеСредств
			               |ГДЕ
			               |	ЗаявкиНаРасходованиеСредств.ДатаРасхода МЕЖДУ &ДатаНач И &ДатаКон
			               |	И (ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Подготовлен)
			               |			ИЛИ ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Согласован)
			               |			ИЛИ ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Утвержден))
			               |	И ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.ФормаОплаты = ЗНАЧЕНИЕ(Перечисление.ВидыДенежныхСредств.Безналичные)
			               |	И ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Подразделение.ОбособленноеПодразделение
			               |
			               |УПОРЯДОЧИТЬ ПО
			               |	ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Состояние УБЫВ,
			               |	Контрагент
			               |АВТОУПОРЯДОЧИВАНИЕ";
		Иначеесли СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Малышев Егор" Тогда  //Малышев Егор			
			Запрос = Новый Запрос;
			Запрос.УстановитьПараметр("ДатаНач", НачалоДня(ДатаНач));				   
			Запрос.УстановитьПараметр("ДатаКон", КонецДня(ДатаКон));
			Запрос.УстановитьПараметр("Подразделение", Справочники.Подразделения.НайтиПоКоду("00006"));

			Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ
			               |	ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование КАК Ссылка,
			               |	ВЫБОР
			               |		КОГДА ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийЗаявкиНаРасходование.ВыдачаДенежныхСредствПодотчетнику)
			               |			ТОГДА ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Получатель
			               |		ИНАЧЕ ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Контрагент
			               |	КОНЕЦ КАК Контрагент
			               |ИЗ
			               |	РегистрНакопления.ЗаявкиНаРасходованиеСредств КАК ЗаявкиНаРасходованиеСредств
			               |ГДЕ
			               |	ЗаявкиНаРасходованиеСредств.ДатаРасхода МЕЖДУ &ДатаНач И &ДатаКон
			               |	И (ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Подготовлен)
			               |			ИЛИ ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Согласован)
			               |			ИЛИ ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Утвержден))
			               |	И ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.ФормаОплаты = ЗНАЧЕНИЕ(Перечисление.ВидыДенежныхСредств.Безналичные)
			               |	И ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Подразделение = &Подразделение
			               |
			               |УПОРЯДОЧИТЬ ПО
			               |	ЗаявкиНаРасходованиеСредств.ЗаявкаНаРасходование.Состояние УБЫВ,
			               |	Контрагент
			               |АВТОУПОРЯДОЧИВАНИЕ";
						   
			
		КонецЕсли;
		
	КонецЕсли;			   
	Если Запрос <> Неопределено Тогда
	Результат = Запрос.Выполнить().Выгрузить();
	
	Для Каждого СтрокаТЗ Из Результат Цикл
				
		СтрокаТЧ = Безналичные.Добавить();
		СтрокаТЧ.Заявка			 = СтрокаТЗ.Ссылка;
		СтрокаТЧ.Контрагент		 = СтрокаТЗ.Контрагент;
		СтрокаТЧ.Ответственный	 = СтрокаТЗ.Ссылка.Ответственный;
		СтрокаТЧ.Состояние		 = СтрокаТЗ.Ссылка.Состояние;
		СтрокаТЧ.Сумма			 = СтрокаТЗ.Ссылка.СуммаДокумента;
		СтрокаТЧ.Подразделение	 = СтрокаТЗ.Ссылка.Подразделение;
		СтрокаТЧ.ВидОперации	 = СтрокаТЗ.Ссылка.ВидОперации;
		
	КонецЦикла;
	конецЕсли;
КонецПроцедуры	

Процедура ЗаполнитьТЧНаличнойОплаты()
	
	Наличные.Очистить();
	
	Если Согласование Тогда
		
		//Согласование заявок на наличные д/с предусмотрено для обособленных подразделений.
		//Выполняется их руководителями.
		Запрос = Новый Запрос;
		Запрос.УстановитьПараметр("ДатаНач", НачалоДня(ДатаНач));				   
		Запрос.УстановитьПараметр("ДатаКон", КонецДня(ДатаКон));
		Запрос.УстановитьПараметр("Подразделение", глТекущийПользователь.ОсновноеПодразделение);
		Запрос.Текст = "ВЫБРАТЬ
		               |	ЗаявкаНаРасходованиеСредств.Ссылка,
		               |	ВЫБОР
		               |		КОГДА ЗаявкаНаРасходованиеСредств.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийЗаявкиНаРасходование.ВыдачаДенежныхСредствПодотчетнику)
		               |			ТОГДА ЗаявкаНаРасходованиеСредств.Получатель
		               |		ИНАЧЕ ЗаявкаНаРасходованиеСредств.Контрагент
		               |	КОНЕЦ КАК Контрагент
		               |ИЗ
		               |	Документ.ЗаявкаНаРасходованиеСредств КАК ЗаявкаНаРасходованиеСредств
		               |ГДЕ
		               |	ЗаявкаНаРасходованиеСредств.ДатаРасхода МЕЖДУ &ДатаНач И &ДатаКон
		               |	И (ЗаявкаНаРасходованиеСредств.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Подготовлен)
		               |			ИЛИ ЗаявкаНаРасходованиеСредств.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Согласован)
					   |			ИЛИ ЗаявкаНаРасходованиеСредств.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Утвержден))
		               |	И ЗаявкаНаРасходованиеСредств.Проведен
		               |	И ЗаявкаНаРасходованиеСредств.ФормаОплаты = ЗНАЧЕНИЕ(Перечисление.ВидыДенежныхСредств.Наличные)
		               |	И ЗаявкаНаРасходованиеСредств.Подразделение = &Подразделение
		               |
		               |УПОРЯДОЧИТЬ ПО
		               |	ЗаявкаНаРасходованиеСредств.Состояние УБЫВ,
		               |	Контрагент
		               |АВТОУПОРЯДОЧИВАНИЕ";
	КонецЕсли;

	Если Утверждение Тогда
		
		//Утверждение заявок на наличные д/с предусмотрено для обособленных подразделений.
		//Выполняется Серковым только по обособленным подр-ям.
		//Финотделом - по всем остальным подразделениям.
		Запрос = Новый Запрос;
		Запрос.УстановитьПараметр("ДатаНач", НачалоДня(ДатаНач));				   
		Запрос.УстановитьПараметр("ДатаКон", КонецДня(ДатаКон));
		Запрос.УстановитьПараметр("Пустое", Справочники.Подразделения.ПустаяСсылка());
		
		Если РольДоступна("яштФинДиректор") И НЕ СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Серков" И НЕ СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Бондаренко Е.Д. (снабжение)" Тогда
			Запрос.Текст = "ВЫБРАТЬ
			               |	ЗаявкаНаРасходованиеСредств.Ссылка,
			               |	ВЫБОР
			               |		КОГДА ЗаявкаНаРасходованиеСредств.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийЗаявкиНаРасходование.ВыдачаДенежныхСредствПодотчетнику)
			               |			ТОГДА ЗаявкаНаРасходованиеСредств.Получатель
			               |		ИНАЧЕ ЗаявкаНаРасходованиеСредств.Контрагент
			               |	КОНЕЦ КАК Контрагент
			               |ИЗ
			               |	Документ.ЗаявкаНаРасходованиеСредств КАК ЗаявкаНаРасходованиеСредств
			               |ГДЕ
			               |	ЗаявкаНаРасходованиеСредств.ДатаРасхода МЕЖДУ &ДатаНач И &ДатаКон
			               |	И (ЗаявкаНаРасходованиеСредств.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Подготовлен)
			               |			ИЛИ ЗаявкаНаРасходованиеСредств.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Утвержден))
			               |	И ЗаявкаНаРасходованиеСредств.Проведен
			               |	И ЗаявкаНаРасходованиеСредств.ФормаОплаты = ЗНАЧЕНИЕ(Перечисление.ВидыДенежныхСредств.Наличные)
			               |	И (ЗаявкаНаРасходованиеСредств.Подразделение = &Пустое ИЛИ НЕ ЗаявкаНаРасходованиеСредств.Подразделение.ОбособленноеПодразделение)
			               |
			               |УПОРЯДОЧИТЬ ПО
			               |	ЗаявкаНаРасходованиеСредств.Состояние УБЫВ,
			               |	Контрагент
			               |АВТОУПОРЯДОЧИВАНИЕ";
		ИначеЕсли  СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Серков" или СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Марешева И.Г." или СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Бондаренко Е.Д. (снабжение)" Тогда
			Запрос.Текст = "ВЫБРАТЬ
			               |	ЗаявкаНаРасходованиеСредств.Ссылка,
			               |	ВЫБОР
			               |		КОГДА ЗаявкаНаРасходованиеСредств.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийЗаявкиНаРасходование.ВыдачаДенежныхСредствПодотчетнику)
			               |			ТОГДА ЗаявкаНаРасходованиеСредств.Получатель
			               |		ИНАЧЕ ЗаявкаНаРасходованиеСредств.Контрагент
			               |	КОНЕЦ КАК Контрагент
			               |ИЗ
			               |	Документ.ЗаявкаНаРасходованиеСредств КАК ЗаявкаНаРасходованиеСредств
			               |ГДЕ
			               |	ЗаявкаНаРасходованиеСредств.ДатаРасхода МЕЖДУ &ДатаНач И &ДатаКон
			               |	И 
						   |(ЗаявкаНаРасходованиеСредств.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Согласован)
						   |			ИЛИ ЗаявкаНаРасходованиеСредств.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Подготовлен)
			               |			ИЛИ ЗаявкаНаРасходованиеСредств.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Утвержден))
			               |	И ЗаявкаНаРасходованиеСредств.Проведен
			               |	И ЗаявкаНаРасходованиеСредств.ФормаОплаты = ЗНАЧЕНИЕ(Перечисление.ВидыДенежныхСредств.Наличные)
			               |	И ЗаявкаНаРасходованиеСредств.Подразделение.ОбособленноеПодразделение
			               |
			               |УПОРЯДОЧИТЬ ПО
			               |	ЗаявкаНаРасходованиеСредств.Состояние УБЫВ,
			               |	Контрагент
			               |АВТОУПОРЯДОЧИВАНИЕ";
			Иначе  //егор малышев
			Запрос.УстановитьПараметр("ВЭД", Справочники.Подразделения.НайтиПоКоду("00006"));
			   
			Запрос.Текст = "ВЫБРАТЬ
			               |	ЗаявкаНаРасходованиеСредств.Ссылка,
			               |	ВЫБОР
			               |		КОГДА ЗаявкаНаРасходованиеСредств.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийЗаявкиНаРасходование.ВыдачаДенежныхСредствПодотчетнику)
			               |			ТОГДА ЗаявкаНаРасходованиеСредств.Получатель
			               |		ИНАЧЕ ЗаявкаНаРасходованиеСредств.Контрагент
			               |	КОНЕЦ КАК Контрагент
			               |ИЗ
			               |	Документ.ЗаявкаНаРасходованиеСредств КАК ЗаявкаНаРасходованиеСредств
			               |ГДЕ
			               |	ЗаявкаНаРасходованиеСредств.ДатаРасхода МЕЖДУ &ДатаНач И &ДатаКон
						   //|	И (ЗаявкаНаРасходованиеСредств.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Согласован)
						   //|			ИЛИ ЗаявкаНаРасходованиеСредств.Состояние = ЗНАЧЕНИЕ(Перечисление.СостоянияОбъектов.Утвержден))
			               |	И ЗаявкаНаРасходованиеСредств.Проведен
			               |	И ЗаявкаНаРасходованиеСредств.ФормаОплаты = ЗНАЧЕНИЕ(Перечисление.ВидыДенежныхСредств.Наличные)
			               |	И ЗаявкаНаРасходованиеСредств.Подразделение = &ВЭД
			               |
			               |УПОРЯДОЧИТЬ ПО
			               |	ЗаявкаНаРасходованиеСредств.Состояние УБЫВ,
			               |	Контрагент
			               |АВТОУПОРЯДОЧИВАНИЕ";
						   
		КонецЕсли;
	КонецЕсли;
				   
	Результат = Запрос.Выполнить().Выгрузить();
	
	Для Каждого СтрокаТЗ Из Результат Цикл
				
		СтрокаТЧ = Наличные.Добавить();
		СтрокаТЧ.Заявка			 = СтрокаТЗ.Ссылка;
		СтрокаТЧ.Контрагент		 = СтрокаТЗ.Контрагент;
		СтрокаТЧ.Ответственный	 = СтрокаТЗ.Ссылка.Ответственный;
		СтрокаТЧ.Состояние		 = СтрокаТЗ.Ссылка.Состояние;
		СтрокаТЧ.Сумма			 = СтрокаТЗ.Ссылка.СуммаДокумента;
		СтрокаТЧ.Подразделение	 = СтрокаТЗ.Ссылка.Подразделение;
		СтрокаТЧ.ВидОперации	 = СтрокаТЗ.Ссылка.ВидОперации;
		
	КонецЦикла;
	
КонецПроцедуры	

Процедура БезналичныеПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	
	Если ДанныеСтроки.Состояние = Перечисления.СостоянияОбъектов.Утвержден Тогда
		ОформлениеСтроки.ЦветТекста = WebЦвета.Серый;
		ОформлениеСтроки.Ячейки.Пометка.ОтображатьФлажок = Ложь;
	КонецЕсли;
	
КонецПроцедуры

Процедура НаличныеПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)

	Если Согласование И (ДанныеСтроки.Состояние = Перечисления.СостоянияОбъектов.Согласован ИЛИ ДанныеСтроки.Состояние = Перечисления.СостоянияОбъектов.Утвержден) Тогда
		ОформлениеСтроки.ЦветТекста = WebЦвета.Серый;
		ОформлениеСтроки.Ячейки.Пометка.ОтображатьФлажок = Ложь;
	КонецЕсли;
	Если Утверждение И ДанныеСтроки.Состояние = Перечисления.СостоянияОбъектов.Утвержден Тогда
		ОформлениеСтроки.ЦветТекста = WebЦвета.Серый;
		ОформлениеСтроки.Ячейки.Пометка.ОтображатьФлажок = Ложь;
	КонецЕсли;
	
КонецПроцедуры

Процедура КоманднаяПанель2ДействиеУстановитьФлажки(Кнопка)
	
	Для каждого СтрокаТабличнойЧасти Из Безналичные Цикл
		СтрокаТабличнойЧасти.Пометка = Истина;
	КонецЦикла; 
	
КонецПроцедуры

Процедура КоманднаяПанель2ДействиеСнятьФлажки(Кнопка)

	Для каждого СтрокаТабличнойЧасти Из Безналичные Цикл
		СтрокаТабличнойЧасти.Пометка = Ложь;
	КонецЦикла; 
	
КонецПроцедуры

Процедура УтвердитьБезналичныеНажатие(Элемент)
	
	Для каждого СтрокаТабличнойЧасти Из Безналичные Цикл
		Если Утверждение Тогда
			Если РольДоступна("яштФинДиректор") И НЕ СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Серков" И НЕ СокрЛП(ПараметрыСеанса.ТекущийПользователь.Код) = "Бондаренко Е.Д. (снабжение)"  Тогда
				Если СтрокаТабличнойЧасти.Пометка И НЕ СтрокаТабличнойЧасти.Состояние = Перечисления.СостоянияОбъектов.Утвержден Тогда
					ЗаявкаОбъект = СтрокаТабличнойЧасти.Заявка.ПолучитьОбъект();
					ЗаявкаОбъект.Состояние = Перечисления.СостоянияОбъектов.Утвержден;
					ЗаявкаОбъект.Утвердил = ПараметрыСеанса.ТекущийПользователь; 
					ЗаявкаОбъект.Записать(РежимЗаписиДокумента.Проведение);
				КонецЕсли;
			Иначе
				Если СтрокаТабличнойЧасти.Пометка И НЕ СтрокаТабличнойЧасти.Состояние = Перечисления.СостоянияОбъектов.Согласован Тогда
					ЗаявкаОбъект = СтрокаТабличнойЧасти.Заявка.ПолучитьОбъект();
					ЗаявкаОбъект.Состояние = Перечисления.СостоянияОбъектов.Согласован;
					ЗаявкаОбъект.Записать(РежимЗаписиДокумента.Проведение);
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
	ЗаполнитьТЧБезналичнойОплаты();
	
КонецПроцедуры

Процедура КоманднаяПанель3ДействиеУстановитьФлажки(Кнопка)

	Для каждого СтрокаТабличнойЧасти Из Наличные Цикл
		СтрокаТабличнойЧасти.Пометка = Истина;
	КонецЦикла; 
	
КонецПроцедуры

Процедура КоманднаяПанель3ДействиеСнятьФлажки(Кнопка)

	Для каждого СтрокаТабличнойЧасти Из Наличные Цикл
		СтрокаТабличнойЧасти.Пометка = Ложь;
	КонецЦикла; 
	
КонецПроцедуры

Процедура УтвердитьНаличныеНажатие(Элемент)

	Для каждого СтрокаТабличнойЧасти Из Наличные Цикл
		Если Согласование Тогда
			Если СтрокаТабличнойЧасти.Пометка И НЕ СтрокаТабличнойЧасти.Состояние = Перечисления.СостоянияОбъектов.Согласован Тогда
				ЗаявкаОбъект = СтрокаТабличнойЧасти.Заявка.ПолучитьОбъект();
				ЗаявкаОбъект.Состояние = Перечисления.СостоянияОбъектов.Согласован;
				ЗаявкаОбъект.Записать(РежимЗаписиДокумента.Проведение);
			КонецЕсли;
		КонецЕсли;
		Если Утверждение Тогда
			Если СтрокаТабличнойЧасти.Пометка И НЕ СтрокаТабличнойЧасти.Состояние = Перечисления.СостоянияОбъектов.Утвержден Тогда
				ЗаявкаОбъект = СтрокаТабличнойЧасти.Заявка.ПолучитьОбъект();
				ЗаявкаОбъект.Состояние = Перечисления.СостоянияОбъектов.Утвержден;
				ЗаявкаОбъект.Утвердил = ПараметрыСеанса.ТекущийПользователь;
				ЗаявкаОбъект.Записать(РежимЗаписиДокумента.Проведение);
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
	ЗаполнитьТЧНаличнойОплаты();
	
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	Если ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "РазрешитьСогласовыватьЗаявки") Тогда
		Согласование = Истина;
	КонецЕсли;		
	Если ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "РазрешитьУтверждатьЗаявки") Тогда
		Согласование = Ложь;
		Утверждение = Истина;  //оставляем более старшую настройку прав
	КонецЕсли;
	Если НЕ Согласование И НЕ Утверждение Тогда
		Сообщить("У вас нет прав на согласование и утверждение Заявок на расходование средств.");
		Отказ = Истина;
	КонецЕсли;
	
КонецПроцедуры

Процедура ПриОткрытии()
	
	Если Согласование Тогда
		ЭлементыФормы.УтвердитьНаличные.Заголовок = "Согласовать выбранные"
	КонецЕсли;
	
	Если параметрысеанса.ТекущийПользователь = Справочники.Пользователи.НайтиПоКоду("Малышев Егор") Тогда
		ЭлементыФормы.УтвердитьБезналичные.Заголовок = "Согласовать выбранные"
	КонецЕсли;
	
	
	ДатаНач = НачалоДня(НачалоДня(ТекущаяДата())-1);
	ДатаКон = КонецДня(ТекущаяДата());
	
КонецПроцедуры

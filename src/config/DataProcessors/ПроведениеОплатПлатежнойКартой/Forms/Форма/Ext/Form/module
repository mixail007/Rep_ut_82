
Процедура КнопкаВыполнитьНажатие(Кнопка)
	Для Каждого СтрТЧ из ДокументыОплаты Цикл
		Если СтрТЧ.Активен Тогда
			ДокОбъект = СтрТЧ.Документ.ПолучитьОбъект();
			ДокОбъект.Статус = Перечисления.СтатусыОплатПлатежнойКартой.Подтвержден;
			ДокОбъект.ОтражатьВБухгалтерскомУчете = Истина;
			ДокОбъект.ОтражатьВНалоговомУчете = Истина;
			Попытка		
				ДокОбъект.Записать(РежимЗаписиДокумента.Проведение);
				СтрТЧ.Статус = Перечисления.СтатусыОплатПлатежнойКартой.Подтвержден;
			Исключение
			    Сообщить("Не удалось провести документ: " + СтрТЧ.Документ);
			КонецПопытки;
		КонецЕсли;
	КонецЦикла;
КонецПроцедуры

Процедура КоманднаяПанель1УстановитьВсеФлажки(Кнопка)
	Для каждого СтрокаТЧ Из ДокументыОплаты Цикл
		СтрокаТЧ.Активен = Истина;
	КонецЦикла;
	ИтогоВыбранно = ДокументыОплаты.Итог("Сумма");
КонецПроцедуры

Процедура КоманднаяПанель1Действие9(Кнопка)
	Для каждого СтрокаТЧ Из ДокументыОплаты Цикл
		СтрокаТЧ.Активен = Ложь;
	КонецЦикла;
	ИтогоВыбранно = 0;
КонецПроцедуры

Процедура КоманднаяПанель1ЗаполнитьДокументами(Кнопка)
	ДокументыОплаты.Очистить();
	Если ЗначениеНеЗаполнено(НачПериода) или ЗначениеНеЗаполнено(НачПериода) Тогда
		Сообщить("Необходимо заполнить Период");
		Возврат;
	КонецЕсли;
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ОплатаОтПокупателяПлатежнойКартой.Ссылка КАК Документ,
	|	ОплатаОтПокупателяПлатежнойКартой.СуммаДокумента КАК Сумма,
	|	ОплатаОтПокупателяПлатежнойКартой.Статус
	|ИЗ
	|	Документ.ОплатаОтПокупателяПлатежнойКартой КАК ОплатаОтПокупателяПлатежнойКартой
	|ГДЕ
	|	ОплатаОтПокупателяПлатежнойКартой.Дата МЕЖДУ &Дата1 И &Дата2
	|	И НЕ ОплатаОтПокупателяПлатежнойКартой.ПометкаУдаления
	|	И ОплатаОтПокупателяПлатежнойКартой.Проведен = ЛОЖЬ
	|
	|УПОРЯДОЧИТЬ ПО
	|	ОплатаОтПокупателяПлатежнойКартой.МоментВремени";
	Запрос.УстановитьПараметр("Дата1", НачПериода);
	Запрос.УстановитьПараметр("Дата2", КонецДня(КонПериода));
	РезультатЗапроса = Запрос.Выполнить();
	ДокументыОплаты.Загрузить(РезультатЗапроса.Выгрузить());
	
КонецПроцедуры

Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	Если НастройкаПериода.Редактировать() Тогда
		НачПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры

Процедура ДокументыОплатыПередНачаломИзменения(Элемент, Отказ)
	ТекущиеДанные = ЭлементыФормы.ДокументыОплаты.ТекущиеДанные;
	Если ЭлементыФормы.ДокументыОплаты.ТекущаяКолонка.Имя = "Активен"
		и ТекущиеДанные.Статус = Перечисления.СтатусыОплатПлатежнойКартой.Подтвержден Тогда
		Отказ = Истина;
	КонецЕсли;		
КонецПроцедуры

Процедура ДокументыОплатыПриОкончанииРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования)
	ТЗ = ДокументыОплаты.Выгрузить(Новый Структура("Активен",Истина));
	ИтогоВыбранно = ТЗ.Итог("Сумма");
КонецПроцедуры

Процедура ПриОткрытии()
	НачПериода = ТекущаяДата() - 24*60*60; // вчерашний день по умолчанию
	КонПериода = ТекущаяДата() - 24*60*60;
КонецПроцедуры

перем ТекстСообщения0;


Процедура КнопкаВыполнитьНажатие(Кнопка)
	Сформировать();
КонецПроцедуры


Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.УстановитьПериод(НачДата, ?(КонДата='0001-01-01', КонДата, КонецДня(КонДата)));
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	Если НастройкаПериода.Редактировать() Тогда
		НачДата = НастройкаПериода.ПолучитьДатуНачала();
		КонДата = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
	КнопкаВыполнитьНажатие(Неопределено);
КонецПроцедуры


Процедура ОсновныеДействияФормыДействиеОтправить(Кнопка)
	ОтправитьКлиент();	
КонецПроцедуры


Процедура ПриОткрытии()
	ПриОткрытииКлиент();
	ЭлементыФормы.УЗнаименование.СписокВыбора.Добавить("1c@yst.ru");
	ЭлементыФормы.УЗнаименование.СписокВыбора.Добавить("no-reply@yst76.ru");
КонецПроцедуры



Процедура НачДатаРегулирование(Элемент, Направление, СтандартнаяОбработка)
	Если КонДата<НачДата тогда
		КонДата=НачДата;
	КонецЕсли;	
КонецПроцедуры

Процедура НачДатаПриИзменении(Элемент)
	Если КонДата<НачДата тогда
		КонДата=НачДата;
	КонецЕсли;
КонецПроцедуры

Процедура КонДатаПриИзменении(Элемент)
	Если КонДата<НачДата тогда
		НачДата=КонДата;
	КонецЕсли;
КонецПроцедуры


Процедура КонДатаРегулирование(Элемент, Направление, СтандартнаяОбработка)
	Если КонДата<НачДата тогда
		НачДата=КонДата;
	КонецЕсли;
КонецПроцедуры


Процедура АдресаКонтрагентовПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	Если ДанныеСтроки.ТребуетсяОтправкаПоПочте тогда
		ОформлениеСтроки.цветФона = webЦвета.СветлоЖелтый;
		ОформлениеСтроки.Шрифт = новый Шрифт(ОформлениеСтроки.Шрифт,,,Истина);
	КонецЕсли;	
	
	 ОформлениеСтроки.Ячейки.ТребуетсяОтправкаПоПочте.ОтображатьТекст = ЛОЖЬ;
	 //ОформлениеСтроки.Ячейки.ТребуетсяОтправкаПоПочте.ОтображатьФлажок = Истина;
	 //ОформлениеСтроки.Ячейки.ТребуетсяОтправкаПоПочте.Флажок = ?(ДанныеСтроки.ТребуетсяОтправкаПоПочте=Истина, 1, 0);
КонецПроцедуры

//------------------------------------------------
Процедура КоманднаяПанель2ВыбратьВсе(Кнопка)
	Для i=0 по ЭлементыФормы.АдресаКонтрагентов.Значение.Количество()-1 цикл
		стр = ЭлементыФормы.АдресаКонтрагентов.Значение[i];
		стр.ТребуетсяОтправкаПоПочте = Истина;
	КонецЦикла;
	ЭлементыФормы.АдресаКонтрагентов.ОбновитьСтроки();
	
	Для i=0 по Реализации.Количество()-1 цикл
		стр = Реализации[i];
		стр.Выбран = Истина;
	КонецЦикла;
	ЭлементыФормы.Реализации.ОбновитьСтроки();

	
КонецПроцедуры


Процедура КоманднаяПанель2УбратьВсе(Кнопка)
	Для i=0 по ЭлементыФормы.АдресаКонтрагентов.Значение.Количество()-1 цикл
		стр = ЭлементыФормы.АдресаКонтрагентов.Значение[i];
		стр.ТребуетсяОтправкаПоПочте = ЛОЖЬ;
	КонецЦикла;	
	ЭлементыФормы.АдресаКонтрагентов.ОбновитьСтроки();
	
	Для i=0 по Реализации.Количество()-1 цикл
		стр = Реализации[i];
		стр.Выбран = ЛОЖЬ;
	КонецЦикла;
	ЭлементыФормы.Реализации.ОбновитьСтроки();
	
 КонецПроцедуры


 Процедура КоманднаяПанель2Инверсия(Кнопка)
	 Для i=0 по ЭлементыФормы.АдресаКонтрагентов.Значение.Количество()-1 цикл
		стр = ЭлементыФормы.АдресаКонтрагентов.Значение[i];
		стр.ТребуетсяОтправкаПоПочте = не стр.ТребуетсяОтправкаПоПочте;
	КонецЦикла;	
	ЭлементыФормы.АдресаКонтрагентов.ОбновитьСтроки();
	
	Для i=0 по Реализации.Количество()-1 цикл
		стр = Реализации[i];
		стр.Выбран = НЕ стр.Выбран;
	КонецЦикла;
	ЭлементыФормы.Реализации.ОбновитьСтроки();
 	
КонецПроцедуры




 Процедура АдресаКонтрагентовПриАктивизацииСтроки(Элемент)
	 //позиционируемся на реализации
	 попытка
		 стрКонтр = ЭлементыФормы.АдресаКонтрагентов.ТекущиеДанные;
	Если ЗначениеЗаполнено(стрКонтр) тогда	 
		
		 СтрокиРеализ = Реализации.НайтиСтроки(новый Структура("Контрагент", стрКонтр.Контрагент));
		 
		 Если СтрокиРеализ.Количество()>0 тогда
			ЭлементыФормы.Реализации.ТекущаяСтрока = СтрокиРеализ[0];
	 	КонецЕсли;	 
			
		для i=0 по СтрокиРеализ.Количество()-1 цикл
			стр = СтрокиРеализ[i];
			стр.Выбран = стрКонтр.ТребуетсяОтправкаПоПочте;
		КонецЦикла;
		
	 КонецЕсли;	 
		
	 исключение
	 конецПопытки;	
 КонецПроцедуры


 Процедура АдресаКонтрагентовТребуетсяОтправкаПоПочтеПриИзменении(Элемент)
	 //ОформлениеСтроки.Ячейки.ТребуетсяОтправкаПоПочте.ОтображатьФлажок = ЛОЖЬ;
КонецПроцедуры


Процедура АдресаКонтрагентовЭлектронныйАдресПриИзменении(Элемент)
	Сообщить("Для сохранения эл.адресов - откройте карточку Контрагента и на закладке Контакты - введите ""Адрес электронной почты для обмена документами"" ");
КонецПроцедуры


Процедура КаталогВременныхФайловНачалоВыбора(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = ложь;
	
ДиалогОткрытияФайла = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.ВыборКаталога);
ДиалогОткрытияФайла.Каталог = КаталогВременныхФайлов;
ДиалогОткрытияФайла.Заголовок = "Выберите каталог временных файлов";
Если ДиалогОткрытияФайла.Выбрать() Тогда
КаталогВременныхФайлов = ДиалогОткрытияФайла.Каталог;
КонецЕсли;

КонецПроцедуры

Процедура КаталогВременныхФайловОчистка(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = ложь;
	КаталогВременныхФайлов = КаталогВременныхФайлов();
	//КаталогВременныхФайлов =стрЗаменить(КаталогВременныхФайлов,"Local Settings\Temp\","Мои документы\");
КонецПроцедуры

Процедура КаталогВременныхФайловОткрытие(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = ложь;
	ДиалогОткрытияФайла = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	ДиалогОткрытияФайла.Каталог = КаталогВременныхФайлов;
	Фильтр = "Excel-файлы (*.xls)|*.xls";
	ДиалогОткрытияФайла.Фильтр = Фильтр;
 	ДиалогОткрытияФайла.Заголовок = "Просмотр каталога временных файлов";
	Если ДиалогОткрытияФайла.Выбрать() Тогда
		Если КаталогВременныхФайлов <> ДиалогОткрытияФайла.Каталог тогда
			КаталогВременныхФайлов = ДиалогОткрытияФайла.Каталог;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

Процедура ВсеРеализацииПриИзменении(Элемент)
	Режим = РежимДиалогаВопрос.ДаНет;
Ответ = Вопрос("Обновить список Контрагентов и Реализаций?", Режим, 10);
Если Ответ = КодВозвратаДиалога.Да Тогда
    КнопкаВыполнитьНажатие(неопределено);
КонецЕсли;

КонецПроцедуры


//+++ при перевыборе Контрагента - изменяем адрес эл.почты
процедура перезаполнитьЭлПочтуТекСтроки()

	текСтрока = ЭлементыФормы.АдресаКонтрагентов.ТекущиеДанные;
	
	отбор1 = новый Структура("Объект", текСтрока.Контрагент);
	отбор1.Вставить("Тип", перечисления.ТипыКонтактнойИнформации.АдресЭлектроннойПочты);
	отбор1.Вставить("Вид", Справочники.ВидыКонтактнойИнформации.НайтиПоКоду("00013") );
	
	рс = регистрыСведений.КонтактнаяИнформация.Получить(отбор1);
	Если рс=Неопределено тогда
		текСтрока.ЭлектронныйАдрес = "";
		текСтрока.ТребуетсяОтправкаПоПочте = ложь;
	иначе
		текСтрока.ЭлектронныйАдрес = рс.Представление;
		текСтрока.ТребуетсяОтправкаПоПочте = истина;
	КонецЕсли;

КонецПроцедуры

Процедура АдресаКонтрагентовКонтрагентОткрытие(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = ложь;
	текСтрока = ЭлементыФормы.АдресаКонтрагентов.ТекущиеДанные;
	фрм1 = текСтрока.Контрагент.получитьФорму("ФормаЭлемента");
	фрм1.ОткрытьМодально();
	перезаполнитьЭлПочтуТекСтроки();
КонецПроцедуры

Процедура АдресаКонтрагентовКонтрагентПриИзменении(Элемент)
		перезаполнитьЭлПочтуТекСтроки();
КонецПроцедуры

Процедура РеализацииПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	
	 //ОформлениеСтроки.Ячейки.Выбран.ОтображатьТекст  = ЛОЖЬ;
	 //ОформлениеСтроки.Ячейки.Выбран.ОтображатьФлажок = Истина;
	 //ОформлениеСтроки.Ячейки.Выбран.Флажок = ДанныеСтроки.выбран;
	 
КонецПроцедуры

Процедура АдресаКонтрагентовПриИзмененииФлажка(Элемент, Колонка)
	//позиционируемся на реализации
	 попытка
		 стрКонтр = ЭлементыФормы.АдресаКонтрагентов.ТекущиеДанные;
		 
	Если ЗначениеЗаполнено(стрКонтр) тогда	 
		
		 СтрокиРеализ = Реализации.НайтиСтроки(новый Структура("Контрагент", стрКонтр.Контрагент)); 
			
		для i=0 по СтрокиРеализ.Количество()-1 цикл
			стр = СтрокиРеализ[i];
			Если стр.Выбран <> стрКонтр.ТребуетсяОтправкаПоПочте тогда
				стр.Выбран = стрКонтр.ТребуетсяОтправкаПоПочте;
			КонецЕсли;	
		КонецЦикла;
		
	 КонецЕсли;	 
		
	 исключение
	 конецПопытки;	

КонецПроцедуры


         ТекстСообщения0 ="   Добрый день,
						 |
						 |Высылаем Вам копии документов.
						 |
						 |
						 |С уважением, 
						 |ЗАО Торговая Компания ""Яршинторг"", 
						 |юр./факт.адрес: 150044, Ярославская обл, Ярославль г, Базовая ул, дом № 3
						 |тел./факс: (4852) 200-200, 67-11-67
						 |Web-сайт : http://www.yst.ru
						 |"; 
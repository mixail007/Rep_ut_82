<?xml version="1.0" encoding="UTF-8"?>
<DataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema" xmlns:dcscom="http://v8.1c.ru/8.1/data-composition-system/common" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataSource>
		<name>ИсточникДанных1</name>
		<dataSourceType>Local</dataSourceType>
	</dataSource>
	<dataSet xsi:type="DataSetQuery">
		<name>НаборДанных1</name>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДнейПросрочено</dataPath>
			<field>ДнейПросрочено</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДоговорКонтрагента</dataPath>
			<field>ДоговорКонтрагента</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Контрагент</dataPath>
			<field>Контрагент</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Менеджер</dataPath>
			<field>Менеджер</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>НаправлениеПродаж</dataPath>
			<field>НаправлениеПродаж</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Сделка</dataPath>
			<field>Сделка</field>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СуммаПросроченногоДолга</dataPath>
			<field>СуммаПросроченногоДолга</field>
		</field>
		<dataSource>ИсточникДанных1</dataSource>
		<query>ВЫБРАТЬ
	ВзаиморасчетыСКонтрагентамиОстатки.ДоговорКонтрагента.ОтветственноеЛицо КАК Менеджер,
	ВзаиморасчетыСКонтрагентамиОстатки.ДоговорКонтрагента.Владелец КАК Контрагент,
	ВзаиморасчетыСКонтрагентамиОстатки.ДоговорКонтрагента КАК ДоговорПродажи,
	ВзаиморасчетыСКонтрагентамиОстатки.Сделка,
	ВзаиморасчетыСКонтрагентамиОстатки.Сделка.ДатаОтгрузки КАК ДатаОтгрузки,
	ВзаиморасчетыСКонтрагентамиОстатки.Сделка.ДатаОплаты КАК ДатаОплаты,
	ВзаиморасчетыСКонтрагентамиОстатки.СуммаУпрОстаток КАК СуммаДолга,
	ВзаиморасчетыСКонтрагентамиОстатки.СуммаУпрОстаток КАК СуммаПросроченногоДолга,
	0 КАК НачислилиПеней,
	ВЫБОР
		КОГДА ВзаиморасчетыСКонтрагентамиОстатки.ДоговорКонтрагента.ТипДоговора = &amp;Пени
			ТОГДА ВзаиморасчетыСКонтрагентамиОстатки.СуммаУпрОстаток
		ИНАЧЕ 0
	КОНЕЦ КАК ВыставилиПеней,
	ВзаиморасчетыСКонтрагентамиОстатки.ДоговорКонтрагента.ОтветственноеЛицо.ОсновноеПодразделение КАК Подразделение,
	ВзаиморасчетыСКонтрагентамиОстатки.ДоговорКонтрагента.ОтветственноеЛицо.НаправлениеПродаж КАК НаправлениеПродаж
ПОМЕСТИТЬ вт
ИЗ
	РегистрНакопления.ВзаиморасчетыСКонтрагентами.Остатки(
			,
			ДоговорКонтрагента.ВидДоговора = &amp;СПокупателем
				ИЛИ ДоговорКонтрагента.ВидДоговора = &amp;СКомиссионером) КАК ВзаиморасчетыСКонтрагентамиОстатки
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	вт.Менеджер,
	вт.Контрагент,
	вт.ДоговорПродажи,
	вт.Сделка,
	вт.ДатаОтгрузки,
	вт.ДатаОплаты,
	СУММА(вт.СуммаДолга) КАК СуммаДолга,
	СУММА(вт.СуммаПросроченногоДолга) КАК СуммаПросроченногоДолга,
	СУММА(вт.НачислилиПеней) КАК НачислилиПеней,
	СУММА(вт.ВыставилиПеней) КАК ВыставилиПеней,
	вт.Подразделение,
	вт.НаправлениеПродаж
ПОМЕСТИТЬ свод
ИЗ
	вт КАК вт

СГРУППИРОВАТЬ ПО
	вт.Менеджер,
	вт.Контрагент,
	вт.ДоговорПродажи,
	вт.Сделка,
	вт.ДатаОтгрузки,
	вт.ДатаОплаты,
	вт.Подразделение,
	вт.НаправлениеПродаж
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВзаиморасчетыСКонтрагентамиОстатки.ДоговорКонтрагента КАК ДоговорКонтрагента,
	ВзаиморасчетыСКонтрагентамиОстатки.Сделка КАК Сделка,
	СУММА(ВЫБОР
			КОГДА &amp;УчитыватьВзимныеОбязательства
				ТОГДА ВзаиморасчетыСКонтрагентамиОстатки.СуммаУпрОстаток - ЕСТЬNULL(УпрВзаимозачеты.Сумма, 0)
			ИНАЧЕ ВзаиморасчетыСКонтрагентамиОстатки.СуммаУпрОстаток
		КОНЕЦ) КАК СуммаУпрОстаток
ПОМЕСТИТЬ ПДЗ
ИЗ
	РегистрНакопления.ВзаиморасчетыСКонтрагентами.Остатки(
			&amp;ТекДата,
			(ДоговорКонтрагента.ВидДоговора = &amp;СПокупателем
				ИЛИ ДоговорКонтрагента.ВидДоговора = &amp;СКомиссионером)
				И Сделка.ДатаОплаты &lt; &amp;ТекДата) КАК ВзаиморасчетыСКонтрагентамиОстатки
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			УправленческийЗачетВзаимныхОбязательствСуммыДолга.ДоговорКонтрагента КАК ДоговорКонтрагента,
			УправленческийЗачетВзаимныхОбязательствСуммыДолга.Сделка КАК Сделка,
			УправленческийЗачетВзаимныхОбязательствСуммыДолга.Сумма КАК Сумма
		ИЗ
			Документ.УправленческийЗачетВзаимныхОбязательств.СуммыДолга КАК УправленческийЗачетВзаимныхОбязательствСуммыДолга
		ГДЕ
			УправленческийЗачетВзаимныхОбязательствСуммыДолга.Ссылка.Проведен
			И УправленческийЗачетВзаимныхОбязательствСуммыДолга.ВидЗадолженности = ЗНАЧЕНИЕ(Перечисление.ВидыЗадолженности.Дебиторская)) КАК УпрВзаимозачеты
		ПО ВзаиморасчетыСКонтрагентамиОстатки.ДоговорКонтрагента = УпрВзаимозачеты.ДоговорКонтрагента
			И ВзаиморасчетыСКонтрагентамиОстатки.Сделка = УпрВзаимозачеты.Сделка
ГДЕ
	ВзаиморасчетыСКонтрагентамиОстатки.СуммаУпрОстаток &gt; 0

СГРУППИРОВАТЬ ПО
	ВзаиморасчетыСКонтрагентамиОстатки.ДоговорКонтрагента,
	ВзаиморасчетыСКонтрагентамиОстатки.Сделка
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	свод.Менеджер,
	свод.Контрагент,
	свод.Сделка,
	свод.ДатаОтгрузки,
	свод.ДатаОплаты,
	свод.СуммаДолга,
	ПДЗ.СуммаУпрОстаток КАК СуммаПросроченногоДолга,
	свод.НаправлениеПродаж,
	ВЫБОР
		КОГДА НЕ ПДЗ.Сделка ЕСТЬ NULL 
				И ЕСТЬNULL(ПДЗ.СуммаУпрОстаток, 0) &gt; 0
			ТОГДА ВЫБОР
					КОГДА РАЗНОСТЬДАТ(ВЫБОР
								КОГДА ЕСТЬNULL(ПДЗ.Сделка.ДатаОплаты, 0) = 0
										ИЛИ ПДЗ.Сделка.ДатаОплаты = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
									ТОГДА ПДЗ.Сделка.Дата
								ИНАЧЕ ПДЗ.Сделка.ДатаОплаты
							КОНЕЦ, &amp;ТекДата, ДЕНЬ) + 1 &gt; 0
						ТОГДА РАЗНОСТЬДАТ(ВЫБОР
									КОГДА ЕСТЬNULL(ПДЗ.Сделка.ДатаОплаты, 0) = 0
											ИЛИ ПДЗ.Сделка.ДатаОплаты = ДАТАВРЕМЯ(1, 1, 1, 0, 0, 0)
										ТОГДА ПДЗ.Сделка.Дата
									ИНАЧЕ ПДЗ.Сделка.ДатаОплаты
								КОНЕЦ, &amp;ТекДата, ДЕНЬ) + 1
					ИНАЧЕ 0
				КОНЕЦ
		ИНАЧЕ 0
	КОНЕЦ КАК ДнейПросрочено
ПОМЕСТИТЬ Итого
ИЗ
	свод КАК свод
		ЛЕВОЕ СОЕДИНЕНИЕ ПДЗ КАК ПДЗ
		ПО свод.Сделка = ПДЗ.Сделка
			И свод.ДоговорПродажи = ПДЗ.ДоговорКонтрагента
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	Итого.Менеджер КАК Менеджер,
	Итого.Контрагент КАК Контрагент,
	//СУММА(Итого.СуммаДолга) КАК СуммаДолга,
	СУММА(Итого.СуммаПросроченногоДолга) КАК СуммаПросроченногоДолга,
	Итого.НаправлениеПродаж,
	МАКСИМУМ(Итого.ДнейПросрочено) КАК ДнейПросрочено
ИЗ
	Итого КАК Итого
ГДЕ
	Итого.ДнейПросрочено &gt; 13

СГРУППИРОВАТЬ ПО
	Итого.Менеджер,
	Итого.Контрагент,
	Итого.НаправлениеПродаж</query>
	</dataSet>
	<totalField>
		<dataPath>СуммаПросроченногоДолга</dataPath>
		<expression>Сумма(СуммаПросроченногоДолга)</expression>
	</totalField>
	<parameter>
		<name>Период</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Период</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>false</useRestriction>
	</parameter>
	<parameter>
		<name>Пени</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Пени</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.ТипыДоговоров</v8:Type>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>СКомиссионером</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>С комиссионером</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:EnumRef.ВидыДоговоровКонтрагентов</v8:Type>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>СПокупателем</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>С покупателем</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:EnumRef.ВидыДоговоровКонтрагентов</v8:Type>
		</valueType>
		<value xsi:nil="true"/>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>ТекДата</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Тек дата</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
	</parameter>
	<parameter>
		<name>УчитыватьВзимныеОбязательства</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Учитывать взимные обязательства</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:boolean</v8:Type>
		</valueType>
		<value xsi:type="xs:boolean">false</value>
		<useRestriction>true</useRestriction>
	</parameter>
	<settingsVariant>
		<dcsset:name>Основной</dcsset:name>
		<dcsset:presentation xsi:type="xs:string">Основной</dcsset:presentation>
		<dcsset:settings xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows">
			<dcsset:selection>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>НаправлениеПродаж</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Менеджер</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Контрагент</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СуммаПросроченногоДолга</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ДнейПросрочено</dcsset:field>
				</dcsset:item>
			</dcsset:selection>
			<dcsset:order>
				<dcsset:item xsi:type="dcsset:OrderItemField">
					<dcsset:field>НаправлениеПродаж</dcsset:field>
					<dcsset:orderType>Asc</dcsset:orderType>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:OrderItemField">
					<dcsset:field>Менеджер</dcsset:field>
					<dcsset:orderType>Asc</dcsset:orderType>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:OrderItemField">
					<dcsset:field>Контрагент</dcsset:field>
					<dcsset:orderType>Asc</dcsset:orderType>
				</dcsset:item>
			</dcsset:order>
			<dcsset:item xsi:type="dcsset:StructureItemGroup">
				<dcsset:order>
					<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
				</dcsset:order>
				<dcsset:selection>
					<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
				</dcsset:selection>
			</dcsset:item>
		</dcsset:settings>
	</settingsVariant>
</DataCompositionSchema>
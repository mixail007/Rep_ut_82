
Перем ВесТребуется Экспорт ;
Перем ОбъемТребуется Экспорт ;

Процедура КнопкаВыполнитьНажатие(Кнопка)
	// Вставить содержимое обработчика.
КонецПроцедуры

Процедура ПриОткрытии()
	
	ЭлементыФормы.ВесОсталосьНабрать.Заголовок    = ВесТребуется;
	ЭлементыФормы.ОбъемОсталосьНабрать.Заголовок  = ОбъемТребуется;
	
	ЗаполнитьТипыТраспортов();
	ЗаполнитьСписокАвтомобилей();
	
КонецПроцедуры

Процедура ЗаполнитьСписокАвтомобилей()
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ТипАвтомобиля.Наименование,
		|	ТипАвтомобиля.Объем КАК Вместимость,
		|	ТипАвтомобиля.Вес * 1000 КАК Грузоподъемность,
		|	ТипАвтомобиля.ТипТранспорта
		|ИЗ
		|	Справочник.ТипАвтомобиля КАК ТипАвтомобиля";
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		НовСтрСписокАвтомобилей = СписокАвтомобилей.Добавить();
		ЗаполнитьЗначенияСвойств(НовСтрСписокАвтомобилей,ВыборкаДетальныеЗаписи);
	КонецЦикла;
	
КонецПроцедуры


Процедура ЗаполнитьТипыТраспортов()
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ТипыТранспорта.Наименование,
		|	ТипыТранспорта.Объем Вместимость,
		|	ТипыТранспорта.Вес * 1000 КАК Грузоподъемность,
		|   ТипыТранспорта.Ссылка ТипТранспорта
		|ИЗ
		|	Справочник.ТипыТранспорта КАК ТипыТранспорта";
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		НовСтрСписокАвтомобилей = ТипыТранспортныхСредств.Добавить();
		ЗаполнитьЗначенияСвойств(НовСтрСписокАвтомобилей,ВыборкаДетальныеЗаписи);
	КонецЦикла;
	
КонецПроцедуры


Процедура ВыбратьНажатие(Элемент)
	
	ИмяТЧ = ПолучитьАктивнуюТаблицу();
	
	Данные = ЭлементыФормы[ИмяТЧ].ТекущиеДанные;
	НовСтрВыбранныеТранспортныеСредства = ВыбранныеТранспортныеСредства.Добавить(); 
	ЗаполнитьЗначенияСвойств(НовСтрВыбранныеТранспортныеСредства,Данные);
	  
КонецПроцедуры


Процедура УбратьНажатие(Элемент)
	
	ТекСтрока = ЭлементыФормы.ВыбранныеТранспортныеСредства.ТекущиеДанные;
	ВыбранныеТранспортныеСредства.Удалить(ТекСтрока);
	
КонецПроцедуры


Процедура ОбновлениеОтображения()
	
	ВесНабрали = ВыбранныеТранспортныеСредства.Итог("Грузоподъемность");
	ЭлементыФормы.ВесНабрали.Заголовок         = ВесНабрали;
	ЭлементыФормы.ВесОсталосьНабрать.Заголовок = ВесТребуется - ВесНабрали;
	
	ОбъемНабрали = ВыбранныеТранспортныеСредства.Итог("Вместимость");
	ЭлементыФормы.ОбъемНабрали.Заголовок         = ОбъемНабрали;
	ЭлементыФормы.ОбъемОсталосьНабрать.Заголовок = ОбъемТребуется - ОбъемНабрали;
	
КонецПроцедуры
	

Функция ПолучитьАктивнуюТаблицу()
	
	Возврат ЭлементыФормы.ПанельАвтомобилиТипы.ТекущаяСтраница.Имя;
	
КонецФункции
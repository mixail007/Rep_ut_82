////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ

// Процедура - обработчик события "ПриОткрытии" формы
Процедура ПриОткрытии()
	
КонецПроцедуры // ПриОткрытии()

// Процедура вызывается при нажатии кнопок "Установить все флаги", "Сбросить все флаги"
Процедура ФлагиНажатие(Элемент)
	ВидыДокументов.ЗаполнитьПометки(Элемент.Имя="ВсеФлаги");	
КонецПроцедуры // ФлагиНажатие()

// Процедура вызывается при нажатии кнопки "Найти"
Процедура НайтиНажатие(Элемент)
	ТекстЗапроса="";
	ЭтоЧисло = Истина;
	Попытка
		НомерКакЧисло = Число(ЭлементыФормы.НомерДокумента.Значение);
	Исключение
		ЭтоЧисло = Ложь;
	КонецПопытки;
	
	Для Каждого Док Из ВидыДокументов Цикл
		Если Док.Пометка=Истина Тогда			
			ИмяДока=Док.Значение;
			МетаданныеДокумента = Метаданные.Документы[ИмяДока];
			Если МетаданныеДокумента.ДлинаНомера=0 Тогда
				Продолжить;
			КонецЕсли;
			Если МетаданныеДокумента.ТипНомера=Метаданные.СвойстваОбъектов.ТипНомераДокумента.Число Тогда
				Если Не ЭтоЧисло Тогда
					Продолжить;
				КонецЕсли;
				ИскомыйНомер = НомерКакЧисло;
			Иначе
				ИскомыйНомер = """"+ЭлементыФормы.НомерДокумента.Значение+"""";
			КонецЕсли;
			
			ТекстЗапроса=ТекстЗапроса+"
			|Выбрать "+?(ТекстЗапроса="", "РАЗРЕШЕННЫЕ ", "")+"Дата, Ссылка Из Документ."+ИмяДока+" Как Док
			|ГДЕ ";
			Если Не ((ПериодС=Дата(01,01,01)) и (ПериодС=Дата(01,01,01))) Тогда
				ТекстЗапроса=ТекстЗапроса+" (Дата>=&НачалоИнтервала) И (Дата<=&КонецИнтервала) И ";
			КонецЕсли;
			
			ТекстЗапроса=ТекстЗапроса+"
			|Док.Номер="+ИскомыйНомер+"
			|UNION";
		КонецЕсли;
	КонецЦикла;
	Если ПустаяСтрока(ТекстЗапроса) Тогда
		Возврат;
	КонецЕсли;
	ТекстЗапроса=(Лев(ТекстЗапроса, СтрДлина(ТекстЗапроса)-СтрДлина("UNION")));		
	ТекстЗапроса=ТекстЗапроса+"
	|УПОРЯДОЧИТЬ ПО Дата";
	Запрос=Новый Запрос;
	Запрос.Текст=ТекстЗапроса;
	Запрос.УстановитьПараметр("НачалоИнтервала", НачалоДня(ПериодС));
	Запрос.УстановитьПараметр("КонецИнтервала", КонецДня(ПериодПо));
	ЭлементыФормы.НайденныеДокументы.Значение.ЗагрузитьЗначения(Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку(1));
КонецПроцедуры // НайтиНажатие()

// Процедура вызывается при выборе из списка найденного документа
Процедура НайденныеДокументыВыбор(Элемент, ЭлементСписка)
	Если ЭлементСписка<>Неопределено Тогда
		ОповеститьОВыборе(ЭлементСписка.Значение);
	КонецЕсли;
КонецПроцедуры // НайденныеДокументыВыбор()

// Процедура вызывается при нажатии кнопки "Выбрать"
Процедура ВыбратьНажатие(Элемент)
	НайденныеДокументыВыбор(ЭлементыФормы.НайденныеДокументы, ЭлементыФормы.НайденныеДокументы.ТекущаяСтрока)
КонецПроцедуры // ВыбратьНажатие()

// Процедура вызывается при нажатии кнопки "Отмена"
Процедура ОтменаНажатие(Элемент)
	Закрыть();
КонецПроцедуры // ОтменаНажатие()








Процедура КнопкаВыполнитьНажатие(Кнопка)
	// Вставить содержимое обработчика.
КонецПроцедуры

Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.Редактировать();
	НачПериода = НастройкаПериода.ПолучитьДатуНачала();
	КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
КонецПроцедуры

Процедура ОсновныеДействияФормыУдалить(Кнопка)

	Для Каждого Строка из ТаблицаЧеков Цикл
		Если (Строка.ЕстьФл) Тогда 
			УдалитьЧек(Строка.Чек);
		КонецЕсли;
	КонецЦикла;
	
	КоманднаяПанель1Выбрать(Кнопка);
КонецПроцедуры

Процедура КоманднаяПанель1Выбрать(Кнопка)

	ТаблицаЧеков.Очистить();
	Запрос = Новый Запрос;
 	Запрос.УстановитьПараметр("ДатаНач",НачалоДня(НачПериода));
	Запрос.УстановитьПараметр("ДатаКон",КонецДня(КонПериода));
	Запрос.УстановитьПараметр("Склад",ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "ОсновнойСклад"));
	Запрос.Текст = "
	|Выбрать Ссылка Из Документ.ЧекККМ
	|Где Проведен = Истина и (Дата >= &ДатаНач и Дата <= &ДатаКон) и Склад = &Склад";
	Выб = Запрос.Выполнить().Выбрать();
	
	Пока Выб.Следующий() Цикл
		
		Стр = ТаблицаЧеков.Добавить();
		Стр.ЕстьФл = Ложь;
		Стр.Чек = Выб.Ссылка;
		Стр.Сумма = Выб.Ссылка.СуммаДокумента;
		
	КонецЦикла;
	
КонецПроцедуры

Процедура ПриОткрытии()
	
	НачПериода = НачалоДня(ТекущаяДата());
	КонПериода = КонецДня(ТекущаяДата());
	
КонецПроцедуры

//Процедура УдалитьЧек(Чек)
//	
//	МаркаИНомерАвтомобиля = НайтиЗаписьМаркиИНомера(Чек);
//	
//	Если (МаркаИНомерАвтомобиля = Справочники.МаркиИНомераАвтомобилей.ПустаяСсылка()) Тогда 
//		
//		Ответ = Вопрос("Не найдена запись в регистре статистики для чека " + Чек + " пометить его на удаление ?",РежимДиалогаВопрос.ДаНет);
//		Если (Ответ = КодВозвратаДиалога.Да) Тогда 
//			Объект = Чек.ПолучитьОбъект();
//			Объект.УстановитьПометкуУдаления(Истина);
//		КонецЕсли;
//		
//	Иначе 
//		Объект = МаркаИНомерАвтомобиля.ПолучитьОбъект();
//		Объект.Удалить();
//		
//		ОбъектЧек = Чек.ПолучитьОбъект();
//		ОбъектЧек.УстановитьПометкуУдаления(Истина);
//	КонецЕсли;	
//	
//КонецПроцедуры

//Функция НайтиЗаписьМаркиИНомера(Чек)                           
//	
//	Запрос = новый Запрос;
//	Запрос.УстановитьПараметр("Дата",Чек.Дата);
//	Запрос.УстановитьПараметр("Номер",Чек.Номер);
//	Запрос.Текст = "
//	|Выбрать МаркаИНомерАвтомобиля как МИН из РегистрСведений.СтатистикаПоУслугам
//	|Где (Дата = &Дата) и (НомерЧека = &Номер)";
//	
//	Выб = Запрос.Выполнить().Выбрать();
//	
//	Если (Выб.Следующий()) Тогда 
//		Возврат Выб.МИН; 	
//	Иначе 
//		Возврат Справочники.МаркиИНомераАвтомобилей.ПустаяСсылка();
//	КонецЕсли;
//		
//КонецФункции
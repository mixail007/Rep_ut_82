
Процедура ВыбПериодНажатие(Элемент) Экспорт 
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.Редактировать();
	НачПериода = НастройкаПериода.ПолучитьДатуНачала();
	КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
КонецПроцедуры

Процедура КоманднаяПанель1Сформировать(Кнопка) Экспорт 
	ТипЦен = ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "ОсновнойТипЦенПродажи");
	Запрос = новый запрос;
	Запрос.УстановитьПараметр("НачДата",НачалоДня(НачПериода));
	Запрос.УстановитьПараметр("КонДата",КонецДня(КонПериода));
	Запрос.УстановитьПараметр("Тип",ТипЦен);
	Запрос.Текст = "
	|выбрать МИНТабл.МаркаИНомерАвтомобиля.Наименование как Марка, МИНТабл.МаркаИНомерАвтомобиля.НомерАвто как Номер, МинТабл.Номенклатура как номенклатура, Дата, МинТабл.Цена как цена, МинТабл.Сумма как Сумма, МинТабл.Количество как Количество, МинТабл.АвтоСкидка как АвтоСкидка, МинТабл.РучнаяСкидка как Скидка
	|из регистрсведений.статистикапоуслугам как МИНТабл
	|ГДЕ Дата>=&НачДата и Дата<=&КонДата";
	Макет = ОбъектОбработки.ПолучитьМакет("Журнал");
	ТД = ЭтаФорма.ЭлементыФормы.ТабличныйДокумент;
	ТД.Очистить();
	Обл = Макет.ПолучитьОбласть("Заголовок");	
	Обл.Параметры.СтрокаЗаголовка = "Отчет за период с " + НачПериода + " по " + КонПериода;
	ТД.Вывести(Обл);
	Обл = Макет.ПолучитьОбласть("Шапка");
	ТД.Вывести(Обл);
	Выборка = Запрос.Выполнить().Выбрать();
	Обл = Макет.ПолучитьОбласть("Строка");
	Итого = 0;
	Пока Выборка.Следующий() Цикл
		Обл.Параметры.Дата			=   Выборка.Дата;
		Обл.Параметры.Марка 		=	Выборка.Марка;
		Обл.Параметры.Номер 		=	Выборка.Номер;
		Обл.Параметры.Услуга 		=	Выборка.Номенклатура;
		Обл.Параметры.Цена 			=	Выборка.Цена;
		Обл.Параметры.Сумма			= 	Выборка.Сумма;
		Итого 						= 	Итого + Выборка.Сумма; 
		Обл.Параметры.Количество	= 	Выборка.Количество;
		Обл.Параметры.АвтоСкидка	= 	Выборка.АвтоСкидка;
		Обл.Параметры.Скидка		= 	Выборка.Скидка;
		ТД.Вывести(Обл);
	КонецЦикла;	
	Обл = Макет.ПолучитьОбласть("Итого");
	Обл.Параметры.Итого				= 	Итого;
	Тд.Вывести(Обл);
	Если Выборка.Количество()>0 Тогда 
		Этаформа.ЭлементыФормы.КоманднаяПанель1.Кнопки.Печать.Доступность = истина;
	Иначе 
		Этаформа.ЭлементыФормы.КоманднаяПанель1.Кнопки.Печать.Доступность = ложь;		
	КонецЕсли;
	ТД.Показать();	                    	
КонецПроцедуры

Процедура ПриОткрытии()
	НачПериода = НачалоДня(ТекущаяДата());
	КонПериода = КонецДня(ТекущаяДата());
КонецПроцедуры

Процедура КоманднаяПанель1Печать(Кнопка)
	ЭтаФорма.ЭлементыФормы.ТабличныйДокумент.АвтоМасштаб = истина;
	ЭтаФорма.ЭлементыФормы.ТабличныйДокумент.Напечатать();
КонецПроцедуры

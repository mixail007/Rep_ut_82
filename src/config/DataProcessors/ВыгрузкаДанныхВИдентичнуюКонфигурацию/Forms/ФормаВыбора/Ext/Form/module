// Процедура передает сделанные настройки в главную форму отчета.
//
Процедура Выбрать()

	МассивСтрока = Новый Массив; 
	МассивСтрока.Добавить(Тип("Строка"));
	КвалификаторСтроки = Новый КвалификаторыСтроки("100", ДопустимаяДлина.Переменная);
	ОписаниеТиповСтрока = Новый ОписаниеТипов(МассивСтрока, , КвалификаторСтроки);

	ВыбранныеСтроки = Новый ТаблицаЗначений;
	ВыбранныеСтроки.Колонки.Добавить("ИмяФильтра", 		ОписаниеТиповСтрока);
	ВыбранныеСтроки.Колонки.Добавить("ОписаниеФильтра", ОписаниеТиповСтрока);
	ВыбранныеСтроки.Колонки.Добавить("ПредставлениеФильтра", ОписаниеТиповСтрока);
	ВыбранныеСтроки.Колонки.Добавить("ОписаниеТипов");

	Если ЭлементыФормы.ТабличноеПоле.ТекущаяСтрока <> Неопределено Тогда

		СтрТабличноеПоле = ЭлементыФормы.ТабличноеПоле.ТекущиеДанные;

		НоваяСтрока = ВыбранныеСтроки.Добавить();
		НоваяСтрока.ИмяФильтра           	= СтрТабличноеПоле.ИмяПоля;
		НоваяСтрока.ПредставлениеФильтра  	= СтрТабличноеПоле.ПредставлениеПоля;
		НоваяСтрока.ОписаниеФильтра       	= СтрТабличноеПоле.ОписаниеПоля;
		НоваяСтрока.ОписаниеТипов           = СтрТабличноеПоле.ОписаниеТипов;

	КонецЕсли;

	ОповеститьОВыборе(ВыбранныеСтроки);

КонецПроцедуры

///////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ

// Процедура - обработчик события "При открытии" формы.
//
Процедура ПриОткрытии()

	СтруктураПараметров = НачальноеЗначениеВыбора;

	мИсходнаяТаблица="";
	СтруктураСуществующиеЗначения = Новый Структура;
	СтруктураНеиспользуемыеЗначения = Новый Структура;

	Если ТипЗнч(СтруктураПараметров) = Тип("Структура") Тогда

		СтруктураПараметров.Свойство("СтруктураСуществующиеЗначения", СтруктураСуществующиеЗначения);
		СтруктураПараметров.Свойство("СтруктураНеиспользуемыеЗначения", СтруктураНеиспользуемыеЗначения);
		СтруктураПараметров.Свойство("ИсходнаяТаблица", мИсходнаяТаблица);

	КонецЕсли;

	мТаблицаИспользуемыеФильтры     = СтруктураПараметров.ТаблицаФильтры;

    Заголовок="Фильтры выгрузки";
		
	Сч = 0;

	Пока Сч < мТаблицаИспользуемыеФильтры.Количество() Цикл

		Строка = мТаблицаИспользуемыеФильтры[Сч];

		Если СтруктураНеиспользуемыеЗначения.Свойство(Строка.ИмяПоля) Тогда

			мТаблицаИспользуемыеФильтры.Удалить(Строка);

		Иначе

			Сч = Сч + 1;

		КонецЕсли;

	КонецЦикла;

	ЭлементыФормы.ТабличноеПоле.Значение = мТаблицаИспользуемыеФильтры;
		
КонецПроцедуры

// Процедура - обработчик нажатия кнопки "ОК".
//
Процедура КнопкаВыбратьНажатие(Элемент)

    Выбрать();
	
КонецПроцедуры

// Процедура - обработчик попытки удаления строки из таблицы.
//
Процедура ТабличноеПолеПередУдалением(Элемент, Отказ)

	Отказ = Истина;

КонецПроцедуры

// Процедура - обработчик выбора строки таблицы.
//
Процедура ТабличноеПолеВыбор(Элемент, ВыбраннаяСтрока, Колонка, СтандартнаяОбработка)
   
	Выбрать();

КонецПроцедуры

// Процедура - обработчик попытки добавления строки в таблицу.
//
Процедура ТабличноеПолеПередНачаломДобавления(Элемент, Отказ, Копирование)

	Отказ = Истина;

КонецПроцедуры











 Перем мЖирныйШрифт;
 Процедура ПрозрачностьПриПолученииДанных(Элемент, ОформленияСтрок)

	Для каждого ОформлениеСтроки из Оформлениястрок Цикл
		ОформлениеСтроки.Ячейки.ГодовойОборот.Видимость = ЛожЬ; 	
		ОформлениеСтроки.Ячейки.ОборотЯШТ.Видимость = ЛожЬ;
		ОформлениеСтроки.Ячейки.ДляШин.Видимость = ЛожЬ;
		ОформлениеСтроки.Ячейки.КоличествоЛетоЯШТ.Шрифт =  мЖирныйШрифт;
		ОформлениеСтроки.Ячейки.КоличествоЗимаЯШТ.Шрифт =  мЖирныйШрифт;
		ОформлениеСтроки.Ячейки.КоличествоЯШТ.Шрифт =  мЖирныйШрифт;
       	ОформлениеСтроки.Ячейки.ДоляЯШТ_л.ЦветТекста =  webцвета.Синий;
       	ОформлениеСтроки.Ячейки.ДоляЯШТ_з.ЦветТекста =  webцвета.Синий;
       	ОформлениеСтроки.Ячейки.ДоляЯШТ.ЦветТекста =  webцвета.Синий;

	
		Если ОформлениеСтроки.ДанныеСтроки.Прозрачность.Этогруппа Тогда
			ОформлениеСтроки.Шрифт = мЖирныйШрифт;
        конецЕсли;
		Если ЗначениеЗаполнено(ОформлениеСтроки.ДанныеСтроки.Прозрачность) и ЗначениеЗаполнено(ОформлениеСтроки.ДанныеСтроки.Производитель)Тогда
			ОформлениеСтроки.Ячейки.Прозрачность.Текст = "";
			ОформлениеСтроки.Ячейки.Прозрачность.толькоПросмотр = Истина;
			Если ОформлениеСтроки.ДанныеСтроки.Прозрачность.принадлежитЭлементу(Справочники.ПрозрачностьКонтрагентов.Шины) тогда
				ОформлениеСтроки.Ячейки.доляЯШТ.толькоПросмотр = Истина;
			иначе
				ОформлениеСтроки.Ячейки.доляЯШТ_л.толькоПросмотр = Истина;
				ОформлениеСтроки.Ячейки.доляЯШТ_з.толькоПросмотр = Истина;
			конецЕсли;
		иначе	
			Для каждого Ячейка из ОформлениеСтроки.Ячейки Цикл
				Ячейка.ТолькоПросмотр = Истина;
			конецЦикла;
			ОформлениеСтроки.Ячейки.Прозрачность.толькоПросмотр = Ложь;
			Если ОформлениеСтроки.ДанныеСтроки.Прозрачность.принадлежитЭлементу(Справочники.ПрозрачностьКонтрагентов.Шины) тогда
				ОформлениеСтроки.Ячейки.доляЯШТ_л.толькоПросмотр =Ложь;
				ОформлениеСтроки.Ячейки.доляЯШТ_з.толькоПросмотр =Ложь;
			иначе
				ОформлениеСтроки.Ячейки.доляЯШТ.толькоПросмотр =Ложь;
			конецЕсли;
		конецЕсли;	
	конецЦикла;	
		ЭлементыФормы.Дерево.Колонки.ДоляЯШТ_л.Видимость = Клиент;
	    ЭлементыФормы.Дерево.Колонки.ДоляЯШТ_з.Видимость = Клиент;
		ЭлементыФормы.Дерево.Колонки.ДоляЯШТ.Видимость = Клиент;

КонецПроцедуры

Процедура ПрозрачностьПроизводительНачалоВыбораИзСписка(Элемент, СтандартнаяОбработка)
	// Вставить содержимое обработчика.
КонецПроцедуры

Процедура ПрозрачностьУровеньЗакупокНачалоВыбораИзСписка(Элемент, СтандартнаяОбработка)
	Если Элемент.списокВыбора.Количество()>0 Тогда
	Элемент.списокВыбора.Очистить();
    конецЕсли;
    Элемент.СписокВыбора.Добавить("дилер");
    Элемент.СписокВыбора.Добавить("субдилер");
    Элемент.СписокВыбора.Добавить("покупает у субдилера");
    Элемент.СписокВыбора.Добавить("не закупают");
КонецПроцедуры

Процедура ПрозрачностьСистемаРаботыНачалоВыбораИзСписка(Элемент, СтандартнаяОбработка)
	Если Элемент.списокВыбора.Количество()>0 Тогда
	Элемент.списокВыбора.Очистить();
    конецЕсли;
    Элемент.СписокВыбора.Добавить("По сезонным заказам");
    Элемент.СписокВыбора.Добавить("В текущем режиме");
    Элемент.СписокВыбора.Добавить("По сезонным + текущий режим");
КонецПроцедуры

Процедура ПрозрачностьОсновнойПоставщикНачалоВыбораИзСписка(Элемент, СтандартнаяОбработка)
	Если Элемент.списокВыбора.Количество()>0 Тогда
		Элемент.списокВыбора.Очистить();
	конецЕсли;
	Если ЭлементыФормы.Дерево.ТекущаяСтрока.Родитель.Прозрачность.Родитель.наименование = "Диски" Тогда
		Элемент.СписокВыбора.Добавить("KFZ");
		Элемент.СписокВыбора.Добавить("Mefro");
		Элемент.СписокВыбора.Добавить("TG-Racing");
		Элемент.СписокВыбора.Добавить("АвтоАльянс");
		Элемент.СписокВыбора.Добавить("Автошинснаб");
		Элемент.СписокВыбора.Добавить("Азов-Тэк");
		Элемент.СписокВыбора.Добавить("Бринекс");
		Элемент.СписокВыбора.Добавить("Вирбак");
		Элемент.СписокВыбора.Добавить("ВМ Авто (VMauto)");
		Элемент.СписокВыбора.Добавить("Восход");
		Элемент.СписокВыбора.Добавить("Город Колес");
		Элемент.СписокВыбора.Добавить("Диск М (Течлайн)");
		Элемент.СписокВыбора.Добавить("Дискавери");
		Элемент.СписокВыбора.Добавить("Диски Супер"); 
		Элемент.СписокВыбора.Добавить("Дископтим"); 
		Элемент.СписокВыбора.Добавить("Евродиски");
		Элемент.СписокВыбора.Добавить("Зелёная Шина (Пауэр) ");
		Элемент.СписокВыбора.Добавить("Лантратов ИП (R17.ru)");
		Элемент.СписокВыбора.Добавить("КиК");
		Элемент.СписокВыбора.Добавить("Колесный Ряд");
		Элемент.СписокВыбора.Добавить("Колесо (Москва)");
		Элемент.СписокВыбора.Добавить("Кременчуг");
		Элемент.СписокВыбора.Добавить("Кроун Диски");
		Элемент.СписокВыбора.Добавить("Лига-тайрес");
		Элемент.СписокВыбора.Добавить("МВ Кингисепп (Magnetto)");
		Элемент.СписокВыбора.Добавить("Мир Колес (Самара)");
		Элемент.СписокВыбора.Добавить("МК Сервис (Колёсный Ряд)");
		Элемент.СписокВыбора.Добавить("Орбис (Русские аллюминиевые диски)"); 
		Элемент.СписокВыбора.Добавить("Пауэр");
		Элемент.СписокВыбора.Добавить("Регионшинснаб");
		Элемент.СписокВыбора.Добавить("Римекс");
		Элемент.СписокВыбора.Добавить("Ро-са (Sakura-wheels) (Владивосток)");
		Элемент.СписокВыбора.Добавить("Русские алюминиевые диски");
		Элемент.СписокВыбора.Добавить("Север-Авто"); 
		Элемент.СписокВыбора.Добавить("Скад");
		Элемент.СписокВыбора.Добавить("Слик");
		Элемент.СписокВыбора.Добавить("ТЗСК");
		Элемент.СписокВыбора.Добавить("Фортис");
		Элемент.СписокВыбора.Добавить("Хорошие Колёса");
		Элемент.СписокВыбора.Добавить("Шале");
		Элемент.СписокВыбора.Добавить("Шининвест");
		Элемент.СписокВыбора.Добавить("Юнипол");
		Элемент.СписокВыбора.Добавить("Яршинторг");

	ИначеЕсли ЭлементыФормы.Дерево.ТекущаяСтрока.Родитель.Прозрачность.Родитель.наименование = "Шины" Тогда
		Элемент.СписокВыбора.Добавить("Авигард");
		Элемент.СписокВыбора.Добавить("Автошинкомплект");
		Элемент.СписокВыбора.Добавить("Автошинснаб");
		Элемент.СписокВыбора.Добавить("Автоэксперт");
		Элемент.СписокВыбора.Добавить("Ай-ти-ар");
		Элемент.СписокВыбора.Добавить("Бринэкс");
		Элемент.СписокВыбора.Добавить("Веллс");
		Элемент.СписокВыбора.Добавить("Вершина");
		Элемент.СписокВыбора.Добавить("Вианор");
		Элемент.СписокВыбора.Добавить("Вирбак"); 
		Элемент.СписокВыбора.Добавить("Восход");
		Элемент.СписокВыбора.Добавить("Дакар (ИП Лагерной)");
		Элемент.СписокВыбора.Добавить("Дарус");
		Элемент.СписокВыбора.Добавить("Евродиски (Юлтэк)");
		Элемент.СписокВыбора.Добавить("Зелёная Шина (Пауэр)"); 
		Элемент.СписокВыбора.Добавить("Калиновский");
		Элемент.СписокВыбора.Добавить("Кама ТД");
		Элемент.СписокВыбора.Добавить("Кама-СПБ");
		Элемент.СписокВыбора.Добавить("КАМА-Урал");
		Элемент.СписокВыбора.Добавить("КАМА-Юг");
		Элемент.СписокВыбора.Добавить("Колобокс");
		Элемент.СписокВыбора.Добавить("Лантратов ИП (R17.ru)");
		Элемент.СписокВыбора.Добавить("Ласерта");
		Элемент.СписокВыбора.Добавить("Лига-тайрес");
		Элемент.СписокВыбора.Добавить("Линарис");
		Элемент.СписокВыбора.Добавить("Мишлен");
		Элемент.СписокВыбора.Добавить("Муханов");
		Элемент.СписокВыбора.Добавить("Нокиан Тайерс"); 
		Элемент.СписокВыбора.Добавить("Паскер");
		Элемент.СписокВыбора.Добавить("Пауэр");
		Элемент.СписокВыбора.Добавить("Петромакс"); 
		Элемент.СписокВыбора.Добавить("Петрошина"); 
		Элемент.СписокВыбора.Добавить("ПИН");
		Элемент.СписокВыбора.Добавить("ПОШК"); 
		Элемент.СписокВыбора.Добавить("Псковшина");
		Элемент.СписокВыбора.Добавить("Радуга (Колесо)");
		Элемент.СписокВыбора.Добавить("Регионшинснаб");
		Элемент.СписокВыбора.Добавить("Римэкс");
		Элемент.СписокВыбора.Добавить("Рустрейд");
		Элемент.СписокВыбора.Добавить("РусШина Питер (Автоэксперт)"); 
		Элемент.СписокВыбора.Добавить("Север-Авто"); 
		Элемент.СписокВыбора.Добавить("Север-Шина");
		Элемент.СписокВыбора.Добавить("Семисотнов");
		Элемент.СписокВыбора.Добавить("Такабаев");
		Элемент.СписокВыбора.Добавить("Трек"); 
		Элемент.СписокВыбора.Добавить("Тюменская шинная компания");
		Элемент.СписокВыбора.Добавить("Форсаж (Камтех)"); 
		Элемент.СписокВыбора.Добавить("Хорошие Колёса"); 
		Элемент.СписокВыбора.Добавить("Шинавтотрейд");
		Элемент.СписокВыбора.Добавить("Шининвест");
		Элемент.СписокВыбора.Добавить("Шинсервис");
		Элемент.СписокВыбора.Добавить("Эксклюзив"); 
		Элемент.СписокВыбора.Добавить("Южная шинная компания"); 
		Элемент.СписокВыбора.Добавить("Юнипол"); 
		Элемент.СписокВыбора.Добавить("Яршинторг");
		
		//тольятти
		Элемент.СписокВыбора.Добавить("Кама Самара ООО");
		Элемент.СписокВыбора.Добавить("Сабун ООО = Автодиск");
		Элемент.СписокВыбора.Добавить("Игрес ООО");
		Элемент.СписокВыбора.Добавить("Белшина Нижегородский ТД");
		Элемент.СписокВыбора.Добавить("Веха-Мастер ООО");
		Элемент.СписокВыбора.Добавить("АвтошинСнаб Корпорация ООО");
		Элемент.СписокВыбора.Добавить("Компания ШинТрейд ООО");
		Элемент.СписокВыбора.Добавить("Евро Групп ООО");
		Элемент.СписокВыбора.Добавить("Кордиант");
		Элемент.СписокВыбора.Добавить("Мир Колес");
		Элемент.СписокВыбора.Добавить("Нортек");
		Элемент.СписокВыбора.Добавить("Поволжская Шинная Компания");
		Элемент.СписокВыбора.Добавить("Автолюбитель (Kolex)");
		Элемент.СписокВыбора.Добавить("Прада (масла, шина)");
		Элемент.СписокВыбора.Добавить("Шинный двор");
		Элемент.СписокВыбора.Добавить("Регион Опт");
		Элемент.СписокВыбора.Добавить("Глобал Авто");
		Элемент.СписокВыбора.Добавить("Волга Транс (Ульяновск)");
		Элемент.СписокВыбора.Добавить("Автодиск ТД");
		
		
		
		
		
		
		
		
		
		
		
		
		
		
	ИначеЕсли ЭлементыФормы.Дерево.ТекущаяСтрока.Родитель.Прозрачность.Родитель.наименование = "АКБ" Тогда
		Элемент.СписокВыбора.Добавить(" AKUMARKET NRG");
		Элемент.СписокВыбора.Добавить("АБК Маркет"); 
		Элемент.СписокВыбора.Добавить("Автобат Ярославль");
		Элемент.СписокВыбора.Добавить("Автоюнион МСК");
		Элемент.СписокВыбора.Добавить("Агротехснаб");
		Элемент.СписокВыбора.Добавить("АКБ +");
		Элемент.СписокВыбора.Добавить("АКБ Торг"); 
		Элемент.СписокВыбора.Добавить("Аком Люберцы");
		Элемент.СписокВыбора.Добавить("Армтек");
		Элемент.СписокВыбора.Добавить("Атлант МСК");
		Элемент.СписокВыбора.Добавить("БатБаза");
		Элемент.СписокВыбора.Добавить("Веста");
		Элемент.СписокВыбора.Добавить("Вирбак");
		Элемент.СписокВыбора.Добавить("Восток");
		Элемент.СписокВыбора.Добавить("Восход");
		Элемент.СписокВыбора.Добавить("Катод"); 
		Элемент.СписокВыбора.Добавить("Максион");
		Элемент.СписокВыбора.Добавить("МегаАрсенал");
		Элемент.СписокВыбора.Добавить("Новбат В.Новгород");
		Элемент.СписокВыбора.Добавить("НПН Нижний Новгород");
		Элемент.СписокВыбора.Добавить("Паскер");
		Элемент.СписокВыбора.Добавить("Планета Авто");
		Элемент.СписокВыбора.Добавить("Полюс + ");
		Элемент.СписокВыбора.Добавить("Русток МСК");
		Элемент.СписокВыбора.Добавить("Север-Юг Авто"); 
		Элемент.СписокВыбора.Добавить("Трейд Сервис");
		Элемент.СписокВыбора.Добавить("Тубор"); 
		Элемент.СписокВыбора.Добавить("Химсервис");
		Элемент.СписокВыбора.Добавить("Энергия");
		Элемент.СписокВыбора.Добавить("Южный порт (рынок)");
		Элемент.СписокВыбора.Добавить("Южуралаккумулятор");
		Элемент.СписокВыбора.Добавить("Яршинторг");
	Иначе //аксы
		Элемент.СписокВыбора.Добавить("AVSрегион");
		Элемент.СписокВыбора.Добавить("Azard"); 
		Элемент.СписокВыбора.Добавить("Grass");
		Элемент.СписокВыбора.Добавить("АБРО ТД");
		Элемент.СписокВыбора.Добавить("Авто-Компонент"); 
		Элемент.СписокВыбора.Добавить("Автокомфорт (ИП Фетисов)"); 
		Элемент.СписокВыбора.Добавить("Автомастер");
		Элемент.СписокВыбора.Добавить("Автопитер");
		Элемент.СписокВыбора.Добавить("Автопрофи");
		Элемент.СписокВыбора.Добавить("Автосвет");
		Элемент.СписокВыбора.Добавить("Автосоюз");
		Элемент.СписокВыбора.Добавить("Базис Трейд");
		Элемент.СписокВыбора.Добавить("Бизнеспартнер");
		Элемент.СписокВыбора.Добавить("Валерия");
		Элемент.СписокВыбора.Добавить("Вера");
		Элемент.СписокВыбора.Добавить("Веста Ойл");
		Элемент.СписокВыбора.Добавить("Винс");
		Элемент.СписокВыбора.Добавить("Восток");
		Элемент.СписокВыбора.Добавить("Восход");
		Элемент.СписокВыбора.Добавить("ИП Ефимычев (Ярославль)"); 
		Элемент.СписокВыбора.Добавить("Колесо Фортуны"); 
		Элемент.СписокВыбора.Добавить("Лубримекс ТФ");
		Элемент.СписокВыбора.Добавить("ОйлСити (ИП Ломакина)"); 
		Элемент.СписокВыбора.Добавить("Оптовый Город"); 
		Элемент.СписокВыбора.Добавить("Паскер");
		Элемент.СписокВыбора.Добавить("Планета Авто");
		Элемент.СписокВыбора.Добавить("Почин Авто"); 
		Элемент.СписокВыбора.Добавить("Росавтопром");
		Элемент.СписокВыбора.Добавить("РубежСевероЗапад");
		Элемент.СписокВыбора.Добавить("Садолин-Юг");
		Элемент.СписокВыбора.Добавить("Селена");
		Элемент.СписокВыбора.Добавить("СпортАвто");
		Элемент.СписокВыбора.Добавить("Техноресурс");
		Элемент.СписокВыбора.Добавить("УниверсалАвтоПлюс");
		Элемент.СписокВыбора.Добавить("ХАДО");
		Элемент.СписокВыбора.Добавить("Чистая сила");
		Элемент.СписокВыбора.Добавить("Южный порт (рынок)");
		Элемент.СписокВыбора.Добавить("Яршинторг");

	конецЕсли;
КонецПроцедуры

Процедура КоманднаяПанель1Заполнить(Кнопка)

	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.Прозрачность,
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.Производитель,
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.УровеньЗакупок,
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.СистемаРаботы,
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.ОсновнойПоставщик,
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.КоличествоГодовойОбъем,
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.СуммаГодовойОбъем,
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.КоличествоЯШТ,
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.СуммаЯШТ
		|ПОМЕСТИТЬ ДопИнфо
		|ИЗ
		|	Справочник.ДополнительнаяИнформацияПоКонтрагентам.ПрозрачностьКонтрагента КАК ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента
		|ГДЕ
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.Ссылка = &Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПрозрачностьКонтрагентовПроизводители.Ссылка КАК Прозрачность,
		|	ПрозрачностьКонтрагентовПроизводители.Производитель,
		|	ЕСТЬNULL(ДопИнфо.УровеньЗакупок, ""                         "") КАК УровеньЗакупок,
		|	ЕСТЬNULL(ДопИнфо.СистемаРаботы, ""                         "") КАК СистемаРаботы,
		|	ЕСТЬNULL(ДопИнфо.ОсновнойПоставщик, ""                                                  "") КАК ОсновнойПоставщик,
		|	ЕСТЬNULL(ДопИнфо.КоличествоГодовойОбъем, 0) КАК КоличествоГодовойОбъем,
		|	ЕСТЬNULL(ДопИнфо.СуммаГодовойОбъем, 0) КАК СуммаГодовойОбъем,
		|	ЕСТЬNULL(ДопИнфо.КоличествоЯШТ, 0) КАК КоличествоЯШТ,
		|	ЕСТЬNULL(ДопИнфо.СуммаЯШТ, 0) КАК СуммаЯШТ
		|ИЗ
		|	Справочник.ПрозрачностьКонтрагентов.Производители КАК ПрозрачностьКонтрагентовПроизводители
		|		ЛЕВОЕ СОЕДИНЕНИЕ ДопИнфо КАК ДопИнфо
		|		ПО ПрозрачностьКонтрагентовПроизводители.Ссылка = ДопИнфо.Прозрачность
		|			И ПрозрачностьКонтрагентовПроизводители.Производитель = ДопИнфо.Производитель
		|ИТОГИ ПО
		|	Прозрачность ИЕРАРХИЯ";

		Запрос.УстановитьПараметр("Ссылка",ссылка);
		Результат = Запрос.Выполнить();

	Дерево = Результат.Выгрузить(ОбходРезультатаЗапроса.ПоГруппировкам);


КонецПроцедуры

Процедура ДеревоУровеньЗакупокОкончаниеВводаТекста(Элемент, Текст, Значение, СтандартнаяОбработка)
	к=1;
КонецПроцедуры

Процедура ДеревоСистемаРаботыПриИзменении(Элемент)
ЗаполнитьЭлемент(Элемент);	
КонецПроцедуры

процедура ЗаполнитьЭлемент(Элемент)
	
	
	текСтрока = ЭлементыФормы.Дерево.ТекущиеДанные;
	Отбор = Новый Структура();
	Отбор.Вставить("Прозрачность",текСтрока.Прозрачность);
	Отбор.Вставить("Производитель",текСтрока.Производитель);
	Отбор.Вставить("Год",Год);
	Отбор.Вставить("Полугодие",Полугодие);
	Строки = Прозрачностьконтрагента.НайтиСтроки(Отбор);
	Если строки.Количество()> 0 Тогда //меняем существующую строку
		попытка
			строки[0][ЭлементыФормы.Дерево.ТекущаяКолонка.Имя] = Элемент.значение;
		исключение      
		конецПопытки;
		Если ЭлементыФормы.Дерево.ТекущаяКолонка.Имя = "КоличествоЛето" или  ЭлементыФормы.Дерево.ТекущаяКолонка.Имя = "КоличествоЗима" Тогда
			строки[0].КоличествоГодовойОбъем = строки[0].КоличествоЛето+строки[0].КоличествоЗима;	
			ЭлементыФормы.Дерево.ТекущаяСтрока.КоличествоГодовойОбъем =  строки[0].КоличествоЛето+строки[0].КоличествоЗима;	
		конецЕсли;
		Если ЭлементыФормы.Дерево.ТекущаяКолонка.Имя = "КоличествоЛетоЯШТ" или  ЭлементыФормы.Дерево.ТекущаяКолонка.Имя = "КоличествоЗимаЯШТ" Тогда
			строки[0].КоличествоЯШТ = строки[0].КоличествоЛетоЯШТ+строки[0].КоличествоЗимаЯШТ;	
			ЭлементыФормы.Дерево.ТекущаяСтрока.КоличествоЯШТ =  строки[0].КоличествоЛетоЯШТ+строки[0].КоличествоЗимаЯШТ;	
		конецЕсли;

		
		Если ЭлементыФормы.Дерево.ТекущаяКолонка.Имя = "ДоляЯШТ_л" Тогда
			если текСтрока.ДоляЯШТ_л =0 тогда
				строки[0].КоличествоЛето = 0;
				ЭлементыФормы.Дерево.ТекущаяСтрока.КоличествоЛето = 0;
			иначе
				строки[0].КоличествоЛето = Окр(строки[0].КоличествоЛетоЯШТ/текСтрока.ДоляЯШТ_л*100,0);
				ЭлементыФормы.Дерево.ТекущаяСтрока.КоличествоЛето = Окр(строки[0].КоличествоЛетоЯШТ/текСтрока.ДоляЯШТ_л*100,0);
			конецЕсли;
			строки[0].КоличествоГодовойОбъем = строки[0].КоличествоЛето+строки[0].КоличествоЗима;
			ЭлементыФормы.Дерево.ТекущаяСтрока.КоличествоГодовойОбъем =  строки[0].КоличествоЛето+строки[0].КоличествоЗима;	

		конецЕсли;	
		Если ЭлементыФормы.Дерево.ТекущаяКолонка.Имя = "ДоляЯШТ_з"  Тогда
			если текСтрока.ДоляЯШТ_з =0 тогда
				строки[0].КоличествоЗима = 0;
				ЭлементыФормы.Дерево.ТекущаяСтрока.КоличествоЗима = 0;
			иначе
				строки[0].КоличествоЗима = Окр(строки[0].КоличествоЗимаЯШТ/текСтрока.ДоляЯШТ_з*100,0);
				ЭлементыФормы.Дерево.ТекущаяСтрока.КоличествоЗима = Окр(строки[0].КоличествоЗимаЯШТ/текСтрока.ДоляЯШТ_з*100,0);
			конецЕсли;
			строки[0].КоличествоГодовойОбъем = строки[0].КоличествоЛето+строки[0].КоличествоЗима;
			ЭлементыФормы.Дерево.ТекущаяСтрока.КоличествоГодовойОбъем =  строки[0].КоличествоЛето+строки[0].КоличествоЗима;	
	
		конецЕсли;	
		Если ЭлементыФормы.Дерево.ТекущаяКолонка.Имя = "ДоляЯШТ"  Тогда
			Если текСтрока.ДоляЯШТ =0 тогда
				строки[0].КоличествоГодовойОбъем =0;
				ЭлементыФормы.Дерево.ТекущаяСтрока.КоличествоГодовойОбъем =0;
			иначе
				строки[0].КоличествоГодовойОбъем = Окр(строки[0].КоличествоЯШТ/текСтрока.ДоляЯШТ*100,0);
				ЭлементыФормы.Дерево.ТекущаяСтрока.КоличествоГодовойОбъем =  Окр(строки[0].КоличествоЯШТ/текСтрока.ДоляЯШТ*100,0);	
	
			конецЕсли;
		конецЕсли;	
	иначе	
		Строка = Прозрачностьконтрагента.Добавить();
		Строка.Год = Год;
		Строка.Полугодие = Полугодие;
		Строка.Прозрачность = текСтрока.Прозрачность;
		Строка.Производитель = текСтрока.Производитель;
		попытка
		строка[ЭлементыФормы.Дерево.ТекущаяКолонка.Имя] = Элемент.значение;
	    исключение
		конецПопытки;
		//проверим это строка или группа
		если текСтрока.Строки.Количество()=0 тогда
			Если ЭлементыФормы.Дерево.ТекущаяКолонка.Имя = "КоличествоЛето" или  ЭлементыФормы.Дерево.ТекущаяКолонка.Имя = "КоличествоЗима" Тогда
				строка.КоличествоГодовойОбъем = строка.КоличествоЛето+строка.КоличествоЗима;
				ЭлементыФормы.Дерево.ТекущаяСтрока.КоличествоГодовойОбъем =  строка.КоличествоЛето+строка.КоличествоЗима;
			конецЕсли;	
			Если ЭлементыФормы.Дерево.ТекущаяКолонка.Имя = "КоличествоЛетоЯШТ" или  ЭлементыФормы.Дерево.ТекущаяКолонка.Имя = "КоличествоЗимаЯШТ" Тогда
				строка.КоличествоЯШТ = строка.КоличествоЛетоЯШТ+строка.КоличествоЗимаЯШТ;
				ЭлементыФормы.Дерево.ТекущаяСтрока.КоличествоЯШТ =  строка.КоличествоЛетоЯШТ+строка.КоличествоЗимаЯШТ;
			конецЕсли;			
			Если ЭлементыФормы.Дерево.ТекущаяКолонка.Имя = "ДоляЯШТ_л" Тогда
				если текСтрока.ДоляЯШТ_л =0 тогда
					Строка.КоличествоЛето = 0;
				иначе
					Строка.КоличествоЛето = Окр(Строка.КоличествоЛетоЯШТ/текСтрока.ДоляЯШТ_л*100,0);
				конецЕсли;
				Строка.КоличествоГодовойОбъем = Строка.КоличествоЛето+строки[0].КоличествоЗима;
			конецЕсли;	
			Если ЭлементыФормы.Дерево.ТекущаяКолонка.Имя = "ДоляЯШТ_з"  Тогда
				если текСтрока.ДоляЯШТ_з =0 тогда
					Строка.КоличествоЗима = 0;
				иначе
					Строка.КоличествоЗима = Окр(Строка.КоличествоЗимаЯШТ/текСтрока.ДоляЯШТ_з*100,0);
				конецЕсли;
				Строка.КоличествоГодовойОбъем = Строка.КоличествоЛето+Строка.КоличествоЗима;
			конецЕсли;	
			Если ЭлементыФормы.Дерево.ТекущаяКолонка.Имя = "ДоляЯШТ"  Тогда
				Если текСтрока.ДоляЯШТ =0 тогда
					Строка.КоличествоГодовойОбъем =0;
				иначе
					Строка.КоличествоГодовойОбъем = Окр(Строка.КоличествоЯШТ/текСтрока.ДоляЯШТ*100,0);
				конецЕсли;
			конецЕсли;
		иначе
			Если ЭлементыФормы.Дерево.ТекущаяКолонка.Имя = "ДоляЯШТ_л" Тогда
				если текСтрока.ДоляЯШТ_л =0 тогда
					текСтрока.КоличествоЛето = 0;
				иначе
					текСтрока.КоличествоЛето = Окр(текСтрока.КоличествоЛетоЯШТ/текСтрока.ДоляЯШТ_л*100,0);
				конецЕсли;
				текСтрока.КоличествоГодовойОбъем = текСтрока.КоличествоЛето+текСтрока.КоличествоЗима;
				для каждого стр из текСтрока.Строки цикл
					стр.ДоляЯШТ_л = текСтрока.ДоляЯШТ_л;
					
					Отбор = Новый Структура();
					Отбор.Вставить("Прозрачность",стр.Прозрачность);
					Отбор.Вставить("Производитель",стр.Производитель);
					Отбор.Вставить("Год",Год);
					Отбор.Вставить("Полугодие",Полугодие);
					СтрокиСтр = Прозрачностьконтрагента.НайтиСтроки(Отбор);
					Если СтрокиСтр.Количество()>0 Тогда	
						если стр.ДоляЯШТ_л =0 тогда
							СтрокиСтр[0].КоличествоЛето = 0;
						иначе
							СтрокиСтр[0].КоличествоЛето = Окр(СтрокиСтр[0].КоличествоЛетоЯШТ/стр.ДоляЯШТ_л*100,0);
							стр.КоличествоЛето = Окр(стр.КоличествоЛетоЯШТ/стр.ДоляЯШТ_л*100,0);

						конецЕсли;
						СтрокиСтр[0].КоличествоГодовойОбъем = СтрокиСтр[0].КоличествоЛето+СтрокиСтр[0].КоличествоЗима;
						стр.КоличествоГодовойОбъем = стр.КоличествоЛето+стр.КоличествоЗима;
					конецЕсли;
				конецЦикла;	
			конецЕсли;	
			Если ЭлементыФормы.Дерево.ТекущаяКолонка.Имя = "ДоляЯШТ_з"  Тогда
				если текСтрока.ДоляЯШТ_з =0 тогда
					текСтрока.КоличествоЗима = 0;
				иначе
					текСтрока.КоличествоЗима = Окр(текСтрока.КоличествоЗимаЯШТ/текСтрока.ДоляЯШТ_з*100,0);
				конецЕсли;
				текСтрока.КоличествоГодовойОбъем = текСтрока.КоличествоЛето+текСтрока.КоличествоЗима;
				для каждого стр из текСтрока.Строки цикл
					стр.ДоляЯШТ_з = текСтрока.ДоляЯШТ_з;
					
					Отбор = Новый Структура();
					Отбор.Вставить("Прозрачность",стр.Прозрачность);
					Отбор.Вставить("Производитель",стр.Производитель);
					Отбор.Вставить("Год",Год);
					Отбор.Вставить("Полугодие",Полугодие);
					СтрокиСтр = Прозрачностьконтрагента.НайтиСтроки(Отбор);
					Если СтрокиСтр.Количество()>0 Тогда	
						если стр.ДоляЯШТ_з =0 тогда
							СтрокиСтр[0].КоличествоЗима = 0;
						иначе
							СтрокиСтр[0].КоличествоЗима = Окр(СтрокиСтр[0].КоличествоЗимаЯШТ/стр.ДоляЯШТ_з*100,0);
							стр.КоличествоЗима = Окр(стр.КоличествоЗимаЯШТ/стр.ДоляЯШТ_з*100,0);
						конецЕсли;
						СтрокиСтр[0].КоличествоГодовойОбъем = СтрокиСтр[0].КоличествоЛето+СтрокиСтр[0].КоличествоЗима;
						стр.КоличествоГодовойОбъем = стр.КоличествоЛето+стр.КоличествоЗима;
					конецесли;
				конецЦикла;	
			конецЕсли;	
			Если ЭлементыФормы.Дерево.ТекущаяКолонка.Имя = "ДоляЯШТ"  Тогда
				Если текСтрока.ДоляЯШТ =0 тогда
					текСтрока.КоличествоГодовойОбъем =0;
				иначе
					текСтрока.КоличествоГодовойОбъем = Окр(текСтрока.КоличествоЯШТ/текСтрока.ДоляЯШТ*100,0);
				конецЕсли;
				для каждого стр из текСтрока.Строки цикл
					стр.ДоляЯШТ = текСтрока.ДоляЯШТ;
					
					Отбор = Новый Структура();
					Отбор.Вставить("Прозрачность",стр.Прозрачность);
					Отбор.Вставить("Производитель",стр.Производитель);
					Отбор.Вставить("Год",Год);
					Отбор.Вставить("Полугодие",Полугодие);
					СтрокиСтр = Прозрачностьконтрагента.НайтиСтроки(Отбор);
					
					Если СтрокиСтр.Количество()>0 Тогда	
						Если стр.ДоляЯШТ =0 тогда
							СтрокиСтр[0].КоличествоГодовойОбъем =0;
							стр.КоличествоГодовойОбъем =0;
						иначе
							СтрокиСтр[0].КоличествоГодовойОбъем = Окр(СтрокиСтр[0].КоличествоЯШТ/стр.ДоляЯШТ*100,2);
							стр.КоличествоГодовойОбъем = Окр(стр.КоличествоЯШТ/стр.ДоляЯШТ*100,0);
						конецЕсли;
					конецЕсли;
				конецЦикла;	
			конецЕсли;	
			
		конецЕсли;
		
	конецЕсли;	
	
конецПроцедуры	


Процедура ДеревоУровеньЗакупокПриИзменении(Элемент)
	ЗаполнитьЭлемент(Элемент);	
КонецПроцедуры


Процедура ДеревоОсновнойПоставщикПриИзменении(Элемент)
	ЗаполнитьЭлемент(Элемент);	
КонецПроцедуры


Процедура ДеревоКоличествоГодовойОбъемПриИзменении(Элемент)
	ЗаполнитьЭлемент(Элемент);	
КонецПроцедуры


Процедура ДеревоСуммаГодовойОбъемПриИзменении(Элемент)
	ЗаполнитьЭлемент(Элемент);	
КонецПроцедуры


Процедура ДеревоколичествоЯШТПриИзменении(Элемент)
	ЗаполнитьЭлемент(Элемент);	
КонецПроцедуры


Процедура ДеревоСуммаЯШТПриИзменении(Элемент)
	ЗаполнитьЭлемент(Элемент);	
КонецПроцедуры


Процедура ПриОткрытии()
	Год = "2016";
	Полугодие = "целый год";
	ЗаполнитьДерево();
	ЭлементыФормы.Основная.ТекущаяСтраница = ЭлементыФормы.Основная.Страницы.Прозрачность;
	ЭлементыФормы.Дерево.Колонки.ДоляЯШТ_л.Видимость = Ложь;
	ЭлементыФормы.Дерево.Колонки.ДоляЯШТ_з.Видимость = Ложь;
	ЭлементыФормы.Дерево.Колонки.ДоляЯШТ.Видимость = Ложь;
КонецПроцедуры

процедура ЗаполнитьДерево()
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.Прозрачность,
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.Производитель,
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.УровеньЗакупок,
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.СистемаРаботы,
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.ОсновнойПоставщик,
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.КоличествоГодовойОбъем,
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.СуммаГодовойОбъем,
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.КоличествоЯШТ,
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.СуммаЯШТ,
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.КоличествоЛето,
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.КоличествоЗима,
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.КоличествоЛетоЯШТ,
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.КоличествоЗимаЯШТ
		|ПОМЕСТИТЬ ДопИнфо
		|ИЗ
		|	Справочник.ДополнительнаяИнформацияПоКонтрагентам.ПрозрачностьКонтрагента КАК ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента
		|ГДЕ
		|	ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.Ссылка = &Ссылка
		|	И ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.Год = &Год
		|	И ДополнительнаяИнформацияПоКонтрагентамПрозрачностьКонтрагента.Полугодие = &Полугодие
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПрозрачностьКонтрагентовПроизводители.Ссылка КАК Прозрачность,
		|	ПрозрачностьКонтрагентовПроизводители.Производитель,
		|	ЕСТЬNULL(ДопИнфо.УровеньЗакупок, ""                         "") КАК УровеньЗакупок,
		|	ЕСТЬNULL(ДопИнфо.СистемаРаботы, ""                         "") КАК СистемаРаботы,
		|	ЕСТЬNULL(ДопИнфо.ОсновнойПоставщик, ""                                                  "") КАК ОсновнойПоставщик,
		|	ЕСТЬNULL(ДопИнфо.КоличествоГодовойОбъем, 0) КАК КоличествоГодовойОбъем,
		|	ЕСТЬNULL(ДопИнфо.СуммаГодовойОбъем, 0) КАК СуммаГодовойОбъем,
		|	ЕСТЬNULL(ДопИнфо.КоличествоЯШТ, 0) КАК КоличествоЯШТ,
		|	ЕСТЬNULL(ДопИнфо.СуммаЯШТ, 0) КАК СуммаЯШТ,
		|	ЕСТЬNULL(ДопИнфо.КоличествоЛето, 0) КАК КоличествоЛето,
		|	ЕСТЬNULL(ДопИнфо.КоличествоЗима, 0) КАК КоличествоЗима,
		|	ЕСТЬNULL(ДопИнфо.КоличествоЛетоЯШТ, 0) КАК КоличествоЛетоЯШТ,
		|	ЕСТЬNULL(ДопИнфо.КоличествоЗимаЯШТ, 0) КАК КоличествоЗимаЯШТ,
		|	ВЫБОР
		|		КОГДА ЕСТЬNULL(ДопИнфо.КоличествоЛето, 0) = 0
		|			ТОГДА 0
		|		ИНАЧЕ ЕСТЬNULL(ДопИнфо.КоличествоЛетоЯШТ, 0) / ЕСТЬNULL(ДопИнфо.КоличествоЛето, 0) * 100
		|	КОНЕЦ КАК ДоляЯШТ_л,
		|	ВЫБОР
		|		КОГДА ЕСТЬNULL(ДопИнфо.КоличествоЗима, 0) = 0
		|			ТОГДА 0
		|		ИНАЧЕ ЕСТЬNULL(ДопИнфо.КоличествоЗимаЯШТ, 0) / ЕСТЬNULL(ДопИнфо.КоличествоЗима, 0) * 100
		|	КОНЕЦ КАК ДоляЯШТ_з,
		|	ВЫБОР
		|		КОГДА ЕСТЬNULL(ДопИнфо.КоличествоГодовойОбъем, 0) = 0
		|			ТОГДА 0
		|		ИНАЧЕ ЕСТЬNULL(ДопИнфо.КоличествоЯШТ, 0) / ЕСТЬNULL(ДопИнфо.КоличествоГодовойОбъем, 0) * 100
		|	КОНЕЦ КАК ДоляЯШТ
		|ИЗ
		|	Справочник.ПрозрачностьКонтрагентов.Производители КАК ПрозрачностьКонтрагентовПроизводители
		|		ЛЕВОЕ СОЕДИНЕНИЕ ДопИнфо КАК ДопИнфо
		|		ПО ПрозрачностьКонтрагентовПроизводители.Ссылка = ДопИнфо.Прозрачность
		|			И ПрозрачностьКонтрагентовПроизводители.Производитель = ДопИнфо.Производитель
		|ИТОГИ
		|	СУММА(КоличествоГодовойОбъем),
		|	СУММА(СуммаГодовойОбъем),
		|	СУММА(КоличествоЯШТ),
		|	СУММА(СуммаЯШТ),
		|	СУММА(КоличествоЛето),
		|	СУММА(КоличествоЗима),
		|	СУММА(КоличествоЛетоЯШТ),
		|	СУММА(КоличествоЗимаЯШТ),
		|	ВЫБОР
		|		КОГДА СУММА(КоличествоЛето) = 0
		|			ТОГДА 0
		|		ИНАЧЕ СУММА(КоличествоЛетоЯШТ) / СУММА(КоличествоЛето) * 100
		|	КОНЕЦ КАК ДоляЯШТ_л,
		|	ВЫБОР
		|		КОГДА СУММА(КоличествоЗима) = 0
		|			ТОГДА 0
		|		ИНАЧЕ СУММА(КоличествоЗимаЯШТ) / СУММА(КоличествоЗима) * 100
		|	КОНЕЦ КАК ДоляЯШТ_з,
		|	ВЫБОР
		|		КОГДА СУММА(КоличествоГодовойОбъем) = 0
		|			ТОГДА 0
		|		ИНАЧЕ СУММА(КоличествоЯШТ) / СУММА(КоличествоГодовойОбъем) * 100
		|	КОНЕЦ КАК ДоляЯШТ
		|ПО
		|	Прозрачность ИЕРАРХИЯ";

		Запрос.УстановитьПараметр("Ссылка",ссылка);
		Запрос.УстановитьПараметр("Год",Год);
		Запрос.УстановитьПараметр("Полугодие",Полугодие);

		Результат = Запрос.Выполнить();

	Дерево = Результат.Выгрузить(ОбходРезультатаЗапроса.ПоГруппировкам);
	
		отбор = Новый Структура;
		Отбор.Вставить("Год",Год);
		Отбор.Вставить("Полугодие",Полугодие);
        нужныеСтроки = ПрозрачностьКонтрагента.НайтиСтроки(Отбор);
		Если НужныеСтроки.Количество()>0 тогда
		клиент = НужныеСтроки[0].ПоданнымМенеджера;
	    конецЕсли;

конецПроцедуры	

Процедура ГодПриИзменении(Элемент)
	ЗаполнитьДерево();
КонецПроцедуры

Процедура ПолугодиеПриИзменении(Элемент)
	ЗаполнитьДерево();
КонецПроцедуры

Процедура ДеревоКоличествоЛетоПриИзменении(Элемент)
	ЗаполнитьЭлемент(Элемент);
КонецПроцедуры

Процедура ДеревоКоличествоЗимаПриИзменении(Элемент)
	ЗаполнитьЭлемент(Элемент);
КонецПроцедуры

Процедура ДеревоКоличествоЛетоЯШТПриИзменении(Элемент)
	ЗаполнитьЭлемент(Элемент);
КонецПроцедуры

Процедура ДеревоКоличествоЗимаЯШТПриИзменении(Элемент)
	ЗаполнитьЭлемент(Элемент);
КонецПроцедуры

Процедура ОсновнаяПриСменеСтраницы(Элемент, ТекущаяСтраница)
	Если  ЭлементыФормы.Основная.ТекущаяСтраница.имя = "СтатусыПоТоварнымГруппам"  тогда
		    СтатусыПоТоварнымГруппам.Отбор.Контрагент.ВидСравнения  = ВидСравнения.Равно;
			СтатусыПоТоварнымГруппам.Отбор.Контрагент.Использование = истина;
			СтатусыПоТоварнымГруппам.Отбор.Контрагент.Значение = Владелец ;
	конецЕсли;	
КонецПроцедуры

Процедура ЗаполнитьНажатие(Элемент)
	отбор = Новый Структура;
	Отбор.Вставить("Год",Год);
	Отбор.Вставить("Полугодие",Полугодие);
	нужныеСтроки = ПрозрачностьКонтрагента.НайтиСтроки(Отбор);
	Если НужныеСтроки.Количество()<2 Тогда
		Список = Новый списокЗначений();
		Список.Добавить(перечисления.ТипыСезонности.грузовые);
		Список.Добавить(перечисления.ТипыСезонности.сельхоз);

		СписокШин = Новый списокЗначений();
		СписокШин.Добавить(справочники.ПрозрачностьКонтрагентов.НайтиПоКоду("000000005"));
		СписокШин.Добавить(справочники.ПрозрачностьКонтрагентов.НайтиПоКоду("000000006"));
		СписокШин.Добавить(справочники.ПрозрачностьКонтрагентов.НайтиПоКоду("000000007"));
		СписокШин.Добавить(справочники.ПрозрачностьКонтрагентов.НайтиПоКоду("000000008"));
		СписокШин.Добавить(справочники.ПрозрачностьКонтрагентов.НайтиПоКоду("000000009"));

		
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПрозрачностьКонтрагентовПроизводители.Ссылка,
		|	ПрозрачностьКонтрагентовПроизводители.Производитель
		|ПОМЕСТИТЬ Прозрачность
		|ИЗ
		|	Справочник.ПрозрачностьКонтрагентов.Производители КАК ПрозрачностьКонтрагентовПроизводители
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПрозрачностьКонтрагентовНоменклатурныеГруппы.Ссылка,
		|	ПрозрачностьКонтрагентовНоменклатурныеГруппы.НоменклатурнаяГруппа
		|ПОМЕСТИТЬ ПрозрачностьНомГруппы
		|ИЗ
		|	Справочник.ПрозрачностьКонтрагентов.НоменклатурныеГруппы КАК ПрозрачностьКонтрагентовНоменклатурныеГруппы
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Прозрачность.Ссылка,
		|	Прозрачность.Производитель,
		|	ПрозрачностьНомГруппы.НоменклатурнаяГруппа
		|ПОМЕСТИТЬ ПрозрачностьСвод
		|ИЗ
		|	Прозрачность КАК Прозрачность
		|		ПОЛНОЕ СОЕДИНЕНИЕ ПрозрачностьНомГруппы КАК ПрозрачностьНомГруппы
		|		ПО Прозрачность.Ссылка = ПрозрачностьНомГруппы.Ссылка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СУММА(ПродажиОбороты.КоличествоОборот) КАК Количество,
		|	ВЫБОР
		|		КОГДА ПродажиОбороты.Номенклатура.НоменклатурнаяГруппа.Наименование ПОДОБНО ""%зим%""
		|			ТОГДА ""Зима""
		|		ИНАЧЕ ""Лето""
		|	КОНЕЦ КАК сезон,
		|	ВЫБОР
		|		КОГДА ПродажиОбороты.Номенклатура.Модель.Наименование ПОДОБНО ""%Nordman%""
		|			ТОГДА &Nordman
		|		КОГДА ПродажиОбороты.Номенклатура.Модель.Наименование ПОДОБНО ""%FORMULA Energy%""
		|			ТОГДА &FORMULA
		|		ИНАЧЕ ПродажиОбороты.Номенклатура.Производитель
		|	КОНЕЦ КАК Производитель,
		|	ПрозрачностьСвод.Ссылка КАК Прозрачность,
		|	ПродажиОбороты.Номенклатура.НоменклатурнаяГруппа
		|ПОМЕСТИТЬ Продажи
		|ИЗ
		|	РегистрНакопления.Продажи.Обороты(
		|			&Нач,
		|			&Кон,
		|			,
		|			ДоговорКонтрагента.Владелец = &Контрагент
		|				И НЕ Номенклатура.Модель.Сезон В (&Грузовые)) КАК ПродажиОбороты
		|		ЛЕВОЕ СОЕДИНЕНИЕ ПрозрачностьСвод КАК ПрозрачностьСвод
		|		ПО (ВЫБОР
		|				КОГДА ПродажиОбороты.Номенклатура.Модель.Наименование ПОДОБНО ""%Nordman%""
		|					ТОГДА &Nordman
		|				КОГДА ПродажиОбороты.Номенклатура.Модель.Наименование ПОДОБНО ""%FORMULA Energy%""
		|					ТОГДА &FORMULA
		|				ИНАЧЕ ПродажиОбороты.Номенклатура.Производитель
		|			КОНЕЦ = ПрозрачностьСвод.Производитель)
		|			И ПродажиОбороты.Номенклатура.НоменклатурнаяГруппа = ПрозрачностьСвод.НоменклатурнаяГруппа
		|
		|СГРУППИРОВАТЬ ПО
		|	ВЫБОР
		|		КОГДА ПродажиОбороты.Номенклатура.НоменклатурнаяГруппа.Наименование ПОДОБНО ""%зим%""
		|			ТОГДА ""Зима""
		|		ИНАЧЕ ""Лето""
		|	КОНЕЦ,
		|	ВЫБОР
		|		КОГДА ПродажиОбороты.Номенклатура.Модель.Наименование ПОДОБНО ""%Nordman%""
		|			ТОГДА &Nordman
		|		КОГДА ПродажиОбороты.Номенклатура.Модель.Наименование ПОДОБНО ""%FORMULA Energy%""
		|			ТОГДА &FORMULA
		|		ИНАЧЕ ПродажиОбороты.Номенклатура.Производитель
		|	КОНЕЦ,
		|	ПрозрачностьСвод.Ссылка,
		|	ПродажиОбороты.Номенклатура.НоменклатурнаяГруппа
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Продажи.Прозрачность,
		|	Продажи.Производитель,
		|	Продажи.Количество КАК КоличествоЛетоЯШТ,
		|	0 КАК КоличествоЗимаЯШТ,
		|	Продажи.Количество КАК КоличествоЯШТ
		|ПОМЕСТИТЬ свод
		|ИЗ
		|	Продажи КАК Продажи
		|ГДЕ
		|	Продажи.сезон ПОДОБНО ""Лето""
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	Продажи.Прозрачность,
		|	Продажи.Производитель,
		|	0,
		|	Продажи.Количество,
		|	Продажи.Количество
		|ИЗ
		|	Продажи КАК Продажи
		|ГДЕ
		|	Продажи.сезон ПОДОБНО ""Зима""
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	свод.Прозрачность,
		|	свод.Производитель,
		|	СУММА(ВЫБОР
		|			КОГДА свод.Прозрачность В (&Шины)
		|				ТОГДА свод.КоличествоЛетоЯШТ
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК КоличествоЛетоЯШТ,
		|	СУММА(ВЫБОР
		|			КОГДА свод.Прозрачность В (&Шины)
		|				ТОГДА свод.КоличествоЗимаЯШТ
		|			ИНАЧЕ 0
		|		КОНЕЦ) КАК КоличествоЗимаЯШТ,
		|	СУММА(свод.КоличествоЯШТ) КАК КоличествоЯШТ,
		|	0 КАК ДоляЯШТ_л,
		|	0 КАК ДоляЯШТ_з,
		|	0 КАК ДоляЯШТ
		|ИЗ
		|	свод КАК свод
		|
		|СГРУППИРОВАТЬ ПО
		|	свод.Прозрачность,
		|	свод.Производитель";
		
		Запрос.УстановитьПараметр("Nordman", Справочники.Производители.НайтиПоКоду("3795"));
		Запрос.УстановитьПараметр("FORMULA", Справочники.Производители.НайтиПоКоду("3796"));
		Запрос.УстановитьПараметр("Грузовые", Список);
		Запрос.УстановитьПараметр("Шины", СписокШин);

		Запрос.УстановитьПараметр("Контрагент",Владелец);
		началоГода = Дата(Число(Год),1,1);
		
		Если полугодие = "целый год" тогда
		нач = НачалоГода;
		кон = КонецГода(НачалоГода);
		иначеЕсли полугодие = "1 полугодие" тогда
		нач = НачалоГода;
		кон = ДобавитьМесяц(НачалоГода,6)-1;
		иначеЕсли полугодие = "2 полугодие" тогда
	   	нач = ДобавитьМесяц(НачалоГода,6);
		кон = КонецГода(НачалоГода);
		конецЕсли;
		
		Запрос.УстановитьПараметр("Нач", Нач);
		Запрос.УстановитьПараметр("Кон", Кон);
		
		Результат = Запрос.Выполнить().Выгрузить();
		
		Для каждого стр из результат цикл
			строка = ПрозрачностьКонтрагента.Добавить();
			ЗаполнитьЗначенияСвойств(строка,стр);
			строка.Год = Год;
			строка.Полугодие = Полугодие;
		конецЦикла;
		Записать();
	конецЕсли;
	ЗаполнитьДерево();
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ)
	Если клиент тогда
		отбор = Новый Структура;
		Отбор.Вставить("Год",Год);
		Отбор.Вставить("Полугодие",Полугодие);
        нужныеСтроки = ПрозрачностьКонтрагента.НайтиСтроки(Отбор);
		для каждого стр из НужныеСтроки Цикл
		стр.поданнымМенеджера = Истина;	
		конецЦикла;
	конецЕсли;	
КонецПроцедуры

Процедура КлиентПриИзменении(Элемент)
		ЭлементыФормы.Дерево.Колонки.ДоляЯШТ_л.Видимость = Клиент;
	    ЭлементыФормы.Дерево.Колонки.ДоляЯШТ_з.Видимость = Клиент;
		ЭлементыФормы.Дерево.Колонки.ДоляЯШТ.Видимость = Клиент;
КонецПроцедуры

Процедура ДеревоДоляЯШТ_лПриИзменении(Элемент)
	ЗаполнитьЭлемент(Элемент);
КонецПроцедуры

Процедура ДеревоДоляЯШТ_зПриИзменении(Элемент)
	ЗаполнитьЭлемент(Элемент);
КонецПроцедуры

Процедура ДеревоДоляЯШТПриИзменении(Элемент)
	ЗаполнитьЭлемент(Элемент);
КонецПроцедуры

Процедура ДобавитьБрендыНажатие(Элемент)
	спрПрозрачность= справочники.ПрозрачностьКонтрагентов.НайтиПоКоду("000000006");
	список = Новый СписокЗначений;
	Для каждого стр из спрПрозрачность.Производители Цикл
		Список.Добавить(стр.Производитель);	
	конецЦикла;	
	Если Список.ОтметитьЭлементы("Отметьте нужные бренды") Тогда
		Для каждого элемент из Список Цикл
			Если Элемент.Пометка Тогда
				Отбор = Новый Структура();
				Отбор.Вставить("Прозрачность",спрПрозрачность);
				Отбор.Вставить("Производитель",Элемент.Значение);
				Отбор.Вставить("Год",Год);
				Отбор.Вставить("Полугодие",Полугодие);
				Строки = Прозрачностьконтрагента.НайтиСтроки(Отбор);
				Если строки.Количество()=0 Тогда //нет еще такой строки
					Строка = Прозрачностьконтрагента.Добавить();
					Строка.Год = Год;
					Строка.Полугодие = Полугодие;
					Строка.Прозрачность = спрПрозрачность;
					Строка.Производитель = Элемент.Значение;
				конецесли;	
			конецЕсли;
		конецЦикла;	
	конецЕсли;	
КонецПроцедуры


мЖирныйШрифт = Новый Шрифт(,, Истина);



Функция РассчитатьРасстояниеМеждуТочкамиГугл(НачальныеКоординаты,КонечныеКоординаты) Экспорт 
	
	//Создаем временный файл в который получим данные 
	ВремФайл = ПолучитьИмяВременногоФайла("xml");  
	
	//Подготовим координаты в виде строки, которую будем использовать при запросе 
	//НачальныеКоординаты = "Ярославль г."; 
	//КонечныеКоординаты = "Рыбинск г."; 
	
	//Вместо координат можно использовать непосредственно адреса в формате: улица, город, страна. 
	//Выполним подключение к сервису и получим данные 
	КодСтраницыСайта = Новый HTTPСоединение("maps.googleapis.com",,,,Неопределено);  
	
	КодСтраницыСайта.Получить("/maps/api/distancematrix/xml?origins=" + НачальныеКоординаты + "&destinations=" + КонечныеКоординаты + "",ВремФайл); 
	
	//Получаем XML файл в котором присутствуют необходимые нам данные 
	XML = Новый ЧтениеXML;
	XML.ОткрытьФайл(ВремФайл);
	
	Дистанция = Ложь;
	ДистанцияВМетрах = "";
	
	Пока XML.Прочитать() Цикл
		
		Если XML.ТипУзла = ТипУзлаXML.НачалоЭлемента Тогда
			Если XML.Имя = "distance" Тогда 
				Дистанция = Истина;
			КонецЕсли;	
			Имя = XML.Имя;
			
		ИначеЕсли Дистанция  
			И XML.ТипУзла = ТипУзлаXML.Текст 
			И Имя = "value" Тогда   
			
			ДистанцияВМетрах = XML.Значение;
			
		ИначеЕсли XML.ТипУзла = ТипУзлаXML.КонецЭлемента Тогда 
			Если XML.Имя = "distance" Тогда 
				Дистанция = Ложь;
			КонецЕсли;	
		КонецЕсли; 
		
	КонецЦикла; 
	
	XML.Закрыть();
	УдалитьФайлы(ВремФайл);
	
	ДистанцияВМетрах = ?(ДистанцияВМетрах = "",0,Число(ДистанцияВМетрах));
	
	Возврат ОКР(ДистанцияВМетрах / 1000 / 10,0) * 10;  //до 10 км.
	
КонецФункции

Функция  НашеМестоположнеиеНаКарте() Экспорт 
	                  
	нашиКоординаты = "г.Ярославль, ул.Базовая, д.3"; //"г.Ярославль, ул.Базовая, д.3"; // 39.838082,57.657312
	
	Если этотОбъект.Подразделение.Код = "00005" тогда
		нашиКоординаты = "г.Ярославль, ул.Базовая, д.3";
	//ИначеЕсли этотОбъект.Подразделение.Код = "00106" тогда      // РнД
	//	нашиКоординаты = "47.245319,39.59017";
	//ИначеЕсли этотОбъект.Подразделение.Код = "00112" тогда // СПб
	//	нашиКоординаты = "59.8424869,30.4261098";// 
	//ИначеЕсли этотОбъект.Подразделение.Код = "00138" тогда
	//	нашиКоординаты = "56.781591,60.64839";// ЕКТ новый  
   ИначеЕсли ЗначениеЗаполнено(этотОбъект.Подразделение.Контрагент) тогда //ищем координаты факт.адреса контрагента подразделения
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ
		              |	КонтактнаяИнформация.Представление КАК Координаты
		               |ИЗ
		               |	РегистрСведений.КонтактнаяИнформация КАК КонтактнаяИнформация
		               |ГДЕ
		               |	КонтактнаяИнформация.Объект = &Объект
		               |	И КонтактнаяИнформация.Тип = &Тип
		               |	И КонтактнаяИнформация.Вид = &Вид";
		
		Запрос.УстановитьПараметр("Объект", этотОбъект.Подразделение.Контрагент);
		Запрос.УстановитьПараметр("Тип", перечисления.ТипыКонтактнойИнформации.Адрес);
		Запрос.УстановитьПараметр("Вид", справочники.ВидыКонтактнойИнформации.ФактАдресКонтрагента);
		
		Результат = Запрос.Выполнить();
		Выборка = Результат.Выбрать();
		
		Если Выборка.Следующий() тогда
		нашиКоординаты = выборка.Координаты;
		КонецЕсли;
	КонецЕсли;

	Возврат нашиКоординаты;
	
КонецФункции
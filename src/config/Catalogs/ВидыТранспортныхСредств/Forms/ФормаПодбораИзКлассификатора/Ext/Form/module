////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ

// Обработчик события ПриОткрытии формы.
//
Процедура ПриОткрытии()

	Макет = Справочники.ВидыТранспортныхСредств.ПолучитьМакет("ВидыТранспортныхСредств");

	Макет.Параметры.Расшифровка = Истина; // чтобы работала расшифровка

	ТабличныйДокумент = ЭлементыФормы.ПолеТабличногоДокумента;

	ТабличныйДокумент.Вывести(Макет);

	ТабличныйДокумент.ФиксацияСверху      = ТабличныйДокумент.Области.ОбластьРасшифровки.Верх - 1;

	ТабличныйДокумент.ОтображатьЗаголовки = Ложь;
	ТабличныйДокумент.ОтображатьСетку     = Ложь;
	ТабличныйДокумент.ТолькоПросмотр      = Истина;

КонецПроцедуры

// Обработчик события ОбработкаРасшифровки элемента ПолеТабличногоДокумента.
//
Процедура ПолеТабличногоДокументаОбработкаРасшифровки(Элемент, Расшифровка, СтандартнаяОбработка)

	СтандартнаяОбработка = Ложь;

	// Получение значений полей выбранной строки.

	ТабличныйДокумент = ЭлементыФормы.ПолеТабличногоДокумента;
	ТекущаяОбласть    = ТабличныйДокумент.ТекущаяОбласть;

	ОбластьКод         = ТабличныйДокумент.Области.Код;
	ОбластьНаименование = ТабличныйДокумент.Области.Наименование;

	Если ТекущаяОбласть.Низ = ТекущаяОбласть.Верх Тогда

		Код         = ТабличныйДокумент.Область(ТекущаяОбласть.Верх, ОбластьКод.        Лево, ТекущаяОбласть.Низ, ОбластьКод.        Право).Текст;
		Наименование  = ТабличныйДокумент.Область(ТекущаяОбласть.Верх, ОбластьНаименование. Лево, ТекущаяОбласть.Низ, ОбластьНаименование.Право).Текст;

		// Проверка наличия выбранного элемента.
		Ссылка = Справочники.ВидыТранспортныхСредств.НайтиПоКоду(Код);

		Если НЕ Ссылка.Пустая() Тогда
			Вопрос = "В справочнике ""Виды транспортных средств"" уже существует элемент с кодом """ + Код + """! Открыть существующий?";
			Ответ  = Вопрос(Вопрос, РежимДиалогаВопрос.ДаНетОтмена, , КодВозвратаДиалога.Отмена, );

			Если      Ответ = КодВозвратаДиалога.Да Тогда
				Ссылка.ПолучитьФорму( , ВладелецФормы, ).Открыть();
				Возврат;

			ИначеЕсли Ответ = КодВозвратаДиалога.Отмена Тогда
				Возврат;
			КонецЕсли;
		КонецЕсли;

		// Создание нового элемента справочника.
		ФормаНовогоЭлемента = Справочники.ВидыТранспортныхСредств.ПолучитьФормуНовогоЭлемента(, ВладелецФормы, );

		ФормаНовогоЭлемента.Код                = Код;
		ФормаНовогоЭлемента.Наименование       = Наименование;

		ФормаНовогоЭлемента.Открыть();

	Иначе

		Форма = ПолучитьОбщуюФорму("ФормаПодбораИзКлассификатора", ЭтаФорма);
		Если Форма.Открыта() Тогда
			Форма.СписокВыбора.Очистить();

		Иначе

			СтуктураКолонок = Новый Структура();
			СтуктураКолонок.Вставить("Код", Новый Структура("Заголовок, Ширина", "Код", 5));
			СтуктураКолонок.Вставить("Наименование", Новый Структура("Заголовок, Ширина", "Наименование"));
			//СтуктураКолонок.Вставить("НаименованиеЛьготы", Новый Структура("Заголовок, Ширина", "Полное наименование"));
			СтуктураКолонок.Вставить("Видимость", Новый Структура("Заголовок, Ширина", ""));	
			Форма.ТипСправочника = "ВидыТранспортныхСредств";
			Форма.НастроитьФорму(СтуктураКолонок);
		КонецЕсли;

		СписокВыбора =  Форма.СписокВыбора;

		Для ТекущаяСтрока = ТекущаяОбласть.Верх по ТекущаяОбласть.Низ Цикл

			Код         = ТабличныйДокумент.Область(ТекущаяСтрока, ОбластьКод.        Лево, ТекущаяСтрока, ОбластьКод.        Право).Текст;
			Наименование= ТабличныйДокумент.Область(ТекущаяСтрока, ОбластьНаименование.Лево, ТекущаяСтрока, ОбластьНаименование.Право).Текст;
			ЭтоЧисло = Истина;
			Попытка
				КодКакЧисло = Число(Код);
			Исключение
				ЭтоЧисло = Ложь;
			КонецПопытки;

			ЕСли ЭтоЧисло Тогда

				СтрокаПодбора = СписокВыбора.Добавить();
				СтрокаПодбора.Код = Код;
				СтрокаПодбора.Наименование = СтрПолучитьСтроку(Наименование, 1);
				СтрокаПодбора.Видимость = Справочники.ВидыТранспортныхСредств.НайтиПоКоду(Код).Пустая();
				СтрокаПодбора.Переносить = СтрокаПодбора.Видимость;

			КонецЕсли;

		КонецЦикла;
		
		Форма.Открыть();

	КонецЕсли;

КонецПроцедуры

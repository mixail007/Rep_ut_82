
Процедура ПриОткрытии()
	
	ЭтаФорма.Заголовок ="Аналитика продаж для клиента "+ Контрагент.Наименование;
	  ЗаполнитьДанныеТаблицы();
	
КонецПроцедуры


Процедура ЗаполнитьДанныеТаблицы()
	
	
	
	Запрос = Новый Запрос;
	
	Запрос.Текст ="ВЫБРАТЬ
	              |	Производитель,
	              |	Статус,
	              |	КоличествоЗима,
	              |	КоличествоЛето
	              |ИЗ
	              |	РегистрСведений.АналитикаПродажПоБрендам 
	              |ГДЕ Контрагент = &Контрагент
				  | УПОРЯДОЧИТЬ ПО Производитель.Наименование";
				  
	Запрос.УстановитьПараметр("Контрагент",Контрагент);
	
	Выборка=Запрос.Выполнить().Выбрать();
	
	ФлагЕстьЗаписи = Ложь;	
	Пока Выборка.Следующий() Цикл
		
		ФлагЕстьЗаписи = Истина;
		НоваяСтрока=ТабличноеПолеАналитика.Добавить();
		ЗаполнитьЗначенияСвойств(НоваяСтрока,Выборка);

	КонецЦикла;	
	
	
	СписокПроизводителей = Новый СписокЗначений;
	
	
	
	СписокПроизводителей.Добавить(Справочники.Производители.НайтиПоКоду(3));  //Barum
	СписокПроизводителей.Добавить(Справочники.Производители.НайтиПоКоду(5)); //BridgeStone
	СписокПроизводителей.Добавить(Справочники.Производители.НайтиПоКоду(6)); //Conti
	СписокПроизводителей.Добавить(Справочники.Производители.НайтиПоКоду(7)); //Conti
	СписокПроизводителей.Добавить(Справочники.Производители.НайтиПоКоду(9)); //Gislaved
	СписокПроизводителей.Добавить(Справочники.Производители.НайтиПоКоду(15));
	СписокПроизводителей.Добавить(Справочники.Производители.НайтиПоКоду(16));
	СписокПроизводителей.Добавить(Справочники.Производители.НайтиПоКоду(17));
	СписокПроизводителей.Добавить(Справочники.Производители.НайтиПоКоду(21));
	СписокПроизводителей.Добавить(Справочники.Производители.НайтиПоКоду(14));
	СписокПроизводителей.Добавить(Справочники.Производители.НайтиПоКоду(81));
	СписокПроизводителей.Добавить(Справочники.Производители.НайтиПоКоду(108));
	СписокПроизводителей.Добавить(Справочники.Производители.НайтиПоКоду(460)); //Amtel
	СписокПроизводителей.Добавить(Справочники.Производители.НайтиПоКоду(39));
	СписокПроизводителей.Добавить(Справочники.Производители.НайтиПоКоду(777));
	СписокПроизводителей.Добавить(Справочники.Производители.НайтиПоКоду(34));
	
	
	Для сч=0 по СписокПроизводителей.Количество()-1 Цикл
		Если ЗначениеНеЗаполнено( ТабличноеПолеАналитика.Найти(СписокПроизводителей[сч].Значение  ,"Производитель")) Тогда
		НоваяСтрока=ТабличноеПолеАналитика.Добавить();
		НоваяСтрока.Производитель = СписокПроизводителей[сч].Значение;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры	

Процедура КнопкаОКНажатие(Элемент)
	// Вставить содержимое обработчика.
КонецПроцедуры

Процедура ОсновныеДействияФормыДействиеОК(Кнопка)

	
НаборЗаписей = РегистрыСведений.АналитикаПродажПоБрендам.СоздатьНаборЗаписей();
НаборЗаписей.Отбор.Контрагент.Установить(Контрагент);


Для  сч=0 по ТабличноеПолеАналитика.Количество()-1 Цикл
	СтрокаТабЧасти=ТабличноеПолеАналитика[сч];
	
	Если СтрокаТабЧасти.Статус>0 или СтрокаТабЧасти.КоличествоЗима>0 ИЛИ СтрокаТабЧасти.КоличествоЛето>0 Тогда
		НоваяЗапись=НаборЗаписей.Добавить();
		НоваяЗапись.Контрагент=Контрагент;
		НоваяЗапись.Производитель=СтрокаТабЧасти.Производитель;
		НоваяЗапись.Статус=СтрокаТабЧасти.Статус;
		НоваяЗапись.КоличествоЗима=СтрокаТабЧасти.КоличествоЗима;
		НоваяЗапись.КоличествоЛето=СтрокаТабЧасти.КоличествоЛето;
		
	КонецЕсли;
КонецЦикла;
НаборЗаписей.Записать();

	
	Закрыть();
КонецПроцедуры

Процедура ТабличноеПолеАналитикаСтатусНачалоВыбораИзСписка(Элемент, СтандартнаяОбработка)
	
	Если Элемент.СписокВыбора.Количество()<3 Тогда
		Элемент.СписокВыбора.Добавить(1,"1-Дилер");
		Элемент.СписокВыбора.Добавить(2,"2-Крупный опт");
		Элемент.СписокВыбора.Добавить(3,"3 Конечный реализатор/потребитель");
	КонецЕсли;
КонецПроцедуры

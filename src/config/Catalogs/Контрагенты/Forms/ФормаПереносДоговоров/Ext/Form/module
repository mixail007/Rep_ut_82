
Процедура КнопкаВыполнитьНажатие(Кнопка)

	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	БумажныеДоговоры.Номер КАК Номер,
		|	БумажныеДоговоры.Период КАК датаНачала,
		|	БумажныеДоговоры.ДатаОкончанияДействия,
		|	БумажныеДоговоры.Состояние,
		|	БумажныеДоговоры.ЕстьДоговорПоручительства,
		|	БумажныеДоговоры.ЕстьКопииПравоустанавливающихДокументов,
		|	БумажныеДоговоры.ДопустимоеЧислоДнейЗадолженности,
		|	БумажныеДоговоры.Пролонгируется
		|ИЗ
		|	РегистрСведений.БумажныеДоговоры КАК БумажныеДоговоры
		|ГДЕ
		|	БумажныеДоговоры.Контрагент = &Контрагент
		|	И (БумажныеДоговоры.ДатаОкончанияДействия = &ПустаяДата
		|	Или БумажныеДоговоры.ДатаОкончанияДействия > &ТекущаяДата)";

	Запрос.УстановитьПараметр("Контрагент", ЭтаФорма.ВладелецФормы.ссылка);
	Запрос.УстановитьПараметр("ПустаяДата", Дата(1,1,1));
	Запрос.УстановитьПараметр("ТекущаяДата", ТекущаяДата());
	Результат = Запрос.Выполнить();
    Если не Результат.Пустой() Тогда
	Выборка = Результат.Выгрузить();
     ТекДанные = Выборка.ВыбратьСтроку("Выберите действующий договор",);
 иначе
	 Предупреждение("Нет действующих договоров!");
	конецесли; 
	
Если ТекДанные <> Неопределено Тогда	
	Для каждого стр из СписокДоговоров Цикл
		Если стр.изменять Тогда
		ДогОб = стр.договор.получитьОбъект();
		ДогОб.обменДанными = Истина;
		ДогОб.Номер = ТекДанные.Номер;
		ДогОб.Дата  = ТекДанные.ДатаНачала;
		ДогОб.ДатаОкончанияДействия = ТекДанные.ДатаОкончанияДействия;
		ДогОб.СостояниеДоговора = ТекДанные.Состояние; 
		ДогОб.ЕстьДогорПоручительства = ТекДанные.ЕстьДоговорПоручительства; 
		ДогОб.ЕстьКопииПравоустанавливающихДокументов  = ТекДанные.ЕстьКопииПравоустанавливающихДокументов;
		ДогОб.ДопустимоеЧислоДнейЗадолженности =ТекДанные.ДопустимоеЧислоДнейЗадолженности;
		ДогОб.Записать();
		Стр.номер = ТекДанные.Номер;
		стр.дата = ТекДанные.ДатаНачала;
		стр.ДатаОкончания = ТекДанные.ДатаОкончанияДействия;
		конецЕсли;
	конецЦикла;
конецЕсли;	
КонецПроцедуры

Процедура ПриОткрытии()
 	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ДоговорыКонтрагентов.Ссылка КАК Договор,
		|	ДоговорыКонтрагентов.ОтветственноеЛицо КАК Ответственный,
		|	Ложь КАК Изменять,
		|	ДоговорыКонтрагентов.Номер,
		|	ДоговорыКонтрагентов.Дата,
		|	ДоговорыКонтрагентов.ДатаОкончанияДействия как ДатаОкончания
		|ИЗ
		|	Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
		|ГДЕ
		|	ДоговорыКонтрагентов.Владелец = &Владелец
		|	И ДоговорыКонтрагентов.ПометкаУдаления = ЛОЖЬ";

	Запрос.УстановитьПараметр("Владелец", ЭтаФорма.ВладелецФормы.ссылка);

	СписокДоговоров = Запрос.Выполнить().Выгрузить();

КонецПроцедуры

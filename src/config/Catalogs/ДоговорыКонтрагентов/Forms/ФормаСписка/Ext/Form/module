
////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ КОМАНДНЫХ ПАНЕЛЕЙ ФОРМЫ

// Процедура - обработчик события нажатие по кнопке Файлы командной панели ДействияФормы.
//
Процедура ДействияФормыФайлы(Кнопка)
	
	Если ЭлементыФормы.СправочникСписок.ТекущиеДанные = Неопределено Тогда
		Возврат;
	КонецЕсли; 
	
	Если ЭлементыФормы.СправочникСписок.ТекущиеДанные.Ссылка.Пустая() Тогда
		Возврат;
	КонецЕсли;

	СтруктураДляСпискаИзображдений = Новый Структура("ОтборОбъектИспользование, ОтборОбъектЗначение, ДоступностьОтбораОбъекта, ВидимостьКолонкиОбъекта", Истина, ЭлементыФормы.СправочникСписок.ТекущиеДанные.Ссылка, Ложь, Ложь);
	СтруктураДляСпискаДополнительныхФайлов = Новый Структура("ОтборОбъектИспользование, ОтборОбъектЗначение, ДоступностьОтбораОбъекта, ВидимостьКолонкиОбъекта", Истина, ЭлементыФормы.СправочникСписок.ТекущиеДанные.Ссылка, Ложь, Ложь);
	ОбязательныеОтборы = Новый Структура("Объект", ЭлементыФормы.СправочникСписок.ТекущиеДанные.Ссылка);
	
	ОткрытьФормуСпискаФайловИИзображений(СтруктураДляСпискаИзображдений, СтруктураДляСпискаДополнительныхФайлов, ОбязательныеОтборы, ЭтаФорма);

КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ФОРМЫ

// Процедура - обработчик события "ПриАктивизацииСтроки" элемента формы СправочникСписок.
//
Процедура СправочникСписокПриАктивизацииСтроки(Элемент)
	
	ЭлементыФормы.СправочникДерево.ТекущаяСтрока = ЭлементыФормы.СправочникСписок.ТекущийРодитель;
	
КонецПроцедуры

Процедура ПриОткрытии()
	
	УстановитьОтборВСправочникДоговорыКонтрагентов(Отбор, ЭлементыФормы.СправочникСписок);
	 //+++ 26.12.2012
	Если НЕ (РольДоступна("яштФинДиректор") или РольДоступна("ПолныеПрава")) 
		   или ПолучитьЗначениеПоУмолчанию(глТекущийПользователь,"УчетТолькоПоПодразделениюПользователя") тогда
		ЭлементыФормы.ДействияФормы.Видимость = ложь;
        ЭлементыФормы.ДействияФормы.Доступность = ложь;
	КонецЕсли;

	//	Если ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "ОграниченныйИнтерфейс") = Истина Тогда
	//	Запрос = Новый Запрос;
	//	Запрос.Текст = 
	//	"ВЫБРАТЬ
	//	|	ДоговорыКонтрагентов.Ссылка
	//	|ИЗ
	//	|	Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
	//	|ГДЕ
	//	|	НЕ ДоговорыКонтрагентов.Наименование ПОДОБНО ""%*%""
	//	|	И ДоговорыКонтрагентов.Организация = &Организация";
	//	
	//	Запрос.УстановитьПараметр("Организация",Справочники.Организации.НайтиПоКоду("00001"));	

	//	
	//	Результат = Запрос.Выполнить().Выгрузить();
	//	СписокДоговоровМенеджера = Новый СписокЗначений;
	//	СписокДоговоровМенеджера.ЗагрузитьЗначения(Результат.ВыгрузитьКолонку("Ссылка"));
	//	Отбор["Наименование"].Использование = Истина;
	//	Отбор["Наименование"].ВидСравнения = ВидСравнения.ВСписке;
	//	Отбор["Наименование"].Значение = СписокДоговоровМенеджера;
	//	ЭлементыФормы.СправочникСписок.НастройкаОтбора["Наименование"].Доступность = Ложь;
	//	
	//	
	//конецесли;	

	
	
	
КонецПроцедуры


Процедура СправочникСписокПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, ЭтоГруппа)
	
	//14.09.2016 - нельзя напрямую добавить/скопировать договор
	Если НЕ (РольДоступна("яштФинДиректор") или РольДоступна("ПравоЗавершенияРаботыПользователей")) или ГлТекущийПользователь<>Справочники.Пользователи.НайтиПоКоду("Захарова Стелла") тогда
		Предупреждение("У Вас недостаточно прав для добавления договора!", 30);
		Отказ = истина;
		Возврат;
	КонецЕсли;	

КонецПроцедуры


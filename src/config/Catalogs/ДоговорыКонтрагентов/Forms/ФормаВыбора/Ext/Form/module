// Процедура - обработчик нажатия кнопки "Файлы"
//
Процедура ДействияФормыФайлы(Кнопка)

	Если НЕ ЭлементыФормы.СправочникСписок.ТекущаяСтрока = Неопределено Тогда
		ФормаВыб = Справочники.ХранилищеДополнительнойИнформации.ПолучитьФорму("ФормаСписка",ЭтаФорма);
		ФормаВыб.Отбор.Объект.Значение = ЭлементыФормы.СправочникСписок.ТекущаяСтрока.Ссылка;
		ФормаВыб.Отбор.Объект.Использование = Истина;
		ФормаВыб.Открыть();
	КонецЕсли;

КонецПроцедуры

// Процедура - обработчик события "ПриОткрытии" формы
//
Процедура ПриОткрытии()
	
	//+++ 26.12.2012
	Если НЕ (РольДоступна("яштФинДиректор") или РольДоступна("ПолныеПрава")) 
		   или ПолучитьЗначениеПоУмолчанию(глТекущийПользователь,"УчетТолькоПоПодразделениюПользователя") тогда
		ЭлементыФормы.ДействияФормы.Видимость = ложь;
        ЭлементыФормы.ДействияФормы.Доступность = ложь;
	КонецЕсли;

	Если РежимВыбора И ЗначениеНеЗаполнено(Отбор.Владелец.Значение) Тогда
		ФормаВыбораВладельца = Справочники.Контрагенты.ПолучитьФормуВыбора();
		ФормаВыбораВладельца.Заголовок = "Выберите контрагента, договор которого Вы хотите выбрать.";
		Контрагент = ФормаВыбораВладельца.ОткрытьМодально();
		Если ТипЗнч(Контрагент) = ТипЗнч(Отбор.Владелец.Значение) Тогда
			Отбор.Владелец.Значение = Контрагент;
		КонецЕсли;
		Отбор.Владелец.Использование = НЕ ЗначениеНеЗаполнено(Отбор.Владелец.Значение);
	КонецЕсли;
	
	Если Отбор.Владелец.Использование И Отбор.Владелец.ВидСравнения = ВидСравнения.Равно Тогда
		ЭлементыФормы.СправочникСписок.Колонки.Владелец.Видимость = Ложь;
	КонецЕсли; 
	
	УстановитьОтборВСправочникДоговорыКонтрагентов(Отбор, ЭлементыФормы.СправочникСписок);

	//Если ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "ОграниченныйИнтерфейс") = Истина Тогда
	//	Запрос = Новый Запрос;
	//	Запрос.Текст = 
	//	"ВЫБРАТЬ
	//	|	ДоговорыКонтрагентов.Ссылка
	//	|ИЗ
	//	|	Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
	//	|ГДЕ
	//	|	НЕ ДоговорыКонтрагентов.Наименование ПОДОБНО ""%*%""
	//	|	И ДоговорыКонтрагентов.Организация = &Организация";
	//	
	//	Запрос.УстановитьПараметр("Организация",Справочники.Организации.НайтиПоКоду("00001"));	

	//	
	//	Результат = Запрос.Выполнить().Выгрузить();
	//	СписокДоговоровМенеджера = Новый СписокЗначений;
	//	СписокДоговоровМенеджера.ЗагрузитьЗначения(Результат.ВыгрузитьКолонку("Ссылка"));
	//	Отбор["Наименование"].Использование = Истина;
	//	Отбор["Наименование"].ВидСравнения = ВидСравнения.ВСписке;
	//	Отбор["Наименование"].Значение = СписокДоговоровМенеджера;
	//	ЭлементыФормы.СправочникСписок.НастройкаОтбора["Наименование"].Доступность = Ложь;

	//конецесли;	


КонецПроцедуры

Процедура СправочникСписокПриАктивизацииСтроки(Элемент)
	
	ЭлементыФормы.СправочникДерево.ТекущаяСтрока = ЭлементыФормы.СправочникСписок.ТекущийРодитель;
	
КонецПроцедуры // СправочникСписокПриАктивизацииСтроки()

Процедура СправочникСписокПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, ЭтоГруппа)
	
	//14.09.2016 - нельзя напрямую добавить/скопировать договор
	Если НЕ (РольДоступна("яштФинДиректор") или РольДоступна("ПравоЗавершенияРаботыПользователей")) тогда
		Предупреждение("У Вас недостаточно прав для добавления договора!", 30);
		Отказ = истина;
		Возврат;
	КонецЕсли;	
	
	МассивПолейОтбора = Новый Массив;
	МассивПолейОтбора.Добавить("Организация");
	МассивПолейОтбора.Добавить("ВидДоговора");
	МассивПолейОтбора.Добавить("ВедениеВзаиморасчетов");
	МассивПолейОтбора.Добавить("ВалютаВзаиморасчетов");

	Если НЕ Копирование и Не ЭтоГруппа Тогда

		Для Каждого ИмяПоляОтбора Из МассивПолейОтбора Цикл
			ОтборФормы = СправочникСписок.Отбор[ИмяПоляОтбора];
			Если ОтборФормы.Использование
			   И (ОтборФормы.ВидСравнения = ВидСравнения.Равно Или ОтборФормы.ВидСравнения = ВидСравнения.ВСписке) Тогда
				Отказ = Истина;
				Прервать;
			КонецЕсли;
		КонецЦикла;

		Если Отказ = Истина Тогда

			НовыйОбъект = Справочники.ДоговорыКонтрагентов.СоздатьЭлемент();

			Для Каждого ИмяПоляОтбора Из МассивПолейОтбора Цикл
				ОтборФормы = СправочникСписок.Отбор[ИмяПоляОтбора];
				Если ОтборФормы.Использование Тогда
					Если ОтборФормы.ВидСравнения = ВидСравнения.Равно Тогда
						НовыйОбъект[ИмяПоляОтбора] = ОтборФормы.Значение;
					ИначеЕсли ОтборФормы.ВидСравнения = ВидСравнения.ВСписке И ОтборФормы.Значение.Количество() > 0 Тогда
						НовыйОбъект[ИмяПоляОтбора] = ОтборФормы.Значение[0];
					КонецЕсли;
				КонецЕсли
			КОнецЦикла;

			// Надо установить владельца, если он задан
			Если СправочникСписок.Отбор.Владелец.Использование
			   И СправочникСписок.Отбор.Владелец.ВидСравнения = ВидСравнения.Равно Тогда
				НовыйОбъект.Владелец = СправочникСписок.Отбор.Владелец.Значение;
			КонецЕсли;

			НовыйОбъект.ПолучитьФорму(,ЭлементыФормы.СправочникСписок).Открыть();

		КонецЕсли;

	КонецЕсли;

КонецПроцедуры // СправочникСписокПередНачаломДобавления()



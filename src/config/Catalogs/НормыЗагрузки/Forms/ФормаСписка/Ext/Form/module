
Процедура СправочникСписокТипоразмерПриИзменении(Элемент)
	
	Если (ЭлементыФормы.СправочникСписок.ТекущиеДанные <> Неопределено) и (ЭлементыФормы.СправочникСписок.ТекущаяСтрока.Типоразмер <> Справочники.Типоразмеры.ПустаяСсылка()) Тогда
		ЭлементыФормы.СправочникСписок.ТекущиеДанные.Наименование = ЭлементыФормы.СправочникСписок.ТекущаяСтрока.Типоразмер.Наименование;			
	Иначе 
		ЭлементыФормы.СправочникСписок.ТекущиеДанные.Наименование = "";
	КонецЕсли;	
	ЭлементыФормы.СправочникСписок.ТекущиеДанные.КоэффициентИмпорта = 1;
	ЭлементыФормы.СправочникСписок.ТекущиеДанные.КоэффициентКоличества = 1;
	
КонецПроцедуры

Процедура ПриОткрытии()
	
	Если (РедактированиеИзФорм) Тогда 
		Если (ЭлементТек <> Справочники.НормыЗагрузки.ПустаяСсылка()) Тогда
			СправочникСписок.Отбор.Ссылка.Установить(ЭлементТек);
			СправочникСписок.Отбор.Ссылка.Использование = Истина;
		Иначе 
			СправочникСписок.Отбор.Типоразмер.Установить(ОтборТипоразмер);
			СправочникСписок.Отбор.Типоразмер.Использование = Истина;
		КонецЕсли;
	КонецЕсли;
	
		
	//УстановитьЭлементыИсторииКнопка(Ссылка, ЭтаФорма);

	
КонецПроцедуры

Процедура ВыводИстории(Элемент)
	
	ВывестиИсторию(ЭлементыФормы.СправочникСписок.ТекущаяСтрока.Ссылка, ЭтаФорма);
	
КонецПроцедуры
	
	



Процедура СправочникСписокПередОкончаниемРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования, Отказ)
	Запрос = новый Запрос;
	Запрос.Текст = "
	|Выбрать Ссылка из Справочник.НормыЗагрузки Где 
	|Ссылка.Типоразмер = &Типоразмер и Ссылка.ВидПродукции = &ВидПродукции и ПометкаУдаления=Ложь";
	Запрос.УстановитьПараметр("Типоразмер",Элемент.ТекущиеДанные.Типоразмер);
	Запрос.УстановитьПараметр("ВидПродукции",Элемент.ТекущиеДанные.ВидПродукции);
	Если не(НоваяСтрока) Тогда 
		Выб = Запрос.Выполнить().Выбрать();
		Если (Выб.Количество()>0) Тогда 
			Выб.Следующий();
			Если (Элемент.ТекущиеДанные.Код<> Выб.Ссылка.Код) Тогда
				Сообщить("Данная норма загрузки уже существует.", СтатусСообщения.Важное);
				Отказ = Истина;
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры

Процедура СправочникСписокПриОкончанииРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования)
	Если (Элемент.ТекущиеДанные = Неопределено) Тогда 
		ОтменаРедактирования = Истина;
	Иначе 
		Запрос = новый Запрос;
		Запрос.Текст = "
		|Выбрать Ссылка.Код как код из Справочник.НормыЗагрузки Где 
		|Ссылка.Типоразмер = &Типоразмер и Ссылка.ВидПродукции = &ВидПродукции и ПометкаУдаления=Ложь";
		Запрос.УстановитьПараметр("Типоразмер",Элемент.ТекущиеДанные.Ссылка.Типоразмер);
		Запрос.УстановитьПараметр("ВидПродукции",Элемент.ТекущиеДанные.ВидПродукции);
		Если (НоваяСтрока) Тогда 
			Выб = Запрос.Выполнить().Выбрать();
			Если Выб.Количество()>0 Тогда 
				Выб.Следующий();
				Если (Элемент.ТекущиеДанные.Ссылка.Код<> Выб.Код) Тогда
					Сообщить("Данная норма загрузки уже существует.", СтатусСообщения.Важное);
					НайденныйЭл = Справочники.НормыЗагрузки.НайтиПоКоду(Элемент.ТекущиеДанные.Ссылка.Код);
					ОбъектЭл = НайденныйЭл.ПолучитьОбъект();
					ОбъектЭл.Удалить();
					ОтменаРедактирования = Истина;
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры

     
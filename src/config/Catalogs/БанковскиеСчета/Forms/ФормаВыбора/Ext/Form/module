Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	Если РежимВыбора И ЗначениеНеЗаполнено(Отбор.Владелец.Значение) И ЗначениеНеЗаполнено(ПараметрОтборПоВладельцу) Тогда
		
		Если ТипЗнч(ВладелецФормы) <> Тип("ТабличноеПоле") Тогда
			Если ТипЗнч(ВладелецФормы.ВыборПоВладельцу)=Тип("СправочникСсылка.Контрагенты") Тогда
				
				ФормаВыбораВладельца = Справочники.Контрагенты.ПолучитьФормуВыбора();
				ФормаВыбораВладельца.Заголовок = "Выберите контрагента, счет которого Вы хотите выбрать.";
				
				Контрагент = ФормаВыбораВладельца.ОткрытьМодально();
				
				Если Контрагент=Неопределено Тогда
					Отказ=Истина;
				КонецЕсли;
				
				Если Отбор.Владелец.ТипЗначения.СодержитТип(ТипЗнч(Контрагент)) Тогда
					Отбор.Владелец.Значение = Контрагент;
				КонецЕсли;
				Если НЕ ЗначениеНеЗаполнено(Отбор.Владелец.Значение) Тогда
					Отбор.Владелец.Использование = Истина;
				КонецЕсли;
				
			Иначе
				
				ФормаВыбораВладельца = Справочники.Организации.ПолучитьФормуВыбора();
				ФормаВыбораВладельца.Заголовок = "Выберите организацию, счет которой Вы хотите выбрать.";
				Организация=ФормаВыбораВладельца.ОткрытьМодально();
				
				Если Организация=Неопределено Тогда
					Отказ=Истина;
				КонецЕсли;
				
				Если Отбор.Владелец.ТипЗначения.СодержитТип(ТипЗнч(Организация)) Тогда
					Отбор.Владелец.Значение = Организация;
				КонецЕсли;
				Если НЕ ЗначениеНеЗаполнено(Отбор.Владелец.Значение) Тогда
					Отбор.Владелец.Использование = Истина;
				КонецЕсли;

			КонецЕсли;
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры


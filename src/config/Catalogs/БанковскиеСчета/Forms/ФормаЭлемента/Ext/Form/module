Перем мВалютаРегламентированногоУчета;

///////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ОБЩЕГО НАЗНАЧЕНИЯ

// Заполняет реквизит "ТекстКорреспондента"
 //
 // Параметры:
 //  Нет.
 //
Процедура ЗаполнитьТекстКорреспондента()

	мВладелец     = ЭтотОбъект.Владелец;

	Если ЗначениеНеЗаполнено(мВладелец) Тогда
		Возврат;
	КонецЕсли;

	ТипВладельца = ТипЗнч(мВладелец);
	Если ТипВладельца = Тип("СправочникСсылка.Организации") Тогда
		СтрКорреспондента = СокрЛП(мВладелец.НаименованиеПолное);
	ИначеЕсли ТипВладельца = Тип("СправочникСсылка.Контрагенты") Тогда
		СтрКорреспондента = СокрЛП(мВладелец.НаименованиеПолное);
	КонецЕсли;	

	Если НЕ БанкДляРасчетов.Пустая() Тогда
		СтрКорреспондента = СтрКорреспондента + " р/с " + НомерСчета
			+ " в " + Банк + " " + Банк.Город;
	КонецЕсли;	

	ТекстКорреспондента = СтрКорреспондента;	

КонецПроцедуры // ЗаполнитьТекстКорреспондента()

// Управляет видимостью некоторых элементов формы
//
// Параметры:
//  Нет.
//
Процедура УстановитьВидимость()

	Если (ЗначениеНеЗаполнено(ВалютаДенежныхСредств))
	 ИЛИ (ВалютаДенежныхСредств = мВалютаРегламентированногоУчета) Тогда
		ЭлементыФормы.НомерИДатаРазрешения.Видимость = Ложь;
		ЭлементыФормы.НадписьНомерИДатаРазрешения.Видимость = Ложь;

	Иначе
		ЭлементыФормы.НомерИДатаРазрешения.Видимость = Истина;
		ЭлементыФормы.НадписьНомерИДатаРазрешения.Видимость = Истина;

	КонецЕсли;

КонецПроцедуры // УстановитьВидимость()


////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

Процедура ПриОткрытии()
    Если ВидСчета = "Иной" тогда
		Если Владелец.Экспорт тогда
			ЭлементыФормы.НомерСчета.Маска = "UUUUUUUUUUUUUUUUUUUUUUUUUUUU";
		Иначе
		    ЭлементыФормы.НомерСчета.Маска = "@@@@@@@@@@@@@@@@@@@@@@@@@@";
		КонецЕсли;
	Иначе
		ЭлементыФормы.НомерСчета.Маска = "@@@@@@@@@@@@@@@@@@@@@@@@@@";
	КонецЕсли;

	Если ЭтоНовый() Тогда
		
		Если ЗначениеНеЗаполнено(ВидСчета) Тогда
			ВидСчета = ЭлементыФормы.ВидСчета.СписокВыбора[0];
		КонецЕсли;
		
		ЗаполнитьТекстКорреспондента();
		
		Если ЗначениеНеЗаполнено(ВалютаДенежныхСредств) Тогда
			ВалютаДенежныхСредств = мВалютаРегламентированногоУчета;
		КонецЕсли;
		
	КонецЕсли;
	
	УстановитьВидимость();
	
	ЗакрыватьПриВыборе = Ложь;
	
	Если НЕ ЭтоНовый() Тогда
		
		УстановитьЭлементыИсторииКнопка(Ссылка, ЭтаФорма);
		
	КонецЕсли; 
	
КонецПроцедуры

Процедура ВыводИстории(Элемент)
	
	ВывестиИсторию(Ссылка, ЭтаФорма);
	
КонецПроцедуры
	
	

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ ДЕЙСТВИЙ КОМАНДНЫХ ПАНЕЛЕЙ ЭЛЕМЕНТОВ

 // Обработчик события "ПриИзменении" реквизита "БанкДляРасчетов"
 //
Процедура БанкДляРасчетовПриИзменении(Элемент)
	ЗаполнитьТекстКорреспондента();
КонецПроцедуры

 // Обработчик события "ПриИзменении" реквизита "НомерСчета"
 //
Процедура НомерСчетаПриИзменении(Элемент)
	ЗаполнитьТекстКорреспондента();
КонецПроцедуры

 // Обработчик события "ПриИзменении" реквизита "Банк"
 //
Процедура БанкПриИзменении(Элемент)
	ЗаполнитьТекстКорреспондента();
КонецПроцедуры

 // Обработчик события "ПриИзменении" реквизита "ВалютаДенежныхСредств"
 //
Процедура ВалютаДенежныхСредствПриИзменении(Элемент)

	УстановитьВидимость()

КонецПроцедуры

Процедура ПриЗаписи(Отказ)

	Если ЭтаФорма.ВладелецФормы <> Неопределено Тогда
	
		ОповеститьОВыборе(Ссылка);
	
	КонецЕсли; 
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ)
	Если ВалютаДенежныхСредств = Справочники.Валюты.НайтиПоКоду("643") и СтрДлина(НомерСчета) > 22 Тогда
		Если ВидСчета = "Иной" и  Владелец.Экспорт Тогда
			
		Иначе
			Сообщить("Длина счета не может быть больше 22 символов!!!");
			отказ = Истина;
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры

Процедура ВидСчетаПриИзменении(Элемент)
	Если Элемент.Значение = "Иной" тогда
		Если Владелец.Экспорт тогда
			ЭлементыФормы.НомерСчета.Маска = "UUUUUUUUUUUUUUUUUUUUUUUUUUUU";
		Иначе
		    ЭлементыФормы.НомерСчета.Маска = "@@@@@@@@@@@@@@@@@@@@@@@@@@";
		КонецЕсли;
	Иначе
		ЭлементыФормы.НомерСчета.Маска = "@@@@@@@@@@@@@@@@@@@@@@@@@@";
	КонецЕсли;
КонецПроцедуры



////////////////////////////////////////////////////////////////////////////////
// ТЕЛО МОДУЛЯ

СписокВидСчета = ЭлементыФормы.ВидСчета.СписокВыбора;
СписокВидСчета.Добавить("Расчетный");
СписокВидСчета.Добавить("Депозитный");
СписокВидСчета.Добавить("Ссудный");
СписокВидСчета.Добавить("Иной");

мВалютаРегламентированногоУчета = Константы.ВалютаРегламентированногоУчета.Получить();

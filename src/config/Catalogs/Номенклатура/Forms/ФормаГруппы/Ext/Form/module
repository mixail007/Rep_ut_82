Функция РазрешеноРедактирование()
    
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Пользователь", глТекущийПользователь);
	Запрос.Текст = "
	|ВЫБРАТЬ
	|	ГруппаНоменклатуры
	|ИЗ
	|	РегистрСведений.ГруппыРедактированияНоменклатуры
	|ГДЕ
	|	Пользователь = &Пользователь
	|";
	
	Результат = Запрос.Выполнить().Выгрузить();
	СписокГрупп = Новый СписокЗначений;
	СписокГрупп = Результат.ВыгрузитьКолонку("ГруппаНоменклатуры");
	
	//+++( 22.08.2011
	Если СписокГрупп.Количество()>0 тогда
		Если СписокГрупп[0] = Справочники.Номенклатура.ПустаяСсылка() тогда 
			Возврат Истина; //1я = пустая ссылка означает, что можно всё!!!
		КонецЕсли;
	КонецЕсли;
    //+++)
	
	//Для каждого СтрокаСписка Из СписокГрупп Цикл
	//
	//	Если СтрокаСписка = Справочники.Номенклатура.ПустаяСсылка() Тогда
	//	
	//		Возврат Истина;	
	//	
	//	КонецЕсли; 	
	//
	//КонецЦикла; 
		
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Родитель", Родитель);
	Запрос.УстановитьПараметр("СписокГрупп", СписокГрупп);
	Запрос.Текст = "
	|ВЫБРАТЬ
	|	*
	|ИЗ 
	|   Справочник.Номенклатура
	|ГДЕ 
	|	Ссылка = &Родитель
	|	И (Ссылка В ИЕРАРХИИ (&СписокГрупп) ИЛИ Ссылка В (&СписокГрупп))
	|";
	
	
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Если Выборка.Количество() > 0 Тогда
	
		Возврат Истина;
		
	Иначе
		
		Возврат Ложь;
	
	КонецЕсли; 
	
	
КонецФункции

Процедура ПриОткрытии()
	
	Если НЕ ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "РазрешитьРедактироватьЭлементыНоменклатуры") Тогда
		
		ЭтаФорма.ТолькоПросмотр = Истина;
		
	Иначе
		
		Если НЕ РазрешеноРедактирование() Тогда
		
			ЭтаФорма.ТолькоПросмотр = Истина;
		
		КонецЕсли; 
		
	КонецЕсли;
	
	Если ЭтотОбъект.ПринадлежитЭлементу(Справочники.Номенклатура.ВнеоборотныеАктивы)
		 ИЛИ ЭтотОбъект.ПринадлежитЭлементу(Справочники.Номенклатура.Материалы)
		 ИЛИ ЭтотОбъект.ПринадлежитЭлементу(Справочники.Номенклатура.ЛокальнаяНоменклатура)
		 ИЛИ ЭтотОбъект.ПринадлежитЭлементу(Справочники.Номенклатура.Автозапчасти) Тогда
		 
		 ЭлементыФормы.Родитель.ТолькоПросмотр = Истина;
	
	КонецЕсли; 

КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	мЭтоНовый = Ложь;
	Если ЭтоНовый() Тогда
		мЭтоНовый = Истина;
		Если НЕ ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "РазрешитьДобавлятьЭлементыНоменклатуры") Тогда
			
			Предупреждение("Вам не разрешено добавлять новые группы!", 10);
			Отказ = Истина;
			Возврат;
			
		Иначе
			
			Если НЕ РазрешеноРедактирование() Тогда
				
				Предупреждение("Вам не разрешено добавлять новые группы" + Символы.ПС +
							   "в группу: " + Родитель + "!", 10);
				Отказ = Истина;          
				Возврат;			
				
			КонецЕсли; 
		КонецЕсли;
	КонецЕсли;

КонецПроцедуры

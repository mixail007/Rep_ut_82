
Процедура НаименованиеПриИзменении(Элемент)
	
	Если Родитель = Справочники.Типоразмеры.НайтиПоНаименованию("Шины") Тогда
		
		ПозицияРазделителяСлэш = Найти(Элемент.Значение, "/");
		ПозицияРазделителяR = Найти(Элемент.Значение, "R");
		
		Если ПозицияРазделителяСлэш > 0 Тогда 
			ПараметрШирина = Лев(Элемент.Значение, ПозицияРазделителяСлэш - 1);
			ЭлементыФормы.Ширина.Значение = ПараметрШирина;	
		КонецЕсли;
		
		Если ПозицияРазделителяСлэш > 0 И ПозицияРазделителяR > 0 И ПозицияРазделителяСлэш < ПозицияРазделителяR Тогда
			ПараметрВысота = Сред(Элемент.Значение, ПозицияРазделителяСлэш + 1, ПозицияРазделителяR - ПозицияРазделителяСлэш - 1);
			ЭлементыФормы.Высота.Значение = ПараметрВысота;
		КонецЕсли;
		
		Если ПозицияРазделителяR > 0 Тогда
			ПараметрДиаметр = Прав(Элемент.Значение, СтрДлина(Элемент.Значение) - ПозицияРазделителяR);
			если найти(ПараметрДиаметр,"(")>0 тогда //+++ 06.07.2012
				ПараметрДиаметр = лев(ПараметрДиаметр, найти(ПараметрДиаметр,"(")-1);
			КонецЕсли;	
			ЭлементыФормы.Диаметр.Значение = ПараметрДиаметр;
		КонецЕсли;
		
	ИначеЕсли Родитель = Справочники.Типоразмеры.НайтиПоНаименованию("Диски") Тогда
		
		ДиаметрДиска=""; 
		КолвоОтверстий="";
		PCD=""; 
		Вылет=""; 
		ДиаметрСтупицы="";
		ШиринаДиска="";
		
		масПараметров = МассивИзСтроки(Элемент.Значение," ");
		Если масПараметров.Количество() >= 4 Тогда
			ДиаметрДиска = СтрЗаменить(масПараметров[0],"R","");
			позСлеш = Найти(масПараметров[1],"/");
			позУмн = Найти(масПараметров[1],"*");
			
			Если позСлеш<позУмн И позСлеш>0 Тогда
				ШиринаДиска=Лев(масПараметров[1],позСлеш-1);	
				КолвоОтверстий=Сред(масПараметров[1],позСлеш+1,позУмн-позСлеш-1);
				PCD=Сред(масПараметров[1],позУмн+1,СтрДлина(масПараметров[1])-позУмн);
			КонецЕсли;
			Вылет=СтрЗаменить(масПараметров[2],"ET","");
			ДиаметрСтупицы=СтрЗаменить(масПараметров[3],"d","");
			
		//+++ 03.12.2013 новый формат  [Ш]х[Д]/[КолОтв]х[PCD] ЕТ[вылет] d[Ступица]
		//------------------------"10.0x20/5x112 ET46 D66.6" ------------------------------------
		ИначеЕсли масПараметров.Количество()>0 тогда
			i = найти(масПараметров[0],"x");
			ШиринаДиска  = лев(масПараметров[0], i-1);
		    масПараметров[0] = прав(масПараметров[0], стрДлина(масПараметров[0]) - i);
			
			i = найти(масПараметров[0],"/");
			ДиаметрДиска  = лев(масПараметров[0], i-1);
		    масПараметров[0] = прав(масПараметров[0], стрДлина(масПараметров[0]) - i);
			
			i = найти(масПараметров[0],"x");
			КолвоОтверстий  = лев(масПараметров[0], i-1);
		    масПараметров[0] = прав(масПараметров[0], стрДлина(масПараметров[0]) - i);
			
			PCD = масПараметров[0];
			
			Если масПараметров.Количество()>1 
				и (Найти(масПараметров[1], "ET")>0 или Найти(масПараметров[1], "ЕТ")>0)  тогда
			 Вылет = масПараметров[1];
			 Вылет = стрзаменить(Вылет,"ET","");
			 Вылет = стрзаменить(Вылет,"ЕТ","");
				Если масПараметров.Количество()>2 и Найти(нрег(масПараметров[2]), "d")>0 тогда
				 ДиаметрСтупицы = масПараметров[2];
			     ДиаметрСтупицы = стрзаменить(ДиаметрСтупицы,"d","");
				 ДиаметрСтупицы = стрзаменить(ДиаметрСтупицы,"D","");
				КонецЕсли; 
			КонецЕсли;
	
		КонецЕсли;	
		
		ЭлементыФормы.Диаметр.Значение = ДиаметрДиска;
		ЭлементыФормы.КоличествоОтверстий.Значение = КолвоОтверстий;
		ЭлементыФормы.PCD.Значение = PCD;
		ЭлементыФормы.Вылет.Значение = Вылет;
		ЭлементыФормы.ДиаметрСтупицы.Значение = ДиаметрСтупицы;
		ЭлементыФормы.Ширина.Значение = ШиринаДиска;
		
	КонецЕсли;
	
КонецПроцедуры

Функция ОтделитьРазделителем(Стр, Знач Разделитель, Режим=0)

	ПраваяЧасть         = "";
	ПозРазделителя      = Найти(Стр, Разделитель);
	ДлинаРазделителя    = СтрДлина(Разделитель);
	Если ПозРазделителя > 0 Тогда
		ПраваяЧасть	 = Сред(Стр, ПозРазделителя + ?(Режим=2, 0, ДлинаРазделителя));
		Стр          = СокрЛП(Лев(Стр, ПозРазделителя - ?(Режим=1, -ДлинаРазделителя + 1, 1)));
	КонецЕсли;

	Возврат(ПраваяЧасть);

КонецФункции // ОтделитьРазделителем()

Функция МассивИзСтроки(Знач Стр, Разделитель=",")

	Массив      = Новый Массив;
	ПраваяЧасть = ОтделитьРазделителем(Стр, Разделитель);
	
	Пока Не ПустаяСтрока(Стр) Цикл
		Массив.Добавить(СокрЛП(Стр));
		Стр         = ПраваяЧасть;
		ПраваяЧасть = ОтделитьРазделителем(Стр, Разделитель);
	КонецЦикла; 

	Возврат(Массив);
	
КонецФункции // МассивИзСтроки() 

Процедура УстановитьВидимостьДоступность()
	
	Если Родитель = Справочники.Типоразмеры.НайтиПоНаименованию("Шины") Тогда
		ЭлементыФормы.Высота.Видимость = Истина;
		ЭлементыФормы.КоличествоОтверстий.Видимость = Ложь;
		ЭлементыФормы.НадписьВысота.Заголовок = "Высота:";
		ЭлементыФормы.ШиринаВДюймах.Видимость = Истина;
		ЭлементыФормы.ШиринаВДюймах.Доступность = Истина;
		ЭлементыФормы.НадписьPCD.Заголовок = "Ширина в дюймах:";
		ЭлементыФормы.PCD.Доступность = Ложь;
		ЭлементыФормы.Вылет.Доступность = Ложь;
		ЭлементыФормы.ДиаметрСтупицы.Доступность = Ложь;
		ЭлементыФормы.PCD.Видимость = Ложь;
		ЭлементыФормы.Вылет.Видимость = Ложь;
		ЭлементыФормы.ДиаметрСтупицы.Видимость = Ложь;
	ИначеЕсли Родитель = Справочники.Типоразмеры.НайтиПоНаименованию("Диски") Тогда
		ЭлементыФормы.КоличествоОтверстий.Видимость = Истина;
		ЭлементыФормы.Высота.Видимость = Ложь;
		ЭлементыФормы.НадписьВысота.Заголовок = "Кол-во отверстий:";
		ЭлементыФормы.PCD.Доступность = Истина;
		ЭлементыФормы.Вылет.Доступность = Истина;
		ЭлементыФормы.ДиаметрСтупицы.Доступность = Истина;
		ЭлементыФормы.PCD.Видимость = Истина;
		ЭлементыФормы.Вылет.Видимость = Истина;
		ЭлементыФормы.ДиаметрСтупицы.Видимость = Истина;
		ЭлементыФормы.ШиринаВДюймах.Видимость = Ложь;
		ЭлементыФормы.ШиринаВДюймах.Доступность = Ложь;
		ЭлементыФормы.НадписьPCD.Заголовок = "PCD:";
    КонецЕсли;
	
КонецПроцедуры

Процедура ПриОткрытии()
	
	УстановитьВидимостьДоступность();
		
КонецПроцедуры  

Процедура РодительПриИзменении(Элемент)
	
	УстановитьВидимостьДоступность();
	
КонецПроцедуры


Процедура ДействияФормыНормаЗагрузки(Кнопка)
	
	фрм1 = Справочники.НормыЗагрузки.ПолучитьФормуСписка();
	фрм1.отбор.Типоразмер.ВидСравнения = ВидСравнения.Равно;
	фрм1.отбор.Типоразмер.Значение = Ссылка;
	фрм1.отбор.Типоразмер.Использование = истина;
	фрм1.Открыть();
	
КонецПроцедуры


Процедура ДействияФормыНормаЗагрузки(Кнопка)
	
	Если (ЭлементыФормы.СправочникСписок.ТекущиеДанные.Ссылка.ЭтоГруппа = Истина) Тогда
		Возврат;
	КонецЕсли;
	
	Если (ТекущийВидПродукции = Неопределено) Тогда 
		ТекущаяНормаЗагрузкиЭл = Справочники.НормыЗагрузки.НайтиПоРеквизиту("Типоразмер",ЭлементыФормы.СправочникСписок.ТекущиеДанные.Ссылка);			
	Иначе 
		ТекущаяНормаЗагрузкиЭл = НайтиСсылкуНаНормуЗагрузки(ЭлементыФормы.СправочникСписок.ТекущиеДанные.Ссылка);		
	КонецЕсли;
	
	СсылкаЭл = ТекущаяНормаЗагрузкиЭл;
	
	Если (ТекущаяНормаЗагрузкиЭл = Справочники.НормыЗагрузки.ПустаяСсылка()) Тогда
		
		ТекущаяНормаЗагрузкиЭл = Справочники.НормыЗагрузки.СоздатьЭлемент();
		ТекущаяНормаЗагрузкиЭл.Типоразмер = ЭлементыФормы.СправочникСписок.ТекущиеДанные.Ссылка;
		ТекущаяНормаЗагрузкиЭл.КоэффициентКоличества = 1;
		ТекущаяНормаЗагрузкиЭл.КоэффициентИмпорта = 1;
		ТекущаяНормаЗагрузкиЭл.ВидПродукции = ТекущийВидПродукции;
		ТекущаяНормаЗагрузкиЭл.Записать();
		СсылкаЭл = ТекущаяНормаЗагрузкиЭл.Ссылка;
		
	ИначеЕсли (ТекущаяНормаЗагрузкиЭл.Типоразмер = Справочники.Типоразмеры.ПустаяСсылка()) Тогда 
		
		Объект = СсылкаЭл.ПолучитьОбъект(); 
		Объект.Типоразмер = ЭлементыФормы.СправочникСписок.ТекущиеДанные.Ссылка;
		Объект.Наименование = ЭлементыФормы.СправочникСписок.ТекущиеДанные.Ссылка.Наименование;
		Объект.Записать();
				
	КонецЕсли;
	
	Форма = Справочники.НормыЗагрузки.ПолучитьФормуСписка();
	Форма.ОтборТипоразмер = ЭлементыФормы.СправочникСписок.ТекущиеДанные.Ссылка;
	//Форма.ЭлементТек = СсылкаЭл;
	Форма.РедактированиеИзФорм = Истина;
	Форма.Открыть();
	
КонецПроцедуры

Функция НайтиСсылкуНаНормуЗагрузки(ТРазмер) 
	
	Запрос = новый Запрос;
	Запрос.Текст = "
	|ВЫБРАТЬ Ссылка из Справочник.НормыЗагрузки
	|Где ВидПродукции = &ВидПродукции И Типоразмер = &Типоразмер";
	
	Запрос.УстановитьПараметр("ВидПродукции",ТекущийВидПродукции);
	Запрос.УстановитьПараметр("Типоразмер",ТРазмер);
	Выб = Запрос.Выполнить().Выбрать();
	
	Если (Выб.Следующий()) Тогда 
		Возврат Выб.Ссылка;
	КонецЕсли;
	
	Возврат Справочники.НормыЗагрузки.ПустаяСсылка(); 
	
КонецФункции


Процедура КнопкаСформироватьНажатие(Кнопка)
	СписокКонтрагентов=Новый СписокЗначений;
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("91735")); //FREEMAN RACING WHEELS INC
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("93695")); //NINGBO PARTNER INTERNATIONAL TRADE CO., LTD
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("91535")); //JIANGSU SAINTY MACHINERY I&E CORP. LTD
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("П000715")); //Zhejiang Jingu Company Ltd
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("93777")); //Steel Strips Wheels Limited
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("93694")); //Zhangzhou Shuangsheng WHeels Co., ltd
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("91834")); //NINGBO LONGTIME MACHINE CO.,LTD
	СписокКонтрагентов.Добавить(Справочники.Контрагенты.НайтиПоКоду("П001626")); //XIAMEN YONGXINGXUN INDUSTRY AND TRADE CO., LTD	
	
	
	СписокИсключаемыхДоговоров=новый СписокЗначений;
	СписокИсключаемыхДоговоров.Добавить(Справочники.ДоговорыКонтрагентов.НайтиПоКоду("F3577",,,Справочники.Контрагенты.НайтиПоКоду("91735  "))); //FREEMAN RACING WHEELS INC
	СписокИсключаемыхДоговоров.Добавить(Справочники.ДоговорыКонтрагентов.НайтиПоКоду("F3551",,,Справочники.Контрагенты.НайтиПоКоду("91535  "))); //JIANGSU SAINTY MACHINERY I&E CORP. LTD
	
	Запрос=новый Запрос;
	Запрос.Текст="ВЫБРАТЬ
	             |	ПоступлениеТоваровУслуг.Ссылка КАК ПоступлениеТоваровУслуг,
	             |	ПоступлениеТоваровУслуг.Сделка.НомерКонтейнера
	             |ПОМЕСТИТЬ втПоступления
	             |ИЗ
	             |	Документ.ПоступлениеТоваровУслуг КАК ПоступлениеТоваровУслуг
	             |ГДЕ
	             |	ПоступлениеТоваровУслуг.Дата МЕЖДУ &ДатаН И &ДатаК
	             |	И ПоступлениеТоваровУслуг.Проведен = ИСТИНА
	             |	И (ПоступлениеТоваровУслуг.НомерВходящегоДокумента ПОДОБНО ""%себ сформир%""
	             |			ИЛИ ПоступлениеТоваровУслуг.НомерВходящегоДокумента ПОДОБНО ""%себ сформир%""
	             |			ИЛИ ПоступлениеТоваровУслуг.НомерВходящегоДокумента ПОДОБНО ""%cеб сформир%""
	             |			ИЛИ ПоступлениеТоваровУслуг.НомерВходящегоДокумента ПОДОБНО ""%себ. сформир%""
	             |			ИЛИ ПоступлениеТоваровУслуг.НомерВходящегоДокумента ПОДОБНО ""%cеб. сформир%""
	             |			ИЛИ ПоступлениеТоваровУслуг.НомерВходящегоДокумента ПОДОБНО ""%себ.сформир%""
	             |			ИЛИ ПоступлениеТоваровУслуг.НомерВходящегоДокумента ПОДОБНО ""%себест.сформир%"")
	             |	И НЕ ПоступлениеТоваровУслуг.Сделка.НомерКонтейнера ЕСТЬ NULL 
	             |	И НЕ ПоступлениеТоваровУслуг.Сделка.НомерКонтейнера = """"
	             |	И ПоступлениеТоваровУслуг.Контрагент В(&СписокКонтрагентов)
	             |;
	             |
	             |////////////////////////////////////////////////////////////////////////////////
	             |ВЫБРАТЬ
	             |	ПоступлениеДопРасходовТовары.ДокументПартии КАК ДокументПартии,
	             |	МАКСИМУМ(ПоступлениеДопРасходовТовары.Ссылка.СуммаДокумента) КАК СуммаДокумента,
	             |	ПоступлениеДопРасходовТовары.Ссылка КАК Ссылка
	             |ПОМЕСТИТЬ ВтОснова
	             |ИЗ
	             |	Документ.ПоступлениеДопРасходов.Товары КАК ПоступлениеДопРасходовТовары
	             |ГДЕ
	             |	ПоступлениеДопРасходовТовары.ДокументПартии В
	             |			(ВЫБРАТЬ
	             |				втПоступления.ПоступлениеТоваровУслуг
	             |			ИЗ
	             |				втПоступления КАК втПоступления)
	             |	И ПоступлениеДопРасходовТовары.Ссылка.Проведен = ИСТИНА
	             |	И НЕ ПоступлениеДопРасходовТовары.Ссылка.ДоговорКонтрагента В (&СписокИсключаемыхДоговоров)
	             |
	             |СГРУППИРОВАТЬ ПО
	             |	ПоступлениеДопРасходовТовары.ДокументПартии,
	             |	ПоступлениеДопРасходовТовары.Ссылка
	             |;
	             |
	             |////////////////////////////////////////////////////////////////////////////////
	             |ВЫБРАТЬ
	             |	втПоступления.ПоступлениеТоваровУслуг,
	             |	втПоступления.СделкаНомерКонтейнера КАК НомерКонтейнера,
	             |	А.СуммаДопРасходов
	             |ИЗ
	             |	втПоступления КАК втПоступления
	             |		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	             |			ВтОснова.ДокументПартии КАК Поступление,
	             |			СУММА(ВтОснова.СуммаДокумента) КАК СуммаДопРасходов
	             |		ИЗ
	             |			ВтОснова КАК ВтОснова
	             |		
	             |		СГРУППИРОВАТЬ ПО
	             |			ВтОснова.ДокументПартии) КАК А
	             |		ПО втПоступления.ПоступлениеТоваровУслуг = А.Поступление";
	Запрос.УстановитьПараметр("ДатаН",НачПериода);
	Запрос.УстановитьПараметр("ДатаК",КонецДня(КонПериода));
	Запрос.УстановитьПараметр("СписокКонтрагентов",СписокКонтрагентов);
	Запрос.УстановитьПараметр("СписокИсключаемыхДоговоров",СписокИсключаемыхДоговоров);
	
	Рез=Запрос.Выполнить().Выбрать();
	
	Если Рез.Количество()>0 Тогда
		Эксель = Новый COMОбъект("Excel.Application");
		//ПутьКФайлу="\\Novikova\Таблица11\таблица 11.xls";
		ПутьКФайлу="c:\Таблица11\таблица 11.xls";
		Файл = Новый Файл(ПутьКФайлу);
		Если Не Файл.Существует() Тогда
			Сообщить("Файл не существует!");
			Возврат;
		КонецЕсли; 
		Книга   = Эксель.Workbooks.Open(ПутьКФайлу);
		КоличествоЛистов = Книга.Sheets.Count;
		НомерЛиста=1;
		СписокЛистов=новый СписокЗначений;
		Пока НомерЛиста <= КоличествоЛистов Цикл
			СписокЛистов.Добавить(Книга.Sheets(НомерЛиста).Name);
			НомерЛиста=НомерЛиста+1;
		КонецЦикла;
		ЛистСезон=СписокЛистов.ВыбратьЭлемент("Укажите сезон");
		Лист                = Книга.Worksheets(ЛистСезон.Значение);
		
		КолонкаКонтейнер="I";
		КолонкаСуммаДопРасходов="DD";
		
		
		Пока Рез.Следующий() Цикл
				Допрасходы=0;
				КонтейнерИзДока=СокрЛП(Рез.НомерКонтейнера);
				НСтр = Лист.Columns(КолонкаКонтейнер).Find(КонтейнерИзДока);
				Если НСтр<>Неопределено тогда
					СтрокаExcel=НСтр.Row;
					ДопРасходыИзФайлаСтр=СокрЛП(Лист.Cells(СтрокаExcel,  КолонкаСуммаДопРасходов).Value);
					СуммаДопРасходовИзФайла=?(ДопРасходыИзФайлаСтр<>"",Окр(Число(ДопРасходыИзФайлаСтр),2),0);
					Если Рез.СуммаДопРасходов<>СуммаДопРасходовИзФайла тогда
						Сообщить(""+Рез.ПоступлениеТоваровУслуг+" сумма в 1с: "+Рез.СуммаДопРасходов+" сумма в файле: "+СуммаДопРасходовИзФайла+" разница: "+(Рез.СуммаДопРасходов-СуммаДопРасходовИзФайла));
					КонецЕсли;	
				Иначе
					Сообщить("Не найден контейнер №"+КонтейнерИзДока);
				КонецЕсли;
        КонецЦикла;
		
		Эксель.DisplayAlerts = 0; 
		Эксель.Quit();
	КонецЕсли;
КонецПроцедуры

Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	Если НастройкаПериода.Редактировать() Тогда
		НачПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры

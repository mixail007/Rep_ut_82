Перем ПечОтветственный, НомерНаряда, ПечОрганизация, ПечМесяц, ПечГод;
Перем мВалютаРегламентированногоУчета;
Процедура УстановитьИнтервал(Дата)

	НачПериода = НачалоДня(Дата);
	КонПериода = КонецДня(Дата);

КонецПроцедуры

Процедура Печать()

 Запрос = Новый Запрос;
 Запрос.УстановитьПараметр("ДатаНач", НачалоДня(НачПериода));
 Запрос.УстановитьПараметр("ДатаКон", КонецДня(НачПериода));
 
 Запрос.Текст = "
 |ВЫБРАТЬ
 |	Сотрудник,
 |	ВесОборот КАК Кол
 |ИЗ
 |	РегистрНакопления.ДанныеПоГрузчикам.Обороты(&ДатаНач, &ДатаКон)";
 
 Выборка = Запрос.Выполнить().Выбрать();
 
 Если Выборка.Количество() = 0 Тогда
 
 	Предупреждение("За данный день не заполнено ни одного наряда!", 10);
	
	Возврат;
 
 КонецЕсли; 
 
 ТабДок = Новый ТабличныйДокумент;
 
 Макет = ПолучитьМакет("Макет");
 
 ОбластьМакета = Макет.ПолучитьОбласть("Шапка");
 
 ОбластьМакета.Параметры.Организация = ПечОрганизация;
 
 ОбластьМакета.Параметры.Ответственный = ПечОтветственный;
 
 ОбластьМакета.Параметры.Мастер = Мастер;
 
 ОбластьМакета.Параметры.Месяц = ПечМесяц;
 
 ОбластьМакета.Параметры.Год = ПечГод;
 
 ОбластьМакета.Параметры.НомерНаряда = НомерНаряда;
 
 ТабДок.Вывести(ОбластьМакета);
 
 ОбластьМакета = Макет.ПолучитьОбласть("Строка");
 
 Кол = 0;
 Ном = 0;
 
 Пока Выборка.Следующий() Цикл
     Ном = Ном + 1;
 	 ОбластьМакета.Параметры.Сотрудник = Выборка.Сотрудник;
	 ОбластьМакета.Параметры.Количество = Выборка.Кол/1000;
	 ОбластьМакета.Параметры.Расценка = Расценка*1000;
	 ОбластьМакета.Параметры.Стоимость = Выборка.Кол * Расценка;
	 ОбластьМакета.Параметры.Ном = Ном;
	 Кол = Кол + Выборка.Кол;
	 //ОбластьМакета.Параметры.Дата = Выборка.Период;
	 ТабДок.Вывести(ОбластьМакета);
 
 КонецЦикла; 
 
 ОбластьМакета = Макет.ПолучитьОбласть("Итог");
 
 ОбластьМакета.Параметры.Количество = Кол/1000;
 
 ОбластьМакета.Параметры.Стоимость  = Кол*Расценка;
 
 ОбластьМакета.Параметры.Расценка   = Расценка*1000;
 
 ТабДок.Вывести(ОбластьМакета);
 
 ОбластьМакета = Макет.ПолучитьОбласть("Подвал");
 
 ОбластьМакета.Параметры.СуммаНаряда = СформироватьСуммуПрописью(Кол*Расценка, мВалютаРегламентированногоУчета);
 
 ОбластьМакета.Параметры.РасшифровкаМастер = Мастер;
 
 ОбластьМакета.Параметры.РасшифровкаСКладовщик = Складовщик;
 
 ОбластьМакета.Параметры.РасшифровкаЗавСкладом = ЗавСкладом;
 
 
 ТабДок.Вывести(ОбластьМакета);
 
 ТабДок.ОтображатьЗаголовки = Ложь;
 ТабДок.ОтображатьСетку     = Ложь;
 ТабДок.ТолькоПросмотр      = Истина;
 ТабДок.АвтоМасштаб 		= Истина;
 ТабДок.ОриентацияСтраницы  = ОриентацияСтраницы.Ландшафт;
 ТабДок.Показать("Наряд №" + НомерНаряда);


КонецПроцедуры
 
 
Процедура КнопкаВыполнитьНажатие(Кнопка)
	
	Г = Строка(Год(НачПериода));
	
	ПечГод = "";
	
	Для Сч = 1 По СтрДлина(Г) Цикл
	
		Если КодСимвола(Сред(Г, Сч, 1)) <> 160 Тогда
		
			ПечГод = ПечГод + Сред(Г, Сч, 1);
		
		КонецЕсли; 
	
	КонецЦикла; 
	
	ПечОтветственный = глТекущийПользователь;
	ПечОрганизация	 = Организация;
	ПечМесяц         = ?(СтрДлина(СокрЛП(Строка(Месяц(НачПериода)))) < 2, "0" + СокрЛП(Строка(Месяц(НачПериода))), СокрЛП(Строка(Месяц(НачПериода))));
	//ПечГод			 = Год(НачПериода);
	НомерНаряда 	 = ?(СтрДлина(СокрЛП(Строка(День(НачПериода)))) < 2, 
						 "0" + СокрЛП(Строка(День(НачПериода))), СокрЛП(Строка(День(НачПериода)))) + "-" +
					   ?(СтрДлина(СокрЛП(Строка(Месяц(НачПериода)))) < 2, 
						 "0" + СокрЛП(Строка(Месяц(НачПериода))), СокрЛП(Строка(Месяц(НачПериода)))) + "/" +
					     Прав(СокрЛП(Строка(Год(НачПериода))), 2) + "-Гр";
	
	Печать();
	
КонецПроцедуры

Процедура ПриОткрытии()
	
	Выб = Справочники.Организации.Выбрать();
	
	Пока Выб.Следующий() Цикл
	
		Орг = Выб.Ссылка;
		
		Если (Орг <> Справочники.Организации.ПустаяСсылка()) И НЕ (Орг.ЭтоГруппа) Тогда
		
			Прервать;
		
		КонецЕсли; 
	
	КонецЦикла; 
	
	Орг1 = ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "ОсновнаяОрганизация");
	
	УстановитьИнтервал(ТекущаяДата());
    Организация      = ?(ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "ОсновнаяОрганизация") = Справочники.Организации.ПустаяСсылка(),
						 Орг,
						 ПолучитьЗначениеПоУмолчанию(глТекущийПользователь, "ОсновнаяОрганизация"));

	 Для каждого ВыбКонстанта Из Метаданные.Константы Цикл
	 
	 	Если ВыбКонстанта.Имя = "Расценка" Тогда
		
			Расценка = Константы.Расценка.Получить();
			
			Если Константы.Расценка.Получить() > 0 Тогда
			
				ЭлементыФормы.Расценка.Доступность = Ложь;
			
			КонецЕсли; 
			
		
		КонецЕсли; 	
		
		Если ВыбКонстанта.Имя = "ЗавСкладом" Тогда
		
			ЗавСкладом = Константы.Завскладом.Получить();
			
			Если Константы.Завскладом.Получить() <> Справочники.ФизическиеЛица.ПустаяСсылка() Тогда
			
				ЭлементыФормы.ЗавСкладом.Доступность = Ложь;
			
			КонецЕсли; 
		
		КонецЕсли; 	

	 
	 КонецЦикла; 
	 
	 
	
	
 КонецПроцедуры
 
 
 мВалютаРегламентированногоУчета   = Константы.ВалютаРегламентированногоУчета.Получить();
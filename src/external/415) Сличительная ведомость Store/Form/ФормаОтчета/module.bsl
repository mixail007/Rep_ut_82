Процедура КнопкаСформироватьНажатие(Кнопка)
	Если ЭлементыФормы.Заказы.Значение = 0 Тогда
	Результат = Прочитать();
	НомерПП=0;
	ТабДок = ЭлементыФормы.ПолеТабличногоДокумента;
	ТабДок.Очистить();
	Макет = ПолучитьМакет("Макет");
	ОбластьЗаголовок = Макет.ПолучитьОбласть("Заголовок");
	
	ОбластьЗаголовок.Параметры.Период = ПредставлениеПериода(НачалоДня(НачПериода),КонецДня(КонПериода),"ФП=Истина");
	ТабДок.Вывести(ОбластьЗаголовок);

    
    ОбластьШапкаТаблицы = Макет.ПолучитьОбласть("Шапка");
	
	ТабДок.Вывести(ОбластьШапкаТаблицы);
	ИтогоЗаказов = Результат.Количество();
	ПоСтатусу = 0;
	ПоСумме = 0; 
	Для каждого строка ИЗ Результат Цикл
		Если (строка.Статус <> строка.СтатусStor) или ((строка.СуммаДокумента - строка.СуммаЗаказаStor)>1 или (строка.СуммаДокумента - строка.СуммаЗаказаStor)<-1) Тогда	
			НомерПП=НомерПП+1;
			ОбластьСтрокаДокумент = Макет.ПолучитьОбласть("СтрокаДокумента");
			ОбластьСтрокаДокумент.Параметры.Заполнить(строка);
			ОбластьСтрокаДокумент.Параметры.НомерПП=НомерПП;
			Если  строка.Статус <> строка.СтатусStor Тогда
				ОбластьСтрокаДокумент.Области.Статусы.ЦветФона=WebЦвета.БледноЗеленый;
				постатусу = постатусу+1; 
			конецЕсли;
			Если  строка.СуммаДокумента <> строка.СуммаЗаказаStor Тогда
				ОбластьСтрокаДокумент.Области.Суммы.ЦветФона=WebЦвета.БледноБирюзовый;
				ПоСумме = ПоСумме+1;
			конецЕсли;
			//если  Строка.ссылка <> Null Тогда
			//ДокументОбъект=Строка.ссылка.ПолучитьОбъект();
			//ДокументОбъект.ОбменДанными.Загрузка = истина; //+++ 19.10.2011 для перезаписи даже в закрытом периоде?!
			//ОбменСУТИнтернетМагазин.ВключитьРегистрациюОбъектаОИМ(ДокументОбъект,Истина);
			//конецЕсли;
			ТабДок.Вывести(ОбластьСтрокаДокумент);
		конецЕсли;
	КонецЦикла;	
    //ТабДок.ТолькоПросмотр=Истина;
    ЭлементыФормы.ПолеТабличногоДокумента.ТолькоПросмотр=Истина;
    ЭлементыФормы.Инфо.Заголовок = "Всего заказов "+ИтогоЗаказов+". Расхождения по статусу у "+постатусу +" заказов (" +Окр(постатусу/ИтогоЗаказов*100,2)+"%).Расхождения по сумме у "+посумме+" заказов ("+ +Окр(посумме/ИтогоЗаказов*100,2)+"%)."; 
иначе
	Результат = ПрочитатьРеализации();
	НомерПП=0;
	ТабДок = ЭлементыФормы.ПолеТабличногоДокумента;
	ТабДок.Очистить();
	Макет = ПолучитьМакет("МакетРеализации");
	ОбластьЗаголовок = Макет.ПолучитьОбласть("Заголовок");
	
	ОбластьЗаголовок.Параметры.Период = ПредставлениеПериода(НачалоДня(НачПериода),КонецДня(КонПериода),"ФП=Истина");
	ТабДок.Вывести(ОбластьЗаголовок);

    
    ОбластьШапкаТаблицы = Макет.ПолучитьОбласть("Шапка");
	
	ТабДок.Вывести(ОбластьШапкаТаблицы);
	ИтогоЗаказов = Результат.Количество();
	ПоСтатусу = 0;
	ПоСумме = 0; 
	Для каждого строка ИЗ Результат Цикл
		Если  ((строка.СуммаДокумента - строка.СуммаДокументаStore)>1 или (строка.СуммаДокумента - строка.СуммаДокументаStore)<-1) Тогда	
			НомерПП=НомерПП+1;
			ОбластьСтрокаДокумент = Макет.ПолучитьОбласть("СтрокаДокумента");
			ОбластьСтрокаДокумент.Параметры.Заполнить(строка);
			ОбластьСтрокаДокумент.Параметры.НомерПП=НомерПП;
			Если  строка.СуммаДокумента <> строка.СуммаДокументаStore Тогда
				ОбластьСтрокаДокумент.Области.Суммы.ЦветФона=WebЦвета.БледноБирюзовый;
				ПоСумме = ПоСумме+1;
			конецЕсли;
			//если  Строка.ссылка <> Null Тогда
			//ДокументОбъект=Строка.ссылка.ПолучитьОбъект();
			//ДокументОбъект.ОбменДанными.Загрузка = истина; //+++ 19.10.2011 для перезаписи даже в закрытом периоде?!
			//ОбменСУТИнтернетМагазин.ВключитьРегистрациюОбъектаОИМ(ДокументОбъект,Истина);
			//конецЕсли;
			ТабДок.Вывести(ОбластьСтрокаДокумент);
		конецЕсли;
	КонецЦикла;	
    //ТабДок.ТолькоПросмотр=Истина;
    ЭлементыФормы.ПолеТабличногоДокумента.ТолькоПросмотр=Истина;
    ЭлементыФормы.Инфо.Заголовок = "Всего реализаций "+ИтогоЗаказов+".Расхождения по сумме у "+посумме+" роеализаций ("+ +Окр(посумме/ИтогоЗаказов*100,2)+"%)."; 
	
	
	
	
	
	
	
	
	
конецЕсли;	
КонецПроцедуры

Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	Если НастройкаПериода.Редактировать() Тогда
		НачПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры

Процедура ЗарегистрироватьНажатие(Элемент)
	мСписокДокументовДляРегистрации = новый СписокЗначений;
	
	Для каждого ВыделеннаяОбласть ИЗ ЭлементыФормы.ПолеТабличногоДокумента.ВыделенныеОбласти Цикл
		ИмяОбласти=ВыделеннаяОбласть.Имя;		
		
		индДвоеточия=Найти(ИмяОбласти,":");
		
		Если индДвоеточия>0 Тогда // несколько ячеек
			индR1=Найти(ИмяОбласти,"R");
			индC1=Найти(ИмяОбласти,"C");
			
			НачальныйНомер=Число(Сред(ИмяОбласти,индR1+1,индC1-индR1-1));
			ОстСтрока=Сред(ИмяОбласти,индДвоеточия);
			
			индR2=Найти(ОстСтрока,"R");
			индC2=Найти(ОстСтрока,"C");
			КонечныйНомер=Число(Сред(ОстСтрока,индR2+1,индC2-индR2-1));                                
			
			Для сч=НачальныйНомер по КонечныйНомер Цикл
				диапазон = "R"+Строка(Формат(сч,"ЧГ=0"))+"C1:R"+Строка(Формат(сч,"ЧГ=0"))+"C5";
				мСсылкаНаДокумент=ЭлементыФормы.ПолеТабличногоДокумента.Область("R"+Строка(Формат(сч,"ЧГ=0"))+"C2").Расшифровка;
				Если не ЗначениеНеЗаполнено(мСсылкаНаДокумент) Тогда 
					ЭлементыФормы.ПолеТабличногоДокумента.Область(диапазон).ЦветФона=WebЦвета.СветлоРозовый;
					Если мСписокДокументовДляРегистрации.НайтиПоЗначению(мСсылкаНаДокумент)=Неопределено Тогда
						мСписокДокументовДляРегистрации.Добавить(мСсылкаНаДокумент);
						//Сообщить(мСсылкаНаДокумент);
					КонецЕсли;	
				КонецЕсли;
			КонецЦикла;	
			
		Иначе // одна ячейка

			индR1=Найти(ИмяОбласти,"R");
			индC1=Найти(ИмяОбласти,"C");
			
			сч=Число(Сред(ИмяОбласти,индR1+1,индC1-индR1-1));
			диапазон = "R"+Строка(Формат(сч,"ЧГ=0"))+"C1:R"+Строка(Формат(сч,"ЧГ=0"))+"C5";
			мСсылкаНаДокумент=ЭлементыФормы.ПолеТабличногоДокумента.Область("R"+Строка(Формат(сч,"ЧГ=0"))+"C2").Расшифровка;
			Если не ЗначениеНеЗаполнено(мСсылкаНаДокумент) Тогда 
				ЭлементыФормы.ПолеТабличногоДокумента.Область(диапазон).ЦветФона=WebЦвета.СветлоРозовый;
					Если мСписокДокументовДляРегистрации.НайтиПоЗначению(мСсылкаНаДокумент)=Неопределено Тогда
						мСписокДокументовДляРегистрации.Добавить(мСсылкаНаДокумент);
						//Сообщить(мСсылкаНаДокумент);
					КонецЕсли;	
			КонецЕсли;


		КонецЕсли;	
		
				
КонецЦикла;	

	//УзелОбмена = ПланыОбмена.ОбменУТ_БП.НайтиПоНаименованию("БП");
		
	Для сч=0 по мСписокДокументовДляРегистрации.Количество()-1 Цикл
	ТекущаяСтрока = мСписокДокументовДляРегистрации[сч];
	
	//Объект = Новый УдалениеОбъекта(ТекущаяСтрока.Значение); 
	//ПланыОбмена.ЗарегистрироватьИзменения(УзелОбмена, Объект);
	
	ДокументОбъект=ТекущаяСтрока.Значение.ПолучитьОбъект();
	
	ДокументОбъект.ОбменДанными.Загрузка = истина; //+++ 19.10.2011 для перезаписи даже в закрытом периоде?!
    ОбменСУТИнтернетМагазин.ВключитьРегистрациюОбъектаОИМ(ДокументОбъект,Истина);
	//ЗарегистрироватьОбъект(ДокументОбъект,Ложь,Истина,Истина);
	КонецЦикла;
		
	
	

КонецПроцедуры


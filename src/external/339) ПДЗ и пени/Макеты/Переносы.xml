<?xml version="1.0" encoding="UTF-8"?>
<SchemaFile xmlns="" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema">
		<dataSource>
			<name>ИсточникДанных1</name>
			<dataSourceType>Local</dataSourceType>
		</dataSource>
		<dataSet xsi:type="DataSetQuery">
			<name>НаборДанных1</name>
			<field xsi:type="DataSetFieldField">
				<dataPath>Возврат</dataPath>
				<field>Возврат</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>ДЗ</dataPath>
				<field>ДЗ</field>
				<title xmlns:d5p1="http://v8.1c.ru/8.1/data/core" xsi:type="d5p1:LocalStringType">
					<d5p1:item>
						<d5p1:lang>ru</d5p1:lang>
						<d5p1:content>Дебеторская задолженность</d5p1:content>
					</d5p1:item>
				</title>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>ДоговорКонтрагента</dataPath>
				<field>ДоговорКонтрагента</field>
				<role>
					<dimension xmlns="http://v8.1c.ru/8.1/data-composition-system/common">true</dimension>
				</role>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Контрагент</dataPath>
				<field>Контрагент</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Менеджер</dataPath>
				<field>Менеджер</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>НаправлениеПродаж</dataPath>
				<field>НаправлениеПродаж</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Оплата</dataPath>
				<field>Оплата</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Отгрузка</dataPath>
				<field>Отгрузка</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>ПДЗ</dataPath>
				<field>ПДЗ</field>
				<title xmlns:d5p1="http://v8.1c.ru/8.1/data/core" xsi:type="d5p1:LocalStringType">
					<d5p1:item>
						<d5p1:lang>ru</d5p1:lang>
						<d5p1:content>в том числе просроченная </d5p1:content>
					</d5p1:item>
				</title>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>ПроцентОплаты</dataPath>
				<field>ПроцентОплаты</field>
				<appearance>
					<item xmlns="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xsi:type="dcsset:SettingsParameterValue">
						<parameter>Формат</parameter>
						<value xsi:type="xs:string">ЧДЦ=2</value>
					</item>
				</appearance>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Сделка</dataPath>
				<field>Сделка</field>
				<role>
					<dimension xmlns="http://v8.1c.ru/8.1/data-composition-system/common">true</dimension>
				</role>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>КонечнаяДатаОТХ</dataPath>
				<field>КонечнаяДатаОТХ</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>ПроцентОТХ</dataPath>
				<field>ПроцентОТХ</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>СхемаРаботыОТХ</dataPath>
				<field>СхемаРаботыОТХ</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>ДатаОплаты</dataPath>
				<field>ДатаОплаты</field>
				<appearance>
					<item xmlns="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xsi:type="dcsset:SettingsParameterValue">
						<parameter>Формат</parameter>
						<value xsi:type="xs:string">ДФ=dd.MM.yyyy</value>
					</item>
				</appearance>
			</field>
			<dataSource>ИсточникДанных1</dataSource>
			<query>ВЫБРАТЬ
	ВзаиморасчетыСКонтрагентамиОстатки.ДоговорКонтрагента.ОтветственноеЛицо КАК Менеджер,
	ВзаиморасчетыСКонтрагентамиОстатки.ДоговорКонтрагента.ОтветственноеЛицо.НаправлениеПродаж КАК НаправлениеПродаж,
	ВзаиморасчетыСКонтрагентамиОстатки.ДоговорКонтрагента.Владелец КАК Контрагент,
	ВЫРАЗИТЬ(ВзаиморасчетыСКонтрагентамиОстатки.Сделка КАК Документ.ЗаказПокупателя) КАК Сделка,
	ВзаиморасчетыСКонтрагентамиОстатки.Сделка.ПроцентОТХ,
	ВзаиморасчетыСКонтрагентамиОстатки.Сделка.КонечнаяДатаОТХ,
	ВзаиморасчетыСКонтрагентамиОстатки.Сделка.СхемаРаботыОТХ,
	ВзаиморасчетыСКонтрагентамиОстатки.ДоговорКонтрагента,
	ВзаиморасчетыСКонтрагентамиОстатки.СуммаВзаиморасчетовОстаток КАК Остаток
ПОМЕСТИТЬ ВТ
ИЗ
	РегистрНакопления.ВзаиморасчетыСКонтрагентами.Остатки({(&amp;КонПериодаП)}, ДоговорКонтрагента.Наименование ПОДОБНО "%перенос/возврат%") КАК ВзаиморасчетыСКонтрагентамиОстатки
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыСКонтрагентамиОбороты.Регистратор ССЫЛКА Документ.РеализацияТоваровУслуг
				ТОГДА ВзаиморасчетыСКонтрагентамиОбороты.СуммаВзаиморасчетовПриход
			ИНАЧЕ 0
		КОНЕЦ) КАК Отгрузка,
	СУММА(ВЫБОР
			КОГДА ВзаиморасчетыСКонтрагентамиОбороты.Регистратор ССЫЛКА Документ.ВозвратТоваровОтПокупателя
				ТОГДА ВзаиморасчетыСКонтрагентамиОбороты.СуммаВзаиморасчетовПриход
			ИНАЧЕ 0
		КОНЕЦ) КАК Возврат,
	ВзаиморасчетыСКонтрагентамиОбороты.Сделка,
	ВзаиморасчетыСКонтрагентамиОбороты.ДоговорКонтрагента
ПОМЕСТИТЬ Отгрузки
ИЗ
	РегистрНакопления.ВзаиморасчетыСКонтрагентами.Обороты({(&amp;НачПериодаП)}, {(&amp;КонПериодаП)}, Регистратор, ДоговорКонтрагента.Наименование ПОДОБНО "%перенос/возврат%") КАК ВзаиморасчетыСКонтрагентамиОбороты

СГРУППИРОВАТЬ ПО
	ВзаиморасчетыСКонтрагентамиОбороты.Сделка,
	ВзаиморасчетыСКонтрагентамиОбороты.ДоговорКонтрагента
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ЕСТЬNULL(Отгрузки.ДоговорКонтрагента.ОтветственноеЛицо, ВТ.Менеджер) КАК Менеджер,
	ЕСТЬNULL(Отгрузки.ДоговорКонтрагента.ОтветственноеЛицо.НаправлениеПродаж, ВТ.НаправлениеПродаж) КАК НаправлениеПродаж,
	ЕСТЬNULL(Отгрузки.ДоговорКонтрагента.Владелец, ВТ.Контрагент) КАК Контрагент,
	ЕСТЬNULL(Отгрузки.Сделка, ВТ.Сделка) КАК Сделка,
	ЕСТЬNULL(Отгрузки.Сделка.ПроцентОТХ, ВТ.СделкаПроцентОТХ) КАК ПроцентОТХ,
	ЕСТЬNULL(Отгрузки.Сделка.КонечнаяДатаОТХ, ВТ.СделкаКонечнаяДатаОТХ) КАК КонечнаяДатаОТХ,
	ЕСТЬNULL(Отгрузки.Сделка.СхемаРаботыОТХ, ВТ.СделкаСхемаРаботыОТХ) КАК СхемаРаботыОТХ,
	Отгрузки.Отгрузка,
	Отгрузки.Возврат,
	ВЫБОР
		КОГДА ВТ.Сделка.ДатаОплаты &lt; &amp;текущаяДата
			ТОГДА ВТ.Остаток
		ИНАЧЕ 0
	КОНЕЦ КАК ПДЗ,
	Отгрузки.Отгрузка + Отгрузки.Возврат - ЕСТЬNULL(ВТ.Остаток, 0) КАК Оплата,
	(Отгрузки.Отгрузка + Отгрузки.Возврат - ЕСТЬNULL(ВТ.Остаток, 0)) / Отгрузки.Отгрузка * 100 КАК ПроцентОплаты,
	ВТ.Остаток КАК ДЗ,
	ВТ.ДоговорКонтрагента,
	Отгрузки.Сделка.ДатаОплаты КАК ДатаОплаты
ИЗ
	Отгрузки КАК Отгрузки
		ПОЛНОЕ СОЕДИНЕНИЕ ВТ КАК ВТ
		ПО (ВТ.Сделка = Отгрузки.Сделка)
			И (ВТ.ДоговорКонтрагента = Отгрузки.ДоговорКонтрагента)</query>
		</dataSet>
		<totalField>
			<dataPath>Возврат</dataPath>
			<expression>Сумма(Возврат)</expression>
		</totalField>
		<totalField>
			<dataPath>ДЗ</dataPath>
			<expression>Сумма(ДЗ)</expression>
		</totalField>
		<totalField>
			<dataPath>Оплата</dataPath>
			<expression>Сумма(Оплата)</expression>
		</totalField>
		<totalField>
			<dataPath>Отгрузка</dataPath>
			<expression>Сумма(Отгрузка)</expression>
		</totalField>
		<totalField>
			<dataPath>ПДЗ</dataPath>
			<expression>Сумма(ПДЗ)</expression>
		</totalField>
		<totalField>
			<dataPath>ПроцентОплаты</dataPath>
			<expression>Сумма(Оплата)/Сумма(Отгрузка)*100</expression>
		</totalField>
		<parameter>
			<name>текущаяДата</name>
			<title xmlns:d4p1="http://v8.1c.ru/8.1/data/core" xsi:type="d4p1:LocalStringType">
				<d4p1:item>
					<d4p1:lang>ru</d4p1:lang>
					<d4p1:content>Текущая дата</d4p1:content>
				</d4p1:item>
			</title>
			<valueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:dateTime</Type>
				<DateQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<DateFractions>Date</DateFractions>
				</DateQualifiers>
			</valueType>
			<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
			<useRestriction>true</useRestriction>
		</parameter>
		<parameter>
			<name>КонПериодаП</name>
			<title xmlns:d4p1="http://v8.1c.ru/8.1/data/core" xsi:type="d4p1:LocalStringType">
				<d4p1:item>
					<d4p1:lang>ru</d4p1:lang>
					<d4p1:content>Кон периода П</d4p1:content>
				</d4p1:item>
			</title>
			<valueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:dateTime</Type>
				<DateQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<DateFractions>DateTime</DateFractions>
				</DateQualifiers>
			</valueType>
			<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
			<useRestriction>false</useRestriction>
		</parameter>
		<parameter>
			<name>НачПериодаП</name>
			<title xmlns:d4p1="http://v8.1c.ru/8.1/data/core" xsi:type="d4p1:LocalStringType">
				<d4p1:item>
					<d4p1:lang>ru</d4p1:lang>
					<d4p1:content>Нач периода П</d4p1:content>
				</d4p1:item>
			</title>
			<valueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core">xs:dateTime</Type>
				<DateQualifiers xmlns="http://v8.1c.ru/8.1/data/core">
					<DateFractions>DateTime</DateFractions>
				</DateQualifiers>
			</valueType>
			<value xsi:type="xs:dateTime">2018-06-01T00:00:00</value>
			<useRestriction>false</useRestriction>
		</parameter>
		<settingsVariant>
			<name xmlns="http://v8.1c.ru/8.1/data-composition-system/settings">Основной</name>
			<presentation xmlns="http://v8.1c.ru/8.1/data-composition-system/settings" xsi:type="xs:string">Основной</presentation>
		</settingsVariant>
	</dataCompositionSchema>
</SchemaFile>﻿<?xml version="1.0" encoding="UTF-8"?>
<Settings xmlns="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<selection>
		<item xsi:type="SelectedItemField">
			<field>ДЗ</field>
		</item>
		<item xsi:type="SelectedItemField">
			<field>ПДЗ</field>
		</item>
		<item xsi:type="SelectedItemField">
			<field>Отгрузка</field>
		</item>
		<item xsi:type="SelectedItemField">
			<field>Возврат</field>
		</item>
		<item xsi:type="SelectedItemField">
			<field>Оплата</field>
		</item>
		<item xsi:type="SelectedItemField">
			<field>ПроцентОплаты</field>
		</item>
	</selection>
	<item xsi:type="StructureItemGroup">
		<groupItems>
			<item xsi:type="GroupItemField">
				<field>НаправлениеПродаж</field>
				<groupType>Items</groupType>
				<periodAdditionType>None</periodAdditionType>
				<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
				<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
			</item>
		</groupItems>
		<order>
			<item xsi:type="OrderItemAuto"/>
		</order>
		<selection>
			<item xsi:type="SelectedItemAuto"/>
		</selection>
		<item xsi:type="StructureItemGroup">
			<groupItems>
				<item xsi:type="GroupItemField">
					<field>Менеджер</field>
					<groupType>Items</groupType>
					<periodAdditionType>None</periodAdditionType>
					<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
					<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
				</item>
			</groupItems>
			<order>
				<item xsi:type="OrderItemAuto"/>
			</order>
			<selection>
				<item xsi:type="SelectedItemAuto"/>
			</selection>
			<item xsi:type="StructureItemGroup">
				<groupItems>
					<item xsi:type="GroupItemField">
						<field>Контрагент</field>
						<groupType>Items</groupType>
						<periodAdditionType>None</periodAdditionType>
						<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
						<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
					</item>
				</groupItems>
				<order>
					<item xsi:type="OrderItemAuto"/>
				</order>
				<selection>
					<item xsi:type="SelectedItemAuto"/>
				</selection>
				<item xsi:type="StructureItemGroup">
					<groupItems>
						<item xsi:type="GroupItemField">
							<field>ДоговорКонтрагента</field>
							<groupType>Items</groupType>
							<periodAdditionType>None</periodAdditionType>
							<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
							<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
						</item>
					</groupItems>
					<order>
						<item xsi:type="OrderItemAuto"/>
					</order>
					<selection>
						<item xsi:type="SelectedItemAuto"/>
					</selection>
					<item xsi:type="StructureItemGroup">
						<groupItems>
							<item xsi:type="GroupItemField">
								<field>Сделка</field>
								<groupType>Items</groupType>
								<periodAdditionType>None</periodAdditionType>
								<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
								<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
							</item>
							<item xsi:type="GroupItemField">
								<field>ДатаОплаты</field>
								<groupType>Items</groupType>
								<periodAdditionType>None</periodAdditionType>
								<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
								<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
							</item>
							<item xsi:type="GroupItemField">
								<field>СхемаРаботыОТХ</field>
								<groupType>Items</groupType>
								<periodAdditionType>None</periodAdditionType>
								<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
								<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
							</item>
							<item xsi:type="GroupItemField">
								<field>ПроцентОТХ</field>
								<groupType>Items</groupType>
								<periodAdditionType>None</periodAdditionType>
								<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
								<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
							</item>
							<item xsi:type="GroupItemField">
								<field>КонечнаяДатаОТХ</field>
								<groupType>Items</groupType>
								<periodAdditionType>None</periodAdditionType>
								<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
								<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
							</item>
						</groupItems>
						<order>
							<item xsi:type="OrderItemAuto"/>
						</order>
						<selection>
							<item xsi:type="SelectedItemAuto"/>
						</selection>
					</item>
				</item>
			</item>
		</item>
	</item>
</Settings>﻿<?xml version="1.0" encoding="UTF-8"?>
<SchemaFile xmlns="" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema"/>
</SchemaFile>
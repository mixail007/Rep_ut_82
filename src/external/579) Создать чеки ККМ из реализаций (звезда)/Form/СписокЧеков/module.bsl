
Процедура КнопкаВыполнитьНажатие(Кнопка)
	Перем Отказ;
	Для каждого стрДоки из СписокЧеков Цикл
		Отказ = ложь;
		Если стрДоки.флажок и  не стрДоки.ЧекККМ.Проведен тогда
			ЧекОбъект = стрДоки.ЧекККМ.ПолучитьОбъект();
			ЧекОбъект.Дата = ТекущаяДата();
			//ЧекОбъект.Записать(РежимЗаписиДокумента.Проведение,РежимПроведенияДокумента.Оперативный);
			ФормаЧека = ЧекОбъект.ПолучитьФорму("ФормаДокумента");
			ЧекОбъект.ПровестиИРаспечататьЧек(Отказ, ФормаЧека);
		КонецЕсли;
	КонецЦикла;
	ПриОткрытии();
КонецПроцедуры

Процедура ПриОткрытии()
	Запрос = новый Запрос;
	Запрос.Текст="ВЫБРАТЬ
	             |	ДокЧекККМ.Проведен,
	             |	ДокЧекККМ.Ссылка КАК ЧекККМ,
	             |	ДокЧекККМ.ЗаказПокупателя.Контрагент КАК Контрагент,
	             |	ДокЧекККМ.ЗаказПокупателя,
	             |	ДокЧекККМ.КассаККМ,
	             |	ЛОЖЬ КАК флажок,
	             |	ДокЧекККМ.СуммаДокумента
	             |ИЗ
	             |	Документ.ЧекККМ КАК ДокЧекККМ
	             |ГДЕ
	             |	(ДокЧекККМ.ЗаказПокупателя = &ЗаказПокупателя
	             |			ИЛИ ДокЧекККМ.КассаККМ = &КассаККМ)
	             |	И ДокЧекККМ.СуммаДокумента > 0
	             |	И ДокЧекККМ.ПометкаУдаления = ЛОЖЬ
	             |	И ДокЧекККМ.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийЧекККМ.Продажа)
	             |	И НЕ ДокЧекККМ.ЗаказПокупателя = ЗНАЧЕНИЕ(Документ.ЗаказПокупателя.ПустаяСсылка)
	             |
	             |УПОРЯДОЧИТЬ ПО
	             |	ЧекККМ
	             |АВТОУПОРЯДОЧИВАНИЕ";
	Запрос.УстановитьПараметр("ЗаказПокупателя",ЗаказПокупателя);
	Запрос.УстановитьПараметр("КассаККМ",КассаККМ);

	СписокЧеков=Запрос.Выполнить().Выгрузить();
	
	ЭлементыФормы.СписокЧеков.СоздатьКолонки();
	ЭлементыФормы.СписокЧеков.Колонки.Добавить("фл","фл");
	Колонки = ЭлементыФормы.СписокЧеков.Колонки;
	Индекс=Колонки.Индекс(Колонки["фл"]);
	ЭлементыФормы.СписокЧеков.Колонки.Сдвинуть(Колонки["фл"],-Индекс);
	ЭлементыФормы.СписокЧеков.Колонки.фл.РежимРедактирования=РежимРедактированияКолонки.Непосредственно;
	ЭлементыФормы.СписокЧеков.Колонки.фл.ДанныеФлажка="флажок";
	ЭлементыФормы.СписокЧеков.Колонки.флажок.видимость=ложь;
КонецПроцедуры

Процедура СписокЧековПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	к=1;
	Если ОформлениеСтроки.ДанныеСтроки.Проведен тогда
		 ОформлениеСтроки.ЦветФона=WebЦвета.БледноЗеленый;
	КонецЕсли;
КонецПроцедуры

Процедура кнУстановитьФлажкиНажатие(Элемент)
	ИзменитьФлажки(истина);
КонецПроцедуры

Процедура кнСнятьФлажкиНажатие(Элемент)
	ИзменитьФлажки(ложь);
КонецПроцедуры

Процедура ИзменитьФлажки(вид)
	Для каждого стр из СписокЧеков цикл
		стр.флажок = вид;
	КонецЦикла;
КонецПроцедуры;


Процедура КнопкаВыполнитьНажатие(Кнопка)
	тз=новый ТаблицаЗначений;
	тз.Колонки.Добавить("КодПодразделения", Новый ОписаниеТипов("Строка"	, , Новый КвалификаторыСтроки(50)));
	тз.Колонки.Добавить("ВсегоНачислено", Новый ОписаниеТипов("Число"	, , Новый КвалификаторыЧисла(10,2)));
	тз.Колонки.Добавить("БольничныйЛист", Новый ОписаниеТипов("Число"	, , Новый КвалификаторыЧисла(10,2)));
    тз.Колонки.Добавить("Премии", Новый ОписаниеТипов("Число"	, , Новый КвалификаторыЧисла(10,2)));
	тз.Колонки.Добавить("ФССПриРождении", Новый ОписаниеТипов("Число"	, , Новый КвалификаторыЧисла(10,2)));
	тз.Колонки.Добавить("ФСС1_5лет", Новый ОписаниеТипов("Число"	, , Новый КвалификаторыЧисла(10,2)));
	тз.Колонки.Добавить("ФССРанниеСроки", Новый ОписаниеТипов("Число"	, , Новый КвалификаторыЧисла(10,2)));

	
	Номерстроки = ПерваяСтрока;
	Пока Номерстроки<=ЭлементыФормы.ПолеТабличногоДокумента1.ВысотаТаблицы цикл
		КодПодразделения=СокрЛП(ЭлементыФормы.ПолеТабличногоДокумента1.Область(Номерстроки,КолонкаКодПодразделения,Номерстроки,КолонкаКодПодразделения).Текст);
		ВсегоНачислено  = ПреобразоватьКЧислу(СокрЛП(ЭлементыФормы.ПолеТабличногоДокумента1.Область(Номерстроки,КолонкаВсегоНачислено,Номерстроки,КолонкаВсегоНачислено).Текст));
		Если КолонкаБЛ<>0 тогда
			БольничныйЛист  = ПреобразоватьКЧислу(СокрЛП(ЭлементыФормы.ПолеТабличногоДокумента1.Область(Номерстроки,КолонкаБЛ,Номерстроки,КолонкаБЛ).Текст));
		Иначе
			БольничныйЛист=0;
		КонецЕсли;
		Если КолонкаПремия<>0 тогда
			Премии  = ПреобразоватьКЧислу(СокрЛП(ЭлементыФормы.ПолеТабличногоДокумента1.Область(Номерстроки,КолонкаПремия,Номерстроки,КолонкаПремия).Текст));
		Иначе
			Премии=0;
		КонецЕсли;
		
		Если КолонкаФССПриРождении<>0 тогда
			ФССПриРождении  = ПреобразоватьКЧислу(СокрЛП(ЭлементыФормы.ПолеТабличногоДокумента1.Область(Номерстроки,КолонкаФССПриРождении,Номерстроки,КолонкаФССПриРождении).Текст));
		Иначе
			ФССПриРождении=0;
		КонецЕсли;
		
		Если КолонкаФСС1_5лет<>0 тогда
			ФСС1_5лет  = ПреобразоватьКЧислу(СокрЛП(ЭлементыФормы.ПолеТабличногоДокумента1.Область(Номерстроки,КолонкаФСС1_5лет,Номерстроки,КолонкаФСС1_5лет).Текст));
		Иначе
			ФСС1_5лет=0;
		КонецЕсли;
		
		Если КолонкаФССРанниеСроки<>0 тогда
			ФССРанниеСроки  = ПреобразоватьКЧислу(СокрЛП(ЭлементыФормы.ПолеТабличногоДокумента1.Область(Номерстроки,КолонкаФССРанниеСроки,Номерстроки,КолонкаФССРанниеСроки).Текст));
		Иначе
			ФССРанниеСроки=0;
		КонецЕсли;


		нстр = тз.Добавить();
		нстр.КодПодразделения = КодПодразделения;
		нстр.ВсегоНачислено = ВсегоНачислено;
		нстр.БольничныйЛист = БольничныйЛист;
		нстр.Премии = Премии;
		нстр.ФССПриРождении = ФССПриРождении;
		нстр.ФСС1_5лет = ФСС1_5лет;
        нстр.ФССРанниеСроки = ФССРанниеСроки;
		
		Номерстроки = Номерстроки+1;	
	КонецЦикла;
	тз.ВыбратьСтроку();
	
	Если Сотрудник=Справочники.Контрагенты.НайтиПоКоду("91764") тогда//сотр -1
		Запрос = новый Запрос;
		Запрос.Текст="ВЫБРАТЬ
		             |	тз.КодПодразделения,
		             |	тз.ВсегоНачислено,
		             |	тз.БольничныйЛист,
		             |	тз.ФССПриРождении,
		             |	тз.ФСС1_5лет,
		             |	тз.ФССРанниеСроки,
		             |	тз.Премии
		             |ПОМЕСТИТЬ втИзЗупа
		             |ИЗ
		             |	&тз КАК тз
		             |;
		             |
		             |////////////////////////////////////////////////////////////////////////////////
		             |ВЫБРАТЬ
		             |	СУММА(втИзЗупа.ВсегоНачислено) КАК ВсегоНачислено,
		             |	СУММА(втИзЗупа.БольничныйЛист) КАК БольничныйЛист,
		             |	СУММА(втИзЗупа.Премии) КАК Премии,
		             |	СоответствияПодразделений.ПодразделениеУТ,
		             |	СУММА(втИзЗупа.ФССПриРождении) КАК ФССПриРождении,
		             |	СУММА(втИзЗупа.ФСС1_5лет) КАК ФСС1_5лет,
		             |	СУММА(втИзЗупа.ФССРанниеСроки) КАК ФССРанниеСроки
		             |ИЗ
		             |	втИзЗупа КАК втИзЗупа
		             |		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
		             |			СоответствиеПодразделенийУТЗУП.ПодразделениеУТ КАК ПодразделениеУТ,
		             |			СоответствиеПодразделенийУТЗУП.КодПодразделение1 КАК КодПодразделениеЗУП
		             |		ИЗ
		             |			РегистрСведений.СоответствиеПодразделенийУТЗУП КАК СоответствиеПодразделенийУТЗУП) КАК СоответствияПодразделений
		             |		ПО втИзЗупа.КодПодразделения = СоответствияПодразделений.КодПодразделениеЗУП
		             |
		             |СГРУППИРОВАТЬ ПО
		             |	СоответствияПодразделений.ПодразделениеУТ";
	ИначеЕсли Сотрудник=Справочники.Контрагенты.НайтиПоКоду("91765") тогда
		Запрос = новый Запрос;
		Запрос.Текст="ВЫБРАТЬ
		             |	тз.КодПодразделения,
		             |	тз.ВсегоНачислено,
		             |	тз.БольничныйЛист,
		             |	тз.Премии
		             |ПОМЕСТИТЬ втИзЗупа
		             |ИЗ
		             |	&тз КАК тз
		             |;
		             |
		             |////////////////////////////////////////////////////////////////////////////////
		             |ВЫБРАТЬ
		             |	СУММА(втИзЗупа.ВсегоНачислено) КАК ВсегоНачислено,
		             |	СУММА(втИзЗупа.БольничныйЛист) КАК БольничныйЛист,
		             |	СУММА(втИзЗупа.Премии) КАК Премии,
		             |	СоответствияПодразделений.ПодразделениеУТ
		             |ИЗ
		             |	втИзЗупа КАК втИзЗупа
		             |		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ РАЗЛИЧНЫЕ
		             |			СоответствиеПодразделенийУТЗУП.ПодразделениеУТ КАК ПодразделениеУТ,
		             |			СоответствиеПодразделенийУТЗУП.КодПодразделение2 КАК КодПодразделениеЗУП
		             |		ИЗ
		             |			РегистрСведений.СоответствиеПодразделенийУТЗУП КАК СоответствиеПодразделенийУТЗУП) КАК СоответствияПодразделений
		             |		ПО втИзЗупа.КодПодразделения = СоответствияПодразделений.КодПодразделениеЗУП
		             |
		             |СГРУППИРОВАТЬ ПО
		             |	СоответствияПодразделений.ПодразделениеУТ";
		
	КонецЕсли;
		Запрос.УстановитьПараметр("тз",тз);
		Рез = Запрос.Выполнить().Выбрать();
		
		Если Рез.Количество()>0 тогда
			ДокПоступление = Документы.ПоступлениеТоваровУслуг.СоздатьДокумент();
			ДокПоступление.Организация = Справочники.Организации.НайтиПоКоду("00001");
			ДокПоступление.Контрагент = Сотрудник;
			ДокПоступление.ДоговорКонтрагента = ДокПоступление.Контрагент.ОсновнойДоговорКонтрагента;
			ДокПоступление.ВидПоступления = Перечисления.ВидыПоступленияТоваров.НаСклад;
			ДокПоступление.Дата = ТекущаяДата();
			ДокПоступление.КратностьВзаиморасчетов =1;
			ДокПоступление.КурсВзаиморасчетов = 1;
			ДокПоступление.СуммаВключаетНДС=Истина;
			ДокПоступление.УчитыватьНДС = истина;
			
			Если Сотрудник=Справочники.Контрагенты.НайтиПоКоду("91764") тогда//сотр -1
				
				Пока Рез.Следующий() Цикл
					нстр = ДокПоступление.Услуги.Добавить();
					нстр.Содержание = "заработная плата";
					нстр.Количество = 1;
					нстр.СтавкаНДС = Перечисления.СтавкиНДС.БезНДС;
					Нстр.Цена = РЕз.ВсегоНачислено - Рез.БольничныйЛист - Рез.ФССПриРождении - Рез.ФСС1_5лет - Рез.ФССРанниеСроки;
					нстр.СтатьяЗатрат = Справочники.СтатьиЗатрат.НайтиПоКоду("А0027");
					нстр.Подразделение =  РЕз.ПодразделениеУТ;
					
					
					// Рассчитать реквизиты табличной части.
					РассчитатьСуммуТабЧасти(нстр, ДокПоступление);
					РассчитатьСуммуНДСТабЧасти(нстр, ДокПоступление);
					
				КонецЦикла;
			ИначеЕсли Сотрудник=Справочники.Контрагенты.НайтиПоКоду("91765") тогда//сотр -2
				
				Пока Рез.Следующий() Цикл
					Если Рез.ВсегоНачислено>0 тогда
					нстр = ДокПоступление.Услуги.Добавить();
					нстр.Содержание = "заработная плата";
					нстр.Количество = 1;
					нстр.СтавкаНДС = Перечисления.СтавкиНДС.БезНДС;
					Нстр.Цена = РЕз.ВсегоНачислено;
					нстр.СтатьяЗатрат = Справочники.СтатьиЗатрат.НайтиПоКоду("А0027");
					нстр.Подразделение =  РЕз.ПодразделениеУТ;
					
					
					// Рассчитать реквизиты табличной части.
					РассчитатьСуммуТабЧасти(нстр, ДокПоступление);
					РассчитатьСуммуНДСТабЧасти(нстр, ДокПоступление);
				КонецЕсли;
				
				Если Рез.Премии>0 тогда
					нстр = ДокПоступление.Услуги.Добавить();
					нстр.Содержание = "премия";
					нстр.Количество = 1;
					нстр.СтавкаНДС = Перечисления.СтавкиНДС.БезНДС;
					Нстр.Цена = РЕз.Премии;
					нстр.СтатьяЗатрат = Справочники.СтатьиЗатрат.НайтиПоКоду("А0028");
					нстр.Подразделение =  РЕз.ПодразделениеУТ;
					// Рассчитать реквизиты табличной части.
					РассчитатьСуммуТабЧасти(нстр, ДокПоступление);
					РассчитатьСуммуНДСТабЧасти(нстр, ДокПоступление);
					КонецЕсли;
				КонецЦикла;
			КонецЕсли;
			ДокПоступление.Услуги.Сортировать("СтатьяЗатрат, Подразделение");
			Форма = ДокПоступление.ПолучитьФорму("ФормаДокумента");
			Форма.Открыть();
		КонецЕсли;

КонецПроцедуры

Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	Если НастройкаПериода.Редактировать() Тогда
		НачПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры

Функция ПреобразоватьКЧислу(ЧислоСтр)
	Врем = СокрЛП(ЧислоСтр);
	Врем = СтрЗаменить(Врем," ","");
	Врем = СтрЗаменить(Врем,",",".");
	Врем = СтрЗаменить(Врем," ","");
	
	Если Врем = "" тогда
		Возврат 0;
	КонецЕсли;	
	Возврат Число(Врем);
КонецФункции

Процедура СотрудникПриИзменении(Элемент)
	Если Сотрудник=Справочники.Контрагенты.НайтиПоКоду("91764") тогда//сотр -1 
		ПерваяСтрока = 3;
		КолонкаКодПодразделения = 1;
		КолонкаВсегоНачислено = 3;
		КолонкаПремия = 0;
		КолонкаБЛ = 0;
	ИначеЕсли  Сотрудник=Справочники.Контрагенты.НайтиПоКоду("91765") тогда//сотр -2 
		ПерваяСтрока = 3;
		КолонкаКодПодразделения = 1;
		КолонкаВсегоНачислено = 3;
		КолонкаПремия = 14;
		КолонкаБЛ = 0;

	КонецЕсли;
КонецПроцедуры

Процедура ПриОткрытии()
	Сотрудник = Справочники.Контрагенты.НайтиПоКоду("91764");
	СотрудникПриИзменении(неопределено);
КонецПроцедуры


Процедура кнСформироватьНажатие(Элемент)
	времянач = ТекущаяДата();
	Состояние("1. Подготовка списка закзов для рассчета премий");
	СписокЗаказов = ПодготовитьСписокЗаказовДляРассчетаПремиии(НачПериода,КонецДня(КонПериода));
	Состояние("2. Подготовка списка закзов обратных продаж");
	СписокЗаказовОбратныхПродаж = ПодготовитьСписокЗаказовОбратныхПродаж(НачПериода,КонецДня(КонПериода));
	Состояние("3. Рассчет премий продажи");
	ПустаяТаб = СписокЗаказов.Скопировать();
	ПустаяТаб.Очистить();
	резПродажи = ПолучитьПремииПоЗаказам("Продажи",СписокЗаказов.ВыгрузитьКолонку("ЗаказПокупателя"), НачПериода, КонецДня(КонПериода),ПустаяТаб);
	Состояние("4. Рассчет депремирования за обратные продажи");
	резОбратныеПродажи = ПолучитьПремииПоЗаказам("Обратные продажи",СписокЗаказовОбратныхПродаж.ВыгрузитьКолонку("ЗаказПокупателя"), Дата(1,1,1), КонецДня(КонПериода),СписокЗаказовОбратныхПродаж);
	рез = ОбъединитьТаблицы(резПродажи,резОбратныеПродажи);
	
	Состояние("5. Рассчет премий за выплаченые пени");
	резПени = ПолучитьПремииПоПеням(НачПериода, КонецДня(КонПериода));
	рез = ОбъединитьТаблицы(рез,резПени);
	
	ЭлементыФормы.Панель1.ТекущаяСтраница = ЭлементыФормы.Панель1.Страницы.пРезультат;
	Состояние("6. ВыводРезультата");
	врем = ТекущаяДата() - ВремяНач;
	Сообщить("Время вычисления: "+врем+"с.");
	ВыводРезультата(рез);
	Состояние("");
	//Рез.ВыбратьСтроку();
КонецПроцедуры

Функция ПолучитьПремииПоПеням(ДатаН,ДатаК)
	Запрос = новый Запрос;
	Запрос.УстановитьПараметр("НачПериода",ДатаН);
	Запрос.УстановитьПараметр("КонПериода",ДатаК);
	Запрос.УстановитьПараметр("ПроцОтсеченияПеней",ПроцентОтсеченияПеней);
	Запрос.УстановитьПараметр("коэффПени",ПроцентЗаОплаченныеПени/100);

	Запрос.Текст="ВЫБРАТЬ
	             |	ВзаиморасчетыСКонтрагентамиОбороты.ДоговорКонтрагента.ОтветственноеЛицо КАК Менеджер,
	             |	ВзаиморасчетыСКонтрагентамиОбороты.ДоговорКонтрагента.Владелец КАК Контрагент,
	             |	СУММА(ВзаиморасчетыСКонтрагентамиОбороты.СуммаВзаиморасчетовРасход) КАК ОплаченныеПени,
	             |	ВзаиморасчетыСКонтрагентамиОбороты.ДоговорКонтрагента.Владелец.ПроцентПени КАК ПроцентПеней,
	             |	""Оплаченые пени"" КАК ВидЗаказа,
	             |	СУММА(ВзаиморасчетыСКонтрагентамиОбороты.СуммаВзаиморасчетовРасход * 0.5) КАК ПремияНачисленная2,
	             |	СУММА(ВЫБОР
	             |			КОГДА ВзаиморасчетыСКонтрагентамиОбороты.ДоговорКонтрагента.Владелец.ПроцентПени * 365 - &ПроцОтсеченияПеней > 0
	             |				ТОГДА ВзаиморасчетыСКонтрагентамиОбороты.СуммаВзаиморасчетовРасход * (ВзаиморасчетыСКонтрагентамиОбороты.ДоговорКонтрагента.Владелец.ПроцентПени * 365 - &ПроцОтсеченияПеней) / (ВзаиморасчетыСКонтрагентамиОбороты.ДоговорКонтрагента.Владелец.ПроцентПени * 365)
	             |			ИНАЧЕ 0
	             |		КОНЕЦ * &коэффПени) КАК ПремияНачисленная
	             |ИЗ
	             |	РегистрНакопления.ВзаиморасчетыСКонтрагентами.Обороты(&НачПериода, &КонПериода, Регистратор, ДоговорКонтрагента.ТипДоговора = ЗНАЧЕНИЕ(Справочник.ТипыДоговоров.Пени)) КАК ВзаиморасчетыСКонтрагентамиОбороты
	             |ГДЕ
	             |	ВзаиморасчетыСКонтрагентамиОбороты.Регистратор ССЫЛКА Документ.ПлатежноеПоручениеВходящее
	             |
	             |СГРУППИРОВАТЬ ПО
	             |	ВзаиморасчетыСКонтрагентамиОбороты.ДоговорКонтрагента.ОтветственноеЛицо,
	             |	ВзаиморасчетыСКонтрагентамиОбороты.ДоговорКонтрагента.Владелец,
	             |	ВзаиморасчетыСКонтрагентамиОбороты.ДоговорКонтрагента.Владелец.ПроцентПени";
				 Рез =Запрос.Выполнить().Выгрузить();
				 Возврат Рез;
КонецФункции


Функция ОбъединитьТаблицы(Т1,Т2)
	Таб = Т1.Скопировать();
	Для каждого стр из Т2 Цикл
		нстр = Таб.Добавить();
		ЗаполнитьЗначенияСвойств(нстр,стр);
	КонецЦикла;
	Возврат Таб;
КонецФункции

Процедура ВыводРезультата(Рез)
	СхемаКомпоновкиДанных = ЭтотОбъект.ПолучитьМакет("ОсновнаяСхемаКомпоновкиДанных");
	КомпоновщикНастроек.Инициализировать(Новый ИсточникДоступныхНастроекКомпоновкиДанных(СхемаКомпоновкиДанных));
	КомпоновщикНастроек.ЗагрузитьНастройки(СхемаКомпоновкиДанных.НастройкиПоУмолчанию);
	
	ВнешниеНаборыДанных = Новый Структура;
	ВнешниеНаборыДанных.Вставить("тз",Рез);
	
	Настройки = КомпоновщикНастроек.Настройки;

	КомпоновщикМакета = Новый КомпоновщикМакетаКомпоновкиДанных;
	МакетКомпоновки = КомпоновщикМакета.Выполнить(СхемаКомпоновкиДанных,
	Настройки);
	
	ПроцессорКомпоновкиДанных = Новый ПроцессорКомпоновкиДанных;
	ПроцессорКомпоновкиДанных.Инициализировать(МакетКомпоновки,ВнешниеНаборыДанных);
	Результат = ЭлементыФормы.Результат;
	Результат.Очистить();
	
	//Выводим результат в табличный документ
	ПроцессорВывода = Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВТабличныйДокумент;
	ПроцессорВывода.УстановитьДокумент(Результат);
	
	ПроцессорВывода.Вывести(ПроцессорКомпоновкиДанных);
	
КонецПроцедуры

Функция ПодготовитьСписокЗаказовОбратныхПродаж(ДатаН, ДатаК)
	Запрос = новый Запрос;
	Запрос.УстановитьПараметр("КонтрРезерваИМ", Справочники.Контрагенты.НайтиПоКоду("П004703"));
	Запрос.УстановитьПараметр("НачПериода",ДатаН);
	Запрос.УстановитьПараметр("КонПериода",ДатаК);
	Запрос.Текст="ВЫБРАТЬ
	             |	СУММА(ЗакупкиОбороты.СтоимостьОборот) КАК СуммаОбратныеПродажи,
	             |	ВЫРАЗИТЬ(ЗаявкаНаВозвратТоваровТовары.Реализация.Сделка КАК Документ.ЗаказПокупателя) КАК ЗаказПокупателя
	             |ПОМЕСТИТЬ вт
	             |ИЗ
	             |	РегистрНакопления.Закупки.Обороты(&НачПериода, &КонПериода, , ЗаказПоставщику.Основание ССЫЛКА Документ.ЗаявкаНаВозвратТоваров) КАК ЗакупкиОбороты
	             |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаявкаНаВозвратТоваров.Товары КАК ЗаявкаНаВозвратТоваровТовары
	             |		ПО ЗакупкиОбороты.ЗаказПоставщику.Основание = ЗаявкаНаВозвратТоваровТовары.Ссылка
	             |			И ЗакупкиОбороты.Номенклатура = ЗаявкаНаВозвратТоваровТовары.Номенклатура
	             |ГДЕ
	             |	99=99
	             |
	             |СГРУППИРОВАТЬ ПО
	             |	ВЫРАЗИТЬ(ЗаявкаНаВозвратТоваровТовары.Реализация.Сделка КАК Документ.ЗаказПокупателя)
	             |;
	             |
	             |////////////////////////////////////////////////////////////////////////////////
	             |ВЫБРАТЬ
	             |	вт.СуммаОбратныеПродажи КАК СуммаОбратныхПродаж,
	             |	вт.ЗаказПокупателя
	             |ИЗ
	             |	вт КАК вт
	             |ГДЕ
	             |	вт.ЗаказПокупателя.ДоговорКонтрагента.ВедениеВзаиморасчетов = ЗНАЧЕНИЕ(Перечисление.ВедениеВзаиморасчетовПоДоговорам.ПоЗаказам)
	             |	И НЕ вт.ЗаказПокупателя.ДоговорКонтрагента.Владелец.КонтрагентДляРезерваИМ = &КонтрРезерваИМ
	             |	И НЕ вт.ЗаказПокупателя.Контрагент.КонтрагентДляРезерваИМ = &КонтрРезерваИМ";
				 
				 Если СписокЗак.Количество()>0 тогда
                   Запрос.Текст = СтрЗаменить(Запрос.Текст,"99=99","ЗаявкаНаВозвратТоваровТовары.Реализация.Сделка в (&ЗаказыПокупателя)");
				   Запрос.УстановитьПараметр("ЗаказыПокупателя",СписокЗак);
				 КонецЕсли;				 
	Рез = Запрос.Выполнить().Выгрузить();
	//Список = Рез.ВыгрузитьКолонку("ЗаказПокупателя");
	Возврат Рез;
КонецФункции	
//Все заказы по которым были реализации и оплаты за период, а так же долги, с просрочкой не более 2 мес
Функция ПодготовитьСписокЗаказовДляРассчетаПремиии(ДатаН, ДатаК)

	Запрос = новый Запрос;
	Запрос.УстановитьПараметр("НачПериода",ДатаН);
	Запрос.УстановитьПараметр("КонПериода",ДатаК);
	Запрос.УстановитьПараметр("КонтрРезерваИМ", Справочники.Контрагенты.НайтиПоКоду("П004703"));
	Запрос.УстановитьПараметр("ПериодОстатков",ДатаК);

	Запрос.Текст="ВЫБРАТЬ РАЗЛИЧНЫЕ
	             |	А.Сделка КАК ЗаказПокупателя,
	             |	0 КАК СуммаОбратныхПродаж
	             |ИЗ
	             |	(ВЫБРАТЬ
	             |		А.Сделка КАК Сделка
	             |	ИЗ
	             |		(ВЫБРАТЬ РАЗЛИЧНЫЕ
	             |			ВзаиморасчетыСКонтрагентамиОбороты.Сделка КАК Сделка
	             |		ИЗ
	             |			РегистрНакопления.ВзаиморасчетыСКонтрагентами.Обороты(
	             |					&НачПериода,
	             |					&КонПериода,
	             |					Регистратор,
	             |					ДоговорКонтрагента.ВедениеВзаиморасчетов = ЗНАЧЕНИЕ(Перечисление.ВедениеВзаиморасчетовПоДоговорам.ПоЗаказам)
	             |						И НЕ ДоговорКонтрагента.Владелец.КонтрагентДляРезерваИМ = &КонтрРезерваИМ
	             |						И НЕ Сделка.Контрагент.КонтрагентДляРезерваИМ = &КонтрРезерваИМ
	             |						И ДОБАВИТЬКДАТЕ(Сделка.ДатаОплаты, МЕСЯЦ, 2) >= &ПериодОстатков) КАК ВзаиморасчетыСКонтрагентамиОбороты
	             |		ГДЕ
	             |			(ВзаиморасчетыСКонтрагентамиОбороты.Регистратор ССЫЛКА Документ.ПлатежноеПоручениеВходящее
	             |						И ВзаиморасчетыСКонтрагентамиОбороты.Регистратор.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ОплатаПокупателя)
	             |					ИЛИ ВзаиморасчетыСКонтрагентамиОбороты.Регистратор ССЫЛКА Документ.ПриходныйКассовыйОрдер
	             |						И ВзаиморасчетыСКонтрагентамиОбороты.Регистратор.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПКО.ОплатаПокупателя))) КАК А
	             |	
	             |	ОБЪЕДИНИТЬ
	             |	
	             |	ВЫБРАТЬ РАЗЛИЧНЫЕ
	             |		ВзаиморасчетыСКонтрагентамиОбороты.Сделка
	             |	ИЗ
	             |		РегистрНакопления.ВзаиморасчетыСКонтрагентами.Обороты(
	             |				&НачПериода,
	             |				&КонПериода,
	             |				Регистратор,
	             |				ДоговорКонтрагента.ВедениеВзаиморасчетов = ЗНАЧЕНИЕ(Перечисление.ВедениеВзаиморасчетовПоДоговорам.ПоЗаказам)
	             |					И НЕ ДоговорКонтрагента.Владелец.КонтрагентДляРезерваИМ = &КонтрРезерваИМ
	             |					И НЕ Сделка.Контрагент.КонтрагентДляРезерваИМ = &КонтрРезерваИМ
	             |					И ДОБАВИТЬКДАТЕ(Сделка.ДатаОплаты, МЕСЯЦ, 2) >= &ПериодОстатков) КАК ВзаиморасчетыСКонтрагентамиОбороты
	             |	ГДЕ
	             |		ВзаиморасчетыСКонтрагентамиОбороты.Регистратор ССЫЛКА Документ.Взаимозачет
	             |		И ВзаиморасчетыСКонтрагентамиОбороты.Регистратор.УчитыватьДляРасчетаПремии
	             |	
	             |	ОБЪЕДИНИТЬ
	             |	
	             |	ВЫБРАТЬ РАЗЛИЧНЫЕ
	             |		ВзаиморасчетыСКонтрагентамиОбороты.Сделка
	             |	ИЗ
	             |		РегистрНакопления.ВзаиморасчетыСКонтрагентами.Обороты(
	             |				&НачПериода,
	             |				&КонПериода,
	             |				Регистратор,
	             |				ДоговорКонтрагента.ВедениеВзаиморасчетов = ЗНАЧЕНИЕ(Перечисление.ВедениеВзаиморасчетовПоДоговорам.ПоЗаказам)
	             |					И НЕ ДоговорКонтрагента.Владелец.КонтрагентДляРезерваИМ = &КонтрРезерваИМ
	             |					И НЕ Сделка.Контрагент.КонтрагентДляРезерваИМ = &КонтрРезерваИМ
	             |					И ДОБАВИТЬКДАТЕ(Сделка.ДатаОплаты, МЕСЯЦ, 2) >= &ПериодОстатков) КАК ВзаиморасчетыСКонтрагентамиОбороты
	             |	ГДЕ
	             |		ВзаиморасчетыСКонтрагентамиОбороты.Регистратор ССЫЛКА Документ.Взаимозачет
	             |		И ВзаиморасчетыСКонтрагентамиОбороты.Регистратор.УчитыватьДляРасчетаПремии
	             |	
	             |	ОБЪЕДИНИТЬ
	             |	
	             |	ВЫБРАТЬ РАЗЛИЧНЫЕ
	             |		ВзаиморасчетыСКонтрагентамиОстатки.Сделка
	             |	ИЗ
	             |		РегистрНакопления.ВзаиморасчетыСКонтрагентами.Остатки(&ПериодОстатков, ) КАК ВзаиморасчетыСКонтрагентамиОстатки
	             |			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
	             |			ПО ВзаиморасчетыСКонтрагентамиОстатки.ДоговорКонтрагента = ДоговорыКонтрагентов.Ссылка
	             |			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаказПокупателя КАК ЗаказПокупателя
	             |			ПО ВзаиморасчетыСКонтрагентамиОстатки.Сделка = ЗаказПокупателя.Ссылка
	             |	ГДЕ
	             |		ДоговорыКонтрагентов.Владелец.КонтрагентДляРезерваИМ <> &КонтрРезерваИМ
	             |		И ДоговорыКонтрагентов.ВедениеВзаиморасчетов = ЗНАЧЕНИЕ(Перечисление.ВедениеВзаиморасчетовПоДоговорам.ПоЗаказам)
	             |		И НЕ ЗаказПокупателя.Контрагент.КонтрагентДляРезерваИМ = &КонтрРезерваИМ
	             |		И ДОБАВИТЬКДАТЕ(ЗаказПокупателя.ДатаОплаты, МЕСЯЦ, 2) >= &ПериодОстатков
	             |	
	             |	ОБЪЕДИНИТЬ
	             |	
	             |	ВЫБРАТЬ РАЗЛИЧНЫЕ
	             |		ПродажиОбороты.ЗаказПокупателя
	             |	ИЗ
	             |		РегистрНакопления.Продажи.Обороты(
	             |				&НачПериода,
	             |				&КонПериода,
	             |				Регистратор,
	             |				ДоговорКонтрагента.ВедениеВзаиморасчетов = ЗНАЧЕНИЕ(Перечисление.ВедениеВзаиморасчетовПоДоговорам.ПоЗаказам)
	             |					И НЕ ДоговорКонтрагента.Владелец.КонтрагентДляРезерваИМ = &КонтрРезерваИМ
	             |					И НЕ ЗаказПокупателя.Контрагент.КонтрагентДляРезерваИМ = &КонтрРезерваИМ) КАК ПродажиОбороты
	             |	ГДЕ
	             |		ПродажиОбороты.ЗаказПокупателя ССЫЛКА Документ.ЗаказПокупателя
	             |	
	             |	СГРУППИРОВАТЬ ПО
	             |		ПродажиОбороты.ЗаказПокупателя) КАК А
	             |ГДЕ
	             |	99 = 99";
				 
				 Если СписокЗак.Количество()>0 тогда
                   Запрос.Текст = СтрЗаменить(Запрос.Текст,"99 = 99","А.Сделка В(&ЗаказыПокупателя)");
				   Запрос.УстановитьПараметр("ЗаказыПокупателя",СписокЗак);
				 КонецЕсли;
				 Рез = Запрос.Выполнить().Выгрузить();
				 //Список = Рез.ВыгрузитьКолонку("ЗаказПокупателя");
				 Возврат Рез;
КонецФункции

Функция ПолучитьПремииПоЗаказам(ВидПродаж, СписокЗаказов, ДатаН, ДатаК, ОбратныеПродажи)
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("СписокЗаказов",СписокЗаказов);
	Запрос.УстановитьПараметр("тзСуммыОбратныхПродаж",ОбратныеПродажи);
	Запрос.УстановитьПараметр("ПроцПремированияПредоплаты",ПроцПремированияПредоплаты);
	Запрос.УстановитьПараметр("ПроцДепремированияПредоплаты",ПроцДеПремированияПредоплаты);
	Запрос.УстановитьПараметр("ПроцДепремированияПросрочки",ПроцДеПремированияПросрочки);
	Запрос.УстановитьПараметр("КоэффотсеченияШ",ПроцентОтсеченияШ/100);
	Запрос.УстановитьПараметр("КоэффотсеченияД",ПроцентОтсеченияД/100);
    Запрос.УстановитьПараметр("КоэффОтсеченияАкб",ПроцентОтсеченияАкб/100);
	Запрос.УстановитьПараметр("КоэффЗаНаценкуШ",ПроцентЗаНаценку/100);
	Запрос.УстановитьПараметр("КоэффЗаНаценкуД",ПроцентЗаНаценкуДиски/100);
	Запрос.УстановитьПараметр("КоэффЗаНаценкуАкс",ПроцентЗаНаценкуАксессуары/100);
	Запрос.УстановитьПараметр("КоэффЗаНаценкуАкб",ПроцентЗаНаценкуАКБ/100);
    Запрос.УстановитьПараметр("КоэффПродаж",ПроцентЗаПродажи/100);
	Запрос.УстановитьПараметр("НачПериода",ДатаН);
	Запрос.УстановитьПараметр("КонПериода",(ДатаК));
	Запрос.УстановитьПараметр("ПериодОстатков",(ДатаК));
	Запрос.УстановитьПараметр("ВидПродаж",ВидПродаж);

	
	Запрос.Текст = "ВЫБРАТЬ
	               |	тзСуммыОбратныхПродаж.ЗаказПокупателя,
	               |	тзСуммыОбратныхПродаж.СуммаОбратныхПродаж КАК СуммаВозврата
	               |ПОМЕСТИТЬ втСуммыОбратныхПродаж
	               |ИЗ
	               |	&тзСуммыОбратныхПродаж КАК тзСуммыОбратныхПродаж
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	А.Сделка,
	               |	СУММА(А.СуммаОплаты) КАК СуммаОплаты,
	               |	СУММА(А.СуммаОплатыДляРасчетаПремии) КАК СуммаОплатыДляРасчетаПремии
	               |ПОМЕСТИТЬ втОплаты
	               |ИЗ
	               |	(ВЫБРАТЬ
	               |		А.Сделка КАК Сделка,
	               |		СУММА(А.СуммаОплаты) КАК СуммаОплаты,
	               |		СУММА(А.СуммаОплаты) КАК СуммаОплатыДляРасчетаПремии
	               |	ИЗ
	               |		(ВЫБРАТЬ
	               |			ВзаиморасчетыСКонтрагентамиОбороты.Сделка КАК Сделка,
	               |			ВзаиморасчетыСКонтрагентамиОбороты.СуммаУпрРасход КАК СуммаОплаты
	               |		ИЗ
	               |			РегистрНакопления.ВзаиморасчетыСКонтрагентами.Обороты(&НачПериода, &КонПериода, Регистратор, Сделка В (&СписокЗаказов)) КАК ВзаиморасчетыСКонтрагентамиОбороты
	               |		ГДЕ
	               |			(ВзаиморасчетыСКонтрагентамиОбороты.Регистратор ССЫЛКА Документ.ПлатежноеПоручениеВходящее
	               |						И ВзаиморасчетыСКонтрагентамиОбороты.Регистратор.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПоступлениеБезналичныхДенежныхСредств.ОплатаПокупателя)
	               |					ИЛИ ВзаиморасчетыСКонтрагентамиОбороты.Регистратор ССЫЛКА Документ.ПриходныйКассовыйОрдер
	               |						И ВзаиморасчетыСКонтрагентамиОбороты.Регистратор.ВидОперации = ЗНАЧЕНИЕ(Перечисление.ВидыОперацийПКО.ОплатаПокупателя))) КАК А
	               |	
	               |	СГРУППИРОВАТЬ ПО
	               |		А.Сделка
	               |	
	               |	ОБЪЕДИНИТЬ
	               |	
	               |	ВЫБРАТЬ
	               |		ВзаиморасчетыСКонтрагентамиОбороты.Сделка,
	               |		СУММА(ВзаиморасчетыСКонтрагентамиОбороты.СуммаУпрРасход),
	               |		СУММА(ВзаиморасчетыСКонтрагентамиОбороты.СуммаУпрРасход)
	               |	ИЗ
	               |		РегистрНакопления.ВзаиморасчетыСКонтрагентами.Обороты(&НачПериода, &КонПериода, Регистратор, Сделка В (&СписокЗаказов)) КАК ВзаиморасчетыСКонтрагентамиОбороты
	               |	ГДЕ
	               |		ВзаиморасчетыСКонтрагентамиОбороты.Регистратор ССЫЛКА Документ.Взаимозачет
	               |		И ВзаиморасчетыСКонтрагентамиОбороты.Регистратор.УчитыватьДляРасчетаПремии
	               |	
	               |	СГРУППИРОВАТЬ ПО
	               |		ВзаиморасчетыСКонтрагентамиОбороты.Сделка
	               |	
	               |	ОБЪЕДИНИТЬ
	               |	
	               |	ВЫБРАТЬ
	               |		ВзаиморасчетыСКонтрагентамиОбороты.Сделка,
	               |		-СУММА(ВзаиморасчетыСКонтрагентамиОбороты.СуммаУпрПриход),
	               |		0
	               |	ИЗ
	               |		РегистрНакопления.ВзаиморасчетыСКонтрагентами.Обороты(&НачПериода, &КонПериода, Регистратор, Сделка В (&СписокЗаказов)) КАК ВзаиморасчетыСКонтрагентамиОбороты
	               |	ГДЕ
	               |		ВзаиморасчетыСКонтрагентамиОбороты.Регистратор ССЫЛКА Документ.Взаимозачет
	               |		И ВзаиморасчетыСКонтрагентамиОбороты.Регистратор.УчитыватьДляРасчетаПремии
	               |	
	               |	СГРУППИРОВАТЬ ПО
	               |		ВзаиморасчетыСКонтрагентамиОбороты.Сделка
	               |	
	               |	ОБЪЕДИНИТЬ ВСЕ
	               |	
	               |	ВЫБРАТЬ
	               |		ВзаиморасчетыСКонтрагентамиОстатки.Сделка,
	               |		0,
	               |		0
	               |	ИЗ
	               |		РегистрНакопления.ВзаиморасчетыСКонтрагентами.Остатки(&ПериодОстатков, Сделка В (&СписокЗаказов)) КАК ВзаиморасчетыСКонтрагентамиОстатки) КАК А
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	А.Сделка
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ПродажиОбороты.ЗаказПокупателя.ДоговорКонтрагента КАК ДоговорКонтрагента,
	               |	ПродажиОбороты.ЗаказПокупателя КАК Сделка,
	               |	ПродажиОбороты.Номенклатура КАК Номенклатура,
	               |	СУММА(ПродажиОбороты.СтоимостьОборот) КАК СуммаПродажи,
	               |	СУММА(ЕСТЬNULL(ПродажиСебестоимостьОбороты.СтоимостьОборот, 0)) КАК СуммаСебестоимости,
	               |	СУММА(ВЫБОР
	               |			КОГДА ПродажиОбороты.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)
	               |				ТОГДА ПродажиОбороты.СтоимостьОборот
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК ПродажиДиски,
	               |	СУММА(ВЫБОР
	               |			КОГДА ПродажиОбороты.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Шины)
	               |				ТОГДА ПродажиОбороты.СтоимостьОборот
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК ПродажиШины,
	               |	СУММА(ВЫБОР
	               |			КОГДА ПродажиОбороты.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.АКБ)
	               |				ТОГДА ПродажиОбороты.СтоимостьОборот
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК ПродажиАкб,
	               |	СУММА(ВЫБОР
	               |			КОГДА ПродажиОбороты.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Аксессуары)
	               |				ТОГДА ПродажиОбороты.СтоимостьОборот
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК ПродажиАксы,
	               |	СУММА(ВЫБОР
	               |			КОГДА ПродажиОбороты.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)
	               |				ТОГДА ПродажиСебестоимостьОбороты.СтоимостьОборот
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК СебестоимостьДиски,
	               |	СУММА(ВЫБОР
	               |			КОГДА ПродажиОбороты.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Шины)
	               |				ТОГДА ПродажиСебестоимостьОбороты.СтоимостьОборот
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК СебестоимостьШины,
	               |	СУММА(ВЫБОР
	               |			КОГДА ПродажиОбороты.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.АКБ)
	               |				ТОГДА ПродажиСебестоимостьОбороты.СтоимостьОборот
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК СебестоимостьАКБ,
	               |	СУММА(ВЫБОР
	               |			КОГДА ПродажиОбороты.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Аксессуары)
	               |				ТОГДА ПродажиСебестоимостьОбороты.СтоимостьОборот
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК СебестоимостьАксы,
	               |	ПродажиОбороты.ЗаказПокупателя.Дата КАК ЗаказДата,
	               |	ПродажиОбороты.ЗаказПокупателя.ДатаОплаты КАК ЗаказДатаОплаты,
	               |	ПродажиОбороты.ЗаказПокупателя.ДатаОтгрузки КАК ЗаказДатаОтгрузки
	               |ПОМЕСТИТЬ втПродажиЗаПериод
	               |ИЗ
	               |	РегистрНакопления.Продажи.Обороты(&НачПериода, &КонПериода, Регистратор, ЗаказПокупателя В (&СписокЗаказов)) КАК ПродажиОбороты
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ПродажиСебестоимость.Обороты(&НачПериода, &КонПериода, Регистратор, ЗаказПокупателя В (&СписокЗаказов)) КАК ПродажиСебестоимостьОбороты
	               |		ПО ПродажиОбороты.ЗаказПокупателя = ПродажиСебестоимостьОбороты.ЗаказПокупателя
	               |			И ПродажиОбороты.Номенклатура = ПродажиСебестоимостьОбороты.Номенклатура
	               |			И ПродажиОбороты.Регистратор = ПродажиСебестоимостьОбороты.Регистратор
	               |ГДЕ
	               |	ПродажиОбороты.ЗаказПокупателя ССЫЛКА Документ.ЗаказПокупателя
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ПродажиОбороты.ЗаказПокупателя,
	               |	ПродажиОбороты.Номенклатура,
	               |	ПродажиОбороты.ЗаказПокупателя.ДоговорКонтрагента,
	               |	ПродажиОбороты.ЗаказПокупателя.Дата,
	               |	ПродажиОбороты.ЗаказПокупателя.ДатаОплаты,
	               |	ПродажиОбороты.ЗаказПокупателя.ДатаОтгрузки
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ПродажиОбороты.ЗаказПокупателя.ДоговорКонтрагента КАК ДоговорКонтрагента,
	               |	ПродажиОбороты.ЗаказПокупателя КАК Сделка,
	               |	ПродажиОбороты.Номенклатура КАК Номенклатура,
	               |	СУММА(ПродажиОбороты.СтоимостьОборот) КАК СуммаПродажи,
	               |	СУММА(ЕСТЬNULL(ПродажиСебестоимостьОбороты.СтоимостьОборот, 0)) КАК СуммаСебестоимости,
	               |	СУММА(ВЫБОР
	               |			КОГДА ПродажиОбороты.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)
	               |				ТОГДА ПродажиОбороты.СтоимостьОборот
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК ПродажиДиски,
	               |	СУММА(ВЫБОР
	               |			КОГДА ПродажиОбороты.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Шины)
	               |				ТОГДА ПродажиОбороты.СтоимостьОборот
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК ПродажиШины,
	               |	СУММА(ВЫБОР
	               |			КОГДА ПродажиОбороты.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.АКБ)
	               |				ТОГДА ПродажиОбороты.СтоимостьОборот
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК ПродажиАкб,
	               |	СУММА(ВЫБОР
	               |			КОГДА ПродажиОбороты.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Аксессуары)
	               |				ТОГДА ПродажиОбороты.СтоимостьОборот
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК ПродажиАксы,
	               |	СУММА(ВЫБОР
	               |			КОГДА ПродажиОбороты.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)
	               |				ТОГДА ПродажиСебестоимостьОбороты.СтоимостьОборот
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК СебестоимостьДиски,
	               |	СУММА(ВЫБОР
	               |			КОГДА ПродажиОбороты.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Шины)
	               |				ТОГДА ПродажиСебестоимостьОбороты.СтоимостьОборот
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК СебестоимостьШины,
	               |	СУММА(ВЫБОР
	               |			КОГДА ПродажиОбороты.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.АКБ)
	               |				ТОГДА ПродажиСебестоимостьОбороты.СтоимостьОборот
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК СебестоимостьАКБ,
	               |	СУММА(ВЫБОР
	               |			КОГДА ПродажиОбороты.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Аксессуары)
	               |				ТОГДА ПродажиСебестоимостьОбороты.СтоимостьОборот
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК СебестоимостьАксы,
	               |	ПродажиОбороты.ЗаказПокупателя.Дата КАК ЗаказДата,
	               |	ПродажиОбороты.ЗаказПокупателя.ДатаОплаты КАК ЗаказДатаОплаты,
	               |	ПродажиОбороты.ЗаказПокупателя.ДатаОтгрузки КАК ЗаказДатаОтгрузки
	               |ПОМЕСТИТЬ втПродажиОплаченныеЗаПериод
	               |ИЗ
	               |	РегистрНакопления.Продажи.Обороты(
	               |			,
	               |			,
	               |			Регистратор,
	               |			ЗаказПокупателя В
	               |				(ВЫБРАТЬ
	               |					втОплаты.Сделка
	               |				ИЗ
	               |					втОплаты КАК втОплаты)) КАК ПродажиОбороты
	               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ПродажиСебестоимость.Обороты(
	               |				,
	               |				,
	               |				Регистратор,
	               |				ЗаказПокупателя В
	               |					(ВЫБРАТЬ
	               |						втОплаты.Сделка
	               |					ИЗ
	               |						втОплаты КАК втОплаты)) КАК ПродажиСебестоимостьОбороты
	               |		ПО ПродажиОбороты.ЗаказПокупателя = ПродажиСебестоимостьОбороты.ЗаказПокупателя
	               |			И ПродажиОбороты.Номенклатура = ПродажиСебестоимостьОбороты.Номенклатура
	               |			И ПродажиОбороты.Регистратор = ПродажиСебестоимостьОбороты.Регистратор
	               |ГДЕ
	               |	ПродажиОбороты.ЗаказПокупателя ССЫЛКА Документ.ЗаказПокупателя
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ПродажиОбороты.ЗаказПокупателя,
	               |	ПродажиОбороты.Номенклатура,
	               |	ПродажиОбороты.ЗаказПокупателя.ДоговорКонтрагента,
	               |	ПродажиОбороты.ЗаказПокупателя.Дата,
	               |	ПродажиОбороты.ЗаказПокупателя.ДатаОплаты,
	               |	ПродажиОбороты.ЗаказПокупателя.ДатаОтгрузки
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ЕСТЬNULL(втПродажиЗаПериод.ДоговорКонтрагента, втПродажиОплаченныеЗаПериод.ДоговорКонтрагента) КАК ДоговорКонтрагента,
	               |	ЕСТЬNULL(втПродажиЗаПериод.Сделка, втПродажиОплаченныеЗаПериод.Сделка) КАК Сделка,
	               |	ЕСТЬNULL(втПродажиЗаПериод.Номенклатура, втПродажиОплаченныеЗаПериод.Номенклатура) КАК Номенклатура,
	               |	СУММА(ЕСТЬNULL(втПродажиЗаПериод.СуммаПродажи, втПродажиОплаченныеЗаПериод.СуммаПродажи)) КАК СуммаПродажи,
	               |	СУММА(ЕСТЬNULL(втПродажиЗаПериод.СуммаСебестоимости, втПродажиОплаченныеЗаПериод.СуммаСебестоимости)) КАК СуммаСебестоимости,
	               |	СУММА(ЕСТЬNULL(втПродажиЗаПериод.ПродажиДиски, втПродажиОплаченныеЗаПериод.ПродажиДиски)) КАК ПродажиДиски,
	               |	СУММА(ЕСТЬNULL(втПродажиЗаПериод.ПродажиШины, втПродажиОплаченныеЗаПериод.ПродажиШины)) КАК ПродажиШины,
	               |	СУММА(ЕСТЬNULL(втПродажиЗаПериод.ПродажиАкб, втПродажиОплаченныеЗаПериод.ПродажиАкб)) КАК ПродажиАкб,
	               |	СУММА(ЕСТЬNULL(втПродажиЗаПериод.ПродажиАксы, втПродажиОплаченныеЗаПериод.ПродажиАксы)) КАК ПродажиАксы,
	               |	СУММА(ЕСТЬNULL(втПродажиЗаПериод.СебестоимостьДиски, втПродажиОплаченныеЗаПериод.СебестоимостьДиски)) КАК СебестоимостьДиски,
	               |	СУММА(ЕСТЬNULL(втПродажиЗаПериод.СебестоимостьШины, втПродажиОплаченныеЗаПериод.СебестоимостьШины)) КАК СебестоимостьШины,
	               |	СУММА(ЕСТЬNULL(втПродажиЗаПериод.СебестоимостьАКБ, втПродажиОплаченныеЗаПериод.СебестоимостьАКБ)) КАК СебестоимостьАКБ,
	               |	СУММА(ЕСТЬNULL(втПродажиЗаПериод.СебестоимостьАксы, втПродажиОплаченныеЗаПериод.СебестоимостьАксы)) КАК СебестоимостьАксы,
	               |	ЕСТЬNULL(втПродажиЗаПериод.ЗаказДата, втПродажиОплаченныеЗаПериод.ЗаказДата) КАК ЗаказДата,
	               |	ЕСТЬNULL(втПродажиЗаПериод.ЗаказДатаОплаты, втПродажиОплаченныеЗаПериод.ЗаказДатаОплаты) КАК ЗаказДатаОплаты,
	               |	ЕСТЬNULL(втПродажиЗаПериод.ЗаказДатаОтгрузки, втПродажиОплаченныеЗаПериод.ЗаказДатаОтгрузки) КАК ЗаказДатаОтгрузки
	               |ПОМЕСТИТЬ втПродажи
	               |ИЗ
	               |	втПродажиЗаПериод КАК втПродажиЗаПериод
	               |		ПОЛНОЕ СОЕДИНЕНИЕ втПродажиОплаченныеЗаПериод КАК втПродажиОплаченныеЗаПериод
	               |		ПО втПродажиЗаПериод.ДоговорКонтрагента = втПродажиОплаченныеЗаПериод.ДоговорКонтрагента
	               |			И втПродажиЗаПериод.Сделка = втПродажиОплаченныеЗаПериод.Сделка
	               |			И втПродажиЗаПериод.Номенклатура = втПродажиОплаченныеЗаПериод.Номенклатура
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ЕСТЬNULL(втПродажиЗаПериод.ДоговорКонтрагента, втПродажиОплаченныеЗаПериод.ДоговорКонтрагента),
	               |	ЕСТЬNULL(втПродажиЗаПериод.Сделка, втПродажиОплаченныеЗаПериод.Сделка),
	               |	ЕСТЬNULL(втПродажиЗаПериод.Номенклатура, втПродажиОплаченныеЗаПериод.Номенклатура),
	               |	ЕСТЬNULL(втПродажиЗаПериод.ЗаказДата, втПродажиОплаченныеЗаПериод.ЗаказДата),
	               |	ЕСТЬNULL(втПродажиЗаПериод.ЗаказДатаОплаты, втПродажиОплаченныеЗаПериод.ЗаказДатаОплаты),
	               |	ЕСТЬNULL(втПродажиЗаПериод.ЗаказДатаОтгрузки, втПродажиОплаченныеЗаПериод.ЗаказДатаОтгрузки)
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	А.Сделка,
	               |	А.НаценкаДиски,
	               |	А.НаценкаШины,
	               |	А.НаценкаАКБ,
	               |	А.НаценкаАксы,
	               |	А.Наценка,
	               |	А.СуммаПродажи,
	               |	А.СуммаСебестоимости,
	               |	А.ПродажиДиски,
	               |	А.ПродажиШины,
	               |	А.ПродажиАкб,
	               |	А.ПродажиАксы,
	               |	ВЫБОР
	               |		КОГДА А.СуммаПродажи <> 0
	               |			ТОГДА А.ПродажиДиски / А.СуммаПродажи
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК КоэффПродажДиски,
	               |	ВЫБОР
	               |		КОГДА А.СуммаПродажи <> 0
	               |			ТОГДА А.ПродажиШины / А.СуммаПродажи
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК КоэффПродажШины,
	               |	ВЫБОР
	               |		КОГДА А.СуммаПродажи <> 0
	               |			ТОГДА А.ПродажиАкб / А.СуммаПродажи
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК КоэффПродажАкб,
	               |	ВЫБОР
	               |		КОГДА А.СуммаПродажи <> 0
	               |			ТОГДА А.ПродажиАксы / А.СуммаПродажи
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК КоэффПродажАксы,
	               |	А.ДатаОплаты,
	               |	А.ДоговорКонтрагента,
	               |	&ВидПродаж
	               |ПОМЕСТИТЬ втПродажиНаценка
	               |ИЗ
	               |	(ВЫБРАТЬ
	               |		втПродажи.Сделка КАК Сделка,
	               |		СУММА(втПродажи.ПродажиДиски - втПродажи.СебестоимостьДиски) КАК НаценкаДиски,
	               |		СУММА(втПродажи.ПродажиШины - втПродажи.СебестоимостьШины) КАК НаценкаШины,
	               |		СУММА(втПродажи.ПродажиАкб - втПродажи.СебестоимостьАКБ) КАК НаценкаАКБ,
	               |		СУММА(втПродажи.ПродажиАксы - втПродажи.СебестоимостьАксы) КАК НаценкаАксы,
	               |		СУММА(втПродажи.СуммаПродажи - втПродажи.СуммаСебестоимости) КАК Наценка,
	               |		СУММА(втПродажи.СуммаПродажи) КАК СуммаПродажи,
	               |		СУММА(втПродажи.СуммаСебестоимости) КАК СуммаСебестоимости,
	               |		СУММА(втПродажи.ПродажиДиски) КАК ПродажиДиски,
	               |		СУММА(втПродажи.ПродажиШины) КАК ПродажиШины,
	               |		СУММА(втПродажи.ПродажиАкб) КАК ПродажиАкб,
	               |		СУММА(втПродажи.ПродажиАксы) КАК ПродажиАксы,
	               |		втПродажи.ЗаказДатаОплаты КАК ДатаОплаты,
	               |		втПродажи.ДоговорКонтрагента КАК ДоговорКонтрагента
	               |	ИЗ
	               |		втПродажи КАК втПродажи
	               |	
	               |	СГРУППИРОВАТЬ ПО
	               |		втПродажи.Сделка,
	               |		втПродажи.ЗаказДатаОплаты,
	               |		втПродажи.ДоговорКонтрагента) КАК А
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	втПродажи.Сделка КАК ЗаказПокупателя,
	               |	втПродажи.ЗаказДата КАК Дата,
	               |	втПродажи.Номенклатура.НоменклатурнаяГруппа КАК НоменклатурнаяГруппа,
	               |	втПродажи.Номенклатура.ВидТовара КАК ВидТовара,
	               |	втПродажи.ДоговорКонтрагента.Владелец КАК Контрагент,
	               |	СУММА(втПродажи.СуммаПродажи) КАК Сумма
	               |ПОМЕСТИТЬ втЗаказ
	               |ИЗ
	               |	втПродажи КАК втПродажи
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	втПродажи.Сделка,
	               |	втПродажи.ЗаказДата,
	               |	втПродажи.Номенклатура.НоменклатурнаяГруппа,
	               |	втПродажи.Номенклатура.ВидТовара,
	               |	втПродажи.ДоговорКонтрагента.Владелец
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	Б.ЗаказПокупателя КАК ЗаказПокупателя,
	               |	СУММА(ВЫБОР
	               |			КОГДА СтавкиБонусовКонтрагентов.Значение <> -1
	               |				ТОГДА СтавкиБонусовКонтрагентов.Значение * втЗаказ.Сумма / 100
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК Бонус,
	               |	СУММА(ВЫБОР
	               |			КОГДА Б.ВидТовара = ЗНАЧЕНИЕ(перечисление.видытоваров.Аксессуары)
	               |				ТОГДА ВЫБОР
	               |						КОГДА СтавкиБонусовКонтрагентов.Значение <> -1
	               |							ТОГДА СтавкиБонусовКонтрагентов.Значение * втЗаказ.Сумма / 100
	               |						ИНАЧЕ 0
	               |					КОНЕЦ
	               |			ИНАЧЕ -0
	               |		КОНЕЦ) КАК БонусАксы,
	               |	СУММА(ВЫБОР
	               |			КОГДА Б.ВидТовара = ЗНАЧЕНИЕ(перечисление.видытоваров.Акб)
	               |				ТОГДА ВЫБОР
	               |						КОГДА СтавкиБонусовКонтрагентов.Значение <> -1
	               |							ТОГДА СтавкиБонусовКонтрагентов.Значение * втЗаказ.Сумма / 100
	               |						ИНАЧЕ 0
	               |					КОНЕЦ
	               |			ИНАЧЕ -0
	               |		КОНЕЦ) КАК БонусАкб,
	               |	СУММА(ВЫБОР
	               |			КОГДА Б.ВидТовара = ЗНАЧЕНИЕ(перечисление.видытоваров.Диски)
	               |				ТОГДА ВЫБОР
	               |						КОГДА СтавкиБонусовКонтрагентов.Значение <> -1
	               |							ТОГДА СтавкиБонусовКонтрагентов.Значение * втЗаказ.Сумма / 100
	               |						ИНАЧЕ 0
	               |					КОНЕЦ
	               |			ИНАЧЕ -0
	               |		КОНЕЦ) КАК БонусДиски,
	               |	СУММА(ВЫБОР
	               |			КОГДА Б.ВидТовара = ЗНАЧЕНИЕ(перечисление.видытоваров.шины)
	               |				ТОГДА ВЫБОР
	               |						КОГДА СтавкиБонусовКонтрагентов.Значение <> -1
	               |							ТОГДА СтавкиБонусовКонтрагентов.Значение * втЗаказ.Сумма / 100
	               |						ИНАЧЕ 0
	               |					КОНЕЦ
	               |			ИНАЧЕ -0
	               |		КОНЕЦ) КАК БонусШины
	               |ПОМЕСТИТЬ втБонусы
	               |ИЗ
	               |	(ВЫБРАТЬ
	               |		А.Контрагент КАК Контрагент,
	               |		А.ЗаказПокупателя КАК ЗаказПокупателя,
	               |		А.ДатаЗаказа КАК ДатаЗаказа,
	               |		А.НоменклатурнаяГруппа КАК НоменклатурнаяГруппа,
	               |		А.Производитель КАК Производитель,
	               |		А.ВидТовара КАК ВидТовара,
	               |		МАКСИМУМ(А.ПериодБонуса) КАК ПериодБонуса
	               |	ИЗ
	               |		(ВЫБРАТЬ
	               |			СтавкиБонусовКонтрагентов.Контрагент КАК Контрагент,
	               |			втЗаказ.ЗаказПокупателя КАК ЗаказПокупателя,
	               |			втЗаказ.Дата КАК ДатаЗаказа,
	               |			СтавкиБонусовКонтрагентов.НоменклатурнаяГруппа КАК НоменклатурнаяГруппа,
	               |			СтавкиБонусовКонтрагентов.Производитель КАК Производитель,
	               |			СтавкиБонусовКонтрагентов.ВидТовара КАК ВидТовара,
	               |			МАКСИМУМ(СтавкиБонусовКонтрагентов.Период) КАК ПериодБонуса,
	               |			СтавкиБонусовКонтрагентов.Вид КАК Вид
	               |		ИЗ
	               |			втЗаказ КАК втЗаказ
	               |				ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.СтавкиБонусовКонтрагентов КАК СтавкиБонусовКонтрагентов
	               |				ПО втЗаказ.Дата >= СтавкиБонусовКонтрагентов.Период
	               |					И втЗаказ.НоменклатурнаяГруппа = СтавкиБонусовКонтрагентов.НоменклатурнаяГруппа
	               |					И (СтавкиБонусовКонтрагентов.Производитель = ЗНАЧЕНИЕ(Справочник.Производители.ПустаяСсылка))
	               |					И втЗаказ.Контрагент = СтавкиБонусовКонтрагентов.Контрагент
	               |					И (втЗаказ.ВидТовара = ЗНАЧЕНИЕ(Перечисление.видыТоваров.ПустаяСсылка))
	               |		
	               |		СГРУППИРОВАТЬ ПО
	               |			СтавкиБонусовКонтрагентов.Контрагент,
	               |			втЗаказ.ЗаказПокупателя,
	               |			втЗаказ.Дата,
	               |			СтавкиБонусовКонтрагентов.НоменклатурнаяГруппа,
	               |			СтавкиБонусовКонтрагентов.Производитель,
	               |			СтавкиБонусовКонтрагентов.ВидТовара,
	               |			СтавкиБонусовКонтрагентов.Вид
	               |		
	               |		ОБЪЕДИНИТЬ ВСЕ
	               |		
	               |		ВЫБРАТЬ
	               |			СтавкиБонусовКонтрагентов.Контрагент,
	               |			втЗаказ.ЗаказПокупателя,
	               |			втЗаказ.Дата,
	               |			СтавкиБонусовКонтрагентов.НоменклатурнаяГруппа,
	               |			СтавкиБонусовКонтрагентов.Производитель,
	               |			СтавкиБонусовКонтрагентов.ВидТовара,
	               |			МАКСИМУМ(СтавкиБонусовКонтрагентов.Период),
	               |			СтавкиБонусовКонтрагентов.Вид
	               |		ИЗ
	               |			втЗаказ КАК втЗаказ
	               |				ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.СтавкиБонусовКонтрагентов КАК СтавкиБонусовКонтрагентов
	               |				ПО втЗаказ.Дата >= СтавкиБонусовКонтрагентов.Период
	               |					И втЗаказ.НоменклатурнаяГруппа = СтавкиБонусовКонтрагентов.НоменклатурнаяГруппа
	               |					И втЗаказ.Контрагент = СтавкиБонусовКонтрагентов.Контрагент
	               |					И (втЗаказ.ВидТовара = ЗНАЧЕНИЕ(Перечисление.видыТоваров.ПустаяСсылка))
	               |		
	               |		СГРУППИРОВАТЬ ПО
	               |			СтавкиБонусовКонтрагентов.Контрагент,
	               |			втЗаказ.Дата,
	               |			СтавкиБонусовКонтрагентов.Производитель,
	               |			СтавкиБонусовКонтрагентов.ВидТовара,
	               |			СтавкиБонусовКонтрагентов.Вид,
	               |			СтавкиБонусовКонтрагентов.НоменклатурнаяГруппа,
	               |			втЗаказ.ЗаказПокупателя
	               |		
	               |		ОБЪЕДИНИТЬ ВСЕ
	               |		
	               |		ВЫБРАТЬ
	               |			СтавкиБонусовКонтрагентов.Контрагент,
	               |			втЗаказ.ЗаказПокупателя,
	               |			втЗаказ.Дата,
	               |			СтавкиБонусовКонтрагентов.НоменклатурнаяГруппа,
	               |			СтавкиБонусовКонтрагентов.Производитель,
	               |			СтавкиБонусовКонтрагентов.ВидТовара,
	               |			МАКСИМУМ(СтавкиБонусовКонтрагентов.Период),
	               |			СтавкиБонусовКонтрагентов.Вид
	               |		ИЗ
	               |			втЗаказ КАК втЗаказ
	               |				ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.СтавкиБонусовКонтрагентов КАК СтавкиБонусовКонтрагентов
	               |				ПО втЗаказ.Дата >= СтавкиБонусовКонтрагентов.Период
	               |					И втЗаказ.Контрагент = СтавкиБонусовКонтрагентов.Контрагент
	               |					И (СтавкиБонусовКонтрагентов.НоменклатурнаяГруппа = ЗНАЧЕНИЕ(Справочник.НоменклатурныеГруппы.ПустаяСсылка))
	               |					И (втЗаказ.ВидТовара = ЗНАЧЕНИЕ(Перечисление.видыТоваров.ПустаяСсылка))
	               |		
	               |		СГРУППИРОВАТЬ ПО
	               |			СтавкиБонусовКонтрагентов.ВидТовара,
	               |			втЗаказ.ЗаказПокупателя,
	               |			втЗаказ.Дата,
	               |			СтавкиБонусовКонтрагентов.НоменклатурнаяГруппа,
	               |			СтавкиБонусовКонтрагентов.Контрагент,
	               |			СтавкиБонусовКонтрагентов.Вид,
	               |			СтавкиБонусовКонтрагентов.Производитель
	               |		
	               |		ОБЪЕДИНИТЬ ВСЕ
	               |		
	               |		ВЫБРАТЬ
	               |			СтавкиБонусовКонтрагентов.Контрагент,
	               |			втЗаказ.ЗаказПокупателя,
	               |			втЗаказ.Дата,
	               |			СтавкиБонусовКонтрагентов.НоменклатурнаяГруппа,
	               |			СтавкиБонусовКонтрагентов.Производитель,
	               |			СтавкиБонусовКонтрагентов.ВидТовара,
	               |			МАКСИМУМ(СтавкиБонусовКонтрагентов.Период),
	               |			СтавкиБонусовКонтрагентов.Вид
	               |		ИЗ
	               |			втЗаказ КАК втЗаказ
	               |				ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.СтавкиБонусовКонтрагентов КАК СтавкиБонусовКонтрагентов
	               |				ПО втЗаказ.Дата >= СтавкиБонусовКонтрагентов.Период
	               |					И втЗаказ.Контрагент = СтавкиБонусовКонтрагентов.Контрагент
	               |					И (СтавкиБонусовКонтрагентов.НоменклатурнаяГруппа = ЗНАЧЕНИЕ(Справочник.НоменклатурныеГруппы.ПустаяСсылка))
	               |					И (СтавкиБонусовКонтрагентов.Производитель = ЗНАЧЕНИЕ(Справочник.Производители.ПустаяСсылка))
	               |					И втЗаказ.ВидТовара = СтавкиБонусовКонтрагентов.ВидТовара
	               |					И (втЗаказ.ВидТовара <> ЗНАЧЕНИЕ(Перечисление.видыТоваров.ПустаяСсылка))
	               |		
	               |		СГРУППИРОВАТЬ ПО
	               |			СтавкиБонусовКонтрагентов.Производитель,
	               |			СтавкиБонусовКонтрагентов.Вид,
	               |			втЗаказ.ЗаказПокупателя,
	               |			СтавкиБонусовКонтрагентов.НоменклатурнаяГруппа,
	               |			СтавкиБонусовКонтрагентов.Контрагент,
	               |			втЗаказ.Дата,
	               |			СтавкиБонусовКонтрагентов.ВидТовара) КАК А
	               |	
	               |	СГРУППИРОВАТЬ ПО
	               |		А.Контрагент,
	               |		А.ЗаказПокупателя,
	               |		А.ДатаЗаказа,
	               |		А.НоменклатурнаяГруппа,
	               |		А.Производитель,
	               |		А.ВидТовара) КАК Б
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.СтавкиБонусовКонтрагентов КАК СтавкиБонусовКонтрагентов
	               |		ПО Б.Контрагент = СтавкиБонусовКонтрагентов.Контрагент
	               |			И Б.ПериодБонуса = СтавкиБонусовКонтрагентов.Период
	               |			И Б.НоменклатурнаяГруппа = СтавкиБонусовКонтрагентов.НоменклатурнаяГруппа
	               |			И Б.Производитель = СтавкиБонусовКонтрагентов.Производитель
	               |			И Б.ВидТовара = СтавкиБонусовКонтрагентов.ВидТовара
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втЗаказ КАК втЗаказ
	               |		ПО Б.ЗаказПокупателя = втЗаказ.ЗаказПокупателя
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	Б.ЗаказПокупателя
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	втПродажи.Номенклатура.НоменклатурнаяГруппа КАК НоменклатураНоменклатурнаяГруппа,
	               |	НАЧАЛОПЕРИОДА(втПродажи.ЗаказДата, МЕСЯЦ) КАК МесяцЗаказа,
	               |	втПродажи.Сделка КАК Сделка,
	               |	втПродажи.ЗаказДатаОплаты КАК ЗаказДатаОплаты,
	               |	СУММА(втПродажи.СуммаПродажи) КАК СуммаПродажи,
	               |	втПродажи.Номенклатура КАК Номенклатура,
	               |	втПродажи.Номенклатура.ВидТовара КАК НоменклатураВидТовара,
	               |	втПродажи.Номенклатура.Производитель КАК НоменклатураПроизводитель,
	               |	втПродажи.ЗаказДата,
	               |	втПродажи.ЗаказДатаОтгрузки
	               |ПОМЕСТИТЬ втДляПредоплатыПросрочки
	               |ИЗ
	               |	втПродажи КАК втПродажи
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	втПродажи.ЗаказДатаОплаты,
	               |	втПродажи.Номенклатура.НоменклатурнаяГруппа,
	               |	втПродажи.Сделка,
	               |	НАЧАЛОПЕРИОДА(втПродажи.ЗаказДата, МЕСЯЦ),
	               |	втПродажи.Номенклатура,
	               |	втПродажи.Номенклатура.ВидТовара,
	               |	втПродажи.Номенклатура.Производитель,
	               |	втПродажи.ЗаказДата,
	               |	втПродажи.ЗаказДатаОтгрузки
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	А.сделка,
	               |	А.номенклатура,
	               |	А.РекомендованаяДатаОплаты,
	               |	А.Приоритет
	               |ПОМЕСТИТЬ втОсноваПремииПредоплата
	               |ИЗ
	               |	(ВЫБРАТЬ
	               |		втДляПредоплатыПросрочки.Сделка КАК сделка,
	               |		втДляПредоплатыПросрочки.Номенклатура КАК номенклатура,
	               |		ВЫБОР
	               |			КОГДА РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.ДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
	               |				ТОГДА ДОБАВИТЬКДАТЕ(втДляПредоплатыПросрочки.ЗаказДатаОтгрузки, ДЕНЬ, РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.ДнейОтсрочки)
	               |			ИНАЧЕ РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.ДатаОплаты
	               |		КОНЕЦ КАК РекомендованаяДатаОплаты,
	               |		4 КАК Приоритет
	               |	ИЗ
	               |		втДляПредоплатыПросрочки КАК втДляПредоплатыПросрочки
	               |			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам КАК РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам
	               |			ПО втДляПредоплатыПросрочки.МесяцЗаказа = РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.Месяц
	               |				И втДляПредоплатыПросрочки.НоменклатураВидТовара = РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.ВидТовара
	               |	ГДЕ
	               |		РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.Производитель = ЗНАЧЕНИЕ(Справочник.Производители.ПустаяСсылка)
	               |		И РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.НоменклатурнаяГруппа = ЗНАЧЕНИЕ(Справочник.НоменклатурныеГруппы.ПустаяСсылка)
	               |	
	               |	ОБЪЕДИНИТЬ ВСЕ
	               |	
	               |	ВЫБРАТЬ
	               |		втДляПредоплатыПросрочки.Сделка,
	               |		втДляПредоплатыПросрочки.Номенклатура,
	               |		ВЫБОР
	               |			КОГДА РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.ДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
	               |				ТОГДА ДОБАВИТЬКДАТЕ(втДляПредоплатыПросрочки.ЗаказДатаОтгрузки, ДЕНЬ, РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.ДнейОтсрочки)
	               |			ИНАЧЕ РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.ДатаОплаты
	               |		КОНЕЦ,
	               |		3
	               |	ИЗ
	               |		втДляПредоплатыПросрочки КАК втДляПредоплатыПросрочки
	               |			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам КАК РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам
	               |			ПО втДляПредоплатыПросрочки.МесяцЗаказа = РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.Месяц
	               |				И втДляПредоплатыПросрочки.НоменклатураВидТовара = РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.ВидТовара
	               |				И втДляПредоплатыПросрочки.НоменклатураПроизводитель = РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.Производитель
	               |	ГДЕ
	               |		РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.НоменклатурнаяГруппа = ЗНАЧЕНИЕ(Справочник.НоменклатурныеГруппы.ПустаяСсылка)
	               |	
	               |	ОБЪЕДИНИТЬ ВСЕ
	               |	
	               |	ВЫБРАТЬ
	               |		втДляПредоплатыПросрочки.Сделка,
	               |		втДляПредоплатыПросрочки.Номенклатура,
	               |		ВЫБОР
	               |			КОГДА РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.ДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
	               |				ТОГДА ДОБАВИТЬКДАТЕ(втДляПредоплатыПросрочки.ЗаказДатаОтгрузки, ДЕНЬ, РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.ДнейОтсрочки)
	               |			ИНАЧЕ РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.ДатаОплаты
	               |		КОНЕЦ,
	               |		2
	               |	ИЗ
	               |		втДляПредоплатыПросрочки КАК втДляПредоплатыПросрочки
	               |			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам КАК РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам
	               |			ПО втДляПредоплатыПросрочки.МесяцЗаказа = РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.Месяц
	               |				И втДляПредоплатыПросрочки.НоменклатураВидТовара = РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.ВидТовара
	               |				И втДляПредоплатыПросрочки.НоменклатураНоменклатурнаяГруппа = РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.НоменклатурнаяГруппа
	               |	ГДЕ
	               |		РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.Производитель = ЗНАЧЕНИЕ(Справочник.Производители.ПустаяСсылка)
	               |	
	               |	ОБЪЕДИНИТЬ ВСЕ
	               |	
	               |	ВЫБРАТЬ
	               |		втДляПредоплатыПросрочки.Сделка,
	               |		втДляПредоплатыПросрочки.Номенклатура,
	               |		ВЫБОР
	               |			КОГДА РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.ДатаОплаты = ДАТАВРЕМЯ(1, 1, 1)
	               |				ТОГДА ДОБАВИТЬКДАТЕ(втДляПредоплатыПросрочки.ЗаказДатаОтгрузки, ДЕНЬ, РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.ДнейОтсрочки)
	               |			ИНАЧЕ РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.ДатаОплаты
	               |		КОНЕЦ,
	               |		1
	               |	ИЗ
	               |		втДляПредоплатыПросрочки КАК втДляПредоплатыПросрочки
	               |			ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам КАК РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам
	               |			ПО втДляПредоплатыПросрочки.МесяцЗаказа = РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.Месяц
	               |				И втДляПредоплатыПросрочки.НоменклатураВидТовара = РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.ВидТовара
	               |				И втДляПредоплатыПросрочки.НоменклатураНоменклатурнаяГруппа = РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.НоменклатурнаяГруппа
	               |				И втДляПредоплатыПросрочки.НоменклатураПроизводитель = РекомендованыеДатыОтсрочкиПоНоменклатурнымГруппам.Производитель) КАК А
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	втПродажи.Сделка КАК ЗаказПокупателя,
	               |	СУММА(ВЫБОР
	               |			КОГДА втПродажи.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(перечисление.ВидыТоваров.Аксессуары)
	               |				ТОГДА ВЫБОР
	               |						КОГДА РАЗНОСТЬДАТ(втПродажи.ЗаказДатаОплаты, ЕСТЬNULL(Б.РекомендованаяДатаОплаты, ДОБАВИТЬКДАТЕ(втПродажи.ЗаказДата, МЕСЯЦ, 4)), ДЕНЬ) > 0
	               |							ТОГДА &ПроцПремированияПредоплаты
	               |						ИНАЧЕ &ПроцДепремированияПредоплаты
	               |					КОНЕЦ * втПродажи.СуммаПродажи * РАЗНОСТЬДАТ(втПродажи.ЗаказДатаОплаты, ЕСТЬNULL(Б.РекомендованаяДатаОплаты, ДОБАВИТЬКДАТЕ(втПродажи.ЗаказДата, МЕСЯЦ, 4)), ДЕНЬ) / 36500
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК ПремияЗаПредоплатуАксы,
	               |	СУММА(ВЫБОР
	               |			КОГДА втПродажи.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(перечисление.ВидыТоваров.АКБ)
	               |				ТОГДА ВЫБОР
	               |						КОГДА РАЗНОСТЬДАТ(втПродажи.ЗаказДатаОплаты, ЕСТЬNULL(Б.РекомендованаяДатаОплаты, ДОБАВИТЬКДАТЕ(втПродажи.ЗаказДата, МЕСЯЦ, 4)), ДЕНЬ) > 0
	               |							ТОГДА &ПроцПремированияПредоплаты
	               |						ИНАЧЕ &ПроцДепремированияПредоплаты
	               |					КОНЕЦ * втПродажи.СуммаПродажи * РАЗНОСТЬДАТ(втПродажи.ЗаказДатаОплаты, ЕСТЬNULL(Б.РекомендованаяДатаОплаты, ДОБАВИТЬКДАТЕ(втПродажи.ЗаказДата, МЕСЯЦ, 4)), ДЕНЬ) / 36500
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК ПремияЗаПредоплатуАкб,
	               |	СУММА(ВЫБОР
	               |			КОГДА втПродажи.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(перечисление.ВидыТоваров.Шины)
	               |				ТОГДА ВЫБОР
	               |						КОГДА РАЗНОСТЬДАТ(втПродажи.ЗаказДатаОплаты, ЕСТЬNULL(Б.РекомендованаяДатаОплаты, ДОБАВИТЬКДАТЕ(втПродажи.ЗаказДата, МЕСЯЦ, 4)), ДЕНЬ) > 0
	               |							ТОГДА &ПроцПремированияПредоплаты
	               |						ИНАЧЕ &ПроцДепремированияПредоплаты
	               |					КОНЕЦ * втПродажи.СуммаПродажи * РАЗНОСТЬДАТ(втПродажи.ЗаказДатаОплаты, ЕСТЬNULL(Б.РекомендованаяДатаОплаты, ДОБАВИТЬКДАТЕ(втПродажи.ЗаказДата, МЕСЯЦ, 4)), ДЕНЬ) / 36500
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК ПремияЗаПредоплатуШины,
	               |	СУММА(ВЫБОР
	               |			КОГДА втПродажи.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(перечисление.ВидыТоваров.Диски)
	               |				ТОГДА ВЫБОР
	               |						КОГДА РАЗНОСТЬДАТ(втПродажи.ЗаказДатаОплаты, ЕСТЬNULL(Б.РекомендованаяДатаОплаты, ДОБАВИТЬКДАТЕ(втПродажи.ЗаказДата, МЕСЯЦ, 4)), ДЕНЬ) > 0
	               |							ТОГДА &ПроцПремированияПредоплаты
	               |						ИНАЧЕ &ПроцДепремированияПредоплаты
	               |					КОНЕЦ * втПродажи.СуммаПродажи * РАЗНОСТЬДАТ(втПродажи.ЗаказДатаОплаты, ЕСТЬNULL(Б.РекомендованаяДатаОплаты, ДОБАВИТЬКДАТЕ(втПродажи.ЗаказДата, МЕСЯЦ, 4)), ДЕНЬ) / 36500
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК ПремияЗаПредоплатуДиски,
	               |	СУММА(0) КАК ПремияЗаПредоплату
	               |ПОМЕСТИТЬ втПремииЗаПредоплату
	               |ИЗ
	               |	втПродажи КАК втПродажи
	               |		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	               |			втОсноваПремииПредоплата.сделка КАК сделка,
	               |			втОсноваПремииПредоплата.номенклатура КАК номенклатура,
	               |			втОсноваПремииПредоплата.РекомендованаяДатаОплаты КАК РекомендованаяДатаОплаты
	               |		ИЗ
	               |			(ВЫБРАТЬ
	               |				втОсноваПремииПредоплата.сделка КАК сделка,
	               |				втОсноваПремииПредоплата.номенклатура КАК номенклатура,
	               |				МИНИМУМ(втОсноваПремииПредоплата.Приоритет) КАК Приоритет
	               |			ИЗ
	               |				втОсноваПремииПредоплата КАК втОсноваПремииПредоплата
	               |			
	               |			СГРУППИРОВАТЬ ПО
	               |				втОсноваПремииПредоплата.номенклатура,
	               |				втОсноваПремииПредоплата.сделка) КАК А
	               |				ВНУТРЕННЕЕ СОЕДИНЕНИЕ втОсноваПремииПредоплата КАК втОсноваПремииПредоплата
	               |				ПО А.сделка = втОсноваПремииПредоплата.сделка
	               |					И А.номенклатура = втОсноваПремииПредоплата.номенклатура
	               |					И А.Приоритет = втОсноваПремииПредоплата.Приоритет) КАК Б
	               |		ПО втПродажи.Сделка = Б.сделка
	               |			И втПродажи.Номенклатура = Б.номенклатура
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	втПродажи.Сделка
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ИнформацияПоПроезду.Заказ,
	               |	СУММА(ИнформацияПоПроезду.ДоставкаВЦене) КАК Транспорт,
	               |	СУММА(ВЫБОР
	               |			КОГДА ИнформацияПоПроезду.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)
	               |				ТОГДА ИнформацияПоПроезду.ДоставкаВЦене
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК ТранспортДиски,
	               |	СУММА(ВЫБОР
	               |			КОГДА ИнформацияПоПроезду.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Шины)
	               |				ТОГДА ИнформацияПоПроезду.ДоставкаВЦене
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК ТранспортШины,
	               |	СУММА(ВЫБОР
	               |			КОГДА ИнформацияПоПроезду.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.АКБ)
	               |				ТОГДА ИнформацияПоПроезду.ДоставкаВЦене
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК ТранспортАКБ,
	               |	СУММА(ВЫБОР
	               |			КОГДА ИнформацияПоПроезду.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Аксессуары)
	               |				ТОГДА ИнформацияПоПроезду.ДоставкаВЦене
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК ТранспортАксы
	               |ПОМЕСТИТЬ втТранспорт
	               |ИЗ
	               |	втПродажиНаценка КАК втПродажиНаценка
	               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ИнформацияПоПроезду КАК ИнформацияПоПроезду
	               |		ПО втПродажиНаценка.Сделка = ИнформацияПоПроезду.Заказ
	               |ГДЕ
	               |	ИнформацияПоПроезду.ДоставкаВЦене > 0
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ИнформацияПоПроезду.Заказ
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ВзаиморасчетыСКонтрагентамиОбороты.ДоговорКонтрагента.ОтветственноеЛицо КАК Менеджер,
	               |	ВзаиморасчетыСКонтрагентамиОбороты.ДоговорКонтрагента.Владелец КАК Контрагент,
	               |	СУММА(ВзаиморасчетыСКонтрагентамиОбороты.СуммаВзаиморасчетовРасход) КАК ОплатаПеней,
	               |	ВзаиморасчетыСКонтрагентамиОбороты.ДоговорКонтрагента.Владелец.ПроцентПени КАК ПроцентПени,
	               |	&ВидПродаж
	               |ПОМЕСТИТЬ втОплаченныеПени
	               |ИЗ
	               |	РегистрНакопления.ВзаиморасчетыСКонтрагентами.Обороты(
	               |			&НачПериода,
	               |			&КонПериода,
	               |			Регистратор,
	               |			ДоговорКонтрагента.ТипДоговора = ЗНАЧЕНИЕ(Справочник.ТипыДоговоров.Пени)
	               |				И &ВидПродаж = ""Продажи"") КАК ВзаиморасчетыСКонтрагентамиОбороты
	               |ГДЕ
	               |	ВзаиморасчетыСКонтрагентамиОбороты.Регистратор ССЫЛКА Документ.ПлатежноеПоручениеВходящее
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ВзаиморасчетыСКонтрагентамиОбороты.ДоговорКонтрагента.ОтветственноеЛицо,
	               |	ВзаиморасчетыСКонтрагентамиОбороты.ДоговорКонтрагента.Владелец,
	               |	ВзаиморасчетыСКонтрагентамиОбороты.ДоговорКонтрагента.Владелец.ПроцентПени
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	А.Сделка,
	               |	А.СуммаУпрОстаток КАК ДолгПоЗаказу,
	               |	ВЫБОР
	               |		КОГДА А.ДнейПросрочки > 0
	               |			ТОГДА А.ДнейПросрочки
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДнейПросрочки,
	               |	А.ДатаОплаты КАК ДатаОплаты,
	               |	ВЫБОР
	               |		КОГДА А.ДнейПросрочки > 0
	               |			ТОГДА А.ШтрафЗаПросрочку
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ШтрафЗаПросрочку,
	               |	ВЫБОР
	               |		КОГДА А.ДнейПросрочки > 0
	               |			ТОГДА А.СуммаУпрОстаток
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК Просрочено
	               |ПОМЕСТИТЬ втПросрочкиОплат
	               |ИЗ
	               |	(ВЫБРАТЬ
	               |		ВзаиморасчетыСКонтрагентамиОстатки.Сделка КАК Сделка,
	               |		СУММА(ВзаиморасчетыСКонтрагентамиОстатки.СуммаУпрОстаток) КАК СуммаУпрОстаток,
	               |		ВЫБОР
	               |			КОГДА РАЗНОСТЬДАТ(втПродажиНаценка.ДатаОплаты, &ПериодОстатков, ДЕНЬ) > 0
	               |				ТОГДА РАЗНОСТЬДАТ(втПродажиНаценка.ДатаОплаты, &ПериодОстатков, ДЕНЬ)
	               |			ИНАЧЕ 0
	               |		КОНЕЦ КАК ДнейПросрочки,
	               |		втПродажиНаценка.ДатаОплаты КАК ДатаОплаты,
	               |		СУММА(ВЫРАЗИТЬ(ВЫБОР
	               |					КОГДА РАЗНОСТЬДАТ(втПродажиНаценка.ДатаОплаты, &ПериодОстатков, ДЕНЬ) > 0
	               |							И втПродажиНаценка.ДатаОплаты > ДАТАВРЕМЯ(1, 1, 1)
	               |						ТОГДА &ПроцДепремированияПросрочки * ВзаиморасчетыСКонтрагентамиОстатки.СуммаУпрОстаток * РАЗНОСТЬДАТ(втПродажиНаценка.ДатаОплаты, &ПериодОстатков, ДЕНЬ) / 36500
	               |					ИНАЧЕ 0
	               |				КОНЕЦ КАК ЧИСЛО(15, 0))) КАК ШтрафЗаПросрочку
	               |	ИЗ
	               |		РегистрНакопления.ВзаиморасчетыСКонтрагентами.Остатки КАК ВзаиморасчетыСКонтрагентамиОстатки
	               |			ВНУТРЕННЕЕ СОЕДИНЕНИЕ втПродажиНаценка КАК втПродажиНаценка
	               |			ПО ВзаиморасчетыСКонтрагентамиОстатки.Сделка = втПродажиНаценка.Сделка
	               |	
	               |	СГРУППИРОВАТЬ ПО
	               |		ВзаиморасчетыСКонтрагентамиОстатки.Сделка,
	               |		втПродажиНаценка.ДатаОплаты,
	               |		ВЫБОР
	               |			КОГДА РАЗНОСТЬДАТ(втПродажиНаценка.ДатаОплаты, &ПериодОстатков, ДЕНЬ) > 0
	               |				ТОГДА РАЗНОСТЬДАТ(втПродажиНаценка.ДатаОплаты, &ПериодОстатков, ДЕНЬ)
	               |			ИНАЧЕ 0
	               |		КОНЕЦ) КАК А
	               |ГДЕ
	               |	А.СуммаУпрОстаток > 0
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	втПродажиНаценка.Сделка,
	               |	втПродажиНаценка.НаценкаДиски,
	               |	втПродажиНаценка.НаценкаШины,
	               |	втПродажиНаценка.НаценкаАКБ,
	               |	втПродажиНаценка.НаценкаАксы,
	               |	втПродажиНаценка.Наценка,
	               |	втПродажиНаценка.СуммаПродажи,
	               |	втПродажиНаценка.СуммаСебестоимости,
	               |	втПродажиНаценка.ПродажиДиски,
	               |	втПродажиНаценка.ПродажиШины,
	               |	втПродажиНаценка.ПродажиАкб,
	               |	втПродажиНаценка.ПродажиАксы,
	               |	втПродажиНаценка.КоэффПродажДиски,
	               |	втПродажиНаценка.КоэффПродажШины,
	               |	втПродажиНаценка.КоэффПродажАкб,
	               |	втПродажиНаценка.КоэффПродажАксы,
	               |	ЕСТЬNULL(втПремииЗаПредоплату.ПремияЗаПредоплатуАксы, 0) + ЕСТЬNULL(втПремииЗаПредоплату.ПремияЗаПредоплатуАкб, 0) + ЕСТЬNULL(втПремииЗаПредоплату.ПремияЗаПредоплатуШины, 0) + ЕСТЬNULL(втПремииЗаПредоплату.ПремияЗаПредоплатуДиски, 0) КАК ПремияЗаПредоплату,
	               |	ЕСТЬNULL(втПремииЗаПредоплату.ПремияЗаПредоплатуДиски, 0) КАК ПремияЗаПредоплатуДиски,
	               |	ЕСТЬNULL(втПремииЗаПредоплату.ПремияЗаПредоплатуШины, 0) КАК ПремияЗаПредоплатуШины,
	               |	ЕСТЬNULL(втПремииЗаПредоплату.ПремияЗаПредоплатуАкб, 0) КАК ПремияЗаПредоплатуАкб,
	               |	ЕСТЬNULL(втПремииЗаПредоплату.ПремияЗаПредоплатуАксы, 0) КАК ПремияЗаПредоплатуАксы,
	               |	ЕСТЬNULL(втТранспорт.ТранспортДиски, 0) КАК ТранспортДиски,
	               |	ЕСТЬNULL(втТранспорт.ТранспортШины, 0) КАК ТранспортШины,
	               |	ЕСТЬNULL(втТранспорт.ТранспортАКБ, 0) КАК ТранспортАКБ,
	               |	ЕСТЬNULL(втТранспорт.ТранспортАксы, 0) КАК ТранспортАксы,
	               |	ЕСТЬNULL(втБонусы.БонусАксы, 0) КАК БонусАксы,
	               |	ЕСТЬNULL(втБонусы.БонусАкб, 0) КАК БонусАкб,
	               |	ЕСТЬNULL(втБонусы.БонусДиски, 0) КАК БонусДиски,
	               |	ЕСТЬNULL(втБонусы.БонусШины, 0) КАК БонусШины
	               |ПОМЕСТИТЬ втПоказателиДляПремииЗаНаценку
	               |ИЗ
	               |	втПродажиНаценка КАК втПродажиНаценка
	               |		ЛЕВОЕ СОЕДИНЕНИЕ втПремииЗаПредоплату КАК втПремииЗаПредоплату
	               |		ПО втПродажиНаценка.Сделка = втПремииЗаПредоплату.ЗаказПокупателя
	               |		ЛЕВОЕ СОЕДИНЕНИЕ втТранспорт КАК втТранспорт
	               |		ПО втПродажиНаценка.Сделка = втТранспорт.Заказ
	               |		ЛЕВОЕ СОЕДИНЕНИЕ втБонусы КАК втБонусы
	               |		ПО втПродажиНаценка.Сделка = втБонусы.ЗаказПокупателя
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	втПоказателиДляПремииЗаНаценку.Сделка,
	               |	(втПоказателиДляПремииЗаНаценку.НаценкаДиски + втПоказателиДляПремииЗаНаценку.ПремияЗаПредоплатуДиски - втПоказателиДляПремииЗаНаценку.ТранспортДиски - втПоказателиДляПремииЗаНаценку.БонусДиски) * (1 + &КоэффотсеченияД) * &КоэффЗаНаценкуД КАК ПремияЗаНаценкуДиски,
	               |	(втПоказателиДляПремииЗаНаценку.НаценкаШины + втПоказателиДляПремииЗаНаценку.ПремияЗаПредоплатуШины - втПоказателиДляПремииЗаНаценку.ТранспортШины - втПоказателиДляПремииЗаНаценку.БонусШины) * (1 + &КоэффотсеченияШ) * &КоэффЗаНаценкуШ КАК ПремияЗаНаценкуШины,
	               |	(втПоказателиДляПремииЗаНаценку.НаценкаАКБ + втПоказателиДляПремииЗаНаценку.ПремияЗаПредоплатуАкб - втПоказателиДляПремииЗаНаценку.ТранспортАКБ - втПоказателиДляПремииЗаНаценку.БонусАкб) * (1 + &КоэффотсеченияАкб) * &КоэффЗаНаценкуАкб КАК ПремияЗаНаценкуАкб,
	               |	(втПоказателиДляПремииЗаНаценку.НаценкаАксы + втПоказателиДляПремииЗаНаценку.ПремияЗаПредоплатуАксы - втПоказателиДляПремииЗаНаценку.ТранспортАксы - втПоказателиДляПремииЗаНаценку.НаценкаАксы) * &КоэффЗаНаценкуАкс КАК ПремияЗаНаценкуАксы,
	               |	ВЫБОР
	               |		КОГДА (втПоказателиДляПремииЗаНаценку.НаценкаДиски + втПоказателиДляПремииЗаНаценку.ПремияЗаПредоплатуДиски - втПоказателиДляПремииЗаНаценку.ТранспортДиски) * (1 + &КоэффотсеченияД) * &КоэффЗаНаценкуД + (втПоказателиДляПремииЗаНаценку.НаценкаШины + втПоказателиДляПремииЗаНаценку.ПремияЗаПредоплатуШины - втПоказателиДляПремииЗаНаценку.ТранспортШины) * (1 + &КоэффотсеченияШ) * &КоэффЗаНаценкуШ + (втПоказателиДляПремииЗаНаценку.НаценкаАКБ + втПоказателиДляПремииЗаНаценку.ПремияЗаПредоплатуАкб - втПоказателиДляПремииЗаНаценку.ТранспортАКБ) * (1 + &КоэффотсеченияАкб) * &КоэффЗаНаценкуАкб + (втПоказателиДляПремииЗаНаценку.НаценкаАксы + втПоказателиДляПремииЗаНаценку.ПремияЗаПредоплатуАксы - втПоказателиДляПремииЗаНаценку.ТранспортАксы) * &КоэффЗаНаценкуАкс > 0
	               |			ТОГДА (втПоказателиДляПремииЗаНаценку.НаценкаДиски + втПоказателиДляПремииЗаНаценку.ПремияЗаПредоплатуДиски - втПоказателиДляПремииЗаНаценку.ТранспортДиски) * (1 + &КоэффотсеченияД) * &КоэффЗаНаценкуД + (втПоказателиДляПремииЗаНаценку.НаценкаШины + втПоказателиДляПремииЗаНаценку.ПремияЗаПредоплатуШины - втПоказателиДляПремииЗаНаценку.ТранспортШины) * (1 + &КоэффотсеченияШ) * &КоэффЗаНаценкуШ + (втПоказателиДляПремииЗаНаценку.НаценкаАКБ + втПоказателиДляПремииЗаНаценку.ПремияЗаПредоплатуАкб - втПоказателиДляПремииЗаНаценку.ТранспортАКБ) * (1 + &КоэффотсеченияАкб) * &КоэффЗаНаценкуАкб + (втПоказателиДляПремииЗаНаценку.НаценкаАксы + втПоказателиДляПремииЗаНаценку.ПремияЗаПредоплатуАксы - втПоказателиДляПремииЗаНаценку.ТранспортАксы) * &КоэффЗаНаценкуАкс
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ПремияЗаНаценку,
	               |	втПоказателиДляПремииЗаНаценку.ПремияЗаПредоплатуДиски,
	               |	втПоказателиДляПремииЗаНаценку.ПремияЗаПредоплатуШины,
	               |	втПоказателиДляПремииЗаНаценку.ПремияЗаПредоплатуАкб,
	               |	втПоказателиДляПремииЗаНаценку.ПремияЗаПредоплатуАксы,
	               |	втПоказателиДляПремииЗаНаценку.ТранспортДиски,
	               |	втПоказателиДляПремииЗаНаценку.ТранспортШины,
	               |	втПоказателиДляПремииЗаНаценку.ТранспортАКБ,
	               |	втПоказателиДляПремииЗаНаценку.ТранспортАксы,
	               |	втПоказателиДляПремииЗаНаценку.НаценкаДиски,
	               |	втПоказателиДляПремииЗаНаценку.НаценкаШины,
	               |	втПоказателиДляПремииЗаНаценку.НаценкаАКБ,
	               |	втПоказателиДляПремииЗаНаценку.НаценкаАксы,
	               |	втПоказателиДляПремииЗаНаценку.ПродажиДиски,
	               |	втПоказателиДляПремииЗаНаценку.ПродажиШины,
	               |	втПоказателиДляПремииЗаНаценку.ПродажиАкб,
	               |	втПоказателиДляПремииЗаНаценку.ПродажиАксы,
	               |	втПоказателиДляПремииЗаНаценку.БонусШины,
	               |	втПоказателиДляПремииЗаНаценку.БонусДиски,
	               |	втПоказателиДляПремииЗаНаценку.БонусАкб,
	               |	втПоказателиДляПремииЗаНаценку.БонусАксы
	               |ПОМЕСТИТЬ втПремияЗаНаценку
	               |ИЗ
	               |	втПоказателиДляПремииЗаНаценку КАК втПоказателиДляПремииЗаНаценку
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ВыплаченоМенеджерам.Менеджер,
	               |	СУММА(ВыплаченоМенеджерам.Выплачено) КАК Выплачено
	               |ПОМЕСТИТЬ втВыплаченоЗаПериод
	               |ИЗ
	               |	РегистрСведений.ВыплаченоМенеджерам КАК ВыплаченоМенеджерам
	               |ГДЕ
	               |	ВыплаченоМенеджерам.Месяц МЕЖДУ &НачПериода И &КонПериода
	               |	И &ВидПродаж = ""Продажи""
	               |
	               |СГРУППИРОВАТЬ ПО
	               |	ВыплаченоМенеджерам.Менеджер
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	А.Менеджер,
	               |	А.Контрагент,
	               |	А.Сделка,
	               |	А.СуммаПродажи,
	               |	А.ПремияЗаНаценку,
	               |	А.ДатаОплаты,
	               |	А.ДолгПоЗаказу,
	               |	А.Просрочено,
	               |	А.ШтрафЗаПросрочку,
	               |	А.ПремияЗаОборот,
	               |	А.Бонусы,
	               |	ВЫБОР
	               |		КОГДА А.ПремияПотенциальная < 0
	               |			ТОГДА 0
	               |		ИНАЧЕ А.ПремияПотенциальная
	               |	КОНЕЦ КАК ПремияПотенциальная,
	               |	А.СуммаОплаты,
	               |	А.СуммаОплатыДляРасчетаПремии,
	               |	А.ВаловаяПрибыль,
	               |	А.ПремияЗаНаценкуДиски,
	               |	А.ПремияЗаНаценкуШины,
	               |	А.ПремияЗаНаценкуАкб,
	               |	А.ПремияЗаНаценкуАксы,
	               |	А.ПремияЗаПредоплатуДиски,
	               |	А.ПремияЗаПредоплатуШины,
	               |	А.ПремияЗаПредоплатуАкб,
	               |	А.ПремияЗаПредоплатуАксы,
	               |	А.ТранспортДиски,
	               |	А.ТранспортШины,
	               |	А.ТранспортАКБ,
	               |	А.ТранспортАксы,
	               |	А.НаценкаДиски,
	               |	А.НаценкаШины,
	               |	А.НаценкаАКБ,
	               |	А.НаценкаАксы,
	               |	А.ПродажиДиски,
	               |	А.ПродажиШины,
	               |	А.ПродажиАкб,
	               |	А.ПродажиАксы,
	               |	А.Транспорт,
	               |	ВЫБОР
	               |		КОГДА А.ПремияНачисленная < 0
	               |			ТОГДА 0
	               |		ИНАЧЕ А.ПремияНачисленная
	               |	КОНЕЦ КАК ПремияНачисленная,
	               |	ВЫБОР
	               |		КОГДА А.ПремияПотенциальная < 0
	               |			ТОГДА 0
	               |		ИНАЧЕ А.ПремияПотенциальная
	               |	КОНЕЦ + ВЫБОР
	               |		КОГДА А.ПремияНачисленная < 0
	               |			ТОГДА 0
	               |		ИНАЧЕ А.ПремияНачисленная
	               |	КОНЕЦ КАК ПремияПотенцц,
	               |	А.БонусАксы,
	               |	А.БонусАкб,
	               |	А.БонусДиски,
	               |	А.БонусШины,
	               |	А.ОбратныеПродажи,
	               |	А.ВидЗаказа,
	               |	А.ОплаченныеПени,
	               |	А.ПроцентПеней,
	               |	А.Выплачено
	               |ИЗ
	               |	(ВЫБРАТЬ
	               |		ДоговорыКонтрагентов.ОтветственноеЛицо КАК Менеджер,
	               |		ДоговорыКонтрагентов.Владелец КАК Контрагент,
	               |		втПродажиНаценка.Сделка КАК Сделка,
	               |		втПродажиНаценка.СуммаПродажи КАК СуммаПродажи,
	               |		втПремияЗаНаценку.ПремияЗаНаценку КАК ПремияЗаНаценку,
	               |		втПродажиНаценка.ДатаОплаты КАК ДатаОплаты,
	               |		втПросрочкиОплат.ДолгПоЗаказу КАК ДолгПоЗаказу,
	               |		втПросрочкиОплат.Просрочено КАК Просрочено,
	               |		втПросрочкиОплат.ШтрафЗаПросрочку КАК ШтрафЗаПросрочку,
	               |		ВЫБОР
	               |			КОГДА втПродажиНаценка.СуммаПродажи > 0
	               |					И ЕСТЬNULL(втТранспорт.Транспорт, 0) < втПродажиНаценка.Наценка
	               |				ТОГДА втПродажиНаценка.СуммаПродажи * &КоэффПродаж
	               |			ИНАЧЕ 0
	               |		КОНЕЦ КАК ПремияЗаОборот,
	               |		ЕСТЬNULL(втБонусы.Бонус, 0) КАК Бонусы,
	               |		ВЫБОР
	               |			КОГДА РАЗНОСТЬДАТ(втПросрочкиОплат.ДатаОплаты, &ПериодОстатков, МЕСЯЦ) >= 2
	               |					ИЛИ ЕСТЬNULL(втТранспорт.Транспорт, 0) > втПродажиНаценка.Наценка
	               |				ТОГДА 0
	               |			ИНАЧЕ ЕСТЬNULL(втПремияЗаНаценку.ПремияЗаНаценку, 0) + ВЫБОР
	               |					КОГДА втПродажиНаценка.СуммаПродажи > 0
	               |						ТОГДА втПродажиНаценка.СуммаПродажи * &КоэффПродаж
	               |					ИНАЧЕ 0
	               |				КОНЕЦ - ЕСТЬNULL(втПросрочкиОплат.ШтрафЗаПросрочку, 0)
	               |		КОНЕЦ - ВЫБОР
	               |			КОГДА РАЗНОСТЬДАТ(втПросрочкиОплат.ДатаОплаты, &ПериодОстатков, МЕСЯЦ) >= 2
	               |					ИЛИ ЕСТЬNULL(втТранспорт.Транспорт, 0) > втПродажиНаценка.Наценка
	               |				ТОГДА 0
	               |			ИНАЧЕ ЕСТЬNULL(втПремияЗаНаценку.ПремияЗаНаценку, 0) + ВЫБОР
	               |					КОГДА втПродажиНаценка.СуммаПродажи > 0
	               |						ТОГДА втПродажиНаценка.СуммаПродажи * &КоэффПродаж
	               |					ИНАЧЕ 0
	               |				КОНЕЦ - ЕСТЬNULL(втПросрочкиОплат.ШтрафЗаПросрочку, 0)
	               |		КОНЕЦ * ВЫБОР
	               |			КОГДА втПродажиНаценка.СуммаПродажи <> 0
	               |				ТОГДА ЕСТЬNULL(втОплаты.СуммаОплатыДляРасчетаПремии, 0) / втПродажиНаценка.СуммаПродажи
	               |			ИНАЧЕ 1
	               |		КОНЕЦ КАК ПремияПотенциальная,
	               |		ЕСТЬNULL(втОплаты.СуммаОплаты, 0) КАК СуммаОплаты,
	               |		ЕСТЬNULL(втОплаты.СуммаОплатыДляРасчетаПремии, 0) КАК СуммаОплатыДляРасчетаПремии,
	               |		втПродажиНаценка.Наценка КАК ВаловаяПрибыль,
	               |		ЕСТЬNULL(втПремияЗаНаценку.ПремияЗаНаценкуДиски, 0) КАК ПремияЗаНаценкуДиски,
	               |		ЕСТЬNULL(втПремияЗаНаценку.ПремияЗаНаценкуШины, 0) КАК ПремияЗаНаценкуШины,
	               |		ЕСТЬNULL(втПремияЗаНаценку.ПремияЗаНаценкуАкб, 0) КАК ПремияЗаНаценкуАкб,
	               |		ЕСТЬNULL(втПремияЗаНаценку.ПремияЗаНаценкуАксы, 0) КАК ПремияЗаНаценкуАксы,
	               |		ЕСТЬNULL(втПремияЗаНаценку.ПремияЗаПредоплатуДиски, 0) КАК ПремияЗаПредоплатуДиски,
	               |		ЕСТЬNULL(втПремияЗаНаценку.ПремияЗаПредоплатуШины, 0) КАК ПремияЗаПредоплатуШины,
	               |		ЕСТЬNULL(втПремияЗаНаценку.ПремияЗаПредоплатуАкб, 0) КАК ПремияЗаПредоплатуАкб,
	               |		ЕСТЬNULL(втПремияЗаНаценку.ПремияЗаПредоплатуАксы, 0) КАК ПремияЗаПредоплатуАксы,
	               |		ЕСТЬNULL(втПремияЗаНаценку.ТранспортДиски, 0) КАК ТранспортДиски,
	               |		ЕСТЬNULL(втПремияЗаНаценку.ТранспортШины, 0) КАК ТранспортШины,
	               |		ЕСТЬNULL(втПремияЗаНаценку.ТранспортАКБ, 0) КАК ТранспортАКБ,
	               |		ЕСТЬNULL(втПремияЗаНаценку.ТранспортАксы, 0) КАК ТранспортАксы,
	               |		ЕСТЬNULL(втПремияЗаНаценку.НаценкаДиски, 0) КАК НаценкаДиски,
	               |		ЕСТЬNULL(втПремияЗаНаценку.НаценкаШины, 0) КАК НаценкаШины,
	               |		ЕСТЬNULL(втПремияЗаНаценку.НаценкаАКБ, 0) КАК НаценкаАКБ,
	               |		ЕСТЬNULL(втПремияЗаНаценку.НаценкаАксы, 0) КАК НаценкаАксы,
	               |		ЕСТЬNULL(втПремияЗаНаценку.ПродажиДиски, 0) КАК ПродажиДиски,
	               |		ЕСТЬNULL(втПремияЗаНаценку.ПродажиШины, 0) КАК ПродажиШины,
	               |		ЕСТЬNULL(втПремияЗаНаценку.ПродажиАкб, 0) КАК ПродажиАкб,
	               |		ЕСТЬNULL(втПремияЗаНаценку.ПродажиАксы, 0) КАК ПродажиАксы,
	               |		ЕСТЬNULL(втТранспорт.Транспорт, 0) КАК Транспорт,
	               |		ВЫБОР
	               |			КОГДА &ВидПродаж = ""Обратные продажи""
	               |				ТОГДА -1 * ВЫБОР
	               |						КОГДА втПродажиНаценка.СуммаПродажи <> 0
	               |							ТОГДА втСуммыОбратныхПродаж.СуммаВозврата / втПродажиНаценка.СуммаПродажи
	               |						ИНАЧЕ 1
	               |					КОНЕЦ
	               |			ИНАЧЕ 1
	               |		КОНЕЦ * ВЫБОР
	               |			КОГДА РАЗНОСТЬДАТ(втПросрочкиОплат.ДатаОплаты, &ПериодОстатков, МЕСЯЦ) >= 2
	               |					ИЛИ ЕСТЬNULL(втТранспорт.Транспорт, 0) > втПродажиНаценка.Наценка
	               |				ТОГДА 0
	               |			ИНАЧЕ ЕСТЬNULL(втПремияЗаНаценку.ПремияЗаНаценку, 0) + ВЫБОР
	               |					КОГДА втПродажиНаценка.СуммаПродажи > 0
	               |						ТОГДА ЕСТЬNULL(втПродажиНаценка.СуммаПродажи, 0) * &КоэффПродаж
	               |					ИНАЧЕ 0
	               |				КОНЕЦ - ЕСТЬNULL(втПросрочкиОплат.ШтрафЗаПросрочку, 0)
	               |		КОНЕЦ * ВЫБОР
	               |			КОГДА втПродажиНаценка.СуммаПродажи <> 0
	               |				ТОГДА ЕСТЬNULL(втОплаты.СуммаОплатыДляРасчетаПремии, 0) / втПродажиНаценка.СуммаПродажи
	               |			ИНАЧЕ 1
	               |		КОНЕЦ КАК ПремияНачисленная,
	               |		0 КАК ПремияПотенцц,
	               |		втПремияЗаНаценку.БонусАксы КАК БонусАксы,
	               |		втПремияЗаНаценку.БонусАкб КАК БонусАкб,
	               |		втПремияЗаНаценку.БонусДиски КАК БонусДиски,
	               |		втПремияЗаНаценку.БонусШины КАК БонусШины,
	               |		ЕСТЬNULL(втСуммыОбратныхПродаж.СуммаВозврата, 0) КАК ОбратныеПродажи,
	               |		ВЫРАЗИТЬ(&ВидПродаж КАК СТРОКА(20)) КАК ВидЗаказа,
	               |		0 КАК ОплаченныеПени,
	               |		0 КАК ПроцентПеней,
	               |		ЕСТЬNULL(втВыплаченоЗаПериод.Выплачено, 0) КАК Выплачено
	               |	ИЗ
	               |		втПродажиНаценка КАК втПродажиНаценка
	               |			ЛЕВОЕ СОЕДИНЕНИЕ втПремияЗаНаценку КАК втПремияЗаНаценку
	               |			ПО втПродажиНаценка.Сделка = втПремияЗаНаценку.Сделка
	               |			ЛЕВОЕ СОЕДИНЕНИЕ втПросрочкиОплат КАК втПросрочкиОплат
	               |			ПО втПродажиНаценка.Сделка = втПросрочкиОплат.Сделка
	               |			ЛЕВОЕ СОЕДИНЕНИЕ втТранспорт КАК втТранспорт
	               |			ПО втПродажиНаценка.Сделка = втТранспорт.Заказ
	               |			ЛЕВОЕ СОЕДИНЕНИЕ втБонусы КАК втБонусы
	               |			ПО втПродажиНаценка.Сделка = втБонусы.ЗаказПокупателя
	               |			ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
	               |				ЛЕВОЕ СОЕДИНЕНИЕ втВыплаченоЗаПериод КАК втВыплаченоЗаПериод
	               |				ПО ДоговорыКонтрагентов.ОтветственноеЛицо = втВыплаченоЗаПериод.Менеджер
	               |			ПО втПродажиНаценка.ДоговорКонтрагента = ДоговорыКонтрагентов.Ссылка
	               |			ЛЕВОЕ СОЕДИНЕНИЕ втОплаты КАК втОплаты
	               |			ПО втПродажиНаценка.Сделка = втОплаты.Сделка
	               |			ЛЕВОЕ СОЕДИНЕНИЕ втСуммыОбратныхПродаж КАК втСуммыОбратныхПродаж
	               |			ПО втПродажиНаценка.Сделка = втСуммыОбратныхПродаж.ЗаказПокупателя) КАК А";
				   
				   Рез = Запрос.Выполнить().Выгрузить();
				   Возврат Рез;
			   КонецФункции	

Процедура ВыбПериодНажатие(Элемент)
				   НастройкаПериода = Новый НастройкаПериода;
				   НастройкаПериода.РедактироватьКакИнтервал = Истина;
				   НастройкаПериода.РедактироватьКакПериод = Истина;
				   НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
				   НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
				   Если НастройкаПериода.Редактировать() Тогда
					   НачПериода = НастройкаПериода.ПолучитьДатуНачала();
					   КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
				   КонецЕсли;
			   КонецПроцедуры

Процедура ПриОткрытии()
				   НачПериода = НачалоМесяца(ТекущаяДата());
				   КонПериода = КонецДня(ТекущаяДата());
				   ПроцПремированияПредоплаты = 9;
				   ПроцДеПремированияПредоплаты = 12;
				   ПроцДеПремированияПросрочки = 15;
				   ПроцентЗаПродажи = 0.2;
				   ПроцентОтсеченияШ  = 7;
				   ПроцентОтсеченияД = 12;
				   ПроцентОтсеченияАКБ = 12;
				   ПроцентЗаНаценку = 5;
				   ПроцентЗаНаценкуДиски = 1;
				   ПроцентЗаНаценкуАксессуары = 5;
				   ПроцентЗаНаценкуАКБ = 1;
				   
				   ПроцентОтсеченияПеней = 15;
				   ПроцентЗаОплаченныеПени = 20;
			   КонецПроцедуры

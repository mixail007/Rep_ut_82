
Процедура ДействияФормыСформировать(Кнопка)
	
	ТЗРезультат = Новый ТаблицаЗначений;
	ТЗРезультат.Колонки.Добавить("Должность");
	ТЗРезультат.Колонки.Добавить("Сотрудник");
	ТЗРезультат.Колонки.Добавить("Показатель");
	ТЗРезультат.Колонки.Добавить("ПредельноеЗначениеПоказателя");
	ТЗРезультат.Колонки.Добавить("РазмерПремииЗаВыполнениеПоказателя");
	ТЗРезультат.Колонки.Добавить("ФактическоеЗначениеПоказателя");
	ТЗРезультат.Колонки.Добавить("Коэффициент");
	ТЗРезультат.Колонки.Добавить("СуммаПремии");
	
	Подразделение = Справочники.Подразделения.НайтиПоКоду("00013");
	
	//ОБЩИЕ ПОКАЗАТЕЛИ ДЛЯ НЕСКОЛЬКИХ ДОЛЖНОСТЕЙ 
	
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	//1. Прибыльность рейсов
	НазваниеПрибыльностьРейсов = "Прибыльность рейсов";
	ПредельноеЗначениеПрибыльностьРейсов = 5;
	РазмерПремииЗаВыполнениеПрибыльностиРейсов = 5000;
	
	URLWS = "http://37.1.84.50:8083/TransportReports";
	ПроксиWS = WSссылки.WSZemVorobReports.СоздатьWSПрокси(URLWS, "TransportReports", "TransportReportsSoap");
	ПроксиWS.Пользователь = "wsAdmin";
	ПроксиWS.Пароль = "5tgbnhy6";
	Ответ = ПроксиWS.GetResult("000000002", ДатаНачала, ДатаОкончания, 1, "");
	
	ФактическоеЗначениеПрибыльностиРейсов = Ответ;

	Если ФактическоеЗначениеПрибыльностиРейсов <> 0 Тогда
		Если ФактическоеЗначениеПрибыльностиРейсов > ПредельноеЗначениеПрибыльностьРейсов Тогда
			СуммаПремииПрибыльностьРейсов = РазмерПремииЗаВыполнениеПрибыльностиРейсов;
		Иначе
			ДоляВыполнения = (ФактическоеЗначениеПрибыльностиРейсов - ПредельноеЗначениеПрибыльностьРейсов) * 100 / ПредельноеЗначениеПрибыльностьРейсов;
			СуммаПремииПрибыльностьРейсов = РазмерПремииЗаВыполнениеПрибыльностиРейсов - РазмерПремииЗаВыполнениеПрибыльностиРейсов / 100 * ДоляВыполнения;
		КонецЕсли;
	КонецЕсли;
	
	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	//2. % транспортной логистики
	НазваниеПроцентТранспортнойЛогистики = "% транспортной логистики";
	ПредельноеЗначениеПроцентаТранспортнойЛогистики = 3;
	РазмерПремииЗаВыполнениеПроцентаТранспортнойЛогистики = 5000;
	
	ТекСсылка = Справочники.ВнешниеОбработки.НайтиПоКоду(465); 
	ИмяФайла = ПолучитьИмяВременногоФайла(); 
	ДвоичныеДанные = ТекСсылка.ХранилищеВнешнейОбработки.Получить(); 
	ДвоичныеДанные.Записать(ИмяФайла); 
	
	Отчет = ВнешниеОтчеты.Создать(ИмяФайла);
	Отчет.НачПериода = ДатаНачала;
	Отчет.КонПериода = ДатаОкончания;
	ТЗ = Новый ТаблицаЗначений;
	ТЗ = Отчет.РезультатКомпоновкиВТЗ();
	
	ФактическоеЗначениеПроцентаТранспортнойЛогистики = 0;
	СуммаПремииПроцентТранспортнойЛогистики = 0;
	ФактическоеЗначениеПроцентаТранспортнойЛогистики = ТЗ[ТЗ.Количество()-1].ПроцентЛогистики;
	ФактическоеЗначениеПроцентаТранспортнойЛогистики = Окр(ФактическоеЗначениеПроцентаТранспортнойЛогистики, 2);
	Если ФактическоеЗначениеПроцентаТранспортнойЛогистики <> 0 Тогда
		Если ФактическоеЗначениеПроцентаТранспортнойЛогистики < ПредельноеЗначениеПроцентаТранспортнойЛогистики Тогда
			СуммаПремииПроцентТранспортнойЛогистики = РазмерПремииЗаВыполнениеПроцентаТранспортнойЛогистики;
		Иначе
			ДоляВыполнения = (ФактическоеЗначениеПроцентаТранспортнойЛогистики - ПредельноеЗначениеПроцентаТранспортнойЛогистики) * 100 / ПредельноеЗначениеПроцентаТранспортнойЛогистики;
			СуммаПремииПроцентТранспортнойЛогистики = РазмерПремииЗаВыполнениеПроцентаТранспортнойЛогистики - РазмерПремииЗаВыполнениеПроцентаТранспортнойЛогистики / 100 * ДоляВыполнения;
		КонецЕсли;
	КонецЕсли;
	
	//РУКОВОДИТЕЛЬ ОТДЕЛА
	Должность = Справочники.ДолжностиОрганизаций.НайтиПоНаименованию("1. Руководитель");
	СписокСотрудников = ПолучитьСотрудников(Подразделение, Должность);
		
	Пока СписокСотрудников.Следующий() Цикл
		
		Сотрудник = СписокСотрудников.Пользователь;
		
		////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//1. Прибыльность рейсов
		СтрТЗ = ТЗРезультат.Добавить();
		СтрТЗ.Должность = Должность;
		СтрТЗ.Сотрудник = Сотрудник;
		СтрТЗ.Показатель = НазваниеПрибыльностьРейсов;
		СтрТЗ.ПредельноеЗначениеПоказателя = ">" + ПредельноеЗначениеПрибыльностьРейсов + "%";
		СтрТЗ.РазмерПремииЗаВыполнениеПоказателя = РазмерПремииЗаВыполнениеПрибыльностиРейсов;
		СтрТЗ.ФактическоеЗначениеПоказателя = ФактическоеЗначениеПрибыльностиРейсов;
		СтрТЗ.СуммаПремии = СуммаПремииПрибыльностьРейсов;
		
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//2. % транспортной логистики
		СтрТЗ = ТЗРезультат.Добавить();
		СтрТЗ.Должность = Должность;
		СтрТЗ.Сотрудник = Сотрудник;
		СтрТЗ.Показатель = НазваниеПроцентТранспортнойЛогистики;
		СтрТЗ.ПредельноеЗначениеПоказателя = "<" + ПредельноеЗначениеПроцентаТранспортнойЛогистики + "%";
		СтрТЗ.РазмерПремииЗаВыполнениеПоказателя = РазмерПремииЗаВыполнениеПроцентаТранспортнойЛогистики;
		СтрТЗ.ФактическоеЗначениеПоказателя = ФактическоеЗначениеПроцентаТранспортнойЛогистики;
		СтрТЗ.СуммаПремии = СуммаПремииПроцентТранспортнойЛогистики;
		
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//3. Норматив по простоям ТС
		Показатель = "Норматив по простоям";
		ПредельноеЗначениеПоказателя = 15;
		РазмерПремииЗаВыполнениеПоказателя = 5000;
		ФактическоеЗначениеПоказателя = 0;
		СуммаПремии = 0;
		
		URLWS = "http://37.1.84.50:8083/TransportReports";
		ПроксиWS = WSссылки.WSZemVorobReports.СоздатьWSПрокси(URLWS, "TransportReports", "TransportReportsSoap");
		ПроксиWS.Пользователь = "wsAdmin";
		ПроксиWS.Пароль = "5tgbnhy6";
		Ответ = ПроксиWS.GetResult("000000015", ДатаНачала, ДатаОкончания, 0, "");
		Ответ = Окр(Ответ, 2);
		
		ФактическоеЗначениеПоказателя = 100 - Ответ;
		Если ФактическоеЗначениеПоказателя < 0 ИЛИ ФактическоеЗначениеПоказателя < ПредельноеЗначениеПоказателя Тогда
			СуммаПремии = РазмерПремииЗаВыполнениеПоказателя;
		Иначе
			ДоляВыполнения = (ФактическоеЗначениеПоказателя - ПредельноеЗначениеПоказателя) * 100 / ПредельноеЗначениеПоказателя;
			СуммаПремии = СуммаПремии - СуммаПремии / 100 * ДоляВыполнения;
		КонецЕсли;
		
		СтрТЗ = ТЗРезультат.Добавить();
		СтрТЗ.Должность = Должность;
		СтрТЗ.Сотрудник = Сотрудник;
		СтрТЗ.Показатель = Показатель;
		СтрТЗ.ПредельноеЗначениеПоказателя = "<" + ПредельноеЗначениеПоказателя + "% (занятость >85%)";
		СтрТЗ.РазмерПремииЗаВыполнениеПоказателя = РазмерПремииЗаВыполнениеПоказателя;
		СтрТЗ.ФактическоеЗначениеПоказателя = Ответ;
		СтрТЗ.СуммаПремии = СуммаПремии;
		
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//4. Передача документов в бухгалтерию
		Показатель = "Передача документов в бухгалтерию (вовремя и в полном объеме)";
		ПредельноеЗначениеПоказателя = "";
		РазмерПремииЗаВыполнениеПоказателя = 5000;
		ФактическоеЗначениеПоказателя = Ложь;
		СуммаПремии = 0;
		
		Запрос = Новый Запрос;
		Запрос.УстановитьПараметр("КонецПериода", КонецМесяца(ДатаОкончания));
		Запрос.УстановитьПараметр("Показатель", "Передача документов в бухгалтерию");
		Запрос.Текст = "ВЫБРАТЬ
		               |	МИНИМУМ(ПоказателиДляРасчетаМотивацииПоСотрудникамДанныеПоСотрудникам.ЗначениеПоказателя) КАК ЗначениеПоказателя
		               |ИЗ
		               |	Документ.ПоказателиДляРасчетаМотивацииПоСотрудникам.ДанныеПоСотрудникам КАК ПоказателиДляРасчетаМотивацииПоСотрудникамДанныеПоСотрудникам
		               |ГДЕ
		               |	ПоказателиДляРасчетаМотивацииПоСотрудникамДанныеПоСотрудникам.Ссылка.Проведен
		               |	И ПоказателиДляРасчетаМотивацииПоСотрудникамДанныеПоСотрудникам.Ссылка.Дата = &КонецПериода
		               |	И ПоказателиДляРасчетаМотивацииПоСотрудникамДанныеПоСотрудникам.Показатель = &Показатель";
		Результат = Запрос.Выполнить().Выбрать();
		Если Результат.Следующий() Тогда
			ФактическоеЗначениеПоказателя = Результат.ЗначениеПоказателя;
		КонецЕсли;
		
		Если ФактическоеЗначениеПоказателя = Истина Тогда
			СуммаПремии = РазмерПремииЗаВыполнениеПоказателя;
		КонецЕсли;
		
		СтрТЗ = ТЗРезультат.Добавить();
		СтрТЗ.Должность = Должность;
		СтрТЗ.Сотрудник = Сотрудник;
		СтрТЗ.Показатель = Показатель;
		СтрТЗ.ПредельноеЗначениеПоказателя = ПредельноеЗначениеПоказателя;
		СтрТЗ.РазмерПремииЗаВыполнениеПоказателя = РазмерПремииЗаВыполнениеПоказателя;
		СтрТЗ.ФактическоеЗначениеПоказателя = ФактическоеЗначениеПоказателя;
		СтрТЗ.СуммаПремии = СуммаПремии;
		
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//5. Депремирование
		Результат = ПолучитьДанныеПоДепремированию(Сотрудник);
		Если Результат.Количество() > 0 Тогда
			Пока Результат.Следующий() Цикл
				СтрТЗ = ТЗРезультат.Добавить();
				СтрТЗ.Должность = Должность;
				СтрТЗ.Сотрудник = Сотрудник;
				СтрТЗ.Показатель = Результат.Показатель;
				СтрТЗ.ПредельноеЗначениеПоказателя = "";
				СтрТЗ.РазмерПремииЗаВыполнениеПоказателя = "";
				СтрТЗ.ФактическоеЗначениеПоказателя = 0;
				СтрТЗ.СуммаПремии = Результат.ЗначениеПоказателя;
			КонецЦикла;
		КонецЕсли;
		
	КонецЦикла;
	
	//МЕНЕДЖЕР ПО ТРАНСПОРТУ (прямого направления)
	Должность = Справочники.ДолжностиОрганизаций.НайтиПоНаименованию("2. Менеджер по транспорту (прямого направления)");
	СписокСотрудников = ПолучитьСотрудников(Подразделение, Должность);
	
	Пока СписокСотрудников.Следующий() Цикл
		
		Сотрудник = СписокСотрудников.Пользователь;
		
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//1. Прибыльность рейсов
		СтрТЗ = ТЗРезультат.Добавить();
		СтрТЗ.Должность = Должность;
		СтрТЗ.Сотрудник = Сотрудник;
		СтрТЗ.Показатель = НазваниеПрибыльностьРейсов;
		СтрТЗ.ПредельноеЗначениеПоказателя = ">" + ПредельноеЗначениеПрибыльностьРейсов + "%";
		СтрТЗ.РазмерПремииЗаВыполнениеПоказателя = РазмерПремииЗаВыполнениеПрибыльностиРейсов;
		СтрТЗ.ФактическоеЗначениеПоказателя = ФактическоеЗначениеПрибыльностиРейсов;
		СтрТЗ.СуммаПремии = СуммаПремииПрибыльностьРейсов;
		
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//2. % транспортной логистики
		СтрТЗ = ТЗРезультат.Добавить();
		СтрТЗ.Должность = Должность;
		СтрТЗ.Сотрудник = Сотрудник;
		СтрТЗ.Показатель = НазваниеПроцентТранспортнойЛогистики;
		СтрТЗ.ПредельноеЗначениеПоказателя = "<" + ПредельноеЗначениеПроцентаТранспортнойЛогистики + "%";
		СтрТЗ.РазмерПремииЗаВыполнениеПоказателя = РазмерПремииЗаВыполнениеПроцентаТранспортнойЛогистики;
		СтрТЗ.ФактическоеЗначениеПоказателя = ФактическоеЗначениеПроцентаТранспортнойЛогистики;
		СтрТЗ.СуммаПремии = СуммаПремииПроцентТранспортнойЛогистики;
		
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//3. Своевременная подача ТС под погрузку
		Показатель = "Своевременная подача транспортных средств под погрузку";
		ПредельноеЗначениеПоказателя = "5";
		РазмерПремииЗаВыполнениеПоказателя = 2500;
		ФактическоеЗначениеПоказателя = 0;
		СуммаПремии = 0;
		
		СтрТЗ = ТЗРезультат.Добавить();
		СтрТЗ.Должность = Должность;
		СтрТЗ.Сотрудник = Сотрудник;
		СтрТЗ.Показатель = Показатель;
		СтрТЗ.ПредельноеЗначениеПоказателя = ПредельноеЗначениеПоказателя + "%";
		СтрТЗ.РазмерПремииЗаВыполнениеПоказателя = РазмерПремииЗаВыполнениеПоказателя;
		СтрТЗ.ФактическоеЗначениеПоказателя = ФактическоеЗначениеПоказателя;
		СтрТЗ.СуммаПремии = СуммаПремии;
		
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//4. Передача документов в бухгалтерию
		Показатель = "Передача документов в бухгалтерию (вовремя и в полном объеме)";
		ПредельноеЗначениеПоказателя = "";
		РазмерПремииЗаВыполнениеПоказателя = 2500;
		ФактическоеЗначениеПоказателя = Ложь;
		СуммаПремии = 0;
		
		Запрос = Новый Запрос;
		Запрос.УстановитьПараметр("КонецПериода", КонецМесяца(ДатаОкончания));
		Запрос.УстановитьПараметр("Показатель", "Передача документов в бухгалтерию");
		Запрос.УстановитьПараметр("Сотрудник", Сотрудник);
		Запрос.Текст = "ВЫБРАТЬ
		               |	ПоказателиДляРасчетаМотивацииПоСотрудникамДанныеПоСотрудникам.ЗначениеПоказателя КАК ЗначениеПоказателя
		               |ИЗ
		               |	Документ.ПоказателиДляРасчетаМотивацииПоСотрудникам.ДанныеПоСотрудникам КАК ПоказателиДляРасчетаМотивацииПоСотрудникамДанныеПоСотрудникам
		               |ГДЕ
		               |	ПоказателиДляРасчетаМотивацииПоСотрудникамДанныеПоСотрудникам.Ссылка.Проведен
		               |	И ПоказателиДляРасчетаМотивацииПоСотрудникамДанныеПоСотрудникам.Ссылка.Дата = &КонецПериода
		               |	И ПоказателиДляРасчетаМотивацииПоСотрудникамДанныеПоСотрудникам.Показатель = &Показатель
		               |	И ПоказателиДляРасчетаМотивацииПоСотрудникамДанныеПоСотрудникам.Сотрудник = &Сотрудник";
		Результат = Запрос.Выполнить().Выбрать();
		Если Результат.Следующий() Тогда
			ФактическоеЗначениеПоказателя = Результат.ЗначениеПоказателя;
		КонецЕсли;
		
		Если ФактическоеЗначениеПоказателя = Истина Тогда
			СуммаПремии = РазмерПремииЗаВыполнениеПоказателя;
		КонецЕсли;
		
		СтрТЗ = ТЗРезультат.Добавить();
		СтрТЗ.Должность = Должность;
		СтрТЗ.Сотрудник = Сотрудник;
		СтрТЗ.Показатель = Показатель;
		СтрТЗ.ПредельноеЗначениеПоказателя = ПредельноеЗначениеПоказателя;
		СтрТЗ.РазмерПремииЗаВыполнениеПоказателя = РазмерПремииЗаВыполнениеПоказателя;
		СтрТЗ.ФактическоеЗначениеПоказателя = ФактическоеЗначениеПоказателя;
		СтрТЗ.СуммаПремии = СуммаПремии;
		
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//5. Депремирование
		Результат = ПолучитьДанныеПоДепремированию(Сотрудник);
		Если Результат.Количество() > 0 Тогда
			Пока Результат.Следующий() Цикл
				СтрТЗ = ТЗРезультат.Добавить();
				СтрТЗ.Должность = Должность;
				СтрТЗ.Сотрудник = Сотрудник;
				СтрТЗ.Показатель = Результат.Показатель;
				СтрТЗ.ПредельноеЗначениеПоказателя = "";
				СтрТЗ.РазмерПремииЗаВыполнениеПоказателя = "";
				СтрТЗ.ФактическоеЗначениеПоказателя = 0;
				СтрТЗ.СуммаПремии = Результат.ЗначениеПоказателя;
			КонецЦикла;
		КонецЕсли;
		
	КонецЦикла;
	
	//МЕНЕДЖЕР ПО ТРАНСПОРТУ (обратного направления)
	Должность = Справочники.ДолжностиОрганизаций.НайтиПоНаименованию("3. Менеджер по транспорту (обратного направления)");
	СписокСотрудников = ПолучитьСотрудников(Подразделение, Должность);
	
	Пока СписокСотрудников.Следующий() Цикл
		
		Сотрудник = СписокСотрудников.Пользователь;
		
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//1. Услуги в прямом направлении
		Показатель = "Услуги в прямом направлении";
		ПредельноеЗначениеПоказателя = "";
		РазмерПремииЗаВыполнениеПоказателя = "";
		ФактическоеЗначениеПоказателя = 0;
		Коэффициент = 0;
		СуммаПремии = 0;
		URLWS = "http://37.1.84.50:8083/TransportReports";
		ПроксиWS = WSссылки.WSZemVorobReports.СоздатьWSПрокси(URLWS, "TransportReports", "TransportReportsSoap");
		ПроксиWS.Пользователь = "wsAdmin";
		ПроксиWS.Пароль = "5tgbnhy6";
		Если Найти(Сотрудник.Наименование, "Боева") > 0 Тогда
			Ответ = ПроксиWS.GetResult("000000002", ДатаНачала, ДатаОкончания, 3, "7602081190"); //по Корпорации Волга
			Если Ответ > 0 И Ответ < 250000 Тогда
				Коэффициент = 2;
			ИначеЕсли Ответ >= 250000 И Ответ < 500000 Тогда
				Коэффициент = 1.3;
			ИначеЕсли Ответ >= 500000 И Ответ < 1000000 Тогда
				Коэффициент = 0.9;
			ИначеЕсли Ответ >= 1000000 Тогда
				Коэффициент = 0.75;
			КонецЕсли;
		Иначе
			Ответ = ПроксиWS.GetResult("000000002", ДатаНачала, ДатаОкончания, 3, ""); //по остальным юрлицам
			Если Ответ > 0 И Ответ < 1000000 Тогда
				Коэффициент = 0.6;
			ИначеЕсли Ответ >= 1000000 И Ответ < 1500000 Тогда
				Коэффициент = 0.45;
			ИначеЕсли Ответ >= 1500000 И Ответ < 2500000 Тогда
				Коэффициент = 0.35;
			ИначеЕсли Ответ >= 2500000 Тогда
				Коэффициент = 0.3;
			КонецЕсли;
		КонецЕсли;
		
		ФактическоеЗначениеПоказателя = Ответ;
		СуммаПремии = Окр(ФактическоеЗначениеПоказателя / 100 * Коэффициент, 2);
		
		СтрТЗ = ТЗРезультат.Добавить();
		СтрТЗ.Должность = Должность;
		СтрТЗ.Сотрудник = Сотрудник;
		СтрТЗ.Показатель = Показатель;
		СтрТЗ.ПредельноеЗначениеПоказателя = ПредельноеЗначениеПоказателя;
		СтрТЗ.РазмерПремииЗаВыполнениеПоказателя = РазмерПремииЗаВыполнениеПоказателя;
		СтрТЗ.ФактическоеЗначениеПоказателя = ФактическоеЗначениеПоказателя;
		СтрТЗ.Коэффициент = Коэффициент;
		СтрТЗ.СуммаПремии = СуммаПремии;
		
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//2. Услуги в обратном направлении
		Показатель = "Услуги в обратном направлении";
		ПредельноеЗначениеПоказателя = "";
		РазмерПремииЗаВыполнениеПоказателя = "";
		ФактическоеЗначениеПоказателя = 0;
		Коэффициент = 0;
		СуммаПремии = 0;
		URLWS = "http://37.1.84.50:8083/TransportReports";
		ПроксиWS = WSссылки.WSZemVorobReports.СоздатьWSПрокси(URLWS, "TransportReports", "TransportReportsSoap");
		ПроксиWS.Пользователь = "wsAdmin";
		ПроксиWS.Пароль = "5tgbnhy6";
		Если Найти(Сотрудник.Наименование, "Боева") > 0 Тогда
			Ответ = ПроксиWS.GetResult("000000002", ДатаНачала, ДатаОкончания, 4, "7602081190"); //по Корпорации Волга
			Если Ответ > 0 И Ответ < 250000 Тогда
				Коэффициент = 2.4;
			ИначеЕсли Ответ >= 250000 И Ответ < 500000 Тогда
				Коэффициент = 1.3;
			ИначеЕсли Ответ >= 500000 И Ответ < 1000000 Тогда
				Коэффициент = 0.9;
			ИначеЕсли Ответ >= 1000000 Тогда
				Коэффициент = 0.75;
			КонецЕсли;
		Иначе
			Ответ = ПроксиWS.GetResult("000000002", ДатаНачала, ДатаОкончания, 4, ""); //по остальным юрлицам
			Если Ответ > 0 И Ответ < 1000000 Тогда
				Коэффициент = 0.4;
			ИначеЕсли Ответ >= 1000000 И Ответ < 1500000 Тогда
				Коэффициент = 0.4;
			ИначеЕсли Ответ >= 1500000 И Ответ < 2500000 Тогда
				Коэффициент = 0.35;
			ИначеЕсли Ответ >= 2500000 Тогда
				Коэффициент = 0.3;
			КонецЕсли;
		КонецЕсли;
		
		ФактическоеЗначениеПоказателя = Ответ;
		СуммаПремии = Окр(ФактическоеЗначениеПоказателя / 100 * Коэффициент, 2);
		
		СтрТЗ = ТЗРезультат.Добавить();
		СтрТЗ.Должность = Должность;
		СтрТЗ.Сотрудник = Сотрудник;
		СтрТЗ.Показатель = Показатель;
		СтрТЗ.ПредельноеЗначениеПоказателя = ПредельноеЗначениеПоказателя;
		СтрТЗ.РазмерПремииЗаВыполнениеПоказателя = РазмерПремииЗаВыполнениеПоказателя;
		СтрТЗ.ФактическоеЗначениеПоказателя = ФактическоеЗначениеПоказателя;
		СтрТЗ.Коэффициент = Коэффициент;
		СтрТЗ.СуммаПремии = СуммаПремии;
		
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//3. ПДЗ > 45 дней
		Показатель = "Дебиторская задолженность";
		ПредельноеЗначениеПоказателя = "";
		РазмерПремииЗаВыполнениеПоказателя = "";
		ФактическоеЗначениеПоказателя = 0;
		Коэффициент = 0;
		СуммаПремии = 0;
		URLWS = "http://37.1.84.50:8083/TransportReports";
		ПроксиWS = WSссылки.WSZemVorobReports.СоздатьWSПрокси(URLWS, "TransportReports", "TransportReportsSoap");
		ПроксиWS.Пользователь = "wsAdmin";
		ПроксиWS.Пароль = "5tgbnhy6";
		Если Найти(Сотрудник.Наименование, "Боева") > 0 Тогда
			Ответ = ПроксиWS.GetResult("000000008", ДатаНачала, ДатаОкончания, 1, "Боева"); 
			Если Ответ > 0 И Ответ < 500000 Тогда
				СуммаПремии = 5000;
			ИначеЕсли Ответ >= 500000 И Ответ < 1000000 Тогда
				СуммаПремии = 3000;
			ИначеЕсли Ответ >= 1000000 Тогда
				СуммаПремии = 0;
			КонецЕсли;
		Иначе
			Ответ = ПроксиWS.GetResult("000000008", ДатаНачала, ДатаОкончания, 1, "Ковылина"); 
			Если Ответ > 0 И Ответ < 1500000 Тогда
				СуммаПремии = 5000;
			ИначеЕсли Ответ >= 1500000 И Ответ < 2500000 Тогда
				СуммаПремии = 3000;
			ИначеЕсли Ответ >= 2500000 Тогда
				СуммаПремии = 0;
			КонецЕсли;
		КонецЕсли;
		
		ФактическоеЗначениеПоказателя = Ответ;
		
		СтрТЗ = ТЗРезультат.Добавить();
		СтрТЗ.Должность = Должность;
		СтрТЗ.Сотрудник = Сотрудник;
		СтрТЗ.Показатель = Показатель;
		СтрТЗ.ПредельноеЗначениеПоказателя = ПредельноеЗначениеПоказателя;
		СтрТЗ.РазмерПремииЗаВыполнениеПоказателя = РазмерПремииЗаВыполнениеПоказателя;
		СтрТЗ.ФактическоеЗначениеПоказателя = ФактическоеЗначениеПоказателя;
		СтрТЗ.Коэффициент = Коэффициент;
		СтрТЗ.СуммаПремии = СуммаПремии;
		
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//4. Депремирование
		Результат = ПолучитьДанныеПоДепремированию(Сотрудник);
		Если Результат.Количество() > 0 Тогда
			Пока Результат.Следующий() Цикл
				СтрТЗ = ТЗРезультат.Добавить();
				СтрТЗ.Должность = Должность;
				СтрТЗ.Сотрудник = Сотрудник;
				СтрТЗ.Показатель = Результат.Показатель;
				СтрТЗ.ПредельноеЗначениеПоказателя = "";
				СтрТЗ.РазмерПремииЗаВыполнениеПоказателя = "";
				СтрТЗ.ФактическоеЗначениеПоказателя = 0;
				СтрТЗ.СуммаПремии = Результат.ЗначениеПоказателя;
			КонецЦикла;
		КонецЕсли;
		
	КонецЦикла;
	
	
	//СТАРШИЙ ОПЕРАТОР ОТДЕЛА ОБЕСПЕЧЕНИЯ
	Должность = Справочники.ДолжностиОрганизаций.НайтиПоНаименованию("4. Старший оператор");
	СписокСотрудников = ПолучитьСотрудников(Подразделение, Должность);
	
	Пока СписокСотрудников.Следующий() Цикл
		
		Сотрудник = СписокСотрудников.Пользователь;
		
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//4. Депремирование
		Результат = ПолучитьДанныеПоДепремированию(Сотрудник);
		Если Результат.Количество() > 0 Тогда
			Пока Результат.Следующий() Цикл
				СтрТЗ = ТЗРезультат.Добавить();
				СтрТЗ.Должность = Должность;
				СтрТЗ.Сотрудник = Сотрудник;
				СтрТЗ.Показатель = Результат.Показатель;
				СтрТЗ.ПредельноеЗначениеПоказателя = "";
				СтрТЗ.РазмерПремииЗаВыполнениеПоказателя = "";
				СтрТЗ.ФактическоеЗначениеПоказателя = ФактическоеЗначениеПоказателя;
				СтрТЗ.СуммаПремии = Результат.ЗначениеПоказателя;
			КонецЦикла;
		КонецЕсли;
		
	КонецЦикла;
	
	
	
	//СТАРШИЙ ОПЕРАТОР ОТДЕЛА ОБЕСПЕЧЕНИЯ
	Должность = Справочники.ДолжностиОрганизаций.НайтиПоНаименованию("4. Старший оператор");
	СписокСотрудников = ПолучитьСотрудников(Подразделение, Должность);
	
	Пока СписокСотрудников.Следующий() Цикл
		
		Сотрудник = СписокСотрудников.Пользователь;
		
		//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		//4. Депремирование
		Результат = ПолучитьДанныеПоДепремированию(Сотрудник);
		Если Результат.Количество() > 0 Тогда
			Пока Результат.Следующий() Цикл
				СтрТЗ = ТЗРезультат.Добавить();
				СтрТЗ.Должность = Должность;
				СтрТЗ.Сотрудник = Сотрудник;
				СтрТЗ.Показатель = Результат.Показатель;
				СтрТЗ.ПредельноеЗначениеПоказателя = "";
				СтрТЗ.РазмерПремииЗаВыполнениеПоказателя = "";
				СтрТЗ.ФактическоеЗначениеПоказателя = ФактическоеЗначениеПоказателя;
				СтрТЗ.СуммаПремии = Результат.ЗначениеПоказателя;
			КонецЦикла;
		КонецЕсли;
		
	КонецЦикла;
	
	
	
	
	
	Настройки = КомпоновщикНастроек.Настройки;
	КомпоновщикМакета = Новый КомпоновщикМакетаКомпоновкиДанных;
	
	МакетКомпоновки = КомпоновщикМакета.Выполнить(СхемаКомпоновкиДанных, Настройки, ДанныеРасшифровки);
	
	ПроцессорКомпоновкиДанных = Новый ПроцессорКомпоновкиДанных;
	ВнешнийНаборДанных = Новый Структура("ТаблицаПараметровОтчета", ТЗРезультат);
	ПроцессорКомпоновкиДанных.Инициализировать(МакетКомпоновки, ВнешнийНаборДанных, ДанныеРасшифровки);	
	
	ЭлементыФормы.Результат.Очистить();
	ДокументРезультат = ЭлементыФормы.Результат;
	
	ПроцессорВывода = Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВТабличныйДокумент;
	ПроцессорВывода.УстановитьДокумент(ДокументРезультат);
	ПроцессорВывода.Вывести(ПроцессорКомпоновкиДанных);
	
КонецПроцедуры

Процедура КнопкаВыбораПериодаНажатие(Элемент)
	
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.УстановитьПериод(ДатаНачала, ?(ДатаОкончания='0001-01-01', ДатаОкончания, КонецДня(ДатаОкончания)));
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	Если НастройкаПериода.Редактировать() Тогда
		ДатаНачала = НастройкаПериода.ПолучитьДатуНачала();
		ДатаОкончания = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
	
КонецПроцедуры

Функция ПолучитьСотрудников(Подразделение, Должность)
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Подразделение", Подразделение);
	Запрос.УстановитьПараметр("Должность", Должность);
	Запрос.Текст = "ВЫБРАТЬ
	               |	СотрудникиДляРасчетаМотивации.Пользователь
	               |ИЗ
	               |	РегистрСведений.СотрудникиДляРасчетаМотивации КАК СотрудникиДляРасчетаМотивации
	               |ГДЕ
	               |	СотрудникиДляРасчетаМотивации.Подразделение = &Подразделение
	               |	И СотрудникиДляРасчетаМотивации.Должность = &Должность";
				   
	Возврат Запрос.Выполнить().Выбрать();
	
КонецФункции

Функция ПолучитьДанныеПоДепремированию(Сотрудник)
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("КонецПериода", КонецМесяца(ДатаОкончания));
	Запрос.УстановитьПараметр("Показатель", "Передача документов в бухгалтерию");
	Запрос.УстановитьПараметр("Сотрудник", Сотрудник);
	
	Запрос.Текст = "ВЫБРАТЬ
	               |	ПоказателиДляРасчетаМотивацииПоСотрудникамДанныеПоСотрудникам.ЗначениеПоказателя КАК ЗначениеПоказателя,
	               |	ПоказателиДляРасчетаМотивацииПоСотрудникамДанныеПоСотрудникам.Сотрудник,
	               |	ПоказателиДляРасчетаМотивацииПоСотрудникамДанныеПоСотрудникам.Показатель
	               |ИЗ
	               |	Документ.ПоказателиДляРасчетаМотивацииПоСотрудникам.ДанныеПоСотрудникам КАК ПоказателиДляРасчетаМотивацииПоСотрудникамДанныеПоСотрудникам
	               |ГДЕ
	               |	ПоказателиДляРасчетаМотивацииПоСотрудникамДанныеПоСотрудникам.Ссылка.Проведен
	               |	И ПоказателиДляРасчетаМотивацииПоСотрудникамДанныеПоСотрудникам.Ссылка.Дата = &КонецПериода
	               |	И НЕ ПоказателиДляРасчетаМотивацииПоСотрудникамДанныеПоСотрудникам.Показатель = &Показатель
	               |	И ПоказателиДляРасчетаМотивацииПоСотрудникамДанныеПоСотрудникам.ЗначениеПоказателя <> 0
	               |	И ПоказателиДляРасчетаМотивацииПоСотрудникамДанныеПоСотрудникам.Сотрудник = &Сотрудник";
				   
				   
	Результат = Запрос.Выполнить().Выбрать();
	
	Возврат Результат;
КонецФункции

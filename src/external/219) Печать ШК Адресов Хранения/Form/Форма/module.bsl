
Процедура КнопкаВыполнитьНажатие(Кнопка)
	
	ТабДокумент = новый ТабличныйДокумент;
	
	Макет = ЭтотОбъект.ПолучитьМакет("Макет");
	
	ОбластьМакета = Макет.ПолучитьОбласть("Строка");
	ОбластьМакетаШапка = Макет.ПолучитьОбласть("Ячейка");
	
	ОбластьМакета2= Макет.ПолучитьОбласть("Строка2");
	
	//+++ Штрих-Код номера документа - февраль 2012
	// требуется установленная компонента 1CBarCode.exe
	N = (ряд1-ряд0+1) * (ПМ1-ПМ0+1);   k=0;
	
	для ряд=ряд0 по ряд1 цикл
		
		если стрДлина(ряд)>1 тогда
		Ангар     =  лев(строка(ряд),1);
		иначе
		Ангар     =  "";
		КонецЕсли;
		РядАнгара = прав(строка(ряд),1);
					
		//---------------------нет ячеек-------------------------------------------
		//если число(Ангар)>3 или число(Ангар)<=0 тогда
		//	Предупреждение("Пока введено только 3 ангара!");
		//	прервать;
		//КонецЕсли;	
	
		//если число(РядАнгара)>6 или число(РядАнгара)<=0 тогда
		//	k=k+(ПМ1-ПМ0+1);
		//	продолжить; // нет рядов 7,8,9,0
		//КонецЕсли;
		
//====================================ячейки===============================================		
		для пм=ПМ0 по ПМ1 цикл
			ОбработкаПрерыванияПользователя();			
			k=k+1;
 		
			//Если Ангар="1" тогда
			//	если ((пм<2 или ПМ>23) и (число(РядАнгара)>=2 и число(РядАнгара)<=5))
			//	или (пм=24 и число(РядАнгара)=1) тогда
			//		продолжить;
			//	КонецЕсли;
			//	
			//ИначеЕсли Ангар="2" тогда	
			//	если ((пм<3 или ПМ>23) и (число(РядАнгара)>=2 и число(РядАнгара)<=5))
			//	или (пм=1 и число(РядАнгара)=6) тогда
			//	продолжить;
			//	КонецЕсли;
			//
			//ИначеЕсли Ангар="3" тогда	
			//	если ((пм<3 или ПМ>22) и (число(РядАнгара)>=2 и число(РядАнгара)<=5))
			//	или (пм=1 и число(РядАнгара)=6) тогда
			//		продолжить;
			//	КонецЕсли;
			//КонецЕсли;	
			
			Состояние("Обрабатывается ряд: "+строка(ряд)+" яч.: "+строка(пм)+" ("+формат(k*100/N,"ЧДЦ=0")+" %) подождите...");
			
			ОбластьМакетаШапка.Параметры.А =Ангар;
			ОбластьМакетаШапка.Параметры.Код0 = РядАнгара+" "+ДелЭР+" "+формат(пм,"ЧЦ=2; ЧН=; ЧВН=");
			ОбластьМакетаШапка.Параметры.расшифровка = "Этаж "+ДелЭР+" АНГАР Ряд "+ДелЭР+" Ячейка "+ДелЭР+" ПалеттоМесто";
			ТабДокумент.Вывести(ОбластьМакетаШапка);
			
			для i=0 по КолЭтажей-1 цикл
				Этаж = КолЭтажей - i; // обратная распечатка
				
				//==============Пустые==================
			    //	если Этаж>3 и (число(РядАнгара)=1 или число(РядАнгара)>5) тогда  //Ангар - 1 и 6 по 2 этажа!
				//	ТабДокумент.Вывести(ОбластьМакета2); 
				//	продолжить;
				//КонецЕсли;	
				
				//условие на 2-е ячейки
				//усл2пм =(Ангар="1" и (число(РядАнгара)>=2 и число(РядАнгара)<=5) и пм=2)
				//	 или (Ангар="2" и (число(РядАнгара)>=2 и число(РядАнгара)<=5) и пм=23)
				//	 или (Ангар="3" и (  ( (число(РядАнгара)>=2 и число(РядАнгара)<=5) и (пм=21 или пм=22) )
				//					  или( (число(РядАнгара)=1 или число(РядАнгара)=6) и пм=23)
				//		 )			  );
				//	 
				//Если усл2пм тогда 
				//	ОбластьМакета = Макет.ПолучитьОбласть("Строка3");
				//Иначе
				//	ОбластьМакета = Макет.ПолучитьОбласть("Строка");
				//КонецЕсли;
			
				ОбластьМакета.Параметры.Э =  Строка(Этаж); 
				ОбластьМакета.Параметры.д = ДелЭР; 
				ОбластьМакета.Параметры.А = Ангар; 
			
				//-------------------------------1 палетто-место--------------------------------------
				Код =Строка(Этаж)+ДелЭР+Ангар+ДелЭР+РядАнгара+ДелЭР+формат(пм,"ЧЦ=2; ЧН=; ЧВН=")+ДелЭР+"1";
				Код1 = РядАнгара+ДелЭР+формат(пм,"ЧЦ=2; ЧН=; ЧВН=")+ДелЭР+"1";
				ОбластьМакета.Параметры.Код1 = Код1; 
				
				КодШК = формат(число(стрЗаменить(Код,ДелЭР,"")),"ЧЦ=6; ЧН=; ЧВН=; ЧГ="); 
				ОбШтрихКодСообщение =строка(преф) + КодШК + КонтрольныйСимволEAN_лок(строка(преф)+КодШК, 8);
				
				//Если усл2пм тогда
				//	ОбШтрихКод=ОбластьМакета.Рисунки.ШК4.Объект;
				//иначе
					ОбШтрихКод=ОбластьМакета.Рисунки.ШК1.Объект;
				//КонецЕсли;	
				ОбШтрихКод.Сообщение = ОбШтрихКодСообщение; 
				ОбШтрихКод.ТекстКода = лев(ОбШтрихКодСообщение,7); 
				
				//-------------------------------2 палетто-место--------------------------------------
				Код = Строка(Этаж)+ДелЭР+Ангар+ДелЭР+РядАнгара+ДелЭР+формат(пм,"ЧЦ=2; ЧН=; ЧВН=")+ДелЭР+"2";
				Код2 = РядАнгара+ДелЭР+формат(пм,"ЧЦ=2; ЧН=; ЧВН=")+ДелЭР+"2";
				ОбластьМакета.Параметры.Код2 = Код2; 
				
				КодШК = формат(число(стрЗаменить(Код,ДелЭР,"")),"ЧЦ=6; ЧН=; ЧВН=; ЧГ="); 
				ОбШтрихКодСообщение =строка(преф) + КодШК + КонтрольныйСимволEAN_лок(строка(преф)+КодШК, 8);
				
				//Если усл2пм тогда
				//	ОбШтрихКод=ОбластьМакета.Рисунки.ШК5.Объект; //3+2
				//иначе
					ОбШтрихКод=ОбластьМакета.Рисунки.ШК2.Объект;
				//КонецЕсли;	
				ОбШтрихКод.Сообщение = ОбШтрихКодСообщение; 
				ОбШтрихКод.ТекстКода = лев(ОбШтрихКодСообщение,7); 
				
				//-------------------------------3 палетто-место--------------------------------------
				//Если НЕ усл2пм тогда 
				Код = Строка(Этаж)+ДелЭР+Ангар+ДелЭР+РядАнгара+ДелЭР+формат(пм,"ЧЦ=2; ЧН=; ЧВН=")+ДелЭР+"3";
				Код3 = РядАнгара+ДелЭР+формат(пм,"ЧЦ=2; ЧН=; ЧВН=")+ДелЭР+"3";
				ОбластьМакета.Параметры.Код3 = Код3; 
				
				КодШК = формат(число(стрЗаменить(Код,ДелЭР,"")),"ЧЦ=6; ЧН=; ЧВН=; ЧГ="); 
				ОбШтрихКодСообщение =строка(преф) + КодШК + КонтрольныйСимволEAN_лок(строка(преф)+КодШК, 8);
				ОбШтрихКод=ОбластьМакета.Рисунки.ШК3.Объект;
				ОбШтрихКод.Сообщение = ОбШтрихКодСообщение; 
				ОбШтрихКод.ТекстКода = лев(ОбШтрихКодСообщение,7); 
				//КонецЕсли;
			
				ТабДокумент.Вывести(ОбластьМакета);
				
			КонецЦикла;//этаж
			ТабДокумент.ВывестиГоризонтальныйРазделительСтраниц();
		КонецЦикла;//ячейки
	КонецЦикла;//ряд
	
	//+++)
	ТабДокумент.Показать();
	
КонецПроцедуры



Процедура ПриОткрытии()
	//5000
	//Сектор0 = 1;   	Сектор1 = 1;
	// Ряд0 = 1; Ряд1 = 8;
	//ПМ0  = 1;  ПМ1 = 16; 
	//КолЭтажей = 5;
	//
	////4000
	//Сектор0 = 0;   	Сектор1 = 0;
	// Ряд0 = 0; Ряд1 = 9;
	//ПМ0  = 1;  ПМ1 = 9; 
	//КолЭтажей = 4;
	
	//все Ангары - имеют префик 4
	Ряд0 = 51; Ряд1 = 56;
	ПМ0  = 1;  ПМ1 = 23; 
	КолЭтажей = 4;
	Преф = 4;
	
	
	ДелЭР=","; 
КонецПроцедуры



// Функция вычисляет контрольный символ кода EAN
//
// Параметры:
//  ШтрихКод     - штрих-код (без контрольной цифры)
//  Тип          - тип штрих-кода: 13 - EAN13, 8 - EAN8
//
// Возвращаемое значение:
//  Контрольный символ штрих-кода
//
Функция КонтрольныйСимволEAN_лок(ШтрихКод, Тип) 
	
	Четн   = 0;
	Нечетн = 0;
	
	КоличествоИтераций = ?(Тип = 13, 6, 4);
	
	Для Индекс = 1 По КоличествоИтераций Цикл
		Если (Тип = 8) и (Индекс = КоличествоИтераций) Тогда
		Иначе
			Четн   = Четн   + Число(Сред(ШтрихКод, 2 * Индекс, 1));
		КонецЕсли;
		Нечетн = Нечетн + Число(Сред(ШтрихКод, 2 * Индекс - 1, 1));
	КонецЦикла;
	
	Если Тип = 13 Тогда
		Четн = Четн * 3;
	Иначе
		Нечетн = Нечетн * 3;
	КонецЕсли;
	
	КонтЦифра = 10 - (Четн + Нечетн) % 10;
	
	Возврат ?(КонтЦифра = 10, "0", Строка(КонтЦифра));
	
КонецФункции // КонтрольныйСимволEAN()


<?xml version="1.0" encoding="UTF-8"?>
<SchemaFile xmlns="" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema">
		<dataSource>
			<name>ИсточникДанных1</name>
			<dataSourceType>Local</dataSourceType>
		</dataSource>
		<dataSet xsi:type="DataSetQuery">
			<name>НаборДанных1</name>
			<field xsi:type="DataSetFieldField">
				<dataPath>Номенклатура</dataPath>
				<field>Номенклатура</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Номер</dataPath>
				<field>Номер</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Отклонение</dataPath>
				<field>Отклонение</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Период</dataPath>
				<field>Период</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Процент</dataPath>
				<field>Процент</field>
				<appearance>
					<item xmlns="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xsi:type="dcsset:SettingsParameterValue">
						<parameter>Формат</parameter>
						<value xsi:type="xs:string">ЧДЦ=2</value>
					</item>
				</appearance>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Цена</dataPath>
				<field>Цена</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>Код</dataPath>
				<field>Код</field>
			</field>
			<field xsi:type="DataSetFieldField">
				<dataPath>НоменклатурнаяГруппа</dataPath>
				<field>НоменклатурнаяГруппа</field>
			</field>
			<dataSource>ИсточникДанных1</dataSource>
			<query>ВЫБРАТЬ
	ЦеныНоменклатуры.Номенклатура КАК Номенклатура,
	ЦеныНоменклатуры.ТипЦен,
	ЦеныНоменклатуры.Период КАК Период,
	КОЛИЧЕСТВО(ЦеныНоменклатуры1.Период) КАК Номер
ПОМЕСТИТЬ ВТ
ИЗ
	РегистрСведений.ЦеныНоменклатуры КАК ЦеныНоменклатуры
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныНоменклатуры КАК ЦеныНоменклатуры1
		ПО ЦеныНоменклатуры.Номенклатура = ЦеныНоменклатуры1.Номенклатура
			И ЦеныНоменклатуры.ТипЦен = ЦеныНоменклатуры1.ТипЦен
			И ЦеныНоменклатуры.Период &lt;= ЦеныНоменклатуры1.Период
ГДЕ
	ЦеныНоменклатуры.ТипЦен = &amp;ТипЦен
	И ЦеныНоменклатуры.Цена &lt;&gt; 0

СГРУППИРОВАТЬ ПО
	ЦеныНоменклатуры.ТипЦен,
	ЦеныНоменклатуры.Период,
	ЦеныНоменклатуры.Номенклатура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ.Номенклатура,
	ВТ.ТипЦен,
	ВТ.Период,
	ЦеныНоменклатуры.Цена,
	ВТ.Номер
ПОМЕСТИТЬ ВТ_Цены
ИЗ
	ВТ КАК ВТ
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныНоменклатуры КАК ЦеныНоменклатуры
		ПО ВТ.Номенклатура = ЦеныНоменклатуры.Номенклатура
			И ВТ.ТипЦен = ЦеныНоменклатуры.ТипЦен
			И ВТ.Период = ЦеныНоменклатуры.Период
ГДЕ
	ВТ.Номер &lt;= 3
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Цены.Номенклатура КАК Номенклатура,
	ВТ_Цены.Период,
	ВТ_Цены.Цена,
	ВТ_Цены.Номер КАК Номер,
	ВЫБОР
		КОГДА ЕСТЬNULL(ВТ_Цены1.Цена, 0) = 0
			ТОГДА 0
		ИНАЧЕ ВТ_Цены.Цена - ВТ_Цены1.Цена
	КОНЕЦ КАК Отклонение,
	ВЫБОР
		КОГДА ЕСТЬNULL(ВТ_Цены1.Цена, 0) = 0
			ТОГДА 0
		ИНАЧЕ (ВТ_Цены.Цена - ВТ_Цены1.Цена) / ВТ_Цены1.Цена * 100
	КОНЕЦ КАК Процент,
	ВТ_Цены.Номенклатура.Код КАК Код,
	ВТ_Цены.Номенклатура.НоменклатурнаяГруппа КАК НоменклатурнаяГруппа
ИЗ
	ВТ_Цены КАК ВТ_Цены
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Цены КАК ВТ_Цены1
		ПО ВТ_Цены.Номенклатура = ВТ_Цены1.Номенклатура
			И ВТ_Цены.ТипЦен = ВТ_Цены1.ТипЦен
			И (ВТ_Цены.Номер = ВТ_Цены1.Номер - 1)
{ГДЕ
	(ВТ_Цены.Номенклатура.НоменклатурнаяГруппа В (&amp;СписокГрупп))}

УПОРЯДОЧИТЬ ПО
	Номенклатура,
	Номер</query>
		</dataSet>
		<totalField>
			<dataPath>Цена</dataPath>
			<expression>Сумма(Цена)</expression>
			<group>Номенклатура</group>
		</totalField>
		<totalField>
			<dataPath>Период</dataPath>
			<expression>Максимум(Период)</expression>
			<group>Номенклатура</group>
		</totalField>
		<totalField>
			<dataPath>Процент</dataPath>
			<expression>Сумма(Процент)</expression>
			<group>Номенклатура</group>
		</totalField>
		<totalField>
			<dataPath>Отклонение</dataPath>
			<expression>Сумма(Отклонение)</expression>
			<group>Номенклатура</group>
		</totalField>
		<totalField>
			<dataPath>Цена</dataPath>
			<expression>0</expression>
			<group>НоменклатурнаяГруппа</group>
		</totalField>
		<totalField>
			<dataPath>Период</dataPath>
			<expression>0</expression>
			<group>НоменклатурнаяГруппа</group>
		</totalField>
		<totalField>
			<dataPath>Процент</dataPath>
			<expression>0</expression>
			<group>НоменклатурнаяГруппа</group>
		</totalField>
		<totalField>
			<dataPath>Отклонение</dataPath>
			<expression>0</expression>
			<group>НоменклатурнаяГруппа</group>
		</totalField>
		<parameter>
			<name>ТипЦен</name>
			<title xmlns:d4p1="http://v8.1c.ru/8.1/data/core" xsi:type="d4p1:LocalStringType">
				<d4p1:item>
					<d4p1:lang>ru</d4p1:lang>
					<d4p1:content>Тип цен</d4p1:content>
				</d4p1:item>
			</title>
			<valueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core" xmlns:d5p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d5p1:CatalogRef.ТипыЦенНоменклатуры</Type>
			</valueType>
			<value xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xsi:type="dcscor:DesignTimeValue">Справочник.ТипыЦенНоменклатуры.ПустаяСсылка</value>
			<useRestriction>false</useRestriction>
		</parameter>
		<parameter>
			<name>СписокГрупп</name>
			<title xmlns:d4p1="http://v8.1c.ru/8.1/data/core" xsi:type="d4p1:LocalStringType">
				<d4p1:item>
					<d4p1:lang>ru</d4p1:lang>
					<d4p1:content>Список групп</d4p1:content>
				</d4p1:item>
			</title>
			<valueType>
				<Type xmlns="http://v8.1c.ru/8.1/data/core" xmlns:d5p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d5p1:CatalogRef.НоменклатурныеГруппы</Type>
			</valueType>
			<value xsi:nil="true"/>
			<useRestriction>false</useRestriction>
		</parameter>
		<settingsVariant>
			<name xmlns="http://v8.1c.ru/8.1/data-composition-system/settings">Основной</name>
			<presentation xmlns="http://v8.1c.ru/8.1/data-composition-system/settings" xsi:type="xs:string">Основной</presentation>
		</settingsVariant>
	</dataCompositionSchema>
</SchemaFile>﻿<?xml version="1.0" encoding="UTF-8"?>
<Settings xmlns="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<outputParameters>
		<dcscor:item xsi:type="SettingsParameterValue">
			<dcscor:parameter>ГоризонтальноеРасположениеОбщихИтогов</dcscor:parameter>
			<dcscor:value xsi:type="dcscor:DataCompositionTotalPlacement">None</dcscor:value>
		</dcscor:item>
		<dcscor:item xsi:type="SettingsParameterValue">
			<dcscor:parameter>ВертикальноеРасположениеОбщихИтогов</dcscor:parameter>
			<dcscor:value xsi:type="dcscor:DataCompositionTotalPlacement">None</dcscor:value>
		</dcscor:item>
	</outputParameters>
	<item xsi:type="StructureItemTable">
		<column>
			<groupItems>
				<item xsi:type="GroupItemField">
					<field>Номер</field>
					<groupType>Items</groupType>
					<periodAdditionType>None</periodAdditionType>
					<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
					<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
				</item>
			</groupItems>
			<order>
				<item xsi:type="OrderItemAuto"/>
			</order>
			<selection>
				<item xsi:type="SelectedItemAuto"/>
			</selection>
		</column>
		<row>
			<groupItems>
				<item xsi:type="GroupItemField">
					<field>НоменклатурнаяГруппа</field>
					<groupType>Items</groupType>
					<periodAdditionType>None</periodAdditionType>
					<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
					<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
				</item>
			</groupItems>
			<order>
				<item xsi:type="OrderItemAuto"/>
			</order>
			<selection>
				<item xsi:type="SelectedItemAuto"/>
			</selection>
			<item>
				<groupItems>
					<item xsi:type="GroupItemField">
						<field>Код</field>
						<groupType>Items</groupType>
						<periodAdditionType>None</periodAdditionType>
						<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
						<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
					</item>
					<item xsi:type="GroupItemField">
						<field>Номенклатура</field>
						<groupType>Items</groupType>
						<periodAdditionType>None</periodAdditionType>
						<periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionBegin>
						<periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</periodAdditionEnd>
					</item>
				</groupItems>
				<order>
					<item xsi:type="OrderItemAuto"/>
				</order>
				<selection>
					<item xsi:type="SelectedItemAuto"/>
				</selection>
			</item>
		</row>
		<selection>
			<item xsi:type="SelectedItemField">
				<field>Период</field>
			</item>
			<item xsi:type="SelectedItemField">
				<field>Цена</field>
			</item>
			<item xsi:type="SelectedItemField">
				<field>Отклонение</field>
			</item>
			<item xsi:type="SelectedItemField">
				<field>Процент</field>
			</item>
		</selection>
	</item>
</Settings>﻿<?xml version="1.0" encoding="UTF-8"?>
<SchemaFile xmlns="" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema"/>
</SchemaFile>
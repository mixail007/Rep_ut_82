Функция ВыбратьЯщик(Organization, парКонтрагент) Экспорт
	Контрагент = парКонтрагент;
	Ящики.Очистить();
	ИНН = СокрЛП(Контрагент.ИНН);
	КПП = СокрЛП(Контрагент.КПП);
	
	КонтрагентПредставление = "(" + ИНН;
	Если НЕ ПустаяСтрока(КПП) Тогда
		КонтрагентПредставление = КонтрагентПредставление + " / " + КПП;
	КонецЕсли;
	КонтрагентПредставление = КонтрагентПредставление + ") " + Контрагент;
	
	
	СписокЯщиков = Модуль_РаботаССерверомДиадок.получитьМассивЯщиковДиадокПоИНН(Organization, ИНН);
	Если списокЯщиков.количество()=0 Тогда
		Возврат Неопределено;
	ИначеЕсли списокЯщиков.Количество() = 1 Тогда
		Возврат Новый Структура("Наименование, Представление, ID", СписокЯщиков[0].Name , СписокЯщиков[0].Name + " (ИНН: " + СписокЯщиков[0].Inn+ ")",  СписокЯщиков[0].ID);
	Иначе
		СписокЯщиковКПП = Модуль_РаботаССерверомДиадок.получитьМассивЯщиковДиадокПоИНН(Organization, ИНН,  КПП);
		Если списокЯщиковКПП.количество()=1 Тогда
			Возврат Новый Структура("Наименование, Представление, ID", СписокЯщиковКПП[0].Name , СписокЯщиковКПП[0].Name + " (ИНН:" + СписокЯщиковКПП[0].Inn+ ")",  СписокЯщиковКПП[0].ID);
		Иначе
			Для Каждого ящ Из СписокЯщиков Цикл
				стр = Ящики.Добавить();
				стр.ИНН = ящ.Inn;
				стр.КПП = ящ.Kpp;
				стр.Ящик = ящ.Name;
				стр.ID = ящ.Id;
			КонецЦикла;
			
			Возврат ОткрытьМодально();
		КонецЕсли;
    КонецЕсли;
КонецФункции

Процедура ВыбратьНажатие(Элемент)
	ТекДанные = ЭлементыФормы.Ящики.ТекущиеДанные;
	Если ТекДанные = Неопределено Тогда
		Предупреждение("Выберите ящик контрагента.",, НаименованиеСистемы);
		Возврат;
	КонецЕсли;
	
	Закрыть(Новый Структура("Наименование, Представление,  ID", ТекДанные.Ящик , ТекДанные.Ящик + " (ИНН: " + ТекДанные.ИНН + ")", ТекДанные.Id));
КонецПроцедуры

Процедура ОтменаНажатие(Элемент)
	Закрыть(Неопределено);
КонецПроцедуры

Процедура ЯщикиПередУдалением(Элемент, Отказ)
	Отказ = Истина;
КонецПроцедуры

Процедура ЯщикиПередНачаломДобавления(Элемент, Отказ, Копирование)
	Отказ = Истина;
КонецПроцедуры

Процедура ЯщикиПередНачаломИзменения(Элемент, Отказ)
	ТекДанные = ЭлементыФормы.Ящики.ТекущиеДанные;
	Закрыть(Новый Структура("Наименование, ID", ТекДанные.Ящик + " (" + ТекДанные.ИНН + " / " + ТекДанные.КПП + ")", ТекДанные.Id));
КонецПроцедуры

Процедура КонтрагентПредставлениеНажатие(Элемент)
	Контрагент.ПолучитьФорму().Открыть();
КонецПроцедуры

Процедура ПриОткрытии()
	КартинкаЗаголовка= ЭДО_БиблиотекаКартинок().КартинкаЗаголовка;
    ЭлементыФормы.Сообщение.Заголовок = "В "+НаименованиеСистемы+" найдено несколько организаций с заданным ИНН. Выберите нужную организацию."
КонецПроцедуры

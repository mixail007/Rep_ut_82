Перем ПустойЭлемент1С;

Процедура КнопкаВыполнитьНажатие(Кнопка)
	Если ЗначениеЗаполнено(Элемент1С)=Ложь Тогда
		предупреждение("Не указано "+стрзаменить(ЭлементыФормы.НадписьЭлемент1С.Заголовок, ":", ""), , НаименованиеСистемы);
		Возврат
	КонецЕсли;	
	// Вставить содержимое обработчика.
	ИспользоватьСопоставлениеПодразделений = ПолучитьПрофильКонфигурации().ИспользоватьСопоставлениеПодразделений;
	НаименованиеСправочникаПодразделений = ПолучитьПрофильКонфигурации().НаименованиеСправочникаПодразделений;
	НаименованиеСправочникаСкладов = ПолучитьПрофильКонфигурации().НаименованиеСправочникаСкладов;

	Если ИспользоватьСопоставлениеПодразделений и (типЗнч(Элемент1С) = тип("СправочникСсылка."+НаименованиеСправочникаПодразделений))  Тогда
		Если ЗначениеЗаполнено(DepartmentID) Тогда
			ПолучитьМодульПрог("Модуль_Данные1С_СвязиОбъектов").Установить_DepartmentID_для_Подразделения(Элемент1С,DepartmentID);
			ПолучитьМодульПрог("Модуль_Данные1С_СвязиОбъектов").Установить_DepartmentName_для_Подразделения(Элемент1С,ПодразделениеВДиадоке);
		иначе 
			ПолучитьМодульПрог("Модуль_Данные1С_СвязиОбъектов").Установить_DepartmentID_для_Подразделения(Элемент1С,"");
			ПолучитьМодульПрог("Модуль_Данные1С_СвязиОбъектов").Установить_DepartmentName_для_Подразделения(Элемент1С,"");
		КонецЕсли;
	ИначеЕсли 	типЗнч(Элемент1С) = тип("СправочникСсылка."+НаименованиеСправочникаСкладов) Тогда
		Если ЗначениеЗаполнено(DepartmentID) И ЗначениеЗаполнено(ПодразделениеВДиадоке) Тогда
			ПолучитьМодульПрог("Модуль_Данные1С_СвязиОбъектов").Установить_DepartmentID_для_Склада(Элемент1С,DepartmentID);
			ПолучитьМодульПрог("Модуль_Данные1С_СвязиОбъектов").Установить_DepartmentName_для_Склада(Элемент1С,ПодразделениеВДиадоке);
		иначе 
			ПолучитьМодульПрог("Модуль_Данные1С_СвязиОбъектов").Установить_DepartmentID_для_Склада(Элемент1С,"");
			ПолучитьМодульПрог("Модуль_Данные1С_СвязиОбъектов").Установить_DepartmentName_для_Склада(Элемент1С,"");
		КонецЕсли;
	КонецЕсли;	
	
	
	ЭтаФорма.Закрыть(Новый Структура("Объект1С, DepartmentID", Элемент1С, DepartmentID ));
КонецПроцедуры

Процедура ПодразделениеВДиадокеНачалоВыбора(Элемент, СтандартнаяОбработка)
	Отказ = Истина;
	
	 Результат = ПолучитьФорму("ФормаВыбораОрганизацииПодразделения").ВыбратьОрганизациюИПодразделениеДиадок(, DepartmentID , Ложь);
	 Если Результат <>Неопределено Тогда
		 ПодразделениеВДиадоке = Результат.ПредставлениеПодразделения;
		 DepartmentID =  Результат.DepartmentID;
 	 КонецЕсли;	
КонецПроцедуры

Процедура ПриОткрытии()
	КартинкаЗаголовка= ЭДО_БиблиотекаКартинок().КартинкаЗаголовка;
	ЭтаФорма.Заголовок = "Сопоставление с подразделением в "+НаименованиеСистемы;
	
	ИспользоватьСопоставлениеПодразделений = ПолучитьПрофильКонфигурации().ИспользоватьСопоставлениеПодразделений;
	НаименованиеСправочникаПодразделений = ПолучитьПрофильКонфигурации().НаименованиеСправочникаПодразделений;
	НаименованиеСправочникаСкладов = ПолучитьПрофильКонфигурации().НаименованиеСправочникаСкладов;
	

	Если ИспользоватьСопоставлениеПодразделений и (типЗнч(Элемент1С) = тип("СправочникСсылка."+НаименованиеСправочникаПодразделений)) Тогда 
		ЭлементыФормы.НадписьЭлемент1С.Заголовок = "Подразделение 1С:";
		ПустойЭлемент1С = справочники[НаименованиеСправочникаПодразделений].ПустаяСсылка();
	ИначеЕсли 	типЗнч(Элемент1С) = тип("СправочникСсылка."+НаименованиеСправочникаСкладов) Тогда 
		ЭлементыФормы.НадписьЭлемент1С.Заголовок = "Склад 1С:";
		ПустойЭлемент1С = справочники[НаименованиеСправочникаСкладов].ПустаяСсылка();
	КонецЕсли;	
КонецПроцедуры

Процедура Элемент1СОчистка(Элемент, СтандартнаяОбработка)
	// Вставить содержимое обработчика.
	СтандартнаяОбработка = Ложь;
	Элемент1С = ПустойЭлемент1С;
КонецПроцедуры

Процедура ПодразделениеВДиадокеОчистка(Элемент, СтандартнаяОбработка)
	// Вставить содержимое обработчика.
КонецПроцедуры

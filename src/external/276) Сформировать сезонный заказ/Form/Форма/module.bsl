Перем МВТ, ТекстЗапросаЛитые,ТекстЗапросаШтампованые,втТолькоПродажи,втПродажиИСправочник;
Перем тзКолонки;

Процедура ВывестиРасшифровку(ТЗ,Заголовок)
	Макет = ПолучитьМакет("Макет");
	ТабДок = новый ТабличныйДокумент;
	
	Область = Макет.ПолучитьОбласть("Заголовок");
	Область.Параметры.Заголовок=Заголовок;
    табДок.Вывести(Область);

	
	Если ТЗ.Колонки.Найти("Дата")<>Неопределено тогда
		Область=Макет.ПолучитьОбласть("Шапка|Дата");
		табДок.Вывести(Область);
		Область=Макет.ПолучитьОбласть("Шапка|Код");
        табДок.Присоединить(Область);
	Иначе
		Область=Макет.ПолучитьОбласть("Шапка|Код");
		табДок.Вывести(Область);
	КонецЕсли;
	Область=Макет.ПолучитьОбласть("Шапка|Номенклатура");
	табДок.Присоединить(Область);
	
	Область=Макет.ПолучитьОбласть("Шапка|Количество");
	табДок.Присоединить(Область);
	
	Для каждого стр из ТЗ цикл
		Если ТЗ.Колонки.Найти("Дата")<>Неопределено тогда
			Область=Макет.ПолучитьОбласть("Строка|Дата");
			Область.Параметры.Дата=стр.Дата;
			табДок.Вывести(Область);
			
			Область=Макет.ПолучитьОбласть("Строка|Код");
			Область.Параметры.Код=стр.Код;
			табДок.Присоединить(Область);
		Иначе
			Область=Макет.ПолучитьОбласть("Строка|Код");
			Область.Параметры.Код=стр.Код;
			табДок.Вывести(Область);
		КонецЕсли;
		Область=Макет.ПолучитьОбласть("Строка|Номенклатура");
		Область.Параметры.Номенклатура=стр.Номенклатура;
		табДок.Присоединить(Область);
		
		Область=Макет.ПолучитьОбласть("Строка|Количество");
		Область.Параметры.Количество=стр.Количество;
		табДок.Присоединить(Область);
	КонецЦикла;	
	ТабДок.Показать();	
КонецПроцедуры	

Процедура КнопкаВыполнитьНажатие(Кнопка)
	МВТ=Новый МенеджерВременныхТаблиц;
	Запрос=новый Запрос;
	Запрос.МенеджерВременныхТаблиц=МВТ;
	Если НоменклатурнаяГруппа.Код="00026" тогда //литые
		Запрос.Текст=ТекстЗапросаЛитые;
	ИначеЕсли НоменклатурнаяГруппа.Код="00049" тогда //штамп
		Запрос.Текст=ТекстЗапросаШтампованые;
	КонецЕсли;
	Если флТолькоПродажи тогда
		втПродажи=втТолькоПродажи;
	Иначе
		втПродажи=втПродажиИСправочник;
	КонецЕсли;
    Запрос.Текст=втПродажи+Запрос.Текст;
	
	Запрос.УстановитьПараметр("НачДата",НачПериода);
	Запрос.УстановитьПараметр("КонДата",КонецДня(КонПериода));
	Запрос.УстановитьПараметр("Производитель",Производитель);
	Запрос.УстановитьПараметр("Литые",НоменклатурнаяГруппа);
	Запрос.УстановитьПараметр("Штампованые",НоменклатурнаяГруппа);
	Запрос.УстановитьПараметр("ТекДата",КонецДня(ТекущаяДата()));
	ТабличноеПоле1=Запрос.Выполнить().Выгрузить();
	
	ЭлементыФормы.ТабличноеПоле1.СоздатьКолонки();
	ПараметрыОтбора=Новый Структура("Имя");
	Для Каждого Колонка из  ЭлементыФормы.ТабличноеПоле1.Колонки цикл
		ПараметрыОтбора.Имя=Колонка.Имя;
		строки=тзКолонки.НайтиСтроки(ПараметрыОтбора);
		Если Строки.Количество()>0 Тогда
			ЗаполнитьЗначенияСвойств(Колонка,Строки[0]);
		КонецЕсли;	
	КонецЦикла;
	
КонецПроцедуры

Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	Если НастройкаПериода.Редактировать() Тогда
		НачПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры


Процедура ТабличноеПоле1Выбор(Элемент, ВыбраннаяСтрока, Колонка, СтандартнаяОбработка)
	ЗапросРасшифровки=новый Запрос;
	ЗапросРасшифровки.МенеджерВременныхТаблиц=МВТ;
	Если Колонка.Имя="ПроданоВТипоразмере" тогда
		Отчет=Отчеты.Продажи;
		Форма=Отчет.ПолучитьФорму("Форма");
		Форма.ЭтотОтчет.ЗаполнитьНачальныеНастройки();
		
		Форма.ЭтотОтчет.ОбщийОтчет.ПостроительОтчета.Отбор.Добавить("Номенклатура.Типоразмер","Номенклатура_Типоразмер","Номенклатура.Типоразмер");
		Форма.ЭтотОтчет.ОбщийОтчет.ПостроительОтчета.Отбор.Добавить("Номенклатура.Производитель","Номенклатура_Производитель","Номенклатура.Производитель");
		Форма.ЭтотОтчет.ОбщийОтчет.ПостроительОтчета.Отбор["Номенклатура_Типоразмер"].Использование = Истина;
		Форма.ЭтотОтчет.ОбщийОтчет.ПостроительОтчета.Отбор["Номенклатура_Типоразмер"].Значение = ВыбраннаяСтрока.Типоразмер;
		Форма.ЭтотОтчет.ОбщийОтчет.ПостроительОтчета.Отбор["Номенклатура_Типоразмер"].ВидСравнения = ВидСравнения.Равно;
		Форма.ЭтотОтчет.ОбщийОтчет.ПостроительОтчета.Отбор["Номенклатура_Производитель"].Использование = Истина;
		Форма.ЭтотОтчет.ОбщийОтчет.ПостроительОтчета.Отбор["Номенклатура_Производитель"].Значение = Производитель;
		Форма.ЭтотОтчет.ОбщийОтчет.ПостроительОтчета.Отбор["Номенклатура_Производитель"].ВидСравнения = ВидСравнения.Равно;

		Форма.ЭтотОтчет.ОбщийОтчет.ПостроительОтчета.ВыбранныеПоля.Очистить();
		Форма.ЭтотОтчет.ОбщийОтчет.ПостроительОтчета.ВыбранныеПоля.Добавить("Номенклатура.Код","Номенклатура_Код");
		Форма.ЭтотОтчет.ОбщийОтчет.ПостроительОтчета.ВыбранныеПоля.Добавить("Номенклатура","Номенклатура");
		Форма.ЭтотОтчет.ОбщийОтчет.ПостроительОтчета.ИзмеренияСтроки.Добавить("Номенклатура");
		Форма.ЭтотОтчет.ОбщийОтчет.ДатаНач=НачПериода;
		Форма.ЭтотОтчет.ОбщийОтчет.ДатаКон=КонецДня(КонПериода);
		Форма.ОбновитьОтчет();
		Форма.Открыть();
		
		
	//Если Колонка.Имя="ПроданоВТипоразмере" тогда
	//	ЗапросРасшифровки.Текст="ВЫБРАТЬ
	//							|	втПродажи.Номенклатура,
	//							|	втПродажи.Количество
	//							|ИЗ
	//							|	втПродажи КАК втПродажи
	//							|ГДЕ
	//							|	втПродажи.Типоразмер = &Типоразмер";
	//	ЗапросРасшифровки.УстановитьПараметр("Типоразмер",ВыбраннаяСтрока.Типоразмер);
	//	Рез=ЗапросРасшифровки.Выполнить().Выгрузить();
	//	Рез.ВыбратьСтроку();
	//ИначеЕсли	Колонка.Имя="КоличествоПродано" тогда
	//	ЗапросРасшифровки.Текст="ВЫБРАТЬ
	//							|	втПродажи.Номенклатура,
	//							|	втПродажи.Количество
	//							|ИЗ
	//							|	втПродажи КАК втПродажи
	//							|ГДЕ
	//							|	втПродажи.Типоразмер = &Типоразмер";
	//	ЗапросРасшифровки.УстановитьПараметр("Типоразмер",ВыбраннаяСтрока.Типоразмер);
	//	Рез=ЗапросРасшифровки.Выполнить().Выгрузить();
	//	Рез.ВыбратьСтроку();
	//	
	ИначеЕсли	Колонка.Имя="ОстатокНаСкладах" тогда
		
		ЗапросРасшифровки.Текст="ВЫБРАТЬ
								|	ВТ_Остатки.Номенклатура.Код как Код,
								|	ВТ_Остатки.Номенклатура,
								|	ВТ_Остатки.Количество
								|ИЗ
								|	ВТ_Остатки КАК ВТ_Остатки
								|ГДЕ
								|	ВТ_Остатки.Типоразмер = &Типоразмер";
		ЗапросРасшифровки.УстановитьПараметр("Типоразмер",ВыбраннаяСтрока.Типоразмер);
		Рез=ЗапросРасшифровки.Выполнить().Выгрузить();
        Рез.Колонки.Найти("Код").Ширина=7;
		Рез.Колонки.Найти("Номенклатура").Ширина=42;
		Рез.Колонки.Найти("Количество").Ширина=10;
		//Рез.ВыбратьСтроку();
		ВывестиРасшифровку(Рез,"Остатки на складах по типоразмеру (факт.)");
	ИначеЕсли	Колонка.Имя="ОстатокВТипоразмере" тогда
		ЗапросРасшифровки.Текст="ВЫБРАТЬ
								|	ВТ_Остатки.Номенклатура.Код как Код,
								|	ВТ_Остатки.Номенклатура,
								|	ВТ_Остатки.Количество
								|ИЗ
								|	ВТ_Остатки КАК ВТ_Остатки
								|ГДЕ
								|	ВТ_Остатки.Типоразмер = &Типоразмер";
		ЗапросРасшифровки.УстановитьПараметр("Типоразмер",ВыбраннаяСтрока.Типоразмер);
		Рез=ЗапросРасшифровки.Выполнить().Выгрузить();
		Рез.Колонки.Найти("Код").Ширина=7;
		Рез.Колонки.Найти("Номенклатура").Ширина=42;
		Рез.Колонки.Найти("Количество").Ширина=10;
		//Рез.ВыбратьСтроку();
		ВывестиРасшифровку(Рез,"");
	ИначеЕсли	Колонка.Имя="КоличествоЗаказаноПокупателями" тогда
		ЗапросРасшифровки.Текст="ВЫБРАТЬ
								|	втЗаказыПокупателей.Номенклатура,
								|	втЗаказыПокупателей.Количество
								|ИЗ
								|	втЗаказыПокупателей КАК втЗаказыПокупателей
								|ГДЕ
								|	втЗаказыПокупателей.Типоразмер = &Типоразмер";
		ЗапросРасшифровки.УстановитьПараметр("Типоразмер",ВыбраннаяСтрока.Типоразмер);
		Рез=ЗапросРасшифровки.Выполнить().Выгрузить();
		Рез.ВыбратьСтроку();
		
	ИначеЕсли	Колонка.Имя="КоличествоВПути" тогда
		ЗапросРасшифровки.Текст="ВЫБРАТЬ
								|	втВПути.Дата КАК Дата,
								|   втВПути.Номенклатура.Код как Код,
								|	втВПути.Номенклатура,
								|	втВПути.Количество
								|ИЗ
								|	втВПути КАК втВПути
								|ГДЕ
								|	втВПути.Номенклатура = &Номенклатура
								|
								|УПОРЯДОЧИТЬ ПО
								|	Дата
								|АВТОУПОРЯДОЧИВАНИЕ";
		ЗапросРасшифровки.УстановитьПараметр("Номенклатура",ВыбраннаяСтрока.Номенклатура);
		Рез=ЗапросРасшифровки.Выполнить().Выгрузить();
		Рез.Колонки.Найти("Дата").Ширина=9;
		Рез.Колонки.Найти("Код").Ширина=7;
        Рез.Колонки.Найти("Номенклатура").Ширина=35;
		Рез.Колонки.Найти("Количество").Ширина=10;
		//Рез.ВыбратьСтроку();
		ВывестиРасшифровку(Рез,"Товары в пути.");
	ИначеЕсли	Колонка.Имя="КоличествоВПроизводстве" тогда	
		ЗапросРасшифровки.Текст="ВЫБРАТЬ
								|	втВПроизводстве.Дата КАК Дата,
								|	втВПроизводстве.Номенклатура.Код как Код,
								|	втВПроизводстве.Номенклатура,
								|	втВПроизводстве.Количество
								|ИЗ
								|	втВПроизводстве КАК втВПроизводстве
								|ГДЕ
								|	втВПроизводстве.Номенклатура = &Номенклатура
								|
								|УПОРЯДОЧИТЬ ПО
								|	Дата
								|АВТОУПОРЯДОЧИВАНИЕ";
		ЗапросРасшифровки.УстановитьПараметр("Номенклатура",ВыбраннаяСтрока.Номенклатура);
		Рез=ЗапросРасшифровки.Выполнить().Выгрузить();
		Рез.Колонки.Найти("Дата").Ширина=9;
		Рез.Колонки.Найти("Код").Ширина=7;
        Рез.Колонки.Найти("Номенклатура").Ширина=35;
		Рез.Колонки.Найти("Количество").Ширина=10;

		//Рез.ВыбратьСтроку();
		ВывестиРасшифровку(Рез,"Товары в производстве.");
	ИначеЕсли   Колонка.Имя="СвободныйОстатокПоТипоразмеру" тогда
		ЗапросРасшифровки.Текст="ВЫБРАТЬ
		                        |	А.Номенклатура.Код как Код,
								|	А.Номенклатура,
								|	А.Количество
								|ИЗ
								|	(ВЫБРАТЬ
								|		ВТ_Остатки.Номенклатура КАК Номенклатура,
								|		ЕСТЬNULL(ВТ_Остатки.Количество, 0) - ЕСТЬNULL(втЗаказыПокупателей.Количество, 0) КАК Количество,
								|		ВТ_Остатки.Типоразмер КАК Типоразмер
								|	ИЗ
								|		ВТ_Остатки КАК ВТ_Остатки
								|			ЛЕВОЕ СОЕДИНЕНИЕ втЗаказыПокупателей КАК втЗаказыПокупателей
								|			ПО ВТ_Остатки.Номенклатура = втЗаказыПокупателей.Номенклатура) КАК А
								|ГДЕ
								|	А.Типоразмер = &Типоразмер
								|	И А.Количество <> 0";
		ЗапросРасшифровки.УстановитьПараметр("Типоразмер",ВыбраннаяСтрока.Типоразмер);
		Рез=ЗапросРасшифровки.Выполнить().Выгрузить();
		Рез.Колонки.Найти("Код").Ширина=7;
		Рез.Колонки.Найти("Номенклатура").Ширина=42;
		Рез.Колонки.Найти("Количество").Ширина=10;

		//Рез.ВыбратьСтроку();
		ВывестиРасшифровку(Рез,"Свободный остаток по типоразмеру.");
	КонецЕсли;	
КонецПроцедуры

Процедура ОсновныеДействияФормыДействие(Кнопка)
	Если ТабличноеПоле1.Итог("КоличествоЗаказать")<>0 тогда
		ДокЗаказСезонный=Документы.ЗаказПоставщикуСезонный.СоздатьДокумент();
		ДокЗаказСезонный.Дата=ТекущаяДата();
		Товары=ДокЗаказСезонный.Товары;
		Для каждого стр из ТабличноеПоле1 Цикл
			Если Стр.КоличествоЗаказать>0 тогда
				стрТовары=Товары.Добавить();
				СтрТовары.Номенклатура=стр.Номенклатура;
				СтрТовары.ЕдиницаИзмерения=стр.Номенклатура.ЕдиницаХраненияОстатков;
				СтрТовары.Коэффициент=стр.Номенклатура.ЕдиницаХраненияОстатков.Коэффициент;
				СтрТовары.Количество=стр.КоличествоЗаказать;
				СтрТовары.Вес=стр.КоличествоЗаказать*стр.Номенклатура.ЕдиницаХраненияОстатков.Вес;
			КонецЕсли;	
		КонецЦикла;	
		ДокЗаказСезонный.ПолучитьФорму().Открыть();
	Иначе
		Предупреждение("Номенклатуры для заказа не выбрано",60);
	КонецЕсли;	
КонецПроцедуры

Процедура ПроизводительПриИзменении(Элемент)
	Если Производитель.Код="597" тогда  //trebl->штампованые, иначе - литые
		НоменклатурнаяГруппа=Справочники.НоменклатурныеГруппы.НайтиПоКоду("00049");
	Иначе
		НоменклатурнаяГруппа=Справочники.НоменклатурныеГруппы.НайтиПоКоду("00026");
	КонецЕсли;	
КонецПроцедуры
Если 1=1 тогда
//ТекстЗапросаЛитые="ВЫБРАТЬ
//				  |	ПродажиОбороты.Номенклатура.Типоразмер КАК Типоразмер,
//				  |	СУММА(ПродажиОбороты.КоличествоОборот) КАК КоличествоОборот
//				  |ПОМЕСТИТЬ ВТ_ПродажиПоТипоразмеру
//				  |ИЗ
//				  |	РегистрНакопления.Продажи.Обороты(
//				  |			&НачДата,
//				  |			&КонДата,
//				  |			,
//				  |			Номенклатура.Производитель = &Производитель
//				  |				И Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)
//				  |				И Номенклатура.НоменклатурнаяГруппа = &Литые) КАК ПродажиОбороты
//				  |
//				  |СГРУППИРОВАТЬ ПО
//				  |	ПродажиОбороты.Номенклатура.Типоразмер
//				  |;
//				  |
//				  |////////////////////////////////////////////////////////////////////////////////
//				  |ВЫБРАТЬ
//				  |	ТоварыНаСкладахОстатки.Номенклатура.Типоразмер КАК Типоразмер,
//				  |	СУММА(ТоварыНаСкладахОстатки.КоличествоОстаток) КАК КоличествоОстаток
//				  |ПОМЕСТИТЬ ВТ_ОстаткиПоТипоразмеру
//				  |ИЗ
//				  |	РегистрНакопления.ТоварыНаСкладах.Остатки(
//				  |			,
//				  |			Номенклатура.Производитель = &Производитель
//				  |				И Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)
//				  |				И Номенклатура.НоменклатурнаяГруппа = &Литые
//				  |				И ((НЕ Склад.ЗапретитьИспользование)
//				  |					И (НЕ Склад.Транзитный))) КАК ТоварыНаСкладахОстатки
//				  |
//				  |СГРУППИРОВАТЬ ПО
//				  |	ТоварыНаСкладахОстатки.Номенклатура.Типоразмер
//				  |;
//				  |
//				  |////////////////////////////////////////////////////////////////////////////////
//				  |ВЫБРАТЬ
//				  |	ЗаказыПокупателейОстатки.Номенклатура.Типоразмер КАК Типоразмер,
//				  |	СУММА(ЗаказыПокупателейОстатки.КоличествоОстаток) КАК КоличествоОстаток
//				  |ПОМЕСТИТЬ ВТ_ЗаказыПокупателейПоТипоразмеру
//				  |ИЗ
//				  |	РегистрНакопления.ЗаказыПокупателей.Остатки(
//				  |			,
//				  |			(НЕ ЗаказПокупателя.Транзит)
//				  |				И ЗаказПокупателя.Проверен
//				  |				И Номенклатура.Производитель = &Производитель
//				  |				И Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)
//				  |				И Номенклатура.НоменклатурнаяГруппа = &Литые) КАК ЗаказыПокупателейОстатки
//				  |
//				  |СГРУППИРОВАТЬ ПО
//				  |	ЗаказыПокупателейОстатки.Номенклатура.Типоразмер
//				  |;
//				  |
//				  |////////////////////////////////////////////////////////////////////////////////
//				  |ВЫБРАТЬ
//				  |	А.Номенклатура.Код КАК Код,
//				  |	А.Номенклатура КАК Номенклатура,
//				  |	А.Номенклатура.Типоразмер КАК Типоразмер,
//				  |	А.КоличествоПродано,
//				  |	А.КоличествоОбщее,
//				  |	А.ОстатокНаСкладах,
//				  |	А.КоличествоЗаказаноПокупателями,
//				  |	А.КоличествоВПути,
//				  |	А.КоличествоВПроизводстве,
//				  |	ВТ_ПродажиПоТипоразмеру.КоличествоОборот КАК ПроданоВТипоразмере,
//				  |	ВТ_ОстаткиПоТипоразмеру.КоличествоОстаток КАК ОстатокВТипоразмере,
//				  |	А.КоличествоЗаказать + ВЫБОР
//				  |		КОГДА А.КоличествоЗаказать = 0
//				  |				И А.КоличествоОбщее <= 40
//				  |				И А.КоличествоПродано >= 20
//				  |			ТОГДА 80
//				  |		ИНАЧЕ 0
//				  |	КОНЕЦ КАК КоличествоЗаказать,
//				  |	А.ОстатокНаСкладах - А.КоличествоЗаказаноПокупателями КАК СвободныйОстаток,
//				  |	ЕСТЬNULL(ВТ_ОстаткиПоТипоразмеру.КоличествоОстаток, 0) - ЕСТЬNULL(ВТ_ЗаказыПокупателейПоТипоразмеру.КоличествоОстаток, 0) КАК СвободныйОстатокПоТипоразмеру
//				  |ИЗ
//				  |	(ВЫБРАТЬ
//				  |		А.Номенклатура КАК Номенклатура,
//				  |		А.КоличествоПродано КАК КоличествоПродано,
//				  |		А.КоличествоОбщее КАК КоличествоОбщее,
//				  |		ВЫБОР
//				  |			КОГДА А.КоличествоОбщее >= А.КоличествоПродано
//				  |				ТОГДА 0
//				  |			КОГДА А.КоличествоПродано - А.КоличествоОбщее > 60
//				  |				ТОГДА ВЫБОР
//				  |						КОГДА А.КоличествоПродано - А.КоличествоОбщее > 80
//				  |							ТОГДА А.КоличествоПродано - А.КоличествоОбщее
//				  |						ИНАЧЕ 80
//				  |					КОНЕЦ
//				  |			КОГДА А.КоличествоПродано - А.КоличествоОбщее < 60
//				  |				ТОГДА ВЫБОР
//				  |						КОГДА А.КоличествоПродано < 300
//				  |							ТОГДА 0
//				  |						ИНАЧЕ 80
//				  |					КОНЕЦ
//				  |			ИНАЧЕ 0
//				  |		КОНЕЦ КАК КоличествоЗаказать,
//				  |		А.ОстатокНаСкладах КАК ОстатокНаСкладах,
//				  |		А.КоличествоВПути КАК КоличествоВПути,
//				  |		А.КоличествоВПроизводстве КАК КоличествоВПроизводстве,
//				  |		А.КоличествоЗаказаноПокупателями КАК КоличествоЗаказаноПокупателями
//				  |	ИЗ
//				  |		(ВЫБРАТЬ
//				  |			ПродажиОбороты.Номенклатура КАК Номенклатура,
//				  |			ПродажиОбороты.КоличествоОборот КАК КоличествоПродано,
//				  |			ЕСТЬNULL(ТоварыНаСкладахОстатки.КоличествоОстаток, 0) + ЕСТЬNULL(ЗаказыПоставщикамОстатки.КоличествоОстаток, 0) + ЕСТЬNULL(ТоварыВПроизводствеОстатки.КоличествоОстаток, 0) - ЕСТЬNULL(ЗаказыПокупателейОстатки.КоличествоОстаток, 0) КАК КоличествоОбщее,
//				  |			ЕСТЬNULL(ТоварыНаСкладахОстатки.КоличествоОстаток, 0) КАК ОстатокНаСкладах,
//				  |			ЕСТЬNULL(ЗаказыПоставщикамОстатки.КоличествоОстаток, 0) КАК КоличествоВПути,
//				  |			ЕСТЬNULL(ТоварыВПроизводствеОстатки.КоличествоОстаток, 0) КАК КоличествоВПроизводстве,
//				  |			ЕСТЬNULL(ЗаказыПокупателейОстатки.КоличествоОстаток, 0) КАК КоличествоЗаказаноПокупателями
//				  |		ИЗ
//				  |			РегистрНакопления.Продажи.Обороты(
//				  |					&НачДата,
//				  |					&КонДата,
//				  |					,
//				  |					Номенклатура.Производитель = &Производитель
//				  |						И Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)) КАК ПродажиОбороты
//				  |				ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыНаСкладах.Остатки(
//				  |						,
//				  |						(НЕ Склад.ЗапретитьИспользование)
//				  |							И (НЕ Склад.Транзитный)) КАК ТоварыНаСкладахОстатки
//				  |				ПО ПродажиОбороты.Номенклатура = ТоварыНаСкладахОстатки.Номенклатура
//				  |				ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ЗаказыПоставщикам.Остатки(, (НЕ ЗаказПоставщику.Транзит)) КАК ЗаказыПоставщикамОстатки
//				  |				ПО ПродажиОбороты.Номенклатура = ЗаказыПоставщикамОстатки.Номенклатура
//				  |				ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ЗаказыПоставщикуСезонные.Остатки(, (НЕ ЗаказПоставщикуСезонный.Транзит)) КАК ТоварыВПроизводствеОстатки
//				  |				ПО ПродажиОбороты.Номенклатура = ТоварыВПроизводствеОстатки.Номенклатура
//				  |				ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ЗаказыПокупателей.Остатки(
//				  |						,
//				  |						(НЕ ЗаказПокупателя.Транзит)
//				  |							И ЗаказПокупателя.Проверен) КАК ЗаказыПокупателейОстатки
//				  |				ПО ПродажиОбороты.Номенклатура = ЗаказыПокупателейОстатки.Номенклатура) КАК А) КАК А
//				  |		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ПродажиПоТипоразмеру КАК ВТ_ПродажиПоТипоразмеру
//				  |		ПО А.Номенклатура.Типоразмер = ВТ_ПродажиПоТипоразмеру.Типоразмер
//				  |		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ОстаткиПоТипоразмеру КАК ВТ_ОстаткиПоТипоразмеру
//				  |		ПО А.Номенклатура.Типоразмер = ВТ_ОстаткиПоТипоразмеру.Типоразмер
//				  |		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ЗаказыПокупателейПоТипоразмеру КАК ВТ_ЗаказыПокупателейПоТипоразмеру
//				  |		ПО А.Номенклатура.Типоразмер = ВТ_ЗаказыПокупателейПоТипоразмеру.Типоразмер
//				  |
//				  |УПОРЯДОЧИТЬ ПО
//				  |	Типоразмер,
//				  |	Номенклатура
//				  |АВТОУПОРЯДОЧИВАНИЕ";
КонецЕсли;
тзКолонки=новый таблицаЗначений;
тзКолонки.Колонки.Добавить("Имя");
тзКолонки.Колонки.Добавить("ТекстШапки");
тзКолонки.Колонки.Добавить("Ширина");
тзКолонки.Колонки.Добавить("Видимость");
тзКолонки.Колонки.Добавить("ТолькоПросмотр");
нСтр=тзКолонки.Добавить();
нСтр.Имя="Код";
нСтр.ТекстШапки="Код";
нСтр.Ширина=10;
нСтр.Видимость=Истина;
нСтр.ТолькоПросмотр=Истина;

нСтр=тзКолонки.Добавить();
нСтр.Имя="Номенклатура";
нСтр.ТекстШапки="Номенклатура";
нСтр.Ширина=50;
нСтр.Видимость=Истина;
нСтр.ТолькоПросмотр=Истина;

нСтр=тзКолонки.Добавить();
нСтр.Имя="Типоразмер";
нСтр.ТекстШапки="Типоразмер";
нСтр.Ширина=30;
нСтр.Видимость=Истина;
нСтр.ТолькоПросмотр=Истина;

нСтр=тзКолонки.Добавить();
нСтр.Имя="КоличествоПродано";
нСтр.ТекстШапки="Оборот";
нСтр.Ширина=10;
нСтр.Видимость=Истина;
нСтр.ТолькоПросмотр=Истина;

нСтр=тзКолонки.Добавить();
нСтр.Имя="КоличествоОбщее";
нСтр.ТекстШапки="Свободный+в пути+в производстве";
нСтр.Ширина=10;
нСтр.Видимость=Истина;
нСтр.ТолькоПросмотр=Истина;

нСтр=тзКолонки.Добавить();
нСтр.Имя="ОстатокНаСкладах";
нСтр.ТекстШапки="Остаток";
нСтр.Ширина=10;
нСтр.Видимость=Истина;
нСтр.ТолькоПросмотр=Истина;

нСтр=тзКолонки.Добавить();
нСтр.Имя="КоличествоВПути";
нСтр.ТекстШапки="В пути";
нСтр.Ширина=10;
нСтр.Видимость=Истина;
нСтр.ТолькоПросмотр=Истина;

нСтр=тзКолонки.Добавить();
нСтр.Имя="КоличествоВПроизводстве";
нСтр.ТекстШапки="В производстве";
нСтр.Ширина=10;
нСтр.Видимость=Истина;
нСтр.ТолькоПросмотр=Истина;

нСтр=тзКолонки.Добавить();
нСтр.Имя="ПроданоВТипоразмере";
нСтр.ТекстШапки="Оборот в типоразмере";
нСтр.Ширина=10;
нСтр.Видимость=Истина;
нСтр.ТолькоПросмотр=Истина;

нСтр=тзКолонки.Добавить();
нСтр.Имя="КоличествоЗаказать";
нСтр.ТекстШапки="Заказать";
нСтр.Ширина=10;
нСтр.Видимость=Истина;
нСтр.ТолькоПросмотр=Ложь;


нСтр=тзКолонки.Добавить();
нСтр.Имя="СвободныйОстаток";
нСтр.ТекстШапки="Свободный остаток";
нСтр.Ширина=10;
нСтр.Видимость=Истина;
нСтр.ТолькоПросмотр=Истина;

нСтр=тзКолонки.Добавить();
нСтр.Имя="СвободныйОстатокПоТипоразмеру";
нСтр.ТекстШапки="Свободный по типоразмеру";
нСтр.Ширина=10;
нСтр.Видимость=Истина;
нСтр.ТолькоПросмотр=Истина;

нСтр=тзКолонки.Добавить();
нСтр.Имя="КоличествоЗаказаноПокупателями";
нСтр.ТекстШапки="КоличествоЗаказаноПокупателями";
нСтр.Ширина=10;
нСтр.Видимость=Ложь;
нСтр.ТолькоПросмотр=Истина;

нСтр=тзКолонки.Добавить();
нСтр.Имя="ОстатокВТипоразмере";
нСтр.ТекстШапки="ОстатокВТипоразмере";
нСтр.Ширина=10;
нСтр.Видимость=Ложь;
нСтр.ТолькоПросмотр=Истина;

втТолькоПродажи="ВЫБРАТЬ
          |	ПродажиОбороты.Номенклатура.Типоразмер КАК Типоразмер,
          |	ПродажиОбороты.Номенклатура,
          |	ПродажиОбороты.КоличествоОборот КАК Количество
          |ПОМЕСТИТЬ втПродажи
          |ИЗ
          |	РегистрНакопления.Продажи.Обороты(
          |			&НачДата,
          |			&КонДата,
          |			,
          |			Номенклатура.Производитель = &Производитель
          |				И Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)) КАК ПродажиОбороты";
втПродажиИСправочник="ВЫБРАТЬ
                     |	НоменклатураСпр.Типоразмер КАК Типоразмер,
                     |	НоменклатураСпр.Ссылка КАК Номенклатура,
                     |	ЕСТЬNULL(ПродажиОбороты.КоличествоОборот, 0) КАК Количество
                     |ПОМЕСТИТЬ втПродажи
                     |ИЗ
                     |	Справочник.Номенклатура КАК НоменклатураСпр
                     |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.Продажи.Обороты(
                     |				&НачДата,
                     |				&КонДата,
                     |				,
                     |				Номенклатура.Производитель = &Производитель
                     |					И Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)) КАК ПродажиОбороты
                     |		ПО НоменклатураСпр.Ссылка = ПродажиОбороты.Номенклатура
                     |ГДЕ
                     |	НоменклатураСпр.Производитель = &Производитель
                     |	И НоменклатураСпр.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)";
					 

					 
ТекстЗапросаЛитые="
                  |;
                  |
                  |////////////////////////////////////////////////////////////////////////////////
                  |ВЫБРАТЬ
                  |	ТоварыНаСкладахОстатки.Номенклатура.Типоразмер КАК Типоразмер,
                  |	ТоварыНаСкладахОстатки.Номенклатура,
                  |	СУММА(ТоварыНаСкладахОстатки.КоличествоОстаток) КАК Количество
                  |ПОМЕСТИТЬ ВТ_Остатки
                  |ИЗ
                  |	РегистрНакопления.ТоварыНаСкладах.Остатки(
                  |			,
                  |			Номенклатура.Производитель = &Производитель
                  |				И (НЕ Склад.ЗапретитьИспользование)
                  |				И (НЕ Склад.Транзитный)) КАК ТоварыНаСкладахОстатки
                  |
                  |СГРУППИРОВАТЬ ПО
                  |	ТоварыНаСкладахОстатки.Номенклатура.Типоразмер,
                  |	ТоварыНаСкладахОстатки.Номенклатура
                  |;
                  |
                  |////////////////////////////////////////////////////////////////////////////////
                  |ВЫБРАТЬ
                  |	ЗаказыПокупателейОстатки.Номенклатура.Типоразмер КАК Типоразмер,
                  |	ЗаказыПокупателейОстатки.Номенклатура,
                  |	ЗаказыПокупателейОстатки.КоличествоОстаток КАК Количество
                  |ПОМЕСТИТЬ втЗаказыПокупателей
                  |ИЗ
                  |	РегистрНакопления.ЗаказыПокупателей.Остатки(
                  |			,
                  |			Номенклатура.Производитель = &Производитель
                  |				И (НЕ ЗаказПокупателя.Транзит)
                  |				И ЗаказПокупателя.Проверен) КАК ЗаказыПокупателейОстатки
                  |;
                  |
                  |////////////////////////////////////////////////////////////////////////////////
                  |ВЫБРАТЬ
                  |	ЗаказыПоставщикамОстатки.Номенклатура.Типоразмер КАК Типоразмер,
                  |	ЗаказыПоставщикамОстатки.Номенклатура,
                  |	СУММА(ЗаказыПоставщикамОстатки.КоличествоОстаток) КАК Количество,
                  |	НАЧАЛОПЕРИОДА(ЗаказыПоставщикамОстатки.ЗаказПоставщику.ДатаПоступления, ДЕНЬ) КАК Дата
                  |ПОМЕСТИТЬ втВПути
                  |ИЗ
                  |	РегистрНакопления.ЗаказыПоставщикам.Остатки(
                  |			,
                  |			Номенклатура.Производитель = &Производитель
   //транзит нужен               |				И (НЕ ЗаказПоставщику.Транзит)) КАК ЗаказыПоставщикамОстатки
    	          |				) КАК ЗаказыПоставщикамОстатки
                  |
                  |СГРУППИРОВАТЬ ПО
                  |	ЗаказыПоставщикамОстатки.Номенклатура,
                  |	ЗаказыПоставщикамОстатки.Номенклатура.Типоразмер,
                  |	НАЧАЛОПЕРИОДА(ЗаказыПоставщикамОстатки.ЗаказПоставщику.ДатаПоступления, ДЕНЬ)
                  |;
                  |
                  |////////////////////////////////////////////////////////////////////////////////
                  |ВЫБРАТЬ
                  |	НАЧАЛОПЕРИОДА(ЗаказыПоставщикамСезонныеОстатки.ЗаказПоставщикуСезонный.ДатаДействияПо, ДЕНЬ) КАК Дата,
                  |	ЗаказыПоставщикамСезонныеОстатки.Номенклатура,
                  |	ЗаказыПоставщикамСезонныеОстатки.КоличествоОстаток КАК Количество
                  |ПОМЕСТИТЬ втВПроизводстве
                  |ИЗ
                  |	РегистрНакопления.ЗаказыПоставщикамСезонные.Остатки(
                  |			,
                  |			Номенклатура.Производитель = &Производитель
                  //транзит нужен|				И (НЕ ЗаказПоставщикуСезонный.Транзит)) КАК ЗаказыПоставщикамСезонныеОстатки
				  |				И ЗаказПоставщикуСезонный.ДатаДействияПо >= &ТекДата
				  |				) КАК ЗаказыПоставщикамСезонныеОстатки
                  |ГДЕ
                  |	ЗаказыПоставщикамСезонныеОстатки.КоличествоОстаток > 0
                  |;
                  |
                  |////////////////////////////////////////////////////////////////////////////////
                  |ВЫБРАТЬ
                  |	ПродажиОбороты.Номенклатура.Типоразмер КАК Типоразмер,
                  |	СУММА(ПродажиОбороты.КоличествоОборот) КАК КоличествоОборот
                  |ПОМЕСТИТЬ ВТ_ПродажиПоТипоразмеру
                  |ИЗ
                  |	РегистрНакопления.Продажи.Обороты(
                  |			&НачДата,
                  |			&КонДата,
                  |			,
                  |			Номенклатура.Производитель = &Производитель
                  |				И Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)
                  |				И Номенклатура.НоменклатурнаяГруппа = &Литые) КАК ПродажиОбороты
                  |
                  |СГРУППИРОВАТЬ ПО
                  |	ПродажиОбороты.Номенклатура.Типоразмер
                  |;
                  |
                  |////////////////////////////////////////////////////////////////////////////////
                  |ВЫБРАТЬ
                  |	ТоварыНаСкладахОстатки.Номенклатура.Типоразмер КАК Типоразмер,
                  |	СУММА(ТоварыНаСкладахОстатки.КоличествоОстаток) КАК КоличествоОстаток
                  |ПОМЕСТИТЬ ВТ_ОстаткиПоТипоразмеру
                  |ИЗ
                  |	РегистрНакопления.ТоварыНаСкладах.Остатки(
                  |			,
                  |			Номенклатура.Производитель = &Производитель
                  |				И Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)
                  |				И Номенклатура.НоменклатурнаяГруппа = &Литые
                  |				И ((НЕ Склад.ЗапретитьИспользование)
                  |					И (НЕ Склад.Транзитный))) КАК ТоварыНаСкладахОстатки
                  |
                  |СГРУППИРОВАТЬ ПО
                  |	ТоварыНаСкладахОстатки.Номенклатура.Типоразмер
                  |;
                  |
                  |////////////////////////////////////////////////////////////////////////////////
                  |ВЫБРАТЬ
                  |	ЗаказыПокупателейОстатки.Номенклатура.Типоразмер КАК Типоразмер,
                  |	СУММА(ЗаказыПокупателейОстатки.КоличествоОстаток) КАК КоличествоОстаток
                  |ПОМЕСТИТЬ ВТ_ЗаказыПокупателейПоТипоразмеру
                  |ИЗ
                  |	РегистрНакопления.ЗаказыПокупателей.Остатки(
                  |			,
                  |			(НЕ ЗаказПокупателя.Транзит)
                  |				И ЗаказПокупателя.Проверен
                  |				И Номенклатура.Производитель = &Производитель
                  |				И Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)
                  |				И Номенклатура.НоменклатурнаяГруппа = &Литые) КАК ЗаказыПокупателейОстатки
                  |
                  |СГРУППИРОВАТЬ ПО
                  |	ЗаказыПокупателейОстатки.Номенклатура.Типоразмер
                  |;
                  |
                  |////////////////////////////////////////////////////////////////////////////////
                  |ВЫБРАТЬ
                  |	А.Номенклатура.Код КАК Код,
                  |	А.Номенклатура КАК Номенклатура,
                  |	А.Номенклатура.Типоразмер КАК Типоразмер,
                  |	А.КоличествоЗаказать + ВЫБОР
                  |		КОГДА А.КоличествоЗаказать = 0
                  |				И А.КоличествоОбщее <= 40
                  |				И А.КоличествоПродано >= 20
                  |			ТОГДА 80
                  |		ИНАЧЕ 0
                  |	КОНЕЦ КАК КоличествоЗаказать,
                  |	А.КоличествоПродано,
                  |	А.КоличествоОбщее,
                  |	А.ОстатокНаСкладах,
                  |	А.КоличествоЗаказаноПокупателями,
                  |	А.КоличествоВПути,
                  |	А.КоличествоВПроизводстве,
                  |	ВТ_ПродажиПоТипоразмеру.КоличествоОборот КАК ПроданоВТипоразмере,
                  |	ВТ_ОстаткиПоТипоразмеру.КоличествоОстаток КАК ОстатокВТипоразмере,
                  |	А.ОстатокНаСкладах - А.КоличествоЗаказаноПокупателями КАК СвободныйОстаток,
                  |	ЕСТЬNULL(ВТ_ОстаткиПоТипоразмеру.КоличествоОстаток, 0) - ЕСТЬNULL(ВТ_ЗаказыПокупателейПоТипоразмеру.КоличествоОстаток, 0) КАК СвободныйОстатокПоТипоразмеру
                  |ИЗ
                  |	(ВЫБРАТЬ
                  |		А.Номенклатура КАК Номенклатура,
                  |		А.КоличествоПродано КАК КоличествоПродано,
                  |		А.КоличествоОбщее КАК КоличествоОбщее,
                  |		ВЫБОР
                  |			КОГДА А.КоличествоОбщее >= А.КоличествоПродано
                  |				ТОГДА 0
                  |			КОГДА А.КоличествоПродано - А.КоличествоОбщее > 60
                  |				ТОГДА ВЫБОР
                  |						КОГДА А.КоличествоПродано - А.КоличествоОбщее > 80
                  |							ТОГДА А.КоличествоПродано - А.КоличествоОбщее
                  |						ИНАЧЕ 80
                  |					КОНЕЦ
                  |			КОГДА А.КоличествоПродано - А.КоличествоОбщее < 60
                  |				ТОГДА ВЫБОР
                  |						КОГДА А.КоличествоПродано < 300
                  |							ТОГДА 0
                  |						ИНАЧЕ 80
                  |					КОНЕЦ
                  |			ИНАЧЕ 0
                  |		КОНЕЦ КАК КоличествоЗаказать,
                  |		А.ОстатокНаСкладах КАК ОстатокНаСкладах,
                  |		А.КоличествоВПути КАК КоличествоВПути,
                  |		А.КоличествоВПроизводстве КАК КоличествоВПроизводстве,
                  |		А.КоличествоЗаказаноПокупателями КАК КоличествоЗаказаноПокупателями
                  |	ИЗ
                  |		(ВЫБРАТЬ
                  |			втПродажи.Номенклатура КАК Номенклатура,
                  |			втПродажи.Количество КАК КоличествоПродано,
                  |			ЕСТЬNULL(ВТ_Остатки.Количество, 0) + ЕСТЬNULL(ВложенныйЗапросВПути.Количество, 0) + ЕСТЬNULL(ВложенныйЗапросВПроизводстве.Количество, 0) - ЕСТЬNULL(втЗаказыПокупателей.Количество, 0) КАК КоличествоОбщее,
                  |			ЕСТЬNULL(ВТ_Остатки.Количество, 0) КАК ОстатокНаСкладах,
                  |			ЕСТЬNULL(ВложенныйЗапросВПути.Количество, 0) КАК КоличествоВПути,
                  |			ЕСТЬNULL(ВложенныйЗапросВПроизводстве.Количество, 0) КАК КоличествоВПроизводстве,
                  |			ЕСТЬNULL(втЗаказыПокупателей.Количество, 0) КАК КоличествоЗаказаноПокупателями
                  |		ИЗ
                  |			втПродажи КАК втПродажи
                  |				ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Остатки КАК ВТ_Остатки
                  |				ПО втПродажи.Номенклатура = ВТ_Остатки.Номенклатура
                  |				ЛЕВОЕ СОЕДИНЕНИЕ втЗаказыПокупателей КАК втЗаказыПокупателей
                  |				ПО втПродажи.Номенклатура = втЗаказыПокупателей.Номенклатура
                  |				ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
                  |					втВПроизводстве.Номенклатура КАК Номенклатура,
                  |					СУММА(втВПроизводстве.Количество) КАК Количество
                  |				ИЗ
                  |					втВПроизводстве КАК втВПроизводстве
                  |				
                  |				СГРУППИРОВАТЬ ПО
                  |					втВПроизводстве.Номенклатура) КАК ВложенныйЗапросВПроизводстве
                  |				ПО втПродажи.Номенклатура = ВложенныйЗапросВПроизводстве.Номенклатура
                  |				ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
                  |					втВПути.Типоразмер КАК Типоразмер,
                  |					втВПути.Номенклатура КАК Номенклатура,
                  |					СУММА(втВПути.Количество) КАК Количество
                  |				ИЗ
                  |					втВПути КАК втВПути
                  |				
                  |				СГРУППИРОВАТЬ ПО
                  |					втВПути.Типоразмер,
                  |					втВПути.Номенклатура) КАК ВложенныйЗапросВПути
                  |				ПО втПродажи.Номенклатура = ВложенныйЗапросВПути.Номенклатура) КАК А) КАК А
                  |		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ПродажиПоТипоразмеру КАК ВТ_ПродажиПоТипоразмеру
                  |		ПО А.Номенклатура.Типоразмер = ВТ_ПродажиПоТипоразмеру.Типоразмер
                  |		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ОстаткиПоТипоразмеру КАК ВТ_ОстаткиПоТипоразмеру
                  |		ПО А.Номенклатура.Типоразмер = ВТ_ОстаткиПоТипоразмеру.Типоразмер
                  |		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ЗаказыПокупателейПоТипоразмеру КАК ВТ_ЗаказыПокупателейПоТипоразмеру
                  |		ПО А.Номенклатура.Типоразмер = ВТ_ЗаказыПокупателейПоТипоразмеру.Типоразмер
                  |
                  |УПОРЯДОЧИТЬ ПО
                  |	Типоразмер,
                  |	Номенклатура
                  |АВТОУПОРЯДОЧИВАНИЕ";
				  
				  
ТекстЗапросаШтампованые="
                        |;
                        |
                        |////////////////////////////////////////////////////////////////////////////////
                        |ВЫБРАТЬ
                        |	ТоварыНаСкладахОстатки.Номенклатура.Типоразмер КАК Типоразмер,
                        |	ТоварыНаСкладахОстатки.Номенклатура,
                        |	СУММА(ТоварыНаСкладахОстатки.КоличествоОстаток) КАК Количество
                        |ПОМЕСТИТЬ ВТ_Остатки
                        |ИЗ
                        |	РегистрНакопления.ТоварыНаСкладах.Остатки(
                        |			,
                        |			Номенклатура.Производитель = &Производитель
                        |				И (НЕ Склад.ЗапретитьИспользование)) КАК ТоварыНаСкладахОстатки
                        |
                        |СГРУППИРОВАТЬ ПО
                        |	ТоварыНаСкладахОстатки.Номенклатура.Типоразмер,
                        |	ТоварыНаСкладахОстатки.Номенклатура
                        |;
                        |
                        |////////////////////////////////////////////////////////////////////////////////
                        |ВЫБРАТЬ
                        |	ЗаказыПокупателейОстатки.Номенклатура.Типоразмер КАК Типоразмер,
                        |	ЗаказыПокупателейОстатки.Номенклатура,
                        |	ЗаказыПокупателейОстатки.КоличествоОстаток КАК Количество
                        |ПОМЕСТИТЬ втЗаказыПокупателей
                        |ИЗ
                        |	РегистрНакопления.ЗаказыПокупателей.Остатки(
                        |			,
                        |			Номенклатура.Производитель = &Производитель
                        |				И ЗаказПокупателя.Проверен) КАК ЗаказыПокупателейОстатки
                        |;
                        |
                        |////////////////////////////////////////////////////////////////////////////////
                        |ВЫБРАТЬ
                        |	ЗаказыПоставщикамОстатки.Номенклатура.Типоразмер КАК Типоразмер,
                        |	ЗаказыПоставщикамОстатки.Номенклатура,
                        |	СУММА(ЗаказыПоставщикамОстатки.КоличествоОстаток) КАК Количество,
                        |	НАЧАЛОПЕРИОДА(ЗаказыПоставщикамОстатки.ЗаказПоставщику.ДатаПоступления, ДЕНЬ) КАК Дата
                        |ПОМЕСТИТЬ втВПути
                        |ИЗ
                        |	РегистрНакопления.ЗаказыПоставщикам.Остатки(, Номенклатура.Производитель = &Производитель) КАК ЗаказыПоставщикамОстатки
                        |
                        |СГРУППИРОВАТЬ ПО
                        |	ЗаказыПоставщикамОстатки.Номенклатура,
                        |	ЗаказыПоставщикамОстатки.Номенклатура.Типоразмер,
                        |	НАЧАЛОПЕРИОДА(ЗаказыПоставщикамОстатки.ЗаказПоставщику.ДатаПоступления, ДЕНЬ)
                        |;
                        |
                        |////////////////////////////////////////////////////////////////////////////////
                        |ВЫБРАТЬ
                        |	НАЧАЛОПЕРИОДА(ЗаказыПоставщикамСезонныеОстатки.ЗаказПоставщикуСезонный.ДатаДействияПо, ДЕНЬ) КАК Дата,
                        |	ЗаказыПоставщикамСезонныеОстатки.Номенклатура,
                        |	ЗаказыПоставщикамСезонныеОстатки.КоличествоОстаток КАК Количество,
                        |	ЗаказыПоставщикамСезонныеОстатки.Номенклатура.Типоразмер КАК Типоразмер
                        |ПОМЕСТИТЬ втВПроизводстве
                        |ИЗ
                        |	РегистрНакопления.ЗаказыПоставщикамСезонные.Остатки(, Номенклатура.Производитель = &Производитель  И ЗаказПоставщикуСезонный.ДатаДействияПо >= &ТекДата) КАК ЗаказыПоставщикамСезонныеОстатки
                        |ГДЕ
                        |	ЗаказыПоставщикамСезонныеОстатки.КоличествоОстаток > 0
                        |;
                        |
                        |////////////////////////////////////////////////////////////////////////////////
                        |ВЫБРАТЬ
                        |	ПродажиОбороты.Номенклатура.Типоразмер КАК Типоразмер,
                        |	СУММА(ПродажиОбороты.КоличествоОборот) КАК КоличествоОборот
                        |ПОМЕСТИТЬ ВТ_ПродажиПоТипоразмеру
                        |ИЗ
                        |	РегистрНакопления.Продажи.Обороты(
                        |			&НачДата,
                        |			&КонДата,
                        |			,
                        |			Номенклатура.Производитель = &Производитель
                        |				И Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)
                        |				И Номенклатура.НоменклатурнаяГруппа = &Штампованые) КАК ПродажиОбороты
                        |
                        |СГРУППИРОВАТЬ ПО
                        |	ПродажиОбороты.Номенклатура.Типоразмер
                        |;
                        |
                        |////////////////////////////////////////////////////////////////////////////////
                        |ВЫБРАТЬ
                        |	ТоварыНаСкладахОстатки.Номенклатура.Типоразмер КАК Типоразмер,
                        |	СУММА(ТоварыНаСкладахОстатки.КоличествоОстаток) КАК КоличествоОстаток
                        |ПОМЕСТИТЬ ВТ_ОстаткиПоТипоразмеру
                        |ИЗ
                        |	РегистрНакопления.ТоварыНаСкладах.Остатки(
                        |			,
                        |			Номенклатура.Производитель = &Производитель
                        |				И Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)
                        |				И Номенклатура.НоменклатурнаяГруппа = &Штампованые
                        |				И ((НЕ Склад.ЗапретитьИспользование)
                        |					И (НЕ Склад.Транзитный))) КАК ТоварыНаСкладахОстатки
                        |
                        |СГРУППИРОВАТЬ ПО
                        |	ТоварыНаСкладахОстатки.Номенклатура.Типоразмер
                        |;
                        |
                        |////////////////////////////////////////////////////////////////////////////////
                        |ВЫБРАТЬ
                        |	ЗаказыПокупателейОстатки.Номенклатура.Типоразмер КАК Типоразмер,
                        |	СУММА(ЗаказыПокупателейОстатки.КоличествоОстаток) КАК КоличествоОстаток
                        |ПОМЕСТИТЬ ВТ_ЗаказыПокупателейПоТипоразмеру
                        |ИЗ
                        |	РегистрНакопления.ЗаказыПокупателей.Остатки(
                        |			,
                        |			(НЕ ЗаказПокупателя.Транзит)
                        |				И ЗаказПокупателя.Проверен
                        |				И Номенклатура.Производитель = &Производитель
                        |				И Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)
                        |				И Номенклатура.НоменклатурнаяГруппа = &Штампованые) КАК ЗаказыПокупателейОстатки
                        |
                        |СГРУППИРОВАТЬ ПО
                        |	ЗаказыПокупателейОстатки.Номенклатура.Типоразмер
                        |;
                        |
                        |////////////////////////////////////////////////////////////////////////////////
                        |ВЫБРАТЬ
                        |	А.Номенклатура.Код КАК Код,
                        |	А.Номенклатура,
                        |	А.Номенклатура.Типоразмер КАК Типоразмер,
                        |	А.КоличествоЗаказать + ВЫБОР
                        |		КОГДА А.КоличествоЗаказать = 0
                        |				И А.КоличествоОбщее <= 40
                        |				И А.КоличествоПродано >= 20
                        |			ТОГДА 80
                        |		ИНАЧЕ 0
                        |	КОНЕЦ КАК КоличествоЗаказать,
                        |	А.КоличествоПродано,
                        |	А.КоличествоОбщее,
                        |	А.ОстатокНаСкладах,
                        |	А.КоличествоВПути,
                        |	А.КоличествоВПроизводстве,
                        |	ВТ_ПродажиПоТипоразмеру.КоличествоОборот КАК ПроданоВТипоразмере,
                        |	А.ОстатокНаСкладах - А.КоличествоЗаказаноПокупателями КАК СвободныйОстаток,
                        |	ЕСТЬNULL(ВТ_ОстаткиПоТипоразмеру.КоличествоОстаток, 0) - ЕСТЬNULL(ВТ_ЗаказыПокупателейПоТипоразмеру.КоличествоОстаток, 0) КАК СвободныйОстатокПоТипоразмеру
                        |ИЗ
                        |	(ВЫБРАТЬ
                        |		А.Номенклатура КАК Номенклатура,
                        |		А.КоличествоПродано КАК КоличествоПродано,
                        |		А.КоличествоОбщее КАК КоличествоОбщее,
                        |		ВЫБОР
                        |			КОГДА А.КоличествоОбщее >= А.КоличествоПродано
                        |				ТОГДА 0
                        |			ИНАЧЕ А.КоличествоПродано - А.КоличествоОбщее
                        |		КОНЕЦ КАК КоличествоЗаказать,
                        |		А.ОстатокНаСкладах КАК ОстатокНаСкладах,
                        |		А.КоличествоВПути КАК КоличествоВПути,
                        |		А.КоличествоВПроизводстве КАК КоличествоВПроизводстве,
                        |		А.КоличествоЗаказаноПокупателями КАК КоличествоЗаказаноПокупателями
                        |	ИЗ
                        |		(ВЫБРАТЬ
                        |			втПродажи.Номенклатура КАК Номенклатура,
                        |			втПродажи.Количество КАК КоличествоПродано,
                        |			ЕСТЬNULL(ВТ_Остатки.Количество, 0) + ЕСТЬNULL(ВложенныйЗапросВПути.Количество, 0) + ЕСТЬNULL(ВложенныйЗапросВПроизводстве.Количество, 0) - ЕСТЬNULL(втЗаказыПокупателей.Количество, 0) КАК КоличествоОбщее,
                        |			ЕСТЬNULL(ВТ_Остатки.Количество, 0) КАК ОстатокНаСкладах,
                        |			ЕСТЬNULL(ВложенныйЗапросВПути.Количество, 0) КАК КоличествоВПути,
                        |			ЕСТЬNULL(ВложенныйЗапросВПроизводстве.Количество, 0) КАК КоличествоВПроизводстве,
                        |			ЕСТЬNULL(втЗаказыПокупателей.Количество, 0) КАК КоличествоЗаказаноПокупателями
                        |		ИЗ
                        |			втПродажи КАК втПродажи
                        |				ЛЕВОЕ СОЕДИНЕНИЕ втЗаказыПокупателей КАК втЗаказыПокупателей
                        |				ПО втПродажи.Номенклатура = втЗаказыПокупателей.Номенклатура
                        |				ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Остатки КАК ВТ_Остатки
                        |				ПО втПродажи.Номенклатура = ВТ_Остатки.Номенклатура
                        |				ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
                        |					втВПути.Типоразмер КАК Типоразмер,
                        |					втВПути.Номенклатура КАК Номенклатура,
                        |					СУММА(втВПути.Количество) КАК Количество
                        |				ИЗ
                        |					втВПути КАК втВПути
                        |				
                        |				СГРУППИРОВАТЬ ПО
                        |					втВПути.Номенклатура,
                        |					втВПути.Типоразмер) КАК ВложенныйЗапросВПути
                        |				ПО втПродажи.Номенклатура = ВложенныйЗапросВПути.Номенклатура
                        |				ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
                        |					втВПроизводстве.Номенклатура КАК Номенклатура,
                        |					СУММА(втВПроизводстве.Количество) КАК Количество,
                        |					втВПроизводстве.Типоразмер КАК Типоразмер
                        |				ИЗ
                        |					втВПроизводстве КАК втВПроизводстве
                        |				
                        |				СГРУППИРОВАТЬ ПО
                        |					втВПроизводстве.Номенклатура,
                        |					втВПроизводстве.Типоразмер) КАК ВложенныйЗапросВПроизводстве
                        |				ПО втПродажи.Номенклатура = ВложенныйЗапросВПроизводстве.Номенклатура) КАК А) КАК А
                        |		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ПродажиПоТипоразмеру КАК ВТ_ПродажиПоТипоразмеру
                        |		ПО А.Номенклатура.Типоразмер = ВТ_ПродажиПоТипоразмеру.Типоразмер
                        |		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ОстаткиПоТипоразмеру КАК ВТ_ОстаткиПоТипоразмеру
                        |		ПО А.Номенклатура.Типоразмер = ВТ_ОстаткиПоТипоразмеру.Типоразмер
                        |		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ЗаказыПокупателейПоТипоразмеру КАК ВТ_ЗаказыПокупателейПоТипоразмеру
                        |		ПО А.Номенклатура.Типоразмер = ВТ_ЗаказыПокупателейПоТипоразмеру.Типоразмер";				  

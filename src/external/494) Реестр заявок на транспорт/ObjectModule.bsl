Функция Сформировать() Экспорт
	
	ТабДок = Новый ТабличныйДокумент;
	ТабДок.ОтображатьСетку = Ложь;
	Макет = ПолучитьМакет("Макет");	
	ОбластьЗаголовок = Макет.ПолучитьОбласть("Заголовок");
	ОбластьШапкаТаблицы = Макет.ПолучитьОбласть("ШапкаТаблицы");
	ОбластьСтрокаТаблицы = Макет.ПолучитьОбласть("СтрокаТаблицы");
	ОбластьСтарые = Макет.ПолучитьОбласть("Старые");
	ОбластьСегодня = Макет.ПолучитьОбласть("Сегодня");
	#Если Клиент Тогда
	ОбластьЗаголовок.Параметры.Менеджер = глТекущийПользователь; 
	#КонецЕсли
	ТабДок.Вывести(ОбластьЗаголовок);
	
	ТабДок.Вывести(ОбластьСтарые);
	
	ТабДок.Вывести(ОбластьШапкаТаблицы);

	Запрос = Новый Запрос;
	//Запрос.УстановитьПараметр("польз",глТекущийПользователь);
	Запрос.УстановитьПараметр("Статус1",Перечисления.СтатусыЗаявокНаТранспорт.Доставлен);
	Запрос.УстановитьПараметр("Статус2",Перечисления.СтатусыЗаявокНаТранспорт.Отменен);
	Запрос.УстановитьПараметр("Дата1",НачалоДня(ТекущаяДата())-24*60*60*2);
	Запрос.УстановитьПараметр("Дата2",КонецДня(ТекущаяДата())+24*60*60);
	Запрос.УстановитьПараметр("НачалоТекДня",НачалоДня(ТекущаяДата()));
	Запрос.УстановитьПараметр("КонецТекДня",КонецДня(ТекущаяДата()));
	Запрос.УстановитьПараметр("НачалоВчерашнегоДня",НачалоДня(ТекущаяДата())-24*60*60);
	Запрос.Текст = "ВЫБРАТЬ
	               |	ЗаданиеНаОтгрузкуОбратки.Ссылка,
	               |	ЗаданиеНаОтгрузкуОбратки.ДокументОснование
	               |ПОМЕСТИТЬ Врем
	               |ИЗ
	               |	Документ.ЗаданиеНаОтгрузку.Обратки КАК ЗаданиеНаОтгрузкуОбратки
	               |ГДЕ
	               |	ЗаданиеНаОтгрузкуОбратки.Ссылка.ПометкаУдаления = ЛОЖЬ
	               |	И ЗаданиеНаОтгрузкуОбратки.Ссылка.Дата МЕЖДУ &Дата1 И &Дата2
	               |	И ТИПЗНАЧЕНИЯ(ЗаданиеНаОтгрузкуОбратки.ДокументОснование) = ТИП(Документ.ЗаявкаНаТранспорт)
	               |	И ЗаданиеНаОтгрузкуОбратки.Ссылка.Выполнено = ЛОЖЬ
	               |
	               |ОБЪЕДИНИТЬ ВСЕ
	               |
	               |ВЫБРАТЬ
	               |	ЗаданиеНаОтгрузкуЗаявкиНаТранспорт.Ссылка,
	               |	ЗаданиеНаОтгрузкуЗаявкиНаТранспорт.Заявка
	               |ИЗ
	               |	Документ.ЗаданиеНаОтгрузку.ЗаявкиНаТранспорт КАК ЗаданиеНаОтгрузкуЗаявкиНаТранспорт
	               |ГДЕ
	               |	ЗаданиеНаОтгрузкуЗаявкиНаТранспорт.Ссылка.ПометкаУдаления = ЛОЖЬ
	               |	И ЗаданиеНаОтгрузкуЗаявкиНаТранспорт.Ссылка.Дата МЕЖДУ &Дата1 И &Дата2
	               |	И ЗаданиеНаОтгрузкуЗаявкиНаТранспорт.Ссылка.Выполнено = ЛОЖЬ
	               |;
	               |
	               |////////////////////////////////////////////////////////////////////////////////
	               |ВЫБРАТЬ
	               |	ЗаявкаНаТранспорт.Представление,
	               |	ЗаявкаНаТранспорт.Направление,
	               |	ЗаявкаНаТранспорт.Выполнил,
	               |	ЗаявкаНаТранспорт.ДатаДоставкиС КАК ДатаДоставкиС,
	               |	ЗаявкаНаТранспорт.ДатаДоставкиПо,
	               |	ЗаявкаНаТранспорт.ФактическаяДата,
	               |	ЗаявкаНаТранспорт.Сумма,
	               |	ЗаявкаНаТранспорт.Статус,
	               |	ВЫБОР
	               |		КОГДА Врем.Ссылка ЕСТЬ NULL 
	               |			ТОГДА ЛОЖЬ
	               |		ИНАЧЕ ИСТИНА
	               |	КОНЕЦ КАК ИдетОтгрузка,
	               |	ВЫБОР
	               |		КОГДА ЧАС(ЗаявкаНаТранспорт.Дата) > 15
	               |				И ЗаявкаНаТранспорт.Дата < &НачалоТекДня
	               |				И ЗаявкаНаТранспорт.Дата > &НачалоВчерашнегоДня
	               |			ТОГДА ИСТИНА
	               |		ИНАЧЕ ЛОЖЬ
	               |	КОНЕЦ КАК ВчераПозже15,
	               |	ВЫБОР
	               |		КОГДА ЗаявкаНаТранспорт.ДатаДоставкиПо < &НачалоТекДня
	               |			ТОГДА ИСТИНА
	               |		ИНАЧЕ ЛОЖЬ
	               |	КОНЕЦ КАК Старая,
	               |	ВЫБОР
	               |		КОГДА ДЕНЬ(&НачалоТекДня) - ДЕНЬ(ЗаявкаНаТранспорт.ДатаДоставкиПо) > 0
	               |			ТОГДА ДЕНЬ(&НачалоТекДня) - ДЕНЬ(ЗаявкаНаТранспорт.ДатаДоставкиПо)
	               |		ИНАЧЕ 0
	               |	КОНЕЦ КАК ДнеПросрочено,
	               |	ЗаявкаНаТранспорт.Ответственный КАК Менеджер,
	               |	Врем.Ссылка.ОбъемМакс КАК ОбъемМакс,
	               |	Врем.Ссылка.ДатаВыгрузкиПрямогоРейса КАК ДатаВыгрузкиПрямогоРейса,
	               |	Врем.Ссылка.Тариф КАК Тариф,
	               |	ЗаявкаНаТранспорт.Ссылка
	               |ИЗ
	               |	Документ.ЗаявкаНаТранспорт КАК ЗаявкаНаТранспорт
	               |		ЛЕВОЕ СОЕДИНЕНИЕ Врем КАК Врем
	               |		ПО ЗаявкаНаТранспорт.Ссылка = Врем.ДокументОснование
	               |ГДЕ
	               |	ЗаявкаНаТранспорт.Статус <> &Статус1
	               |	И ЗаявкаНаТранспорт.Статус <> &Статус2
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	ЗаявкаНаТранспорт.ДатаДоставкиПо";
	рез = запрос.Выполнить().Выгрузить();
	Напечатал = Ложь;
	для Каждого стр из рез цикл
		если стр.ДатаДоставкиПо >= НачалоДня(ТекущаяДата()) и не Напечатал Тогда
			ТабДок.Вывести(ОбластьСегодня);
			Напечатал = Истина;
		КонецЕсли;
		ОбластьСтрокаТаблицы.Параметры.заявка = стр.Представление + ", Маршрут:" + стр.Направление;
		ОбластьСтрокаТаблицы.Параметры.заявкассылка = стр.ссылка;
		ОбластьСтрокаТаблицы.Параметры.статус = стр.Статус;
		ОбластьСтрокаТаблицы.Параметры.логист = стр.Выполнил;
		ОбластьСтрокаТаблицы.Параметры.сумма = стр.Сумма;
		
		ОбластьСтрокаТаблицы.Параметры.СФакт = стр.Тариф;
		ОбластьСтрокаТаблицы.Параметры.ОФакт = стр.ОбъемМакс;
		ОбластьСтрокаТаблицы.Параметры.ДФакт = стр.ДатаВыгрузкиПрямогоРейса;
		
		ОбластьСтрокаТаблицы.Параметры.Дата1 = строка(Формат(стр.ДатаДоставкиС,"ДФ=dd.MM.yyyy")) + " - " + строка(Формат(стр.ДатаДоставкиПо,"ДФ=dd.MM.yyyy"));
		ОбластьСтрокаТаблицы.Параметры.Дата2 = Формат(стр.ФактическаяДата,"ДФ=dd.MM.yyyy");
		ОбластьСтрокаТаблицы.Параметры.Менеджер = стр.Менеджер;
		ОбластьСтрокаТаблицы.Параметры.Дней = стр.ДнеПросрочено;
		ОбластьОформления = ТабДок.Вывести(ОбластьСтрокаТаблицы);
		Если стр.Старая и не стр.ВчераПозже15 и не стр.ИдетОтгрузка Тогда
		    ТабДок.Область(ОбластьОформления.Верх, 2, ОбластьОформления.Низ, 12).ЦветФона = WebЦвета.Розовый;
		ИначеЕсли стр.ИдетОтгрузка Тогда
			ТабДок.Область(ОбластьОформления.Верх, 2, ОбластьОформления.Низ, 12).ЦветФона = WebЦвета.БледноСиреневый;
		КонецЕсли;
	КонецЦикла;
	
	Возврат ТабДок;
	//ТабДок.Показать();

	
КонецФункции
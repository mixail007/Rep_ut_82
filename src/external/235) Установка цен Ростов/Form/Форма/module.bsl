
Процедура КнопкаВыполнитьНажатие(Кнопка)
	
	Сообщить("Начало обработки: "+ТекущаяДата());
	//Шины
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ЦеныНоменклатурыСрезПоследних.Номенклатура,
	               |	ЦеныНоменклатурыСрезПоследних.Валюта,
	               |	ВЫБОР
	               |		КОГДА //ЦеныНоменклатурыСрезПоследних.Номенклатура.НоменклатурнаяГруппа В (&НоменклатурныеГруппы) ИЛИ
	               |				 ЦеныНоменклатурыСрезПоследних.Номенклатура.Производитель В (&ПроизводителиСНаценкой)
	               |			ТОГДА ВЫРАЗИТЬ(ЦеныНоменклатурыСрезПоследних.Цена* 1.015 КАК ЧИСЛО(7, 0))
	               |		ИНАЧЕ ЦеныНоменклатурыСрезПоследних.Цена
	               |	КОНЕЦ КАК Цена,
	               |	ЦеныНоменклатурыСрезПоследних.ЕдиницаИзмерения,
	               |	ВЫБОР
	               |		КОГДА ЦеныНоменклатурыСрезПоследних.ТипЦен = &КрупныйЯШТ
	               |			ТОГДА &КрупныйРостов
	               |		ИНАЧЕ ВЫБОР
	               |				КОГДА ЦеныНоменклатурыСрезПоследних.ТипЦен = &СреднийЯШТ
	               |					ТОГДА &СреднийРостов
	               |				ИНАЧЕ &МелкийРостов
	               |			КОНЕЦ
	               |	КОНЕЦ КАК ТипЦен
	               |ИЗ
	               |	РегистрСведений.ЦеныНоменклатуры.СрезПоследних(
	               |			&Период,
	               |			Номенклатура В ИЕРАРХИИ (&ШиныДиски)
				   |			И Не Номенклатура.Производитель = &НКШЗ
	               |				И Номенклатура В
	               |					(ВЫБРАТЬ
	               |						ТоварыНаСкладахОстатки.Номенклатура
	               |					ИЗ
	               |						РегистрНакопления.ТоварыНаСкладах.Остатки(&Период, Склад.Подразделение = &ПодразделениеРостова И Номенклатура.Производитель В (&ПроизводителиСНаценкой)
	               |							И Номенклатура В ИЕРАРХИИ (&ШиныДиски)) КАК ТоварыНаСкладахОстатки
	               |					ГДЕ
	               |						ТоварыНаСкладахОстатки.КоличествоОстаток > 0)
	               |				И (НЕ Номенклатура В
	               |						(ВЫБРАТЬ
	               |							ЦеныНоменклатуры.Номенклатура
	               |						ИЗ
	               |							РегистрСведений.ЦеныНоменклатуры КАК ЦеныНоменклатуры
	               |						ГДЕ
	               |							ЦеныНоменклатуры.Период = &ПериодНачалоДня
	               |							И ЦеныНоменклатуры.Номенклатура В ИЕРАРХИИ (&ШиныДиски)
	               |							И ЦеныНоменклатуры.ТипЦен В (&ТипЦенРостов)))
	               |				И ТипЦен В (&ТипЦенЯШТ)) КАК ЦеныНоменклатурыСрезПоследних";
								   
	НоменклатурныеГруппы    = Новый СписокЗначений;			   
	ПроизводителиСНаценкой  = Новый СписокЗначений;
	ШиныДиски               = Новый СписокЗначений;
	ТипЦенЯШТ               = Новый СписокЗначений;
	ТипЦенРостов            = Новый СписокЗначений;
	/////////////////////////
	НоменклатурныеГруппы.Добавить(Справочники.НоменклатурныеГруппы.НайтиПоКоду("00016")); //Импорт зима
	//НоменклатурныеГруппы.Добавить(Справочники.НоменклатурныеГруппы.НайтиПоКоду("00017")); //Импорт лето
	
	
	/////////////////////////
	ПроизводителиСНаценкой.Добавить(Справочники.Производители.НайтиПоКоду("23")); //Белая Церковь
	ПроизводителиСНаценкой.Добавить(Справочники.Производители.НайтиПоКоду("67")); //Бобруйск
	ПроизводителиСНаценкой.Добавить(Справочники.Производители.НайтиПоКоду("44")); //ЯШЗ
	ПроизводителиСНаценкой.Добавить(Справочники.Производители.НайтиПоКоду("33")); //КШЗ
	
	
	/////////////////////////
	ШиныДиски.Добавить(Справочники.Номенклатура.НайтиПоКоду("0001746")); //Шины
	ШиныДиски.Добавить(Справочники.Номенклатура.НайтиПоКоду("0001752")); //Диски
	
	
	/////////////////////////
	ТипЦенЯШТ.Добавить(Справочники.ТипыЦенНоменклатуры.НайтиПоКоду("00005")); //Крупный опт
	ТипЦенЯШТ.Добавить(Справочники.ТипыЦенНоменклатуры.НайтиПоКоду("00002")); //Средний опт
	ТипЦенЯШТ.Добавить(Справочники.ТипыЦенНоменклатуры.НайтиПоКоду("00004")); //Мелкий опт
	
	
	/////////////////////////
	ТипЦенРостов.Добавить(Справочники.ТипыЦенНоменклатуры.НайтиПоКоду("00015")); //Крупный опт Ростов
	ТипЦенРостов.Добавить(Справочники.ТипыЦенНоменклатуры.НайтиПоКоду("00016")); //Средний опт Ростов
	ТипЦенРостов.Добавить(Справочники.ТипыЦенНоменклатуры.НайтиПоКоду("00017")); //Мелкий опт Ростов
	
	
	/////////////////////////
	Запрос.УстановитьПараметр("Период", ТекущаяДата()); 
	Запрос.УстановитьПараметр("ПериодНачалоДня", НачалоДня(ТекущаяДата()));
	Запрос.УстановитьПараметр("НоменклатурныеГруппы", НоменклатурныеГруппы);
	Запрос.УстановитьПараметр("ПроизводителиСНаценкой", ПроизводителиСНаценкой);
	Запрос.УстановитьПараметр("ШиныДиски", ШиныДиски);
	Запрос.УстановитьПараметр("ТипЦенЯШТ", ТипЦенЯШТ);
	Запрос.УстановитьПараметр("ТипЦенРостов", ТипЦенРостов);
	Запрос.УстановитьПараметр("ПодразделениеРостова", Справочники.Подразделения.НайтиПоКоду("00106"));
	Запрос.УстановитьПараметр("КрупныйЯШТ", Справочники.ТипыЦенНоменклатуры.НайтиПоКоду("00005"));
	Запрос.УстановитьПараметр("СреднийЯШТ", Справочники.ТипыЦенНоменклатуры.НайтиПоКоду("00002"));
	Запрос.УстановитьПараметр("КрупныйРостов", Справочники.ТипыЦенНоменклатуры.НайтиПоКоду("00015"));
	Запрос.УстановитьПараметр("СреднийРостов", Справочники.ТипыЦенНоменклатуры.НайтиПоКоду("00016"));
	Запрос.УстановитьПараметр("МелкийРостов", Справочники.ТипыЦенНоменклатуры.НайтиПоКоду("00017"));
	
	Запрос.УстановитьПараметр("НКШЗ", Справочники.Производители.НайтиПоКоду("39"));  // НкШЗ
	
	ТЗРезультат  = Запрос.Выполнить().Выгрузить();
	
	Если ТЗРезультат.Количество() > 0 Тогда
		
		НовыйДок = Документы.УстановкаЦенНоменклатуры.СоздатьДокумент();
		
		НовыйДок.Дата = ТекущаяДата();
		
		Для Каждого ТипЦены Из ТипЦенРостов Цикл
			Стр = НовыйДок.ТипыЦен.Добавить();
			Стр.ТипЦен = ТипЦены.Значение;
		КонецЦикла;
		
		НовыйДок.Товары.Загрузить(ТЗРезультат);
		
		НовыйДок.Комментарий = "Документ создан автоматически для Ростова на Дону";
		НовыйДок.Записать(РежимЗаписиДокумента.Проведение);
		
		Сообщить("Создан документ "+Строка(НовыйДок.Ссылка));
		
	Иначе
		
		Сообщить("На текущую дату нет данных для установки цен. Документ не сформирован.");
		
	КонецЕсли;
	
	Сообщить("Конец обработки: "+ТекущаяДата());
	
КонецПроцедуры

//https://infostart.ru/public/337631/
 
//вспомогательные функции
Функция ByteToDec(знч16) 
	Если знч16 = "0" Тогда
		Возврат 0;
	ИначеЕсли знч16 = "1" Тогда
		Возврат 1;
	ИначеЕсли знч16 = "2" Тогда
		Возврат 2;
	ИначеЕсли знч16 = "3" Тогда
		Возврат 3;
	ИначеЕсли знч16 = "4" Тогда
		Возврат 4;
	ИначеЕсли знч16 = "5" Тогда
		Возврат 5;
	ИначеЕсли знч16 = "6" Тогда
		Возврат 6;
	ИначеЕсли знч16 = "7" Тогда
		Возврат 7;
	ИначеЕсли знч16 = "8" Тогда
		Возврат 8;
	ИначеЕсли знч16 = "9" Тогда
		Возврат 9;
	ИначеЕсли знч16 = "A" Тогда
		Возврат 10;
	ИначеЕсли знч16 = "B" Тогда
		Возврат 11;
	ИначеЕсли знч16 = "C" Тогда
		Возврат 12;
	ИначеЕсли знч16 = "D" Тогда
		Возврат 13;
	ИначеЕсли знч16 = "E" Тогда
		Возврат 14;
	ИначеЕсли знч16 = "F" Тогда
		Возврат 15;
	Иначе
		Возврат 0;
	КонецЕсли;
КонецФункции

Функция HexToDec(знч16) 
	знч10 = 0;
	длн = СтрДлина(знч16);
	Для й = 1 По СтрДлина(знч16) Цикл
		знч10 = знч10 + Pow(16, длн - й) * ByteToDec(Сред(знч16, й, 1));
	КонецЦикла;
	Возврат знч10;
КонецФункции

//------------основная функция расчета даты по UID--------------------
Функция ПолучитьМоментСозданияУникальногоИдентификатора(УИ)
	
	Если стрДлина(УИ)<18 тогда                   //5b34fad2-cf03-11e4-adf5-c488bb62e7c5
		сообщить("Неверный формат Уникального идентификатора! UID должен иметь длину 36 символов (не менее 18), например: 5b34fad2-cf03-11e4-adf5-c488bb62e7c5", СтатусСообщения.Внимание);
		возврат '00010101';
	КонецЕсли;
    УИ = СокрЛП(ВРег(СтрЗаменить("" + УИ, "-", "")));
	
	Если Не Сред(УИ, 13, 1) = "1" Тогда
		Возврат '00010101';
	КонецЕсли;
	интервал16 = ВРег(Сред(УИ, 14, 3) + Сред(УИ, 9, 4) + Сред(УИ, 1, 8));
	интервал10 = HexToDec(интервал16);
	интервалСек = интервал10 / 10000000;
	
	ЭлементыФормы.Надпись3.Заголовок = "Внутри секунды: 0,"+формат(  1000000*(интервалСек - цел(интервалСек)),"ЧЦ=7; ЧДЦ=1; ЧВН=; ЧГ=3,0" )+" Сек." ;
	
	Результат = Дата(1582, 10, 15) + интервалСек + ЧасПояс*3600;
	
	Возврат Результат ;
	
КонецФункции

Функция ПолучитьМоментСозданияСсылки() 
	
	Если ПолеВвода1=неопределено или ПолеВвода1.пустая() тогда 
		УИ = ПолеВвода3;
	Иначе	
		УИ = "" + ПолеВвода1.УникальныйИдентификатор();
		ПолеВвода3 = УИ;
	КонецЕсли;
	
	Если СокрЛП(УИ)="" тогда
		Результат = "01.01.0001 0:00:00";	
    Иначе
		Результат = ПолучитьМоментСозданияУникальногоИдентификатора(УИ);
	КонецЕсли;

	Возврат Результат;
	
КонецФункции


//////////////интерфейсные функции формы/////////////////////////////////////////////////////////

Процедура КнопкаВыполнитьНажатие(Кнопка)
	рез = ПолучитьМоментСозданияСсылки();
	ПолеВвода2  = Дата(рез);
КонецПроцедуры

Процедура ПриОткрытии()
	ЧасПояс = 3;   //+3 GMT  - Москва ( +4 до ноября 2014г.)
КонецПроцедуры

Процедура ЧасПоясПриИзменении(Элемент)
	Если ПолеВвода2<>'00010101' тогда // пересчет
		КнопкаВыполнитьНажатие(неопределено);
	КонецЕсли;
КонецПроцедуры

Процедура ПолеВвода1ПриИзменении(Элемент)
	
     ПолеВвода3 = ""; ПолеВвода2='00010101';
	 
	//автопересчет
	 КнопкаВыполнитьНажатие(неопределено); 

КонецПроцедуры

Процедура ПолеВвода3ПриИзменении(Элемент)
	//автопересчет
	 КнопкаВыполнитьНажатие(неопределено); 

КонецПроцедуры



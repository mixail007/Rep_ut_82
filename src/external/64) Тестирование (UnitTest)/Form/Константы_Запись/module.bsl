Функция СоздатьСтруктуру()
	Тест = Новый Структура;
	Тест.Вставить("Описание", ЭлементыФормы.ПТДОписание.ПолучитьТекст());
	Тест.Вставить("Константы", тпКонстанты);
	Тест.Вставить("Параметры", Параметры);
	Тест.Вставить("ФормаРедактирования", "Константы_Запись");
	Возврат Тест;
КонецФункции

Процедура ЗаполнитьИзСтруктуры(Тест) Экспорт
	Если Тест.Свойство("Описание") Тогда
		ЭлементыФормы.ПТДОписание.УстановитьТекст(Тест.Описание);
	КонецЕсли;
	
	Если Тест.Свойство("Константы") Тогда
		тпКонстанты = Тест.Константы;
	КонецЕсли;
	
	Если Тест.Свойство("Параметры") Тогда
		Параметры = Тест.Параметры;
	КонецЕсли;
	
КонецПроцедуры

Процедура КнопкаВыполнитьНажатие(Кнопка)
	// Вставить содержимое обработчика.
	СтруктураТеста = СоздатьСтруктуру();
	Если МодальныйРежим Тогда 
		Закрыть(СтруктураТеста);
	Иначе
		СтрокаТеста.Описание = СтруктураТеста.Описание;
		СтрокаТеста.Тест = ЗначениеВСтрокуВнутр(СтруктураТеста);
		Закрыть(СтруктураТеста);
	КонецЕсли;
КонецПроцедуры

Процедура ПриОткрытии()
	// Вставить содержимое обработчика.
	Если тпКонстанты.Количество() = 0 Тогда
		Для Каждого Константа Из Метаданные.Константы Цикл
			НоваяСтрока = тпКонстанты.Добавить();
			НоваяСтрока.Имя = Константа.Имя;
			НоваяСтрока.Константа = ?(ПустаяСтрока(Константа.Синоним),Константа.Имя, Константа.Синоним);
			НоваяСтрока.Описание = Константа.Комментарий;
			НоваяСтрока.Значение = Константы[Константа.Имя].Получить();
		КонецЦикла;
	КонецЕсли;
КонецПроцедуры

Процедура тпКонстантыВычислятьПриИзменении(Элемент)
	// Вставить содержимое обработчика.
	ТекСтрока = ЭлементыФормы.тпКонстанты.ТекущиеДанные;

	Если Элемент.Значение Тогда
		ТекСтрока.Значение = Строка(ТекСтрока.Значение);
	Иначе
		ТекСтрока.Значение = Константы[ТекСтрока.Имя].Получить();
	КонецЕсли;
	
КонецПроцедуры


Процедура тпКонстантыЗначениеНачалоВыбора(Элемент, СтандартнаяОбработка)
	// Вставить содержимое обработчика.
	ТекущиеДанные = ЭлементыФормы.тпКонстанты.ТекущиеДанные;
	Если ТекущиеДанные = Неопределено ИЛИ Элемент = Неопределено Тогда
		Возврат;
	КонецЕсли;
	Если ТекущиеДанные.Вычислять Тогда
		СтандартнаяОбработка = Ложь;
		Элемент.Значение = Строка(Элемент.Значение);
		Форма = ПолучитьФорму("Другое_ФормаВвода");
		Форма.Параметры = Параметры;
		Форма.ПараметрыТестов = ПараметрыТестов;
		Если Форма.Открыта() Тогда
			Форма.Закрыть();
		КонецЕсли;
		Описание = ПолучитьМакет("Макет_ВырожениеЗначения").ПолучитьТекст();
		Форма.ЭлементыФормы.Описание.УстановитьТекст(Описание);
		Форма.ЭлементыФормы.Код.УстановитьТекст(Элемент.Значение);
		Результат = Форма.ОткрытьМодально();
		Если Результат <> Неопределено Тогда
			Элемент.Значение = Результат;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

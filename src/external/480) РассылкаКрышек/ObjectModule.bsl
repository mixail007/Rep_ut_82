Функция Печать() Экспорт
	
	//Если Не Метаданные.Имя = "УправлениеТорговлей" Тогда
	//	Сообщить("Печатная форма предназначена для использования в конфигурации ""Управление торговлей""", СтатусСообщения.Внимание);
	//КонецЕсли;
	
	Возврат ПечатьРеализации();
	
КонецФункции // Печать


Функция ПечатьРеализации() Экспорт
	Если ТЗ.Колонки.Количество() = 0 тогда
		ТЗ = СсылкаНаОбъект.Товары.Выгрузить();
		ТЗ.Свернуть("Номенклатура","Количество");
	КонецЕсли;
	
	Запрос=Новый Запрос;
	Запрос.МенеджерВременныхТаблиц=Новый МенеджерВременныхТаблиц;
	Запрос.УстановитьПараметр("ТЗ", ТЗ);
	Запрос.УстановитьПараметр("Ссылка", СсылкаНаОбъект);
	Запрос.УстановитьПараметр("Крышки", Справочники.Номенклатура.НайтиПоКоду("0080004"));
	СписокПроизводителей = Новый СписокЗначений;
	СписокПроизводителей.Добавить(Справочники.Производители.НайтиПоКоду("3333"));
	СписокПроизводителей.Добавить(Справочники.Производители.НайтиПоКоду("3400"));
	Запрос.УстановитьПараметр("СписокПроизводителей", СписокПроизводителей);
	
	тип = СсылкаНаОбъект.Метаданные().Имя;
	Запрос.Текст= "ВЫБРАТЬ
	              |	ТЗ.Номенклатура,
	              |	ТЗ.Количество
	              |ПОМЕСТИТЬ Заказано
	              |ИЗ
	              |	&ТЗ КАК ТЗ
	              |;
	              |
	              |////////////////////////////////////////////////////////////////////////////////
	              |ВЫБРАТЬ
	              |	ЗаказыПокупателейОстатки.Номенклатура КАК Номенклатура,
	              |	ЗаказыПокупателейОстатки.Количество КАК КоличествоЗаказано,
	              |	КомплектующиеНоменклатуры.Комплектующая.Код КАК Код,
	              |	КомплектующиеНоменклатуры.Комплектующая КАК Комплектующая,
	              |	КомплектующиеНоменклатуры.Комплектующая.КодСБИС КАК КомплектующаяКодСБИС,
	              |	ЕСТЬNULL(ТоварыНаСкладахОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток
	              |ПОМЕСТИТЬ А
	              |ИЗ
	              |	Справочник.Номенклатура КАК СпрНоменклатура
	              |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Заказано КАК ЗаказыПокупателейОстатки
	              |			ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
	              |				КомплектующиеНоменклатуры.Номенклатура КАК Номенклатура,
	              |				КомплектующиеНоменклатуры.Комплектующая КАК Комплектующая
	              |			ИЗ
	              |				РегистрСведений.КомплектующиеНоменклатуры КАК КомплектующиеНоменклатуры
	              |			ГДЕ
	              |				КомплектующиеНоменклатуры.Номенклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)
	              |				И КомплектующиеНоменклатуры.Комплектующая В ИЕРАРХИИ(&Крышки)) КАК КомплектующиеНоменклатуры
	              |				ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыНаСкладах.Остатки(, ) КАК ТоварыНаСкладахОстатки
	              |				ПО КомплектующиеНоменклатуры.Комплектующая = ТоварыНаСкладахОстатки.Номенклатура
	              |			ПО ЗаказыПокупателейОстатки.Номенклатура = КомплектующиеНоменклатуры.Номенклатура
	              |		ПО СпрНоменклатура.Ссылка = ЗаказыПокупателейОстатки.Номенклатура
	              |ГДЕ
	              |	СпрНоменклатура.ВидТовара = ЗНАЧЕНИЕ(Перечисление.ВидыТоваров.Диски)
	              |;
	              |
	              |////////////////////////////////////////////////////////////////////////////////
	              |ВЫБРАТЬ РАЗЛИЧНЫЕ
	              |	А.Номенклатура,
	              |	А.Комплектующая КАК Комплектующая,
	              |	А.Комплектующая.Код КАК Код,
	              |	А.Комплектующая.КодСБИС КАК КодСБИС,
	              |	СУММА(А.КоличествоЗаказано) КАК Количество,
	              |	МАКСИМУМ(А.КоличествоОстаток) КАК Остаток
	              |ПОМЕСТИТЬ ВТ_ТаблицаКомплектующихПоНоменклатуре
	              |ИЗ
	              |	А КАК А
	              |
	              |СГРУППИРОВАТЬ ПО
	              |	А.Номенклатура,
	              |	А.Комплектующая,
	              |	А.Комплектующая.Код,
	              |	А.Комплектующая.КодСБИС
	              |;
	              |
	              |////////////////////////////////////////////////////////////////////////////////
	              |ВЫБРАТЬ РАЗЛИЧНЫЕ ПЕРВЫЕ 1000
	              |	ВТ_ТаблицаКомплектующихПоНоменклатуре.Комплектующая КАК Номенклатура,
	              |	ВТ_ТаблицаКомплектующихПоНоменклатуре.Комплектующая.Код КАК Код,
	              |	ВТ_ТаблицаКомплектующихПоНоменклатуре.Комплектующая.КодСБИС КАК КодСБИС,
	              |	СУММА(ВТ_ТаблицаКомплектующихПоНоменклатуре.Количество) КАК Количество,
	              |	МАКСИМУМ(ВТ_ТаблицаКомплектующихПоНоменклатуре.Остаток) КАК Остаток,
	              |	ЛОЖЬ КАК ОрнаментКолпаков
	              |ПОМЕСТИТЬ ВТ_ТаблицаКрышек
	              |ИЗ
	              |	ВТ_ТаблицаКомплектующихПоНоменклатуре КАК ВТ_ТаблицаКомплектующихПоНоменклатуре
	              |ГДЕ
	              |	НЕ ВТ_ТаблицаКомплектующихПоНоменклатуре.Комплектующая ЕСТЬ NULL 
	              |
	              |СГРУППИРОВАТЬ ПО
	              |	ВТ_ТаблицаКомплектующихПоНоменклатуре.Комплектующая,
	              |	ВТ_ТаблицаКомплектующихПоНоменклатуре.Комплектующая.Код,
	              |	ВТ_ТаблицаКомплектующихПоНоменклатуре.Комплектующая.КодСБИС
	              |
	              |ОБЪЕДИНИТЬ ВСЕ
	              |
	              |ВЫБРАТЬ
	              |	ЗаказПокупателяКрышки.Крышка,
	              |	ЗаказПокупателяКрышки.Крышка.Код,
	              |	ЗаказПокупателяКрышки.Крышка.КодСБИС,
	              |	ЗаказПокупателяКрышки.Количество,
	              |	ЕСТЬNULL(ТоварыНаСкладахОстатки.КоличествоОстаток, 0),
	              |	ИСТИНА
	              |ИЗ
	              |	Документ.ЗаказПокупателя.Крышки КАК ЗаказПокупателяКрышки
	              |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыНаСкладах.Остатки КАК ТоварыНаСкладахОстатки
	              |		ПО ЗаказПокупателяКрышки.Крышка = ТоварыНаСкладахОстатки.Номенклатура
	              |ГДЕ
	              |	ЗаказПокупателяКрышки.Ссылка = &Ссылка
	              |
	              |УПОРЯДОЧИТЬ ПО
	              |	КодСБИС
	              |;
	              |
	              |////////////////////////////////////////////////////////////////////////////////
	              |ВЫБРАТЬ
	              |	СУММА(ЗаказыПокупателейОстатки.КоличествоОстаток) КАК КоличествоОстаток
	              |ПОМЕСТИТЬ вт_ОстаткиПоЗаказу
	              |ИЗ
	              |	РегистрНакопления.ЗаказыПокупателей.Остатки(, ЗаказПокупателя = &Ссылка) КАК ЗаказыПокупателейОстатки
	              |;
	              |
	              |////////////////////////////////////////////////////////////////////////////////
	              |ВЫБРАТЬ РАЗЛИЧНЫЕ
	              |	ВТ_ТаблицаКомплектующихПоНоменклатуре.Номенклатура,
	              |	СУММА(ВТ_ТаблицаКомплектующихПоНоменклатуре.Количество) КАК Количество,
	              |	МАКСИМУМ(ВТ_ТаблицаКомплектующихПоНоменклатуре.Остаток) КАК Остаток
	              |ПОМЕСТИТЬ ВТ_ТаблицаДисковБезПривязкиКрышек
	              |ИЗ
	              |	ВТ_ТаблицаКомплектующихПоНоменклатуре КАК ВТ_ТаблицаКомплектующихПоНоменклатуре
	              |ГДЕ
	              |	ВТ_ТаблицаКомплектующихПоНоменклатуре.Комплектующая ЕСТЬ NULL 
	              |
	              |СГРУППИРОВАТЬ ПО
	              |	ВТ_ТаблицаКомплектующихПоНоменклатуре.Номенклатура
	              |;
	              |
	              |////////////////////////////////////////////////////////////////////////////////
	              |ВЫБРАТЬ РАЗЛИЧНЫЕ
	              |	ВТ_ТаблицаКомплектующихПоНоменклатуре.Комплектующая КАК Комплектующая,
	              |	СУММА(ВТ_ТаблицаКомплектующихПоНоменклатуре.Количество) КАК Количество,
	              |	ВТ_ТаблицаКомплектующихПоНоменклатуре.Комплектующая.Код КАК Код,
	              |	ВТ_ТаблицаКомплектующихПоНоменклатуре.Комплектующая.КодСБИС КАК КодСБИС,
	              |	ВТ_ТаблицаКомплектующихПоНоменклатуре.Номенклатура КАК Номенклатура,
	              |	МАКСИМУМ(ВТ_ТаблицаКомплектующихПоНоменклатуре.Остаток) КАК Остаток
	              |ИЗ
	              |	ВТ_ТаблицаКомплектующихПоНоменклатуре КАК ВТ_ТаблицаКомплектующихПоНоменклатуре
	              |ГДЕ
	              |	НЕ ВТ_ТаблицаКомплектующихПоНоменклатуре.Комплектующая ЕСТЬ NULL 
	              |
	              |СГРУППИРОВАТЬ ПО
	              |	ВТ_ТаблицаКомплектующихПоНоменклатуре.Номенклатура,
	              |	ВТ_ТаблицаКомплектующихПоНоменклатуре.Комплектующая,
	              |	ВТ_ТаблицаКомплектующихПоНоменклатуре.Комплектующая.Код,
	              |	ВТ_ТаблицаКомплектующихПоНоменклатуре.Комплектующая.КодСБИС
	              |
	              |УПОРЯДОЧИТЬ ПО
	              |	КодСБИС
	              |ИТОГИ
	              |	СУММА(Количество)
	              |ПО
	              |	Комплектующая";
	
	Результат=Запрос.Выполнить();
	//ТаблицаДисковПоАлфавиту=Результат.Выгрузить();
	
	//ТаблицаДисковПоАлфавиту.Сортировать("НоменклатураНаименование");
	
	ВыборкаДискиПоКрышкам=Результат.Выбрать();
	
	ЗапросКрышки=Новый Запрос;
	ЗапросКрышки.МенеджерВременныхТаблиц=Запрос.МенеджерВременныхТаблиц;
	ЗапросКрышки.Текст="ВЫБРАТЬ * ИЗ ВТ_ТаблицаКрышек";
	ТаблицаКрышки=ЗапросКрышки.Выполнить().Выгрузить();
	
	ЗапросОрнаменты=Новый Запрос;
	ЗапросОрнаменты.МенеджерВременныхТаблиц=Запрос.МенеджерВременныхТаблиц;
	ЗапросОрнаменты.Текст="ВЫБРАТЬ * ИЗ ВТ_ТаблицаКрышек ГДЕ ОрнаментКолпаков = истина";
	ТаблицаОрнаменты=ЗапросОрнаменты.Выполнить().Выгрузить();
	//ТаблицаКрышки.ВыбратьСтроку();
	
	ЗапросДискиБезКрышек=Новый Запрос;
	ЗапросДискиБезКрышек.МенеджерВременныхТаблиц=Запрос.МенеджерВременныхТаблиц;
	ЗапросДискиБезКрышек.Текст="ВЫБРАТЬ * ИЗ ВТ_ТаблицаДисковБезПривязкиКрышек";
	ТаблицаДискиБезКрышек=ЗапросДискиБезКрышек.Выполнить().Выгрузить();
	
	ЗапросОстаткиПоЗаказу=Новый Запрос;
	ЗапросОстаткиПоЗаказу.МенеджерВременныхТаблиц=Запрос.МенеджерВременныхТаблиц;
	ЗапросОстаткиПоЗаказу.Текст="ВЫБРАТЬ * ИЗ ВТ_ОстаткиПоЗаказу";
	ТаблицаЗапросОстаткиПоЗаказу=ЗапросОстаткиПоЗаказу.Выполнить().Выгрузить();
	
	//ТаблицаДискиБезКрышек.ВыбратьСтроку();
	Если тип="ЗаказПокупателя" тогда
		ДопЗаголовок=?(ЗначениеЗаполнено(ссылкаНаОбъект.ДатаГотовностиНаборки),Символы.ПС+"Подготовить к "+ссылкаНаОбъект.ДатаГотовностиНаборки+", отнести "+ссылкаНаОбъект.КудаНестиКрышки+" "+?(ссылкаНаОбъект.КудаНестиКрышки="к менеджеру",ссылкаНаОбъект.ДоговорКонтрагента.ОтветственноеЛицо,""),"");
	Иначе
		ДопЗаголовок="";
	КонецЕсли;	
	
	ТабДок=Новый ТабличныйДокумент;
	ТабДок.Очистить();
	
	Макет = ПолучитьМакет("ОтчетРеализация");
	Если Полн Тогда
		ОбластьКомм= Макет.ПолучитьОбласть("Комментарий");
		ОбластьКомм.Параметры.Комм=ссылкаНаОбъект.Комментарий;
		ТабДок.Вывести(ОбластьКомм);
		ОбластьДатаОтгрузки= Макет.ПолучитьОбласть("ДатаОтгрузки");
		ОбластьТекДата= Макет.ПолучитьОбласть("ТекДата");
		ОбластьДатаОтгрузки.Параметры.ДатаОтгрузки=ссылкаНаОбъект.ДатаОтгрузки;
		
		Попытка
			ОбластьТекДата.Параметры.ТекДата = ""+ТекущаяДата()+" кр: "+СсылкаНаОбъект.Крышки.Количество()+" ост.: "+?(ТаблицаЗапросОстаткиПоЗаказу.Количество()>0,ТаблицаЗапросОстаткиПоЗаказу[0].КоличествоОстаток,0);
			ТабДок.Вывести(ОбластьТекДата);
		Исключение
		КонецПопытки;
		
		ТабДок.Вывести(ОбластьДатаОтгрузки);
		ТабДок.Вывести(ОбластьТекДата);
		
		ОбластьЗаголовок= Макет.ПолучитьОбласть("Заголовок");
		
		ОбластьЗаголовок.Параметры.ЗаголовокДокумента="Заказ покупателя №" +  ссылкаНаОбъект.Номер +" от "+Формат(ссылкаНаОбъект.Дата,"ДФ=dd.MM.yyyy") +". Покупатель: "+ссылкаНаОбъект.Контрагент.Наименование+ДопЗаголовок;
		ОбластьШапка= Макет.ПолучитьОбласть("Шапка");
		ОбластьПодвалТаблицы = Макет.ПолучитьОбласть("ПодвалТаблицы");
		ТабДок.Вывести(ОбластьЗаголовок);
		
		ТабДок.Вывести(ОбластьШапка);
		ОбщееКоличество=0;   ОбщийОстаток = 0;
		Для каждого ВыборкаДетали ИЗ ТаблицаКрышки  Цикл
			ОбластьДетальныхЗаписей = Макет.ПолучитьОбласть("Детали");
			ОбластьДетальныхЗаписей.Параметры.Заполнить(ВыборкаДетали);
			ОбщееКоличество=ОбщееКоличество+ВыборкаДетали.КОличество;
			ОбщийОстаток   =ОбщийОстаток + ВыборкаДетали.Остаток;
			ТабДок.Вывести(ОбластьДетальныхЗаписей);
		КонецЦикла;
		ОбластьПодвалТаблицы.Параметры.Количество=ОбщееКоличество;
		ОбластьПодвалТаблицы.Параметры.Остаток   =ОбщийОстаток;//+++
		ТабДок.Вывести(ОбластьПодвалТаблицы);
	КонецЕсли;
	
	// Выводим дважды
	Если Полн Тогда	
		ч = 2;
	Иначе
		ч = 1;
	КонецЕсли;	
	
	Для сч=1 по ч Цикл
		ТабДок.ВывестиГоризонтальныйРазделительСтраниц();	
		ОбластьЗаголовок= Макет.ПолучитьОбласть("ЗаголовокДиски");	
		ОбластьЗаголовок.Параметры.ЗаголовокДискиБезПривязки="Диски в привязке к крышкам";
		ОбластьЗаголовок.Параметры.ЗаголовокДокумента="Заказ покупателя №" +  ссылкаНаОбъект.Номер +" от "+Формат(ссылкаНаОбъект.Дата,"ДФ=dd.MM.yyyy") +". Покупатель: "+ссылкаНаОбъект.Контрагент.Наименование+ДопЗаголовок;
		ТабДок.Вывести(ОбластьЗаголовок);
		
		ОбластьШапка1= Макет.ПолучитьОбласть("Шапка1");
		ОбластьПодвалТаблицы1 = Макет.ПолучитьОбласть("ПодвалТаблицы1");
		ОбластьТекДата = Макет.ПолучитьОбласть("ТекДата");
		ТабДок.Вывести(ОбластьШапка1);
		ОбщееКоличество=0;   ОбщийОстаток = 0;
		
		
		//выведем орнаменты
		Для каждого ВыборкаДетали ИЗ ТаблицаОрнаменты  Цикл
			ОбластьДетальныхЗаписей = Макет.ПолучитьОбласть("Детали1");
			ОбластьДетальныхЗаписей.Параметры.Заполнить(ВыборкаДетали);
			ОбщееКоличество=ОбщееКоличество+ВыборкаДетали.КОличество;
			//ОбщийОстаток   =ОбщийОстаток + ВыборкаДетали.Остаток;
			ТабДок.Вывести(ОбластьДетальныхЗаписей);
		КонецЦикла;
		
		ВыборкаДискиПоКрышкам.Сбросить(); 
		
		Пока ВыборкаДискиПоКрышкам.Следующий() Цикл
			// выводим только детальные записи
			Если ВыборкаДискиПоКрышкам.ТипЗаписи()=ТипЗаписиЗапроса.ДетальнаяЗапись Тогда
				ОбластьДетальныхЗаписей = Макет.ПолучитьОбласть("ДеталиДиски1");
				
				ОбластьДетальныхЗаписей.Параметры.Заполнить(ВыборкаДискиПоКрышкам);
				ОбластьДетальныхЗаписей.Параметры.Код=ВыборкаДискиПоКрышкам.Номенклатура.Код;
				ОбластьДетальныхЗаписей.Параметры.Номенклатура=ВыборкаДискиПоКрышкам.Номенклатура.Наименование;
				
				ОбщееКоличество=ОбщееКоличество+ВыборкаДискиПоКрышкам.КОличество;
				
				ТабДок.Вывести(ОбластьДетальныхЗаписей);
			Иначе
				ОбластьДетальныхЗаписей = Макет.ПолучитьОбласть("Детали1");
				ОбластьДетальныхЗаписей.Параметры.Номенклатура=ВыборкаДискиПоКрышкам.Комплектующая;
				ОбластьДетальныхЗаписей.Параметры.КодСБИС=ВыборкаДискиПоКрышкам.Комплектующая.КодСБИС;
				ОбластьДетальныхЗаписей.Параметры.Код=ВыборкаДискиПоКрышкам.Комплектующая.Код;
				ОбластьДетальныхЗаписей.Параметры.Количество=ВыборкаДискиПоКрышкам.Количество;
				ТабДок.Вывести(ОбластьДетальныхЗаписей);
			КонецЕсли;
		КонецЦикла;
		
		//Для каждого СтрокаДиск ИЗ  ТаблицаДисковПоАлфавиту Цикл
		//	Если ЗначениеЗаполнено(СтрокаДиск.Номенклатура) Тогда
		//	ОбластьДетальныхЗаписей = Макет.ПолучитьОбласть("Детали1");
		//	ОбластьДетальныхЗаписей.Параметры.Заполнить(СтрокаДиск);
		//	ОбщееКоличество=ОбщееКоличество+СтрокаДиск.КОличество;
		//	
		//	ТабДок.Вывести(ОбластьДетальныхЗаписей);
		//	КонецЕсли;
		//КонецЦикла;	
		
		ОбластьПодвалТаблицы1.Параметры.Количество  = ОбщееКоличество;
		//ОбластьПодвалТаблицы.Параметры.Остаток     =ОбщийОстаток;//+++
		ТабДок.Вывести(ОбластьПодвалТаблицы1);
		
	КонецЦикла; 
	
	// Диски без привязки к крышкам
	
	Если ТаблицаДискиБезКрышек.Количество()>0 Тогда
		ОбластьЗаголовок= Макет.ПолучитьОбласть("ЗаголовокДиски");	
		ОбластьЗаголовок.Параметры.ЗаголовокДискиБезПривязки="Диски без привязки";
		
		ТабДок.Вывести(ОбластьЗаголовок);
		Для каждого Выборка ИЗ ТаблицаДискиБезКрышек Цикл
			ОбластьДетальныхЗаписей = Макет.ПолучитьОбласть("ДеталиДиски");
			ОбластьДетальныхЗаписей.Параметры.Заполнить(Выборка);
			ОбластьДетальныхЗаписей.Параметры.Код=Выборка.Номенклатура.Код;
			ОбластьДетальныхЗаписей.Параметры.Количество=Выборка.Количество;
			ТабДок.Вывести(ОбластьДетальныхЗаписей);
		КонецЦикла;	
		
	КонецЕсли;
	
	Попытка
		ОбластьТекДата.Параметры.ТекДата = ""+ТекущаяДата()+" кр: "+СсылкаНаОбъект.Крышки.Количество()+" ост.: "+?(ТаблицаЗапросОстаткиПоЗаказу.Количество()>0,ТаблицаЗапросОстаткиПоЗаказу[0].КоличествоОстаток,0);
		ТабДок.Вывести(ОбластьТекДата);
	Исключение
	КонецПопытки;
	
	
	ТабДок.ВерхнийКолонтитул.Выводить=Истина;
	ТабДок.ВерхнийКолонтитул.ТекстВЦентре ="[&НомерСтраницы]";
	Возврат ТабДок;
КонецФункции
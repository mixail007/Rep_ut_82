
Процедура КнопкаВыполнитьНажатие(Кнопка)
	
	Если ВыборДокумента Тогда
		
		Если ЗначениеНеЗаполнено(ЭлементыФормы.ВыборДокумента.Значение) Тогда
		
			Предупреждение("Необходимо указать документ!", 5);
			Возврат;
		
		КонецЕсли; 
		
	Иначе
		
		ЕстьВыбранныйТип = Ложь;
		Для каждого СтрокаСписка Из ВидыДокументов Цикл
			
			Если СтрокаСписка.Пометка Тогда
			
				ЕстьВыбранныйТип = Истина;
				Прервать;
				
			КонецЕсли; 	
		
		КонецЦикла; 
		
		Если НЕ ЕстьВыбранныйТип Тогда
		
			Предупреждение("Необходимо указать хотя бы один тип документ!", 5);
			Возврат;
		
		КонецЕсли;
		
		Если ЗначениеНеЗаполнено(НачПериода) ИЛИ ЗначениеНеЗаполнено(КонПериода) Тогда
			
			Предупреждение("Необходимо указать период выборки типов документов!", 5);
			Возврат;
			
		КонецЕсли; 
	
	
	КонецЕсли; 
	
	Если НЕ ВыборРолей Тогда
		
		Если ЗначениеНеЗаполнено(ЭлементыФормы.Пользователь.Значение) Тогда
		
			Предупреждение("Необходимо указать пользователя!", 5);
			Возврат;
		
		КонецЕсли; 
		
	Иначе
		
		ЕстьВыбраннаяРоль = Ложь;
		
		Для каждого СтрокаСписка Из РолиПользователя Цикл
			
			Если СтрокаСписка.Пометка Тогда
			
				ЕстьВыбраннаяРоль = Истина;
				Прервать;
			
			КонецЕсли; 	
		
		КонецЦикла; 
		
		Если НЕ ЕстьВыбраннаяРоль Тогда
		
			Предупреждение("Необходимо указать хотя бы одну роль пользователя!", 5);
			Возврат;
		
		КонецЕсли; 
	
	
	КонецЕсли; 
	
	Если ЗначениеНеЗаполнено(Срок) Тогда
	
		Предупреждение("Необходимо указать срок действия!", 5);
		Возврат;
		
	КонецЕсли; 
	
	Закрыть(Истина);
	
КонецПроцедуры

Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	Если НастройкаПериода.Редактировать() Тогда
		НачПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
КонецПроцедуры

Процедура ЗаполнитьРоли()

	
	Для каждого Роль Из Метаданные.Роли Цикл
	
		РолиПользователя.Добавить(Роль.Имя,,Ложь);	
	
	КонецЦикла; 
	

КонецПроцедуры

Процедура ЗаполнитьВидыДокументов()

	
	Для каждого Док Из Метаданные.Документы Цикл
	
		ВидыДокументов.Добавить(Док.Имя,,Ложь);	
	
	КонецЦикла; 
	

КонецПроцедуры

 
Процедура УстановитьСтраницы()

	Если ВыборРолей Тогда
	
		ЭлементыФормы.Панель2.ТекущаяСтраница = ЭлементыФормы.Панель2.Страницы.ВыборВидаПользователя;
		
	Иначе
		
		ЭлементыФормы.Панель2.ТекущаяСтраница = ЭлементыФормы.Панель2.Страницы.ВыборПользователя;
	
	КонецЕсли;	
	
	Если ВыборДокумента Тогда
	
		ЭлементыФормы.Панель1.ТекущаяСтраница = ЭлементыФормы.Панель1.Страницы.ВыборДокумента;
		
	Иначе
		
		ЭлементыФормы.Панель1.ТекущаяСтраница = ЭлементыФормы.Панель1.Страницы.ВыборВидаДокумента;
	
	КонецЕсли;	


КонецПроцедуры
 

Процедура ПриОткрытии()
	
	СписокСроков = Новый СписокЗначений;
	СписокСроков.Добавить("1 час");
	СписокСроков.Добавить("3 часа");
	СписокСроков.Добавить("6 часов");
	СписокСроков.Добавить("12 часов");
	СписокСроков.Добавить("24 часа");
	СписокСроков.Добавить("48 часов");
	
	ЭлементыФормы.ПолеВыбора1.СписокВыбора.ЗагрузитьЗначения(СписокСроков.ВыгрузитьЗначения());
	ЭлементыФормы.ПолеВыбора1.Значение = ЭлементыФормы.ПолеВыбора1.СписокВыбора.НайтиПоЗначению(СписокСроков[0].Значение).Значение;
	
	ПолеВыбора1ПриИзменении(ЭлементыФормы.ПолеВыбора1);
	
	ЗаполнитьРоли();
	
	ЗаполнитьВидыДокументов();
	
	УстановитьСтраницы();
	
КонецПроцедуры

Процедура ПолеВыбора1ПриИзменении(Элемент)
	
	Часов = СтрЗаменить(ЭлементыФормы.ПолеВыбора1.Значение, "час", "");
	Часов = СтрЗаменить(Часов, "а", "");
	Часов = СокрЛП(СтрЗаменить(Часов, "ов", ""));
	
	Срок = Число(Часов);
	
КонецПроцедуры

Процедура ОбновлениеОтображения()
	
	Если ТипЗнч(ЭлементыФормы.ВыборДокумента.Значение) = Тип("Неопределено") Тогда
	
		ЭлементыФормы.НадписьВыбораДокумента.Заголовок = "Выберите тип документа";
		
	Иначе
		
		ЭлементыФормы.НадписьВыбораДокумента.Заголовок = "Выберите: " + СокрЛП(СтрЗаменить(ТипЗнч(ЭлементыФормы.ВыборДокумента.Значение), "Документ ссылка:", ""));
	
	КонецЕсли; 
	
КонецПроцедуры



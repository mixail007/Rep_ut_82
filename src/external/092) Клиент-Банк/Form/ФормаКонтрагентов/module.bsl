Процедура КнопкаВыполнитьНажатие(Элемент)
	
	Если Организация.Пустая() Тогда
		Сообщить("Не выбрана организация", СтатусСообщения.Внимание);
		Возврат;
	КонецЕсли;
	
	МассивСтрок=Новый Массив;
		
	Если ДеревоКонтрагентов.Строки.Количество()=1 Тогда
				
		Если НЕ СоздатьКонтрагента(ДеревоКонтрагентов.Строки[0].Представление, , Организация, НЕ МодальныйРежим).Пустая() Тогда
			Закрыть();
		КонецЕсли;
		
	Иначе
		
		Для Каждого Строка Из ДеревоКонтрагентов.Строки Цикл
			
			Если Строка.Пометка Тогда
				
				Если НЕ СоздатьКонтрагента(Строка.Представление, , Организация).Пустая() Тогда
					
					МассивСтрок.Добавить(Строка);

				КонецЕсли;							
				
			КонецЕсли;
			
		КонецЦикла;
		
	КонецЕсли;
	
	Для Каждого Строка ИЗ МассивСтрок Цикл
		
		ДеревоКонтрагентов.Строки.Удалить(Строка);
		
	КонецЦикла;
					
КонецПроцедуры

Процедура ПриОткрытии()
	
	Если СписокКонтрагентов <> Неопределено Тогда
		СписокНенайденных();
	Иначе
		ЭлементыФормы.ОсновныеДействияФормы.Кнопки.Действие.Доступность=Ложь;
	КонецЕсли;
	
	Если СписокКонтрагентов.Количество()>1 Тогда
		ЭлементыФормы.ОсновныеДействияФормы.Кнопки.Действие.Текст="Создать контрагентов";
		ЭлементыФормы.КоманднаяПанель2.Видимость=Истина;
	Иначе
		ЭлементыФормы.ОсновныеДействияФормы.Кнопки.Действие.Текст="Создать контрагента";
		ЭлементыФормы.КоманднаяПанель2.Видимость=Ложь;
	КонецЕсли;
			
	ЭлементыФормы.ДеревоКонтрагентов.Колонки["Представление"].ДанныеФлажка = "Пометка";
	ЭлементыФормы.ДеревоКонтрагентов.ТолькоПросмотр=Ложь;
	ЭлементыФормы.ДеревоКонтрагентов.Значение = ТаблицаКонтрагентов;
			
КонецПроцедуры

Процедура ДеревоКонтрагентовПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	
	Если ТаблицаКонтрагентов.Строки.Количество()<2 Тогда
		
	    ОформлениеСтроки.Ячейки.Представление.ОтображатьФлажок= Ложь;
		Возврат;
		
	КонецЕсли;
	
	Если ДанныеСтроки.Родитель=Неопределено Тогда
		
		ОформлениеСтроки.Ячейки.Представление.ОтображатьФлажок=Истина;
		
	Иначе
		
		ОформлениеСтроки.Ячейки.Представление.ОтображатьФлажок= Ложь;
		
	КонецЕсли;
	
КонецПроцедуры

Процедура КоманднаяПанель2УстановитьВсе(Кнопка)
	
	Для Каждого Строка Из ДеревоКонтрагентов.Строки Цикл
		Строка.Пометка=Истина;
	КонецЦикла;
	
КонецПроцедуры

Процедура КоманднаяПанель2СнятьВсеПометки(Кнопка)
	 
Для Каждого Строка Из ДеревоКонтрагентов.Строки Цикл
		Строка.Пометка=Ложь;
	КонецЦикла;
	
КонецПроцедуры







Процедура ПриОткрытии()
	// Вставить содержимое обработчика.
		ТекДата=НачалоДня(ТекущаяДата());
	Компоновщик = ЭтотОбъект.КомпоновщикНастроек;
НачПериода=Компоновщик.Настройки.ПараметрыДанных.НайтиЗначениеПараметра( Новый ПараметрКомпоновкиДанных("НачалоПериода") );
НачПериода.Значение=НачалоДня("20140101");
НачПериода.Использование=Истина;

КонПериода=Компоновщик.Настройки.ПараметрыДанных.НайтиЗначениеПараметра( Новый ПараметрКомпоновкиДанных("КонецПериода") );
КонПериода.Значение=НачалоГода(ТекДата)-1;
КонПериода.Использование=Истина;

НачДата = НачПериода.Значение;
КонДата= КонПериода.Значение;

ПараметрыВывода= Компоновщик.Настройки.ПараметрыВывода;
ПараметрыВывода.Элементы.Найти("Title").Использование=Истина;
ПараметрыВывода.Элементы.Найти("Title").Значение="Анализ  затрат по отношению к прибыли за " +ПредставлениеПериода(НачПериода.Значение, КонПериода.Значение, "ФП = Истина");

СписокПодр=Компоновщик.Настройки.ПараметрыДанных.НайтиЗначениеПараметра( Новый ПараметрКомпоновкиДанных("СписокПодразделение") );
спис = новый СписокЗначений;
спис.Добавить( справочники.Подразделения.НайтиПоКоду("00106") ); //РнД
спис.Добавить( справочники.Подразделения.НайтиПоКоду("00112") ); //СПб
спис.Добавить( справочники.Подразделения.НайтиПоКоду("00138") ); //Ект
спис.Добавить( справочники.Подразделения.НайтиПоКоду("00139") );   //ИМ
СписокПодр.Значение = спис;
КонецПроцедуры

Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.УстановитьПериод(НачДата, ?(КонДата='0001-01-01', КонДата, КонецДня(КонДата)));
	Если НастройкаПериода.Редактировать() Тогда
		НачДата = НастройкаПериода.ПолучитьДатуНачала();
		КонДата = НастройкаПериода.ПолучитьДатуОкончания();
	КонецЕсли;
	ОбновитьДатыКомпоновщика ();
	КонецПроцедуры

Процедура НачДатаПриИзменении(Элемент)
	ОбновитьДатыКомпоновщика ();
КонецПроцедуры

Процедура КонДатаПриИзменении(Элемент)
	ОбновитьДатыКомпоновщика ();

КонецПроцедуры

Процедура ОбновитьДатыКомпоновщика ()
	
	Компоновщик = ЭтотОбъект.КомпоновщикНастроек;

	НачПериода=Компоновщик.Настройки.ПараметрыДанных.НайтиЗначениеПараметра( Новый ПараметрКомпоновкиДанных("НачалоПериода") );
	КонПериода=Компоновщик.Настройки.ПараметрыДанных.НайтиЗначениеПараметра( Новый ПараметрКомпоновкиДанных("КонецПериода") );
	
	НачПериода.Значение=НачДата;
	КонПериода.Значение=КонецДня(КонДата);	

	ПараметрыВывода= Компоновщик.Настройки.ПараметрыВывода;
	ПараметрыВывода.Элементы.Найти("Title").Использование=Истина;
	ПараметрыВывода.Элементы.Найти("Title").Значение="Анализ  затрат по отношению к прибыли за " +ПредставлениеПериода(НачПериода.Значение, КонПериода.Значение, "ФП = Истина");
	
КонецПроцедуры

Процедура НачДатаРегулирование(Элемент, Направление, СтандартнаяОбработка)
	СтандартнаяОбработка = ЛОЖЬ;
	Элемент.Значение = ДобавитьМесяц(Элемент.Значение, Направление*12);
	ОбновитьДатыКомпоновщика();
КонецПроцедуры

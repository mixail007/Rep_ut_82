&НаКлиенте
Перем МестныйКэш Экспорт;
// функции для совместимости кода 
&НаКлиенте
Функция сбисПолучитьФорму(ИмяФормы)
	Если ТипЗнч(ЭтаФорма) = Тип("УправляемаяФорма") Тогда
		Попытка
			ЭтотОбъект="";
		Исключение
		КонецПопытки;
		Возврат ПолучитьФорму("ВнешняяОбработка.СБИС.Форма."+ИмяФормы);
	КонецЕсли;
	Возврат ЭтотОбъект.ПолучитьФорму(ИмяФормы);
КонецФункции
&НаКлиенте
Функция сбисЭлементФормы(Форма,ИмяЭлемента)
	Если ТипЗнч(ЭтаФорма) = Тип("УправляемаяФорма") Тогда
		Возврат Форма.Элементы[ИмяЭлемента];
	КонецЕсли;
	Возврат Форма.ЭлементыФормы[ИмяЭлемента];
КонецФункции
&НаКлиенте
Функция сбисПолучитьСтраницу(Элемент, ИмяСтраницы)
	Если ТипЗнч(ЭтаФорма) = Тип("УправляемаяФорма") Тогда
		Возврат Элемент.ПодчиненныеЭлементы[ИмяСтраницы];
	КонецЕсли;
	Возврат Элемент.Страницы[ИмяСтраницы];
КонецФункции
//------------------------------------------------------
&НаКлиенте
Процедура ПриОткрытии()
// Процедура заполняет реквизиты формы из сохраненных настроек	
	МестныйКэш = ЭтаФорма.ВладелецФормы.Кэш;
	СпособОбмена = МестныйКэш.Парам.СпособОбмена;
	КаталогОбмена = МестныйКэш.Парам.КаталогОбмена;
	
	ТекущееЗначениеНастроек = МестныйКэш.Парам.ТипПрокси;
		
	Если ТекущееЗначениеНастроек = Неопределено или ТекущееЗначениеНастроек = "НеИспользовать" Тогда
		ТипПрокси = "НеИспользовать";
	ИначеЕсли ТекущееЗначениеНастроек = "Вручную" Тогда;
		ПроксиСервер = МестныйКэш.Парам.ПроксиСервер;
		ПроксиПорт   = МестныйКэш.Парам.ПроксиПорт; 
		ПроксиЛогин  = МестныйКэш.Парам.ПроксиЛогин;  
		ПроксиПароль = МестныйКэш.Парам.ПроксиПароль;  
		ТипПрокси="Вручную";
	Иначе
		ТипПрокси="Автоматически";
	КонецЕсли;	
	ОбновитьДоступностьНастроек();
КонецПроцедуры
&НаКлиенте
Процедура НастройкиПроксиСервераПриИзменении(Элемент)
// Процедура устанавливает видимость элементов формы в зависимости от выбранного варианта настроек прокси	
	ОбновитьДоступностьНастроек();
КонецПроцедуры
&НаКлиенте
Процедура СохранитьНажатие(Элемент)
// Процедура записывает выбранные настройки в сохраняемые параметры и закрывает форму	
	Если СпособОбмена = 1 и Не ЗначениеЗаполнено(КаталогОбмена) Тогда
		Предупреждение("Заполните каталог обмена документами");
		Возврат;
	КонецЕсли;
	МестныйКэш.Парам.СпособОбмена = СпособОбмена;
	МестныйКэш.Парам.КаталогОбмена = КаталогОбмена;
	Если ТипПрокси = "Вручную" Тогда
		МестныйКэш.Парам.Вставить("ТипПрокси","Вручную");
		МестныйКэш.Парам.Вставить("ПроксиСервер",ПроксиСервер);
		МестныйКэш.Парам.Вставить("ПроксиПорт",ПроксиПорт );
		МестныйКэш.Парам.Вставить("ПроксиЛогин",ПроксиЛогин);
		МестныйКэш.Парам.Вставить("ПроксиПароль",ПроксиПароль);
	ИначеЕсли ТипПрокси = "Автоматически" Тогда
		МестныйКэш.Парам.Вставить("ТипПрокси","Автоматически");
	Иначе
		МестныйКэш.Парам.Вставить("ТипПрокси","НеИспользовать");
	КонецЕсли;
	ЭтаФорма.Закрыть(СпособОбмена);
КонецПроцедуры
&НаКлиенте
Процедура СпособОбменаПриИзменении(Элемент)
	сбисЭлементФормы(ЭтаФорма, "КаталогОбмена").Видимость = СпособОбмена=1;
	Если СпособОбмена = 1 и Не ЗначениеЗаполнено(КаталогОбмена) Тогда
		КаталогОбменаНачалоВыбора(сбисЭлементФормы(ЭтаФорма, "КаталогОбмена"),"", Истина);
	КонецЕсли;
КонецПроцедуры
&НаКлиенте
Процедура КаталогОбменаНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
// открывает диалог выбора каталога обмена	
	ДиалогОткрытия = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.ВыборКаталога); 
	ДиалогОткрытия.Заголовок = "Выберите каталог обмена документами"; 
	Если ДиалогОткрытия.Выбрать() Тогда 
		КаталогОбмена = ДиалогОткрытия.Каталог; 
	КонецЕсли;
КонецПроцедуры
//////////////////////////////////////////////////////////////////////////////////

////////////////////// Обычное приложение/////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////                                             
Процедура ОбновитьДоступностьНастроек()
// Процедура устанавливает видимость элементов формы в зависимости от выбранного варианта настроек прокси		
	Если ТипПрокси="Вручную" Тогда
		сбисЭлементФормы(ЭтаФорма, "ПроксиСервер").Доступность  = Истина;
		сбисЭлементФормы(ЭтаФорма, "ПроксиПорт").Доступность    = Истина;
		сбисЭлементФормы(ЭтаФорма, "ПроксиЛогин").Доступность   = Истина;
		сбисЭлементФормы(ЭтаФорма, "ПроксиПароль").Доступность  = Истина;
		сбисЭлементФормы(ЭтаФорма, "НадписьСервер").Доступность = Истина;
		сбисЭлементФормы(ЭтаФорма, "НадписьПорт").Доступность   = Истина;
		сбисЭлементФормы(ЭтаФорма, "НадписьЛогин").Доступность  = Истина;
		сбисЭлементФормы(ЭтаФорма, "НадписьПароль").Доступность = Истина;
	    Если МестныйКэш.Парам.Свойство("ПроксиСервер") и СокрЛП(МестныйКэш.Парам.ПроксиСервер)<>"" Тогда
			ПроксиСервер = МестныйКэш.Парам.ПроксиСервер;
		КонецЕсли;	 
		
	Иначе
		сбисЭлементФормы(ЭтаФорма, "ПроксиСервер").Доступность  = Ложь;
		сбисЭлементФормы(ЭтаФорма, "ПроксиПорт").Доступность    = Ложь;
		сбисЭлементФормы(ЭтаФорма, "ПроксиЛогин").Доступность   = Ложь;
		сбисЭлементФормы(ЭтаФорма, "ПроксиПароль").Доступность  = Ложь;
		сбисЭлементФормы(ЭтаФорма, "НадписьСервер").Доступность = Ложь;
		сбисЭлементФормы(ЭтаФорма, "НадписьПорт").Доступность   = Ложь;
		сбисЭлементФормы(ЭтаФорма, "НадписьЛогин").Доступность  = Ложь;
		сбисЭлементФормы(ЭтаФорма, "НадписьПароль").Доступность = Ложь;
	КонецЕсли;	
	сбисЭлементФормы(ЭтаФорма, "КаталогОбмена").Видимость = СпособОбмена=1;
КонецПроцедуры
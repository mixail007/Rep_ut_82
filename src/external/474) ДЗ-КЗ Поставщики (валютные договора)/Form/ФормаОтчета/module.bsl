
Процедура ДействияФормыОтчетПоКлиенту(Кнопка)
	
	ЭлементыФормы.Результат.Очистить();
	табДок = неопределено;
	
	табДок = Печать( Клиент1.УникальныйИдентификатор(), Период, ЭлементыФормы.Результат );
	//табДок.Показать();
	
	путь = КаталогВременныхФайлов();
	
	ИмяФайлаСообщения = сокрЛП(Клиент1.УникальныйИдентификатор())+".htm";
	ИмяФайлаСообщения = СтрЗаменить(ИмяФайлаСообщения, "-","");
	
	Если Вопрос("Записать файл "+ИмяФайлаСообщения+" на сайт YST.RU?",РежимДиалогаВопрос.ДаНет,0) = КодВозвратаДиалога.Да тогда
	
		Состояние(строка(ТекущаяДата())+" Идет запись во временный файл: "+путь+ИмяФайлаСообщения);
		 элементыФормы.Результат.Записать(путь+ИмяФайлаСообщения,ТипФайлаТабличногоДокумента.HTML);
		 
		 ВыгрузитьНаFTP(ЭлементыФормы.Результат, ИмяФайлаСообщения);
		 
		 Сообщить(строка(ТекущаяДата())+" - Файл: "+ИмяФайлаСообщения+" - успешно выгружен на сайт.", СтатусСообщения.Информация);
		Сообщить("Прямая cсылка для скачивания:   http://www.yst.ru/data/"+ИмяФайлаСообщения, СтатусСообщения.Информация);
	КонецЕсли;
	

КонецПроцедуры

Процедура Клиент1ПриИзменении(Элемент)
	
	элОтбора1 = Новый ПолеКомпоновкиДанных("Контрагент");

	N = ЭтотОбъект.КомпоновщикНастроек.Настройки.Отбор.Элементы.Количество();
	НеНашлиЭл1 = Истина;
	для i=0 по N-1 цикл
		эл1 = ЭтотОбъект.КомпоновщикНастроек.Настройки.Отбор.Элементы[i];
		Если эл1.ЛевоеЗначение = элОтбора1 Тогда
			эл1.Использование = не Клиент1.Пустая(); //включаем если есть клиент, и ВЫключаем, если нет!
			эл1.ПравоеЗначение = Клиент1;
		    НеНашлиЭл1 = Ложь;
			Прервать;
		КонецЕсли;
	КонецЦикла;

	Если НеНашлиЭл1 Тогда //добавляем новое поле отбора!
		эл1 = ЭтотОбъект.КомпоновщикНастроек.Настройки.Отбор.Элементы.Вставить(0, Тип("ЭлементОтбораКомпоновкиДанных"));
		эл1.ЛевоеЗначение = элОтбора1;
		эл1.ВидСравнения  = ВидСравненияКомпоновкиДанных.Равно;
		эл1.Использование = не Клиент1.Пустая();
		эл1.ПравоеЗначение = Клиент1;
	КонецЕсли;	

КонецПроцедуры

Процедура ПриОткрытии()
	
	если РольДоступна("ДополнительныеПраваВЭД") тогда
		
		ПоЭкспорту = истина;
		
		
		Период = ТекущаяДата();
		ПараметрСКД = КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("ВЕД");
		ПараметрСКД.Использование = Истина;
		ПараметрСКД.Значение  = ПоЭкспорту;
		
		
	иначе 
		
		ПоЭкспорту = Ложь;
		
		
		Период = ТекущаяДата();
		ПараметрСКД = КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("ВЕД");
		ПараметрСКД.Использование = Истина;
		ПараметрСКД.Значение  = ПоЭкспорту;
		
	КонецЕсли;
   
КонецПроцедуры

Процедура ЭкспортПриИзменении(Элемент)
   ПараметрСКД = КомпоновщикНастроек.Настройки.ПараметрыДанных.Элементы.Найти("ВЕД");
   ПараметрСКД.Использование = Истина;
   ПараметрСКД.Значение  = ПоЭкспорту;

КонецПроцедуры

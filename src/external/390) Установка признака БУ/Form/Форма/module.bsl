
Процедура КнопкаВыполнитьНажатие(Кнопка)
	Ответ = Вопрос("Установить признак БУ для выбранных документов?",РежимДиалогаВопрос.ДаНет);
	Если Ответ = КодВозвратаДиалога.Да Тогда
	Если ЭлементыФормы.Панель1.ТекущаяСтраница.Имя = "Реализация" Тогда
		Для каждого стр из СписокДокументы Цикл
		Если стр.Отметка Тогда	
		 Объект = стр.ДокРеализация.ПолучитьОбъект();
		 Объект.ОтражатьВБухгалтерскомУчете = Истина;
		 Объект.ОтражатьВНалоговомУчете = Истина;
		 Объект.Записать();
		 Отказ= Ложь;
	     ЗарегистрироватьОбъект(Объект,Ложь,Истина,Истина);
		 //Если НЕ Отказ Тогда
		 //обЗаписатьПротоколИзменений(ЭтотОбъект);
		 //КонецЕсли; 
		 Стр.ОтражатьБУ = Истина;
		 Стр.ОтражатьНУ = Истина;
		конецЕсли; 
	 КонецЦикла;
    Иначе
	Для каждого стр из СписокПеремещения Цикл
	Если стр.Отметка Тогда			
		 Объект = стр.ДокПеремещение.ПолучитьОбъект();
		 Объект.ОтражатьВБухгалтерскомУчете = Истина;
		 Объект.ОтражатьВНалоговомУчете = Истина;
		 Объект.Записать();
		 Стр.ОтражатьБУ = Истина;
		 Стр.ОтражатьНУ = Истина;
	конецЕсли;	 
	 КонецЦикла;
    КонецЕсли; 
   конецЕсли;
	КонецПроцедуры
	
Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	Если НастройкаПериода.Редактировать() Тогда
		НачПериода = НастройкаПериода.ПолучитьДатуНачала();
		КонПериода = НастройкаПериода.ПолучитьДатуОкончания();
		ДатаЗапретаСп =  ПараметрыСеанса.ГраницыЗапретаИзмененияДанных.Получить();
		ДатаЗапрета = ДатаЗапретаСп.Получить(Справочники.Организации.НайтиПоКоду("00001")) ;
		 Если НачПериода < ДатаЗапрета Тогда         
			 НачПериода=ДатаЗапрета;
		конецЕсли;	
	КонецЕсли;
КонецПроцедуры

Процедура КоманднаяПанель1Заполнить(Кнопка)
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	РеализацияТоваровУслуг.Ссылка КАК ДокРеализация,
		|	РеализацияТоваровУслуг.Номер,
		|	РеализацияТоваровУслуг.Дата,
		|	РеализацияТоваровУслуг.Организация,
		|	РеализацияТоваровУслуг.ОтражатьВУправленческомУчете КАК ОтражатьУТ,
		|	РеализацияТоваровУслуг.ОтражатьВБухгалтерскомУчете КАК ОтражатьБУ,
		|	РеализацияТоваровУслуг.ОтражатьВНалоговомУчете КАК ОтражатьНУ,
		|	РеализацияТоваровУслуг.Подразделение,
		|	РеализацияТоваровУслуг.ДоговорКонтрагента КАК Договор,
		|	РеализацияТоваровУслуг.Контрагент,
		|	РеализацияТоваровУслуг.СуммаДокумента,
		|	РеализацияТоваровУслуг.Комментарий,
		|	РеализацияТоваровУслуг.Проверен
		|ИЗ
		|	Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
		|ГДЕ
		|	РеализацияТоваровУслуг.Дата МЕЖДУ &ДатаНач И &ДатаКон";
		
		Если ЗначениеЗаполнено(Подразделение) Тогда
			Запрос.Текст = Запрос.Текст + " И РеализацияТоваровУслуг.Подразделение = &Подразделение";
			Запрос.УстановитьПараметр("Подразделение",Подразделение);
		конецЕсли;	
	
	Запрос.УстановитьПараметр("ДатаКон",КонецДня(КонПериода) );
	Запрос.УстановитьПараметр("ДатаНач",НачПериода );
	
	РезультатЗапроса = Запрос.Выполнить();
    СписокДокументы.Загрузить(РезультатЗапроса.Выгрузить()); 	 
      	
КонецПроцедуры

Процедура СписокДокументыПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	Ячейки = ОформлениеСтроки.Ячейки;
	ЯчейкаКартинки = Ячейки.Картинка;
	ЯчейкаКартинки.ОтображатьТекст    = Ложь;
	ЯчейкаКартинки.ОтображатьФлажок   = Ложь;
	ЯчейкаКартинки.ОтображатьКартинку = Истина;
		Если ДанныеСтроки.ДокРеализация = Неопределено Тогда
		ЯчейкаКартинки.ИндексКартинки = 3;
	Иначе
		Если ДанныеСтроки.ДокРеализация.Проведен Тогда
			ЯчейкаКартинки.ИндексКартинки = 0;
		ИначеЕсли ДанныеСтроки.ДокРеализация.ПометкаУдаления Тогда
			ЯчейкаКартинки.ИндексКартинки = 1;
		Иначе
			ЯчейкаКартинки.ИндексКартинки = 2;
		КонецЕсли; 
	КонецЕсли; 
КонецПроцедуры

Процедура КоманднаяПанель1ЗаполнитьБезБУ(Кнопка)
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	РеализацияТоваровУслуг.Ссылка КАК ДокРеализация,
		|	РеализацияТоваровУслуг.Номер,
		|	РеализацияТоваровУслуг.Дата,
		|	РеализацияТоваровУслуг.Организация,
		|	РеализацияТоваровУслуг.ОтражатьВУправленческомУчете КАК ОтражатьУТ,
		|	РеализацияТоваровУслуг.ОтражатьВБухгалтерскомУчете КАК ОтражатьБУ,
		|	РеализацияТоваровУслуг.ОтражатьВНалоговомУчете КАК ОтражатьНУ,
		|	РеализацияТоваровУслуг.Подразделение,
		|	РеализацияТоваровУслуг.ДоговорКонтрагента КАК Договор,
		|	РеализацияТоваровУслуг.Контрагент,
		|	РеализацияТоваровУслуг.СуммаДокумента,
		|	РеализацияТоваровУслуг.Комментарий,
		|	РеализацияТоваровУслуг.Проверен
		|ИЗ
		|	Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
		|ГДЕ
		|	РеализацияТоваровУслуг.Дата МЕЖДУ &ДатаНач И &ДатаКон
		|	И НЕ РеализацияТоваровУслуг.ОтражатьВБухгалтерскомУчете";
		
		Если ЗначениеЗаполнено(Подразделение) Тогда
			Запрос.Текст = Запрос.Текст + " И РеализацияТоваровУслуг.Подразделение = &Подразделение";
			Запрос.УстановитьПараметр("Подразделение",Подразделение);
		конецЕсли;	

	
	Запрос.УстановитьПараметр("ДатаКон",КонецДня(КонПериода));
	Запрос.УстановитьПараметр("ДатаНач",НачПериода );
	
	РезультатЗапроса = Запрос.Выполнить();
    СписокДокументы.Загрузить(РезультатЗапроса.Выгрузить()); 
	
КонецПроцедуры

Процедура КоманднаяПанель2ЗаполнитьВсе(Кнопка)
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПеремещениеТоваров.Ссылка КАК ДокПеремещение,
		|	ПеремещениеТоваров.Номер,
		|	ПеремещениеТоваров.Дата,
		|	ПеремещениеТоваров.Организация,
		|	ПеремещениеТоваров.ОтражатьВУправленческомУчете КАК ОтражатьУУ,
		|	ПеремещениеТоваров.ОтражатьВБухгалтерскомУчете КАК ОтражатьБУ,
		|	ПеремещениеТоваров.ОтражатьВНалоговомУчете КАК ОтражатьНУ,
		|	ПеремещениеТоваров.Подразделение,
		|	ПеремещениеТоваров.Комментарий,
		|	ПеремещениеТоваров.СкладПолучатель,
		|	ПеремещениеТоваров.СкладОтправитель
		|ИЗ
		|	Документ.ПеремещениеТоваров КАК ПеремещениеТоваров
		|ГДЕ
		|	ПеремещениеТоваров.Дата МЕЖДУ &ДатаНач И &ДатаКон";
		
		Если ЗначениеЗаполнено(Подразделение) Тогда
			Запрос.Текст = Запрос.Текст + " и ПеремещениеТоваров.Подразделение = &Подразделение";
			Запрос.УстановитьПараметр("Подразделение",Подразделение);
		конецЕсли;	

	Запрос.УстановитьПараметр("ДатаКон",КонецДня(КонПериода) );
	Запрос.УстановитьПараметр("ДатаНач",НачПериода );
	
	РезультатЗапроса = Запрос.Выполнить();
    СписокПеремещения.Загрузить(РезультатЗапроса.Выгрузить()); 	
КонецПроцедуры

Процедура КоманднаяПанель2ЗаполнитьБезБУ(Кнопка)
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПеремещениеТоваров.Ссылка КАК ДокПеремещение,
		|	ПеремещениеТоваров.Номер,
		|	ПеремещениеТоваров.Дата,
		|	ПеремещениеТоваров.Организация,
		|	ПеремещениеТоваров.ОтражатьВУправленческомУчете КАК ОтражатьУУ,
		|	ПеремещениеТоваров.ОтражатьВБухгалтерскомУчете КАК ОтражатьБУ,
		|	ПеремещениеТоваров.ОтражатьВНалоговомУчете КАК ОтражатьНУ,
		|	ПеремещениеТоваров.Подразделение,
		|	ПеремещениеТоваров.Комментарий,
		|	ПеремещениеТоваров.СкладПолучатель,
		|	ПеремещениеТоваров.СкладОтправитель
		|ИЗ
		|	Документ.ПеремещениеТоваров КАК ПеремещениеТоваров
		|ГДЕ
		|	ПеремещениеТоваров.Дата МЕЖДУ &ДатаНач И &ДатаКон
		|	И НЕ ПеремещениеТоваров.ОтражатьВБухгалтерскомУчете";
	
		Если ЗначениеЗаполнено(Подразделение) Тогда
			Запрос.Текст = Запрос.Текст + " и ПеремещениеТоваров.Подразделение = &Подразделение";
			Запрос.УстановитьПараметр("Подразделение",Подразделение);
		конецЕсли;	
	Запрос.УстановитьПараметр("ДатаКон",КонецДня(КонПериода) );
	Запрос.УстановитьПараметр("ДатаНач",НачПериода );
	
	РезультатЗапроса = Запрос.Выполнить();
    СписокПеремещения.Загрузить(РезультатЗапроса.Выгрузить()); 	
КонецПроцедуры

Процедура СписокПеремещенияПриВыводеСтроки(Элемент, ОформлениеСтроки, ДанныеСтроки)
	Ячейки = ОформлениеСтроки.Ячейки;
	ЯчейкаКартинки = Ячейки.Картинка;
	ЯчейкаКартинки.ОтображатьТекст    = Ложь;
	ЯчейкаКартинки.ОтображатьФлажок   = Ложь;
	ЯчейкаКартинки.ОтображатьКартинку = Истина;
		Если ДанныеСтроки.ДокПеремещение = Неопределено Тогда
		ЯчейкаКартинки.ИндексКартинки = 3;
	Иначе
		Если ДанныеСтроки.ДокПеремещение.Проведен Тогда
			ЯчейкаКартинки.ИндексКартинки = 0;
		ИначеЕсли ДанныеСтроки.ДокПеремещение.ПометкаУдаления Тогда
			ЯчейкаКартинки.ИндексКартинки = 1;
		Иначе
			ЯчейкаКартинки.ИндексКартинки = 2;
		КонецЕсли; 
	КонецЕсли; 
КонецПроцедуры

Процедура НачПериодаПриИзменении(Элемент)
		ДатаЗапретаСп =  ПараметрыСеанса.ГраницыЗапретаИзмененияДанных.Получить();
		ДатаЗапрета = ДатаЗапретаСп.Получить(Справочники.Организации.НайтиПоКоду("00001")) ;
		 Если НачПериода < ДатаЗапрета Тогда         
			 НачПериода=ДатаЗапрета;
		конецЕсли;	
КонецПроцедуры

Процедура КоманднаяПанель1ОтобратьНал(Кнопка)
	
	Для Каждого Стр ИЗ СписокДокументы Цикл
		Если ЭлементыФормы.СписокДокументы.ПроверитьСтроку(стр) Тогда
			Если Найти(стр.Договор.Наименование,"*")<> 0 Тогда  
				Стр.Отметка = Истина;
			иначе
				Стр.Отметка = Ложь;
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

Процедура ОсновныеДействияФормыОтметитьПроверку(Кнопка)
	Ответ = Вопрос("Установить признак ПРОВЕРЕН для выбранных документов?",РежимДиалогаВопрос.ДаНет);
	Если Ответ = КодВозвратаДиалога.Да Тогда
	Если ЭлементыФормы.Панель1.ТекущаяСтраница.Имя = "Реализация" Тогда
		Для каждого стр из СписокДокументы Цикл
		Если Найти(стр.Договор.Наименование,"*") <> 0 и стр.Отметка Тогда
		 Объект = стр.ДокРеализация.ПолучитьОбъект();
		 Объект.Проверен = Истина;
		 Объект.Записать();
		 Стр.Проверен = Истина;
		конецЕсли; 
	 КонецЦикла;
    КонецЕсли; 
   конецЕсли;
КонецПроцедуры

Процедура КоманднаяПанель1Действие1(Кнопка)
	Если ЭлементыФормы.Панель1.ТекущаяСтраница.Имя = "Реализация" Тогда
     Для Каждого Стр ИЗ СписокДокументы Цикл
		Если ЭлементыФормы.СписокДокументы.ПроверитьСтроку(стр) Тогда
			Стр.Отметка = Истина;
		КонецЕсли;
     КонецЦикла;
    Иначе
	Для каждого стр из СписокПеремещения Цикл
		Если ЭлементыФормы.СписокПеремещения.ПроверитьСтроку(Стр) Тогда
			Стр.Отметка = Истина;
		КонецЕсли;
	 КонецЦикла;
    КонецЕсли; 
КонецПроцедуры

Процедура КоманднаяПанель1СнятьОтметки(Кнопка)
	Если ЭлементыФормы.Панель1.ТекущаяСтраница.Имя = "Реализация" Тогда
     Для Каждого Стр ИЗ СписокДокументы Цикл
		Если ЭлементыФормы.СписокДокументы.ПроверитьСтроку(стр) Тогда
			Стр.Отметка = Ложь;
		КонецЕсли;
     КонецЦикла;
    Иначе
	Для каждого стр из СписокПеремещения Цикл
		Если ЭлементыФормы.СписокПеремещения.ПроверитьСтроку(Стр) Тогда
			Стр.Отметка = Ложь;
		КонецЕсли;
	 КонецЦикла;
    КонецЕсли; 
КонецПроцедуры

Процедура КоманднаяПанель1ОтобратьДоговорыПеремещениеОТХ(Кнопка)

	Для Каждого Стр ИЗ СписокДокументы Цикл
		Если ЭлементыФормы.СписокДокументы.ПроверитьСтроку(Стр) Тогда
			Если Стр.Договор.ТипДоговора = Справочники.ТипыДоговоров.ПеремещениеОТХ Тогда  
				Стр.Отметка = Истина;
			Иначе
				Стр.Отметка = Ложь;
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры


